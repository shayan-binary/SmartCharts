!function(){var t,e="2019/01/01",i=["127.0.0.1","localhost","binary.com","binary.sx"];if(t=new Date(e).getTime()){var a=(new Date).getTime();if(t<=a)console.error("This license has expired!");else;}if("file:"!=document.location.protocol&&i&&i.length>0){for(var r=document.location.href,n=!1,s=0;s<i.length;s++)if(r.indexOf(i[s])>-1){n=!0;break}n||(alert("ERROR: Not licensed for domain "+r),console.error("ERROR: Not licensed for domain "+r))}}(),function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():e(t)}(this,function(_exports){var __drawing_=function(t){var e=t.CIQ,i=t.timezoneJS;return e.Drawing=function(){this.chartsOnly=!1,this.penDown=!1},e.Drawing.getDrawingParameters=function(t,i){var a;try{a=new e.Drawing[i]}catch(t){}if(!a)return null;a.stx=t,a.copyConfig();for(var r={},n=a.configs,s=0;s<n.length;s++)r[n[s]]=a[n[s]];var o=t.canvasStyle("stx_annotation");return o&&r.font&&(r.font.size=o.fontSize,r.font.family=o.fontFamily,r.font.style=o.fontStyle,r.font.weight=o.fontWeight),r},e.Drawing.initializeSettings=function(t,i){var a=e.Drawing[i];a&&(drawInstance=new a,drawInstance.initializeSettings&&drawInstance.initializeSettings(t))},e.Drawing.prototype.copyConfig=function(){e.Drawing.copyConfig(this)},e.Drawing.copyConfig=function(t){for(var i=t.configs,a=0;a<i.length;a++){var r=i[a],n=t.stx.currentVectorParameters;"color"==r?t.color=n.currentColor:"parameters"==r?t.parameters=n.fibonacci:"font"==r?t.font=e.clone(n.annotation.font):t[r]=n[r]}},e.Drawing.prototype.dragToDraw=!1,e.Drawing.prototype.permanent=!1,e.Drawing.prototype.chartsOnly=!1,e.Drawing.prototype.abort=function(t){},e.Drawing.prototype.measure=function(){},e.Drawing.prototype.construct=function(t,e){this.stx=t,this.panelName=e.name},e.Drawing.prototype.render=function(t){alert("must implement render function!")},e.Drawing.prototype.click=function(t,e,i){alert("must implement click function!")},e.Drawing.prototype.move=function(t,e,i){alert("must implement move function!")},e.Drawing.prototype.reposition=function(t,e,i,a){},e.Drawing.prototype.intersected=function(t,e,i){alert("must implement intersected function!")},e.Drawing.prototype.reconstruct=function(t,e){alert("must implement reconstruct function!")},e.Drawing.prototype.serialize=function(){alert("must implement serialize function!")},e.Drawing.prototype.adjust=function(){alert("must implement adjust function!")},e.Drawing.prototype.highlight=function(t){return t&&!this.highlighted?this.highlighted=t:!t&&this.highlighted&&(this.highlighted=t),this.highlighted},e.Drawing.prototype.littleCircleRadius=function(){return 6},e.Drawing.prototype.littleCircle=function(t,i,a,r){var n=this.stx.defaultColor,s=e.chooseForegroundColor(n);t.beginPath(),t.lineWidth=1,t.arc(i,a,this.littleCircleRadius(),0,2*Math.PI,!1),t.fillStyle=r?n:s,t.strokeStyle=n,t.fill(),t.stroke(),t.closePath()},e.Drawing.prototype.rotator=function(t,e,i,a){var r=this.littleCircleRadius(),n=this.stx.defaultColor;t.beginPath(),t.lineWidth=2,a||(t.globalAlpha=.5);var s=4+r;t.arc(e,i,s,0,3*Math.PI/2,!1),t.moveTo(e+2+s,i+2),t.lineTo(e+s,i),t.lineTo(e-2+s,i+2),t.moveTo(e-2,i+2-s),t.lineTo(e,i-s),t.lineTo(e-2,i-2-s),t.strokeStyle=n,t.stroke(),t.closePath(),t.globalAlpha=1},e.Drawing.prototype.mover=function(t,e,i,a){var r=this.littleCircleRadius(),n=this.stx.defaultColor,s=r+1;t.save(),t.lineWidth=2,t.strokeStyle=n,t.translate(e,i),a||(t.globalAlpha=.5);for(var o=0;o<4;o++)t.rotate(Math.PI/2),t.beginPath(),t.moveTo(0,s),t.lineTo(0,s+5),t.moveTo(-2,s+5-2),t.lineTo(0,s+5),t.lineTo(2,s+5-2),t.closePath(),t.stroke();t.globalAlpha=1,t.restore()},e.Drawing.prototype.resizer=function(t,e,i,a){var r=this.littleCircleRadius(),n=this.stx.defaultColor,s=5*Math.sqrt(2),o=r+1;t.save(),t.lineWidth=2,t.strokeStyle=n,t.translate(e,i),t.rotate(-e*i/Math.abs(e*i)*Math.PI/4),a||(t.globalAlpha=.5);for(var l=0;l<2;l++)t.rotate(Math.PI),t.beginPath(),t.moveTo(0,o),t.lineTo(0,o+s),t.moveTo(-2,o+s-2),t.lineTo(0,o+s),t.lineTo(2,o+s-2),t.closePath(),t.stroke();t.globalAlpha=1,t.restore()},e.Drawing.prototype.pointIntersection=function(t,e,i){return!!this.stx.panels[this.panelName]&&(t>=i.x0&&t<=i.x1&&e>=i.y1&&e<=i.y0)},e.Drawing.prototype.setPoint=function(t,i,a,r){var n,s=null,o=null;if("number"==typeof i?s=i:i.length>=8?o=i:s=Number(i),(a||0===a)&&(this["v"+t]=a),null!==s)n=this.stx.dateFromTick(s,r,!0),this["tzo"+t]=n.getTimezoneOffset(),this["d"+t]=e.yyyymmddhhmmssmmm(n),this["p"+t]=[s,a];else if(null!==o){n=e.strToDateTime(o),this["tzo"+t]||0===this["tzo"+t]||(this["tzo"+t]=n.getTimezoneOffset()),this["d"+t]=o;var l=this["tzo"+t]-n.getTimezoneOffset();n.setMinutes(n.getMinutes()+l);var h=!1;"freeform"==this.name||e.ChartEngine.isDailyInterval(this.stx.layout.interval)||n.getHours()||n.getMinutes()||n.getSeconds()||n.getMilliseconds()||(h=!0),this["p"+t]=[this.stx.tickFromDate(e.yyyymmddhhmmssmmm(n),r,null,h),a]}},e.Drawing.prototype.setLineColor=function(t){t||(t=this.color);var i=t;return("auto"==i||e.isTransparent(i))&&(i=this.stx.defaultColor),this.highlighted&&(i=this.stx.getCanvasColor("stx_highlight_vector")),i},e.Drawing.BaseTwoPoint=function(){this.p0=null,this.p1=null,this.color=""},e.Drawing.BaseTwoPoint.ciqInheritsFrom(e.Drawing),e.Drawing.BaseTwoPoint.prototype.configs=[],e.Drawing.BaseTwoPoint.prototype.lineIntersection=function(t,i,a,r){var n=this.p0,s=this.p1,o=(this.stx.layout,this.stx.panels[this.panelName]);return n&&s&&o&&e.boxIntersects(a.x0,a.y0,a.x1,a.y1,n[0],n[1],s[0],s[1],r,o.yAxis.semiLog)},e.Drawing.BaseTwoPoint.prototype.boxIntersection=function(t,e){return!(!this.p0||!this.p1)&&(!(t>Math.max(this.p0[0],this.p1[0])||t<Math.min(this.p0[0],this.p1[0]))&&!(e>Math.max(this.p0[1],this.p1[1])||e<Math.min(this.p0[1],this.p1[1])))},e.Drawing.BaseTwoPoint.prototype.accidentalClick=function(t,e){var i=this.stx.panels[this.panelName],a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(t,i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,t,e),o=Math.abs(r-a),l=Math.abs(s-n);if(Math.sqrt(o*o+l*l)<10)return this.penDown=!1,this.dragToDraw&&this.stx.undo(),!0},e.Drawing.BaseTwoPoint.prototype.click=function(t,e,i){this.copyConfig();var a=this.stx.panels[this.panelName];return this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.penDown=!1,!0):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.BaseTwoPoint.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart))},e.Drawing.BaseTwoPoint.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),this.p1=[e,i],this.render(t))},e.Drawing.BaseTwoPoint.prototype.measure=function(){this.p0&&this.p1&&this.stx.setMeasure(this.p0[1],this.p1[1],this.p0[0],this.p1[0],!0,this.name)},e.Drawing.BaseTwoPoint.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.setPoint(1,e.p1[0]-n,e.p1[1]-s,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.render(t))}},e.Drawing.annotation=function(){this.name="annotation",this.arr=[],this.w=0,this.h=0,this.padding=4,this.text="",this.ta=null,this.fontSize=0,this.font={}},e.Drawing.annotation.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.annotation.prototype.getFontString=function(){this.fontDef={style:null,weight:null,size:"12px",family:null};var t=this.stx.canvasStyle("stx_annotation");t&&(t.fontStyle&&(this.fontDef.style=t.fontStyle),t.fontWeight&&(this.fontDef.weight=t.fontWeight),t.fontSize&&(this.fontDef.size=t.fontSize),t.fontFamily&&(this.fontDef.family=t.fontFamily)),this.font.style&&(this.fontDef.style=this.font.style),this.font.weight&&(this.fontDef.weight=this.font.weight),this.font.size&&(this.fontDef.size=this.font.size),this.font.family&&(this.fontDef.family=this.font.family),this.fontString="";var e=!0;for(var i in this.fontDef)this.fontDef[i]&&(e?e=!1:this.fontString+=" ",this.fontString+=this.fontDef[i])},e.Drawing.annotation.prototype.configs=["color","font"],e.Drawing.annotation.prototype.measure=function(){},e.Drawing.annotation.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]);t.font=this.fontString,t.textBaseline="top";var r,n,s,o,l=i,h=a,c=this.w,u=this.h,p=this.setLineColor();if(this.stem)this.stem.d?(r=this.stx.pixelFromTick(this.stem.t),s=this.stx.pixelFromValueAdjusted(e,this.stem.t,this.stem.v),n=l+c/2,o=h+u/2):this.stem.x&&(r=l,s=h,n=(l+=this.stem.x)+c/2,o=(h+=this.stem.y)+u/2),t.beginPath(),this.borderColor?t.strokeStyle=this.borderColor:t.strokeStyle=p,t.moveTo(r,s),t.lineTo(n,o),t.stroke();this.highlighted?(this.stx.canvasColor("stx_annotation_highlight_bg",t),t.fillRect(l,h,c,u)):this.fillColor?(t.fillStyle=this.fillColor,t.fillRect(l,h,c,u)):this.stem&&(t.fillStyle=this.stx.containerColor,t.fillRect(l,h,c,u)),this.borderColor&&(t.beginPath(),t.strokeStyle=this.borderColor,t.rect(l,h,c,u),t.stroke()),this.highlighted?this.stx.canvasColor("stx_annotation_highlight",t):t.fillStyle=p,h+=this.padding;for(var d=0;d<this.arr.length;d++)t.fillText(this.arr[d],l+this.padding,h),h+=this.fontSize;t.textBaseline="alphabetic"}},e.Drawing.annotation.prototype.onChange=function(t){},e.Drawing.annotation.prototype.edit=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.controls.annotationSave,r=this.stx.controls.annotationCancel;if(a&&r){var n;this.stx.editingAnnotation=!0,this.stx.undisplayCrosshairs(),this.stx.openDialog="annotation",this.ta||(this.ta=document.createElement("TEXTAREA"),this.ta.className="stx_annotation",this.ta.onkeyup=m(this),this.ta.onmouseup=(n=this.stx,function(t){n.manageTouchAndMouse&&e.ChartEngine.drawingLine&&n.mouseup(t)}),this.ta.setAttribute("wrap","hard"),e.isIOS7or8&&this.ta.setAttribute("placeholder","Enter Text"),this.stx.chart.container.appendChild(this.ta),this.ta.style.position="absolute",this.ta.style.width="100px",this.ta.style.height="20px",(e.ipad||e.iphone)&&(this.ta.ontouchstart=function(t){t.stopPropagation()}));var s=this;if(this.ta.oninput=function(t){s.onChange(t)},this.ta.style.font=this.fontString,this.color)if("transparent"==this.color||"auto"==this.color){var o=getComputedStyle(this.ta);o&&e.isTransparent(o.backgroundColor)?this.ta.style.color=this.stx.defaultColor:this.ta.style.color="#000"}else this.ta.style.color=this.color;var l,h,c=this.stx.pixelFromTick(this.p0[0],i.chart),u=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]);if(this.ta.style.left=c+140<this.stx.chart.canvasRight?c+"px":this.stx.chart.canvasRight-200+"px",this.ta.style.top=u+60<this.stx.chart.canvasHeight?u+"px":u-60+"px","callout"==this.name&&(this.ta.style.left=c-(isNaN(this.w)?this.defaultWidth:this.w/2)+"px",this.ta.style.top=u-(isNaN(this.h)?this.defaultHeight:this.h/2)+"px"),a.style.display="inline-block",r.style.display="inline-block",e.safeClickTouch(a,(l=this,function(t){""!==l.ta.value&&(l.stx.editingAnnotation=!1,l.text=l.ta.value,l.adjust(),l.stx.addDrawing(l),l.stx.changeOccurred("vector"),l.stx.undo(),l.stx.cancelTouchSingleClick=!0)})),e.safeClickTouch(r,(h=this,function(t){h.stx.editingAnnotation=!1,h.stx.undo(),h.stx.cancelTouchSingleClick=!0})),m(this)(),this.ta.focus(),e.isAndroid&&!e.is_chrome){this.priorBottom=this.stx.chart.container.style.bottom;var p=this.stx.resolveY(u)+100;if(p>e.pageHeight()-400){var d=400-(e.pageHeight()-p);this.stx.chart.container.style.bottom=d+"px"}}}}function m(t){return function(i){if(i)switch(window.event?event.keyCode:i.keyCode){case 27:return void t.stx.undo()}var n=t.stx,s=t.ta,o=s.value.split("\n"),l=0;n.chart.context.font=t.fontString;for(var h=0;h<o.length;h++){var c=n.chart.context.measureText(o[h]).width;c>l&&(l=c)}var u=(o.length+1)*(t.fontSize+3);l<50&&(l=50),s.style.width=l+30+"px",s.style.height=u+"px";var p=parseInt(e.stripPX(s.style.top),10),d=e.stripPX(s.style.left);l=s.clientWidth,u=s.clientHeight,d+l+100<t.stx.chart.canvasWidth?(a.style.top=p+"px",r.style.top=p+"px",a.style.left=d+l+10+"px",r.style.left=d+l+60+"px"):p+u+30<t.stx.chart.canvasHeight?(a.style.top=p+u+10+"px",r.style.top=p+u+10+"px",a.style.left=d+"px",r.style.left=d+50+"px"):(a.style.top=p-35+"px",r.style.top=p-35+"px",a.style.left=d+"px",r.style.left=d+50+"px")}}},e.Drawing.annotation.prototype.click=function(t,e,i){if(!this.stx.overXAxis&&!this.stx.overYAxis){var a=this.stx.panels[this.panelName];return this.copyConfig(),this.setPoint(0,e,i,a.chart),this.adjust(),this.edit(t),!1}},e.Drawing.annotation.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.render(t)}},e.Drawing.annotation.prototype.intersected=function(t,i,a){var r=this.stx.panels[this.panelName];if(!this.p0)return null;var n=this.stx.pixelFromTick(this.p0[0],r.chart),s=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]),o=n+this.w,l=s+this.h;this.stem&&this.stem.x&&(n+=this.stem.x,o+=this.stem.x,s+=this.stem.y,l+=this.stem.y);var h=this.stx.pixelFromTick(t,r.chart),c=this.stx.pixelFromValueAdjusted(r,t,i);return h>=n&&h<=o&&c>=s&&c<=l&&(this.highlighted=!0,{p0:e.clone(this.p0),tick:t,value:i})},e.Drawing.annotation.prototype.abort=function(){var t=this.stx.controls.annotationSave,i=this.stx.controls.annotationCancel;t&&(t.style.display="none"),i&&(i.style.display="none"),this.ta&&this.stx.chart.container.removeChild(this.ta),this.ta=null,this.stx.openDialog="",this.stx.showCrosshairs(),this.stx.editingAnnotation=!1,e.clearCanvas(this.stx.chart.tempCanvas,this.stx),e.isAndroid&&!e.is_chrome&&(this.stx.chart.container.style.bottom=this.priorBottom),e.fixScreen()},e.Drawing.annotation.prototype.reconstruct=function(t,i){this.stx=t,this.color=i.col,this.panelName=i.pnl,this.d0=i.d0,this.tzo0=i.tzo0,this.v0=i.v0,this.text=t.escapeOnSerialize?decodeURIComponent(i.text):i.text,this.stem=i.stem,this.borderColor=i.bc,this.fillColor=i.bg,this.lineWidth=i.lw,this.pattern=i.ptrn,this.font=e.replaceFields(i.fnt,{st:"style",sz:"size",wt:"weight",fl:"family"}),this.font||(this.font={}),this.adjust()},e.Drawing.annotation.prototype.serialize=function(){var t={name:this.name,pnl:this.panelName,col:this.color,d0:this.d0,tzo0:this.tzo0,v0:this.v0,text:this.stx.escapeOnSerialize?encodeURIComponent(this.text):this.text};if(this.font){var i=e.removeNullValues(e.replaceFields(this.font,{style:"st",size:"sz",weight:"wt",family:"fl"}));e.isEmpty(i)||(t.fnt=i)}return this.stem&&(t.stem={d:this.stem.d,v:this.stem.v,x:this.stem.x,y:this.stem.y}),this.borderColor&&(t.bc=this.borderColor),this.fillColor&&(t.bg=this.fillColor),this.lineWidth&&(t.lw=this.lineWidth),this.pattern&&(t.ptrn=this.pattern),t},e.Drawing.annotation.prototype.renderText=function(){this.getFontString();var t=this.stx.panels[this.panelName];if(t){this.arr=this.text.split("\n");var i=0;this.stx.chart.context.font=this.fontString;for(var a=0;a<this.arr.length;a++){var r=this.stx.chart.context.measureText(this.arr[a]).width;r>i&&(i=r)}0===i&&(i=2*this.defaultWidth),this.fontSize=e.stripPX(this.fontDef.size);var n=this.arr.length*this.fontSize;e.touchDevice&&(n+=5),this.w=i+2*this.padding,this.h=n+2*this.padding;var s=this.stx.pixelFromTick(this.p0[0],t.chart)+i,o=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1])+n;this.p1=[this.stx.tickFromPixel(s,t.chart),this.stx.valueFromPixel(o,t)],this.stem&&this.stem.d&&(this.stem.t=this.stx.tickFromDate(this.stem.d,t.chart))}},e.Drawing.annotation.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.renderText())},e.Drawing.segment=function(){this.name="segment"},e.Drawing.segment.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.segment.prototype.render=function(t){var a=this.stx.panels[this.panelName];if(a){var r=this.stx.pixelFromTick(this.p0[0],a.chart),n=this.stx.pixelFromTick(this.p1[0],a.chart),s=this.stx.pixelFromValueAdjusted(a,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(a,this.p1[0],this.p1[1]),l=this.lineWidth,h=this.setLineColor(),c={pattern:this.pattern,lineWidth:l};if(this.stx.plotLine(r,n,s,o,h,this.name,t,a,c),this.axisLabel&&!this.repositioner)if("horizontal"==this.name){this.stx.endClip();var u=this.p0[1];a.chart.transformFunc&&(u=a.chart.transformFunc(this.stx,a.chart,u)),u=a.yAxis.priceFormatter?a.yAxis.priceFormatter(this.stx,a,u):this.stx.formatYAxisPrice(u,a),this.stx.createYAxisLabel(a,u,s,h),this.stx.startClip(a.name)}else if("vertical"==this.name&&this.p0[0]>=0&&!e.ChartEngine.hideDates()){var p,d;if(p=this.stx.dateFromTick(this.p0[0],a.chart,!0),e.ChartEngine.isDailyInterval(this.stx.layout.interval))p.setHours(0,0,0,0);else{var m=1e3*p.getSeconds()+p.getMilliseconds();this.stx.dataZone&&(d=new i.Date(p.getFullYear(),p.getMonth(),p.getDate(),p.getHours(),p.getMinutes(),this.stx.dataZone),p=new Date(d.getTime()+m)),this.stx.displayZone&&(d=new i.Date(p.getTime(),this.stx.displayZone),p=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes()),p=new Date(p.getTime()+m))}var g=e.mmddhhmm(e.yyyymmddhhmm(p));if(a.chart.xAxis.formatter)g=a.chart.xAxis.formatter(p);else if(this.stx.internationalizer){var f;0!==p.getHours()||0!==p.getMinutes()?(f=this.stx.internationalizer.monthDay.format(p),f+=" "+this.stx.internationalizer.hourMinute.format(p)):f=this.stx.internationalizer.yearMonthDay.format(p),g=f}this.stx.endClip(),this.stx.createXAxisLabel(a,g,r,h,null,!0),this.stx.startClip(a.name)}if(this.highlighted&&"horizontal"!=this.name&&"vertical"!=this.name){var y="p0"==this.highlighted,v="p1"==this.highlighted;this.littleCircle(t,r,s,y),this.littleCircle(t,n,o,v)}}},e.Drawing.segment.prototype.abort=function(){this.stx.setMeasure(null,null,null,null,!1)},e.Drawing.segment.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;if("horizontal"!=this.name&&"vertical"!=this.name&&"gartley"!=this.name){if(this.pointIntersection(this.p0[0],this.p0[1],a))return this.highlighted="p0",{action:"drag",point:"p0"};if(this.pointIntersection(this.p1[0],this.p1[1],a))return this.highlighted="p1",{action:"drag",point:"p1"}}return this.lineIntersection(t,i,a,this.name)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},e.Drawing.segment.prototype.configs=["color","lineWidth","pattern"],e.Drawing.segment.prototype.copyConfig=function(){e.Drawing.copyConfig(this),"none"==this.pattern&&(this.pattern="solid")},e.Drawing.segment.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.segment.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.continuous=function(){this.name="continuous",this.dragToDraw=!1,this.maxSegments=null},e.Drawing.continuous.ciqInheritsFrom(e.Drawing.segment),e.Drawing.continuous.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r){if(this.copyConfig(),!this.penDown)return this.setPoint(0,i,a,r.chart),this.penDown=!0,!1;if(this.accidentalClick(i,a))return this.stx.undo(),!0;this.setPoint(1,i,a,r.chart);var n=new(0,e.Drawing.segment),s=this.serialize(this.stx);return n.reconstruct(this.stx,s),this.stx.addDrawing(n),this.stx.changeOccurred("vector"),this.stx.draw(),this.segment++,this.maxSegments&&this.segment>this.maxSegments?!0:(this.setPoint(0,i,a,r.chart),!1)}},e.Drawing.line=function(){this.name="line"},e.Drawing.line.prototype.dragToDraw=!1,e.Drawing.line.ciqInheritsFrom(e.Drawing.segment),e.Drawing.line.prototype.calculateOuterSet=function(t){if(this.p0[0]!=this.p1[0]&&this.p0[1]!=this.p1[1]&&!e.ChartEngine.isDailyInterval(this.stx.layout.interval)){var i={x0:this.p0[0],y0:this.p0[1],x1:this.p1[0],y1:this.p1[1]};i.x0>i.x1&&(i={x0:this.p1[0],y0:this.p1[1],x1:this.p0[0],y1:this.p0[1]});var a=i.x0-1e3,r=i.x1+1e3;this.v0B=e.yIntersection(i,a),this.v1B=e.yIntersection(i,r),this.d0B=this.stx.dateFromTick(a,t.chart),this.d1B=this.stx.dateFromTick(r,t.chart)}},e.Drawing.line.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.calculateOuterSet(a),this.penDown=!1,!0):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.line.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.v0=e.v0,this.v1=e.v1,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,e.d0B&&(this.d0B=e.d0B,this.d1B=e.d1B,this.v0B=e.v0B,this.v1B=e.v1B),this.adjust()},e.Drawing.line.prototype.serialize=function(){var t={name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1};return this.d0B&&(t.d0B=this.d0B,t.d1B=this.d1B,t.v0B=this.v0B,t.v1B=this.v1B),t},e.Drawing.line.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),e.ChartEngine.isDailyInterval(this.stx.layout.interval)&&this.d0B&&(this.setPoint(0,this.d0B,this.v0B,t.chart),this.setPoint(1,this.d1B,this.v1B,t.chart)))},e.Drawing.ray=function(){this.name="ray"},e.Drawing.ray.ciqInheritsFrom(e.Drawing.line),e.Drawing.ray.prototype.calculateOuterSet=function(t){if(this.p0[0]!=this.p1[0]&&this.p0[1]!=this.p1[1]&&!e.ChartEngine.isDailyInterval(this.stx.layout.interval)){var i={x0:this.p0[0],y0:this.p0[1],x1:this.p1[0],y1:this.p1[1]},a=i.x1+1e3;i.x0>i.x1&&(a=i.x1-1e3),this.v0B=this.v0,this.v1B=e.yIntersection(i,a),this.d0B=this.d0,this.d1B=this.stx.dateFromTick(a,t.chart)}},e.Drawing.ray.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),e.ChartEngine.isDailyInterval(this.stx.layout.interval)&&this.d0B&&this.setPoint(1,this.d1B,this.v1B,t.chart))},e.Drawing.horizontal=function(){this.name="horizontal"},e.Drawing.horizontal.prototype.dragToDraw=!1,e.Drawing.horizontal.ciqInheritsFrom(e.Drawing.segment),e.Drawing.horizontal.prototype.measure=function(){},e.Drawing.horizontal.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.setPoint(0,e,i,a.chart),!0},e.Drawing.horizontal.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.v0=e.v0,this.d0=e.d0,this.tzo0=e.tzo0,this.axisLabel=e.al,this.adjust()},e.Drawing.horizontal.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,v0:this.v0,d0:this.d0,tzo0:this.tzo0,al:this.axisLabel}},e.Drawing.horizontal.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=[this.p0[0]+100,this.p0[1]])},e.Drawing.horizontal.prototype.configs=["color","lineWidth","pattern","axisLabel"],e.Drawing.horizontal.prototype.copyConfig=function(){e.Drawing.copyConfig(this),"none"==this.pattern&&(this.pattern="solid")},e.Drawing.vertical=function(){this.name="vertical"},e.Drawing.vertical.ciqInheritsFrom(e.Drawing.horizontal),e.Drawing.vertical.prototype.measure=function(){},e.Drawing.vertical.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=[this.p0[0],this.p0[1]+1])},e.Drawing.measure=function(){this.name="measure"},e.Drawing.measure.ciqInheritsFrom(e.Drawing.segment),e.Drawing.measure.prototype.click=function(t,e,i){return this.copyConfig(),this.penDown?(this.stx.undo(),this.penDown=!1,!0):(this.p0=[e,i],this.penDown=!0,!1)},e.Drawing.rectangle=function(){this.name="rectangle"},e.Drawing.rectangle.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.rectangle.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=Math.round(Math.min(a,r))+.5,l=Math.min(n,s),h=Math.max(a,r)-o,c=Math.max(n,s)-l,u=this.color;this.highlighted&&(u=this.stx.getCanvasColor("stx_highlight_vector"));var p=this.fillColor;p&&!e.isTransparent(p)&&"auto"!=p&&(t.beginPath(),t.rect(o,l,h,c),t.fillStyle=p,t.globalAlpha=.2,t.fill(),t.closePath(),t.globalAlpha=1);var d={pattern:this.pattern,lineWidth:this.lineWidth};if(this.highlighted&&"none"==d.pattern&&(d.pattern="solid",.1==d.lineWidth&&(d.lineWidth=1)),this.stx.plotLine(a,r,n,n,u,"segment",t,i,d),this.stx.plotLine(r,r,n-.5,s+.5,u,"segment",t,i,d),this.stx.plotLine(r,a,s,s,u,"segment",t,i,d),this.stx.plotLine(a,a,s+.5,n-.5,u,"segment",t,i,d),this.highlighted){var m="p0"==this.highlighted,g="p1"==this.highlighted;this.littleCircle(t,a,n,m),this.littleCircle(t,r,s,g)}}},e.Drawing.rectangle.prototype.intersected=function(t,i,a){return this.p0&&this.p1?this.pointIntersection(this.p0[0],this.p0[1],a)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(this.p1[0],this.p1[1],a)?(this.highlighted="p1",{action:"drag",point:"p1"}):this.boxIntersection(t,i)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null:null},e.Drawing.rectangle.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.rectangle.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.rectangle.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.ellipse=function(){this.name="ellipse"},e.Drawing.ellipse.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.ellipse.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=a-(r-a),l=r,h=n,c=s,u=n-(s-n),p=(c-u)/6,d=this.lineWidth;d||(d=1.1);var m=this.color;("auto"==m||e.isTransparent(m))&&(m=this.stx.defaultColor),this.highlighted&&(m=this.stx.getCanvasColor("stx_highlight_vector"),.1==d&&(d=1.1));var g=this.fillColor;if(t.beginPath(),t.moveTo(o,h),t.bezierCurveTo(o,c+p,l,c+p,l,h),t.bezierCurveTo(l,u-p,o,u-p,o,h),g&&!e.isTransparent(g)&&"auto"!=g&&(t.fillStyle=g,t.globalAlpha=.2,t.fill(),t.globalAlpha=1),m&&"none"!=this.pattern&&(t.strokeStyle=m,t.lineWidth=d,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(d,this.pattern)),t.lineDashOffset=0),t.stroke()),t.closePath(),this.highlighted){var f="p1"==this.highlighted;this.littleCircle(t,r,s,f)}}},e.Drawing.ellipse.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;if(this.pointIntersection(this.p1[0],this.p1[1],a))return this.highlighted="p1",{action:"drag",point:"p1"};var r=this.p0[0]-(this.p1[0]-this.p0[0]),n=this.p1[0],s=this.p1[1],o=this.p0[1]-(this.p1[1]-this.p0[1]);return!(t>Math.max(r,n)||t<Math.min(r,n))&&(!(i>Math.max(o,s)||i<Math.min(o,s))&&(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}))},e.Drawing.ellipse.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.ellipse.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.ellipse.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.fibonacci=function(){this.name="fibonacci",this.configurator="fibonacci"},e.Drawing.fibonacci.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.fibonacci.mapping={trend:"t",color:"c",parameters:"p",pattern:"pt",opacity:"o",lineWidth:"lw",level:"l",extendLeft:"e",printLevels:"pl",printValues:"pv",timezone:"tz",display:"d"},e.Drawing.fibonacci.prototype.recommendedLevels=[-.618,-.382,0,.382,.5,.618,1,1.382,1.618],e.Drawing.fibonacci.prototype.configs=["color","fillColor","lineWidth","pattern","parameters"],e.Drawing.fibonacci.prototype.initializeSettings=function(t){var e=this.recommendedLevels;if(e){var i=t.currentVectorParameters.fibonacci.fibs;for(var a in i)for(var r in delete i[a].display,e)i[a].level==e[r]&&(i[a].display=!0)}},e.Drawing.fibonacci.prototype.setOuter=function(){this.outer={p0:e.clone(this.p0),p1:e.clone(this.p1)};for(var t=this.p0[1],i=this.p1[1],a=this.p0[0],r=this.p1[0],n=0,s=1,o=0;o<this.parameters.fibs.length;o++){var l=this.parameters.fibs[o];if(!(l.level>=n&&l.level<=s)&&l.display){var h=i-(i-t)*l.level,c=e.xIntersection({x0:a,x1:r,y0:t,y1:i},h);l.level<n?(n=l.level,this.outer.p1[1]=h,this.outer.p1[0]=c):l.level>s&&(s=l.level,this.outer.p0[1]=h,this.outer.p0[0]=c)}}},e.Drawing.fibonacci.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r)return this.copyConfig(),this.penDown?this.accidentalClick(i,a)?this.dragToDraw:(this.setPoint(1,i,a,r.chart),this.setOuter(),this.parameters=e.clone(this.parameters),this.penDown=!1,!0):(this.setPoint(0,i,a,r.chart),this.penDown=!0,!1)},e.Drawing.fibonacci.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=Math.max(this.p0[1],this.p1[1]),n=Math.min(this.p0[1],this.p1[1]),s=r-n,o=this.stx.pixelFromTick(this.p0[0],i.chart),l=this.stx.pixelFromTick(this.p1[0],i.chart),h=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),c=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),u=Math.min(c,h),p=Math.max(c,h),d=p-u,m=(c-h)/(l-o)>0;this.parameters.trend||(this.parameters.trend={color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}});var g=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var f=t.measureText("161.8%").width+10,y=Number.MAX_VALUE,v=Number.MAX_VALUE,x=-1*Number.MAX_VALUE,b=-1*Number.MAX_VALUE,C=this.color;("auto"==C||e.isTransparent(C))&&(C=this.stx.defaultColor);for(var S=0;S<this.parameters.fibs.length;S++){t.textAlign="left",t.fillStyle=C;var w=this.parameters.fibs[S];if(w.display){var T=this.stx.pixelFromValueAdjusted(i,this.p0[0],c<h?r-s*w.level:n+s*w.level),M=e.xIntersection({x0:o,x1:l,y0:h,y1:c},T),D=this.parameters.extendLeft?0:M,E=i.left+i.width;if(this.parameters.printLevels){var A=Math.round(1e3*w.level)/10+"%";E-=f,this.parameters.printValues&&(t.fillStyle=C,this.stx.canvasFont("stx_yaxis",t)),E<D&&(t.textAlign="right"),t.fillText(A,E,T),E<D?E+=5:E-=5}if(this.parameters.printValues&&M<i.width){var k=this.stx.transformedPriceFromPixel(T,i);k=a.priceFormatter?a.priceFormatter(this.stx,i,k):this.stx.formatYAxisPrice(k,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,k,T,C,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var F=w.color;("auto"==F||e.isTransparent(F))&&(F=this.color),("auto"==F||e.isTransparent(F))&&(F=this.stx.defaultColor);var _=w.color;("auto"==_||e.isTransparent(_))&&(_=this.fillColor),("auto"==_||e.isTransparent(_))&&(_=this.stx.defaultColor),t.fillStyle=_,this.stx.plotLine(D,E,T,T,F,"segment",t,i,w.parameters),t.globalAlpha=.05,t.beginPath(),t.moveTo(E,T),t.lineTo(D,T),D?t.lineTo(l,c):t.lineTo(D,c),t.lineTo(E,c),void 0!==_&&t.fill(),t.globalAlpha=1,T<v&&(y=M,v=T),T>b&&(x=M,b=T)}}for(var P in{0:0,1:1}){var L=m?p-d*P:u+d*P;(L=Math.round(L))<v&&(y=e.xIntersection({x0:o,x1:l,y0:h,y1:c},L),v=L),L>b&&(x=e.xIntersection({x0:o,x1:l,y0:h,y1:c},L),b=L)}if(this.stx.plotLine(y,x,v,b,g,"segment",t,i,this.parameters.trend.parameters),this.highlighted){var O="p0"==this.highlighted,N="p1"==this.highlighted;this.littleCircle(t,o,h,O),this.littleCircle(t,l,c,N)}}}},e.Drawing.fibonacci.prototype.reposition=function(t,i,a,r){i&&(e.Drawing.BaseTwoPoint.prototype.reposition.apply(this,arguments),this.adjust())},e.Drawing.fibonacci.prototype.intersected=function(t,i,a){var r=this.p0,n=this.p1,s=this.outer,o=(this.stx.layout,this.stx.panels[this.panelName]);return r&&n&&o&&e.boxIntersects(a.x0,a.y0,a.x1,a.y1,s.p0[0],s.p0[1],s.p1[0],s.p1[1],"segment",o.yAxis.semiLog)?this.pointIntersection(r[0],r[1],a)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(n[0],n[1],a)?(this.highlighted="p1",{action:"drag",point:"p1"}):(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(n),tick:t,value:i}):null},e.Drawing.fibonacci.prototype.reconstruct=function(t,i){i=e.replaceFields(i,e.reverseObject(e.Drawing.fibonacci.mapping)),this.stx=t,this.parameters=i.parameters,this.parameters||(this.parameters=e.clone(this.stx.currentVectorParameters.fibonacci)),this.color=i.col,this.fillColor=i.fc,this.panelName=i.pnl,this.d0=i.d0,this.d1=i.d1,this.d2=i.d2,this.tzo0=i.tzo0,this.tzo1=i.tzo1,this.tzo2=i.tzo2,this.v0=i.v0,this.v1=i.v1,this.v2=i.v2,this.adjust()},e.Drawing.fibonacci.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setOuter())},e.Drawing.fibonacci.prototype.serialize=function(){var t={name:this.name,parameters:this.parameters,pnl:this.panelName,col:this.color,fc:this.fillColor,d0:this.d0,d1:this.d1,d2:this.d2,tzo0:this.tzo0,tzo1:this.tzo1,tzo2:this.tzo2,v0:this.v0,v1:this.v1,v2:this.v2};return e.replaceFields(t,e.Drawing.fibonacci.mapping)},e.Drawing.retracement=function(){this.name="retracement"},e.Drawing.retracement.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.getDrawingToolList=function(t){var i={},a={ciqInheritsFrom:!0,stxInheritsFrom:!0,copyConfig:!0,getDrawingParameters:!0,getDrawingToolList:!0,initializeSettings:!0,BaseTwoPoint:!0,shape:!0};for(var r in e.extend(a,t),e.Drawing)a[r]||(i[(new e.Drawing[r]).name]=r);return i},t},__i18n_=function(t){var e=t.CIQ,i=t.$$;return e.I18N=function(){},e.I18N.hereDoc=function(t){return t.toString().replace(/^[^/]+\/\*!?/,"").replace(/\*\/[^/]+$/,"")},e.I18N.language="en",e.I18N.longMonths={zh:!0},e.I18N.reverseColorsByLocale={zh:!0,ja:!0},e.I18N.findAllTextNodes=function(t){if(t||(t=document.body),t==document.body&&!i("stashedTextNodes")){var a=document.createElement("div");a.id="stashedTextNodes",a.style.display="none",t.appendChild(a);for(var r=document.querySelectorAll("input,textarea,.editable_content"),n=0;n<r.length;n++){var s=r[n].getAttribute("placeholder");if(s){var o=a.appendChild(document.createElement("translate"));o.setAttribute("original",s),o.placeholderFor=r[n],o.appendChild(document.createTextNode(s))}}}for(var l=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1),h=l.nextNode(),c=new RegExp("^\\s*$"),u=new RegExp("\n|\t|\f","g"),p={},d={SCRIPT:!0,STYLE:!0,TEXTAREA:!0};h;){var m=h.nodeValue;if(!c.test(m)){var g=h.parentNode,f=g.tagName;if(!d[f]){if("TRANSLATE"!=f){var y=g.insertBefore(document.createElement("translate"),h);y.setAttribute("original",m),y.appendChild(h)}else m=g.getAttribute("original");u.test(m)&&(m=m.replace(u,"")),p[m]||(p[m]=[]),p[m].push(h)}}h=l.nextNode()}if(t==document.body){var v=e.Studies?e.Studies.studyLibrary:null;if(v)for(var x in v){null===p[x]&&(p[x]=[]);var b=v[x];if(b.inputs)for(var C in b.inputs)p[C]||(p[C]=[]);if(b.outputs)for(var S in b.outputs)p[S]||(p[S]=[])}}return p},e.I18N.missingWordList=function(t){t||(t=e.I18N.language);var i=e.I18N.findAllTextNodes(),a={},r=e.I18N.wordLists[t];r||(r={});var n,s,o=function(t){void 0===r[t]&&(a[t]="")};for(var l in i)o(l);if(!e.Studies||!e.Studies.studyLibrary)return a;for(var h in e.Studies.studyLibrary){for(var c in o((n=e.Studies.studyLibrary[h]).name),n.inputs)switch(o(c),s=n.inputs[c],Object.prototype.toString.call(s)){case"[object String]":o(s);break;case"[object Array]":for(var u=0;u<s.length;++u)o(s[u])}for(var p in n.outputs)o(p)}return o("Show Zones"),o("OverBought"),o("OverSold"),a},e.I18N.printableMissingWordList=function(t){var i=JSON.stringify(e.I18N.missingWordList(t));return i=i.replace(/","/g,'",\n"')},e.I18N.translateUI=function(t,i){if("pu"==t&&(t="pt"),e.I18N.wordLists){t||(t=e.I18N.language);var a=e.I18N.findAllTextNodes(i),r=e.I18N.wordLists[t];if(r)for(var n in a)for(var s=e.I18N.translateSections(n,r),o=a[n],l=0;l<o.length;l++){var h=o[l],c=h.parentNode,u=c.getAttribute("original");","!==s&&s||(s=u);var p=c.placeholderFor;p?p.placeholder=s:h.data=s}}},e.I18N.translate=function(t,i){if(i||(i=e.I18N.language),!e.I18N.wordLists)return console.log("Must include translations.js in order to use CIQ.I18N.translate()"),t;var a=e.I18N.wordLists[i],r=null;return a&&(r=e.I18N.translateSections(t,a)||t),","===r?t:r},e.I18N.translateSections=function(t,e){if("string"==typeof t&&-1!=t.indexOf("‌")){var i=(t=t.replace(/([(),])/g,"‌$1‌")).split("‌");return i.forEach(function(t,i,a){var r=t.match(/^(\s*).*\S(\s*)$/),n=e[t.trim()];n&&(r&&(n=r[1]+n+r[2]),a[i]=n)}),i.join("")}return e[t]},e.I18N.convertCSV=function(t){var i=new RegExp("[“”]|[‘’]","g"),a=new RegExp('^("+)|("(?="))',"g"),r=e.I18N.wordLists;t||(t=e.I18N.csv);for(var n=t.split("\n"),s=n[0].split(","),o=0;o<s.length;o++){var l=s[o];r[l]||(r[l]={})}for(var h=1;h<n.length;h++){var c=n[h].match(/(".*?"|[^",]+)(?=\s*,|\s*$)|(,(?=,))/g)||[],u=c[0];a.test(u)&&(u=u.replace(a,"")),i.test(u)&&(u=u.replace(i,'"'));for(var p=1;p<c.length;p++){var d=c[p];a.test(d)&&(d=d.replace(a,"")),r[s[p]][u]=d}}},e.I18N.setLanguage=function(t,i,a,r,n){"pu"==i&&(i="pt"),e.I18N.convertCSV(r),e.I18N.language=i,e.I18N.translateUI(i,n),a||(a=e.I18N.translate),t.translationCallback=a},e.I18N.setLocale=function(t,e,i,a,r){if(!Intl.__addLocaleData)return t.setLocale(e,r),void(i&&i(null));var n=(a=void 0===a?"locale-data/jsonp":a)+"/"+e+".js",s=document.createElement("SCRIPT");s.async=!0,s.src=n;var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(s,o.nextSibling),s.onload=function(){t.setLocale(e,r),i&&i(null)},s.onerror=function(){i&&i("cannot load script")}},e.I18N.createMonthArrays=function(t,i,a){t.monthAbv=[],t.monthLetters=[];var r=new Date,n=!0;e.I18N.longMonths&&e.I18N.longMonths[a]&&(n=!1);for(var s=0;s<12;s++){r.setDate(1),r.setMonth(s);var o=i.format(r);if(n){for(var l="",h=0;h<o.length;h++){var c=o.charAt(h);c.charCodeAt(0)<65||(l+=c)}t.monthAbv[s]=l,t.monthLetters[s]=l[0]}else t.monthAbv[s]=o,t.monthLetters[s]=o}},e.I18N.localize=function(t,e){var i=t.locale,a=this.reverseColorsByLocale[e],r=this.reverseColorsByLocale[i];this.setLocale(t,e),this.setLanguage(t,e),a&&r||(a||r)&&this.reverseCandles(t)},e.I18N.reverseCandles=function(t){var e=t.styles,i=t.cloneStyle(e.stx_candle_down),a=t.cloneStyle(e.stx_candle_up);e.stx_candle_up=i,e.stx_candle_down=a},t},__markers_=function(t){var e=t.CIQ;return e.ChartEngine.prototype.makeMarkerHelper=function(){this.markerHelper={chartMap:{},classMap:{}}},e.ChartEngine.prototype.addToHolder=function(t){var i=this.panels[t.params.panelName];if(i){e.derivedFrom(t.params.node,e.Marker.NodeCreator)?(t.stxNodeCreator=t.params.node,t.node=t.stxNodeCreator.node):t.node=t.params.node,this.markerHelper||this.makeMarkerHelper(),t.params.chartContainer?this.container.appendChild(t.node):t.params.includeAxis?i.holder.appendChild(t.node):i.subholder.appendChild(t.node);var a=t.params.label;this.markers[a]||(this.markers[a]=[]),this.markers[a].push(t),t.chart=i.chart,this.markerHelper.chartMap[t.chart.name]||(this.markerHelper.chartMap[t.chart.name]={dataSetLength:0,markers:[]}),this.markerHelper.chartMap[t.chart.name].markers.push(t),t.className||console.log("Marker objects must have a member className");var r=this.markerHelper.classMap[t.className];r||(r=this.markerHelper.classMap[t.className]={}),r[t.params.panelName]||(r[t.params.panelName]=[]),r[t.params.panelName].push(t),this.setMarkerTick(t)}},e.ChartEngine.prototype.getMarkerArray=function(t,e){var i=[];for(var a in this.markers)for(var r=0;r<this.markers[a].length;r++){var n=this.markers[a][r];"panelName"==t?n.params.panelName==e&&i.push(n):"label"==t?a==e&&i.push(n):"all"==t&&i.push(n)}return i},e.ChartEngine.prototype.removeFromHolder=function(t){var e=this.panels[t.params.panelName];e&&(t.node.parentNode==e.holder?e.holder.removeChild(t.node):t.node.parentNode==e.subholder?e.subholder.removeChild(t.node):t.node.parentNode==this.container&&this.container.removeChild(t.node));var i=this.markers[t.params.label];if(i){var a;for(a=0;a<i.length;a++)if(i[a]===t){i.splice(a,1);break}var r=this.markerHelper.chartMap[t.chart.name];if(r)for(a=0;a<r.markers.length;a++)if(r.markers[a]===t){r.markers.splice(a,1);break}var n=this.markerHelper.classMap[t.className];if(n){var s=n[t.params.panelName];if(s)for(a=0;a<s.length;a++)if(s[a]===t){s.splice(a,1);break}}}},e.ChartEngine.prototype.moveMarkers=function(t,e){for(var i=this.getMarkerArray("panelName",t),a=0;a<i.length;a++)i[a].params.panelName=e;for(var r in this.markerHelper.classMap){var n=this.markerHelper.classMap[r][t];n&&(this.markerHelper.classMap[r][e]=n,delete this.markerHelper.classMap[r][t])}},e.ChartEngine.prototype.establishMarkerTicks=function(){this.markerHelper||this.makeMarkerHelper();var t=this.markerHelper.chartMap;for(var e in t){var i=t[e];if(i.dataSetLength!=this.charts[e].dataSet.length)for(var a=0;a<i.markers.length;a++)this.setMarkerTick(i.markers[a])}},e.ChartEngine.prototype.futureTickIfDisplayed=function(t){var e=t.chart;if(!(e.dataSet.length<1)){var i=e.xaxis[e.xaxis.length-1].DT;if(i=new Date(i.getTime()-6e4*this.timeZoneOffset),!(t.params.x>i))for(var a,r,n=e.maxTicks-e.dataSegment.length,s=e.dataSet.length+n,o=new Date(+e.dataSet[e.dataSet.length-1].DT),l=this.standardMarketIterator(o,null,e),h=t.params.x.getTime(),c=e.dataSet.length;c<s;c++){if(a=o.getTime(),(r=(o=l.next()).getTime())==h)return void(t.tick=c);if(r>h&&a<h)return void(t.tick=Math.max(c-1,0))}}},e.ChartEngine.prototype.setMarkerTick=function(t){var e=t.chart;if("master"==t.params.xPositioner&&t.params.x)t.tick=Math.floor(t.params.x/this.layout.periodicity);else if("date"==t.params.xPositioner&&t.params.x){for(var i,a,r=t.params.x.getTime(),n=0;n<e.dataSet.length;n++){if(i=a=e.dataSet[n].DT.getTime(),n>0&&(i=e.dataSet[n-1].DT.getTime()),a==r)return void(t.tick=n);if(a>r&&i<r)return void(t.tick=Math.max(n-1,0));if(r<a)return void(t.tick=null)}if(e.dataSet.length<1)return;new Date(+e.dataSet[n-1].DT).getTime()<r&&(t.params.future=!0),t.tick=null}},e.ChartEngine.prototype.positionMarkers=function(){var t=this;function e(){if(!t.runPrepend("positionMarkers",arguments)){for(var e in t.markerTimeout=null,t.markerHelper.classMap)for(var i in t.markerHelper.classMap[e]){var a=t.markerHelper.classMap[e][i],r=t.panels[i];if(a.length){var n={stx:t,arr:a,panel:r};n.firstTick=r.chart.dataSet.length-r.chart.scroll,n.lastTick=n.firstTick+r.chart.dataSegment.length;var s=a[0].constructor.placementFunction;s?s(n):t.defaultMarkerPlacement(n)}}t.runAppend("positionMarkers",arguments)}}t.markerHelper&&(this.markerDelay||0===this.markerDelay?this.markerTimeout||(this.markerTimeout=setTimeout(e,this.markerDelay)):e())},e.Marker=function(t){this.params={xPositioner:"date",yPositioner:"value",panelName:"chart",permanent:!1,label:"generic",includeAxis:!1},e.extend(this.params,t),this.params.node||(this.params.node=document.createElement("DIV")),this.params.stx?(this.className||(this.className="CIQ.Marker"),this.params.stx.addToHolder(this)):console.log("Marker created without specifying stx")},e.Marker.prototype.remove=function(){this.params.stx.removeFromHolder(this)},e.Marker.prototype.render=function(){var t=[this],e={stx:this.params.stx,arr:t,panel:this.params.stx.panels[this.params.panelName],showClass:this.showClass};this.constructor.placementFunction(e)},e.Marker.removeByLabel=function(t,e){for(var i=t.getMarkerArray("label",e),a=0;a<i.length;a++)t.removeFromHolder(i[a])},e.Marker.positionContentVerticalAndHorizontal=function(t){var e=t.querySelectorAll(".stx-marker-expand")[0];if(e){var i=e.offsetWidth,a=e.offsetHeight;if(!i||!a)return;var r=e.style;r.left=r.right="",r.bottom=r.top="";var n=getComputedStyle(e).left,s=getComputedStyle(e).bottom,o=getComputedStyle(e).height,l=t.offsetLeft+parseInt(n,10),h=parseInt(s,10),c=parseInt(o,10),u=t.offsetTop+h-c,p=t.parentNode.offsetWidth,d=t.parentNode.offsetHeight;l+i>p&&(r.right=n,r.left="auto"),t.offsetTop-c<d&&(t.offsetTop-t.offsetHeight<0?(r.top=s,r.bottom="auto"):u+a>d&&(r.top="auto",r.bottom=3*h+"px"))}},e.ChartEngine.prototype.getBarBounds=function(t){var e;this.layout.chartType;return e="pandf"==this.layout.aggregationType?{high:Math.max(t.pfOpen,t.pfClose),low:Math.min(t.pfOpen,t.pfClose)}:{high:t.High,low:t.Low},t.markerHigh&&(e.high=markerHigh),t.markerLow&&(e.low=markerLow),e},e.ChartEngine.prototype.defaultMarkerPlacement=function(t){var i=t.panel,a=t.yAxis?t.yAxis:t.panel.yAxis,r=i.chart,n=t.stx,s=n.chart.highLowBars||n.highLowBars[n.layout.chartType],o=r.defaultPlotField;o&&!s||(o="Close");for(var l={},h=0;h<t.arr.length;h++){var c=t.arr[h],u=c.params,p=c.node;c.clientWidth||(c.clientWidth=p.clientWidth),c.clientHeight||(c.clientHeight=p.clientHeight);var d=null,m=u.xPositioner,g=u.yPositioner,f=c.tick,y=r.dataSet,v=c.clientWidth;if("none"!=m){if("bar"==m&&u.x){if(u.x<r.xaxis.length){var x=r.xaxis[u.x];x&&(d=x.data)}p.style.left=Math.round(n.pixelFromBar(u.x,r)-v/2)+1+"px"}else{if(!f&&0!==f){if(!(u.future&&r.scroll<r.maxTicks)){p.style.left="-1000px";continue}if(n.futureTickIfDisplayed(c),!(f=c.tick)&&0!==f){p.style.left="-1000px";continue}}if(f<y.length&&(d=y[f]),c.leftpx=Math.round(n.pixelFromTick(f,r)-r.left-v/2),c.rightEdge=c.leftpx+v,p.style.left=c.leftpx+"px",f<t.firstTick&&c.rightEdge<r.left-50)continue}d||(d=y[y.length-1])}else if(g.indexOf("candle")>-1&&(left=getComputedStyle(p).left,left)){var b=n.barFromPixel(parseInt(left,10),r);b>=0&&((d=r.xaxis[b].data)||(d=y[y.length-1]))}var C,S=u.y,w=p.clientHeight;if("none"!=g){var T,M=u.chartContainer?n.height:i.yAxis.bottom,D=0;void 0===l[p.style.left]&&(l[p.style.left]=0),T=l[p.style.left],l[p.style.left]+=w,"value"==g&&S?D=Math.round(M-n.pixelFromPrice(S,i,a)-w/2)+"px":"under_candle"==g&&d?(C=d[o],s&&(C=n.getBarBounds(d).low),D=Math.round(M-n.pixelFromPrice(C,i,a)-w-T)+"px"):"on_candle"==g&&d?(C=d[o],s&&(C=(d.Low+d.High)/2),D=Math.round(M-n.pixelFromPrice(C,i,a)-w/2-T)+"px"):"top"==g?D=Math.round(M-w-T)+"px":"bottom"==g?D=Math.round(T)+"px":d&&(C=d[o],s&&(C=n.getBarBounds(d).high),D=Math.round(M-n.pixelFromPrice(C,i,a)+T)+"px"),p.style.bottom!=D&&(p.style.bottom=D)}e.Marker.positionContentVerticalAndHorizontal(p)}},e.Marker.NodeCreator=function(){},e.Marker.NodeCreator.toNode=function(){return this.node},e.Marker.Simple=function(t){var i=this.node=document.createElement("div");i.className="stx-marker",e.appendClassName(i,t.type),t.category&&e.appendClassName(i,t.category);var a,r=e.newChild(i,"div","stx-visual");if(e.newChild(i,"div","stx-stem"),"callout"==t.type){var n=e.newChild(r,"div","stx-marker-content");e.newChild(n,"h4",null,t.headline),a=e.newChild(n,"div","stx-marker-expand"),e.newChild(a,"p",null,t.story)}else a=e.newChild(i,"div","stx-marker-expand"),e.newChild(a,"h4",null,t.headline),e.newChild(a,"p",null,t.story),e.safeClickTouch(a,function(t){e.toggleClassName(i,"highlight")});function s(){e.Marker.positionContentVerticalAndHorizontal(i)}e.safeClickTouch(r,function(t){e.toggleClassName(i,"highlight"),setTimeout(s,10)})},e.Marker.Simple.ciqInheritsFrom(e.Marker.NodeCreator,!1),t},__quoteFeed_=function(t){var e=t.CIQ;function i(){}return i.fetchInitialData=function(t,e,i,a,r){},i.fetchUpdateData=function(t,e,i,a){},i.fetchPaginationData=function(t,e,i,a,r){},i.subscribe=function(t){},i.unsubscribe=function(t){},e.QuoteFeed=function(){},e.QuoteFeed.prototype.fetch=function(t,e){this.v2QuoteFeed||console.log("You must implement CIQ.QuoteFeed.[yourfeedname].prototype.fetch()")},e.QuoteFeed.prototype.announceError=function(t,i){t.suppressErrors||i.suppressAlert||t.startDate||t.endDate||i.error&&e.alert("Error fetching quote:"+i.error)},e.QuoteFeed.prototype.multiFetch=function(t,i){0===t.length&&i([]);var a={counter:0,finished:t.length,results:[]};function r(t,e,i){return function(a){if(e.results.push({dataCallback:a,params:t}),e.counter++,e.counter>=e.finished){var r=e.results;e.results=[],i(r)}}}for(var n=0;n<t.length;n++){var s=t[n];s.stx.isEquationChart(s.symbol)?e.fetchEquationChart(s,r(s,a,i)):e.ChartEngine.Driver.fetchData(e.QuoteFeed.SERIES,this,s,r(s,a,i))}},e.QuoteFeed.Subscriptions=function(){this.subscriptions=[]},e.QuoteFeed.Subscriptions.ciqInheritsFrom(e.QuoteFeed),e.QuoteFeed.Subscriptions.prototype.checkSubscriptions=function(t){for(var e,i,a=t.getSymbols(),r=0;r<this.subscriptions.length;r++)this.subscriptions[r].match=!1;for(var n=0;n<a.length;n++){var s=(i=a[n]).interval;for("month"!=s&&"week"!=s||t.dontRoll||(s="day"),i.interval=s,i.period=1,i.match=!1,isNaN(i.interval)||(i.period=i.interval,i.interval=i.timeUnit,i.interval||(i.interval="minute")),delete i.periodicity,delete i.timeUnit,delete i.setSpan,r=0;r<this.subscriptions.length;r++){if((e=this.subscriptions[r]).symbol==i.symbol&&e.period==i.period&&e.interval==i.interval){i.match=!0,e.match=!0;break}e.symbol!=i.symbol?("period"!=i.reason&&(i.reason="symbol"),e.reason="symbol"):(i.reason="period",e.reason="period")}}var o=this;this.subscriptions=this.subscriptions.filter(function(e){return e.match||(e.stx||(e.stx=t),o.unsubscribe(e)),e.match}),a.forEach(function(e){e.match||(e.stx||(e.stx=t),e.reason||(e.reason="initialize"),o.subscribe(e),o.subscriptions.push(e))})},e.QuoteFeed.Subscriptions.prototype.fetch=function(t,e){var i=this;this.fetchFromSource(t,function(a){a.error||i.checkSubscriptions(t.stx),e(a)})},e.QuoteFeed.Subscriptions.prototype.subscribe=function(t){console.log("subscribe",t)},e.QuoteFeed.Subscriptions.prototype.unsubscribe=function(t){console.log("unsubscribe",t)},e.QuoteFeed.Subscriptions.prototype.fetchFromSource=function(t,e){console.log("Please provide implementation of fetchFromSource")},e.QuoteFeed.prototype.requiresImmediateRefresh=function(t){return!1},e.ChartEngine.prototype.attachQuoteFeed=function(t,i){i||(i={}),this.quoteDriver&&this.quoteDriver.die(),"function"==typeof t.fetchInitialData||"function"==typeof t.fetchUpdateData||"function"==typeof t.fetchPaginationData?("function"!=typeof t.fetchPaginationData&&"function"!=typeof t.fetchUpdateData&&(i.noLoadMore=!0),t.v2QuoteFeed=!0,["multiFetch","announceError","requiresImmediateRefresh"].forEach(function(i){t[i]||!1===t[i]||(t[i]=e.QuoteFeed.prototype[i])}),"function"==typeof t.subscribe&&(t.checkSubscriptions=e.QuoteFeed.Subscriptions.prototype.checkSubscriptions,t.subscriptions=[]),this.quoteDriver=new e.ChartEngine.Driver(this,t,i)):this.quoteDriver=new e.ChartEngine.Driver(this,t,i)},e.ChartEngine.prototype.attachEngineQuoteFeed=function(t,e){console.log("CIQ.ChartEngine.attachEngineQuoteFeed is now Deprecated. Use CIQ.ChartEngine.attachQuoteFeed instead"),this.attachQuoteFeed(t,e)},e.ChartEngine.prototype.attachTagAlongQuoteFeed=function(t){t.label?this.quoteDriver.attachTagAlongQuoteFeed(t):console.log("Attempt to attachTagAlongQuoteFeed without assigning a label")},e.ChartEngine.prototype.detachTagAlongQuoteFeed=function(t){t.label?this.quoteDriver.detachTagAlongQuoteFeed(t):console.log("Attempt to detachTagAlongQuoteFeed without assigning a label")},e.ChartEngine.Driver=function(t,e,i){this.tagalongs={},this.stx=t,this.quoteFeed=e,i.maximumTicks||(i.maximumTicks=e.maxTicks?e.maxTicks:2e4),this.behavior=i,this.loadingNewChart=!1,this.intervalTimer=null,this.updatingChart=!1,this.updateChartLoop()},e.ChartEngine.Driver.prototype.die=function(){this.intervalTimer&&(window.clearInterval(this.intervalTimer),this.intervalTimer=-1)},e.ChartEngine.Driver.prototype.updateSubscriptions=function(){this.quoteFeed.checkSubscriptions&&this.quoteFeed.checkSubscriptions(this.stx)},e.ChartEngine.Driver.prototype.attachTagAlongQuoteFeed=function(t){t.label&&(this.tagalongs[t.label]||(this.tagalongs[t.label]={label:t.label,quoteFeed:t.quoteFeed,behavior:t.behavior?t.behavior:{},count:0}),this.tagalongs[t.label].count++)},e.ChartEngine.Driver.prototype.detachTagAlongQuoteFeed=function(t){if(t.label){var e=this.tagalongs[t.label];e.count--,e.count||(this.tagalongs[t.label]=null)}},e.ChartEngine.Driver.prototype.loadDependents=function(t,i,a){var r,n,s,o=t.stx,l=t.chart,h=l.series,c=(o.masterData,this),u=[],p={},d=a==e.QuoteFeed.UPDATE,m=a==e.QuoteFeed.PAGINATION;for(r in h)if(n=h[r],d||!1!==n.moreAvailable){if(d||m){if(!n.endPoints)continue;if(t.latestStartDate&&n.endPoints.begin&&n.endPoints.begin<t.latestStartDate)continue}var g=n.parameters;if(!1!==g.loadData&&(!g.data||g.data.useDefaultQuoteFeed)&&(s=g.symbolObject).symbol){for(var f=!0,y=0;y<u.length;y++)e.symbolEqual(u[y],s)&&(f=!1);f&&(u.push(s),p[s.symbol]=n.endPoints)}}for(var v,x=[],b=0;b<u.length;b++){s=u[b];var C=e.shallowClone(t.originalState);C.symbol=s.symbol,C.symbolObject=s,C.update?C.startDate=p[s.symbol].end:(C.startDate||(C.startDate=t.startDate),C.endDate=m?p[s.symbol].begin:t.endDate,C.ticks=t.ticks),x.push(C)}if(!x.length&&d)return o.createDataSet(null,null,{appending:t.originalState.update}),t.nodraw||o.draw(),void(i&&i(null));this.quoteFeed.multiFetch(x,(v=d,function(e){for(var r=null,s=0;s<e.length;s++){var h=e[s],u=h.dataCallback.error;if(!u&&0!==u){for(var p,d=h.params.symbolObject,m=h.dataCallback,g=m.quotes,f=m.moreAvailable,y=o.getSeries({symbolObject:d}),x=0;x<y.length;x++)n=y[x],v||(n.moreAvailable=!1!==f&&(f||g.length>(h.params.endDate?1:0))),p||(p=n.parameters.fillGaps);g=c.cleanup(o,n,g,a,t,p),o.updateChartData(g,l,{secondarySeries:d.symbol,noCreateDataSet:!0,noCleanupDates:!0,overwrite:!0}),g&&g.length&&(!r||r>g[0].DT)&&(r=g[0].DT)}}e.length&&(o.createDataSet(null,null,{appending:t.originalState.update,appendToDate:r}),t.nodraw||o.draw()),i&&i(null)}))},e.ChartEngine.Driver.prototype.cleanup=function(t,i,a,r,n,s){if(t.doCleanupDates(a,t.layout.interval),!n.missingBarsCreated&&a.length){var o,l=n.chart,h=n.symbol;h==l.symbol&&(h=l.defaultPlotField),r!=e.QuoteFeed.PAGINATION||n.loadMoreReplace?r==e.QuoteFeed.UPDATE&&i.endPoints.end&&i.endPoints.end<a[0].DT&&(a.unshift(t.getFirstLastDataRecord(t.masterData,h,!0)),o="shift"):i.endPoints.begin&&i.endPoints.begin>a[a.length-1].DT&&(a.push(t.getFirstLastDataRecord(t.masterData,h,!1)),o="pop"),a=t.doCleanupGaps(a,l,{cleanupGaps:s,noCleanupDates:!0}),o&&a[o]()}return a},e.ChartEngine.Driver.prototype.executeTagAlongs=function(t){var i={count:e.objLength(this.taglongs)},a=this;function r(t,i,r){return function(n){if(r.count--,!n.error){var s=t.fields;s||(s=null),e.addMemberToMasterdata({stx:a.stx,label:i.label,data:n.quotes,fields:s,noCleanupDates:!0})}-1==r.count&&(a.stx.createDataSet(null,null,{appending:t.originalState.update}),a.stx.draw())}}for(var n in this.tagalongs){var s=this.tagalongs[n],o=e.shallowClone(s.behavior);e.extend(o,t,!0),e.ChartEngine.Driver.fetchData(null,s.quoteFeed,o,r(o,s,i))}},e.ChartEngine.Driver.prototype.updateChart=function(){if(!this.updatingChart&&!this.loadingNewChart){var t=e.objLength(this.stx.charts),i=0,a=this.stx,r=a.layout.interval,n=a.layout.timeUnit;for(var s in a.charts){var o=a.charts[s];if(o.symbol){var l=this.makeParams(o.symbol,o.symbolObject,o);o.masterData&&o.masterData.length&&(l.startDate=o.endPoints.end),l.update=!0,l.originalState=e.shallowClone(l),this.updatingChart=!0;var h=c(this,l,o.symbol);a.isEquationChart(l.symbol)?e.fetchEquationChart(l,h):e.ChartEngine.Driver.fetchData(e.QuoteFeed.UPDATE,this.quoteFeed,l,h)}}}function c(s,o,l){return s.behavior.prefetchAction&&s.behavior.prefetchAction("updateChart"),function(h){i++;var c=o.chart;c.masterData;if(l==c.symbol&&r==a.layout.interval&&n==a.layout.timeUnit){if(h.error)s.quoteFeed.announceError(o.originalState,h);else{var u=h.quotes;u=s.cleanup(a,c,u,e.QuoteFeed.UPDATE,o),a.updateChartData(u,c,{noCreateDataSet:!0,noCleanupDates:!0}),c.attribution=h.attribution}i==t&&(s.updatingChart=!1),s.executeTagAlongs(o),s.behavior.callback&&s.behavior.callback(o),s.loadDependents(o,null,e.QuoteFeed.UPDATE)}}}},e.ChartEngine.Driver.prototype.updateChartLoop=function(t){var e;-1!=this.intervalTimer&&(this.intervalTimer&&window.clearInterval(this.intervalTimer),this.behavior.noUpdate||(t||0===t||(t=this.behavior.refreshInterval),t&&(this.intervalTimer=window.setInterval((e=this,function(){e.behavior.noUpdate||e.updateChart()}),1e3*t))))},e.ChartEngine.Driver.prototype.resetRefreshInterval=function(t){this.behavior.refreshInterval=t,this.updateChartLoop()},e.ChartEngine.Driver.prototype.loadAll=function(t,e){var i=this,a=0;!function r(){return function(n){n?e(n):t.moreAvailable?t.loadingMore?e(null):++a>20?e("error, moreAvailable not implemented correctly in QuoteFeed"):i.checkLoadMore(t,!0,!0,r()):e(null)}}()()},e.ChartEngine.Driver.prototype.checkLoadMore=function(t,i,a,r,n){if(t.loadingMore)return t.initialScroll=t.scroll,void(r&&r(null));var s;function o(e){t.loadingMore=!1,r&&r(e)}var l=this.stx;if(t.moreAvailable){var h,c,u=l.layout.interval,p=l.layout.timeUnit,d=!1;if(!this.behavior.noLoadMore&&(!l.maxDataSetSize||t.dataSet.length<l.maxDataSetSize)){var m=t.dataSet.length-(this.behavior.bufferSize||0);if(m<0&&(m=0),t.scroll>=m||i){t.initialScroll=t.scroll,t.loadingMore=!0,s=this.makeParams(t.symbol,t.symbolObject,t),t.masterData&&t.masterData.length?s.endDate=t.endPoints.begin:s.endDate=new Date,s.originalState=e.shallowClone(s),s.nodraw=n,l.fetchMaximumBars[l.layout.aggregationType]&&(a=!0),a&&(s.fetchMaximumBars=!0,!l.maxMasterDataSize||this.behavior.maximumTicks<l.maxMasterDataSize?s.ticks=this.behavior.maximumTicks:s.ticks=l.maxMasterDataSize);var g=(c=s,(h=this).behavior.prefetchAction&&h.behavior.prefetchAction("checkLoadMore"),function(t){var i=h.stx,a=c.chart;if(c.symbol==a.symbol&&u==i.layout.interval&&p==i.layout.timeUnit)if(c.loadMore||(c.chart.loadingMore=!1),t.error)h.quoteFeed.announceError(c.originalState,t),c.chart.loadingMore=!1,r&&r(t.error);else{t.quotes||(t.quotes=[]);var s=t.quotes;s=h.cleanup(i,a,s,e.QuoteFeed.PAGINATION,c),t.moreAvailable?a.moreAvailable=!0:!1!==t.moreAvailable&&s.length?a.moreAvailable=!0:a.moreAvailable=!1,h.tickMultiplier=t.quotes.length?2:2*h.tickMultiplier,a.loadingMore=!1,c.loadMoreReplace?i.setMasterData(s,a,{noCleanupDates:!0}):e.addMemberToMasterdata({stx:i,chart:a,data:s,fields:["*"],noCleanupDates:!0}),s.length&&((!a.endPoints.begin||a.endPoints.begin>s[0].DT)&&(a.endPoints.begin=s[0].DT),c.loadMoreReplace&&(!a.endPoints.end||a.endPoints.end<s[s.length-1].DT)&&(a.endPoints.end=s[s.length-1].DT)),i.createDataSet(),n||i.draw(),h.executeTagAlongs(c),h.behavior.callback&&h.behavior.callback(c),h.loadDependents(c,r,e.QuoteFeed.PAGINATION)}});l.isEquationChart(s.symbol)?e.fetchEquationChart(s,g):e.ChartEngine.Driver.fetchData(e.QuoteFeed.PAGINATION,this.quoteFeed,s,g),d=!0}}!d&&r&&r(null)}else{if(t.dataSet.length>0&&t.scroll>=t.dataSet.length||i)for(var f in t.series)if(!1!==t.series[f].moreAvailable)return s=this.makeParams(t.symbol,t.symbolObject,t),t.masterData&&t.masterData.length?s.endDate=t.masterData[0].DT:s.endDate=l.convertToDataZone(new Date),s.originalState=e.shallowClone(s),s.nodraw=n,t.loadingMore=!0,void this.loadDependents(s,o);r&&r(null)}},e.ChartEngine.Driver.prototype.barsToFetch=function(t){if(t.isSeries)return t.stx.masterData.length;var e=this.stx.layout.interval,i=t.stx.layout.periodicity;return"month"!=e&&"week"!=e||this.stx.dontRoll||(i*="week"==e?7:30),t.stx.chart.maxTicks*i*this.tickMultiplier},e.ChartEngine.Driver.determineStartDate=function(t,i,a){var r=t.interval,n=t.stx.layout.periodicity,s=e.Market.Symbology.isForexSymbol?1.3:4;return r="millisecond"===r||"second"===r?e.SECOND*n*s:"minute"===r?e.MINUTE*n*s:e.DAY*s,t.fetchMaximumBars?new Date(Date.now()-a*r):t.startDate?t.startDate:i.previous(a)},e.ChartEngine.Driver.prototype.makeParams=function(t,i,a){var r=this.stx.layout.interval,n=this.barsToFetch({stx:this.stx});"month"!=r&&"week"!=r||this.stx.dontRoll||(r="day");var s=e.shallowClone(this.behavior);return e.extend(s,{stx:this.stx,symbol:t,symbolObject:i,chart:a,interval:r,extended:this.stx.layout.extended,period:1,feed:"delayed",ticks:n},!0),s.symbolObject||(s.symbolObject={symbol:t}),isNaN(s.interval)||(s.period=parseInt(s.interval,10),s.interval=this.stx.layout.timeUnit,s.interval||(s.interval="minute")),s},e.ChartEngine.Driver.prototype.newChart=function(t,i){var a=this.stx,r=t.symbol,n=a.layout.interval,s=a.layout.timeUnit,o=t.chart;o.moreAvailable=null,o.loadingMore=!1,o.attribution=null,this.tickMultiplier=2;var l=this.makeParams(r,t.symbolObject,o);e.extend(l,t,!0),(a.fetchMaximumBars[a.layout.aggregationType]||t.fetchMaximumBars)&&(!a.maxMasterDataSize||this.behavior.maximumTicks<a.maxMasterDataSize?l.ticks=this.behavior.maximumTicks:l.ticks=a.maxMasterDataSize,l.fetchMaximumBars=!0),this.loadingNewChart=!0,this.updatingChart=!1,l.originalState=e.shallowClone(l);var h,c,u=(c=l,(h=this).behavior.prefetchAction&&h.behavior.prefetchAction("newChart"),function(o){var l=c.chart,u=o.quotes,p=!1;if(r==l.symbol&&n==a.layout.interval&&s==a.layout.timeUnit){for(var d in o.error?h.quoteFeed.announceError(c.originalState,o):(u=h.cleanup(a,l,u,e.QuoteFeed.INITIAL,c),a.setMasterData(u,l,{noCleanupDates:!0}),u.length&&(l.endPoints.begin=u[0].DT,l.endPoints.end=u[u.length-1].DT),l.moreAvailable=!!u&&!1!==o.moreAvailable,l.attribution=o.attribution,t.initializeChart&&a.initializeChart(),a.createDataSet(),p=!0),l.series)l.series[d].endPoints={},l.series[d].moreAvailable=null;h.loadingNewChart=!1;var m=l.masterData;m&&m.length&&(c.startDate=m[0].DT,c.endDate=m[m.length-1].DT),h.executeTagAlongs(c),h.behavior.callback&&h.behavior.callback(c),h.loadDependents(c,function(){p&&!c.nodraw&&h.stx.home(),i&&i(o.error),h.stx.dispatch("newChart",{stx:h.stx,symbol:h.stx.chart.symbol,symbolObject:h.stx.chart.symbolObject,moreAvailable:h.stx.chart.moreAvailable,quoteDriver:h}),h.resetRefreshInterval(h.behavior.refreshInterval)},e.QuoteFeed.INITIAL)}else i&&i("orphaned")});this.stx.isEquationChart(l.symbol)?e.fetchEquationChart(l,u):e.ChartEngine.Driver.fetchData(e.QuoteFeed.INITIAL,this.quoteFeed,l,u)},e.QuoteFeed.INITIAL=1,e.QuoteFeed.UPDATE=2,e.QuoteFeed.PAGINATION=3,e.QuoteFeed.SERIES=4,e.ChartEngine.Driver.fetchData=function(t,i,a,r){i.v2QuoteFeed?"function"!=typeof i.subscribe?e.ChartEngine.Driver.fetchDataInContext(t,i,a,r):e.ChartEngine.Driver.fetchDataInContext(t,i,a,function(t){t.error||i.checkSubscriptions(a.stx),r(t)}):(a.stx.convertToDataZone(a.startDate),a.stx.convertToDataZone(a.endDate),i.fetch(a,r))},e.ChartEngine.Driver.fetchDataInContext=function(t,i,a,r){var n,s,o,l;switch(t===e.QuoteFeed.SERIES&&(a.series=!0,t=e.QuoteFeed.INITIAL,a.endDate&&!a.startDate?t=e.QuoteFeed.PAGINATION:a.startDate&&!a.endDate&&(t=e.QuoteFeed.UPDATE)),t){case e.QuoteFeed.UPDATE:var h;a.startDate?h=a.startDate:(h=new Date).setHours(0,0,0,0),"function"==typeof i.fetchUpdateData&&i.fetchUpdateData(a.symbol,a.stx.convertToDataZone(h),a,r);break;case e.QuoteFeed.INITIAL:(l=new Date).setMilliseconds(0),n={begin:l,interval:"tick"==a.interval?1:a.interval,periodicity:"tick"==a.interval?a.stx.chart.xAxis.futureTicksInterval:a.period,outZone:a.stx.dataZone},s=a.stx.chart.market.newIterator(n),o=e.ChartEngine.Driver.determineStartDate(a,s,a.ticks),l=a.endDate?a.endDate:l,"function"==typeof i.fetchInitialData&&i.fetchInitialData(a.symbol,o,a.stx.convertToDataZone(l),a,r);break;case e.QuoteFeed.PAGINATION:n={begin:a.endDate,interval:"tick"==a.interval?1:a.interval,periodicity:"tick"==a.interval?a.stx.chart.xAxis.futureTicksInterval:a.period,outZone:a.stx.dataZone},s=a.stx.chart.market.newIterator(n);var c=Math.min(a.ticks,a.stx.quoteDriver.behavior.maximumTicks);if(o=e.ChartEngine.Driver.determineStartDate(a,s,c),"function"==typeof i.fetchPaginationData){if(a.stx.maxMasterDataSize&&a.stx.maxMasterDataSize<=a.stx.masterData.length)return;i.fetchPaginationData(a.symbol,o,a.stx.convertToDataZone(a.endDate),a,r)}break;default:console.error("Illegal fetchData constant")}},t},__span_=function(t){var e=t.CIQ;return e.ChartEngine.prototype.setRange=function(t,i){e.isEmpty(t)&&(t={dtLeft:arguments[0],dtRight:arguments[1],padding:arguments[2],chart:arguments[3]},i=arguments[4]),this.staticRange&&(t.goIntoPast=t.goIntoFuture=!0),t.chart||(t.chart=this.chart),void 0===t.padding&&(t.padding=0);var a=!1,r=t.chart,n="string"==typeof t.dtLeft?new Date(t.dtLeft):t.dtLeft,s=new Date;if(t.dtRight&&(s="string"==typeof t.dtRight?new Date(t.dtRight):t.dtRight),!n){var o=this.standardMarketIterator(s,null,r);n=o.previous(r.maxTicks),t.periodicity||(a=!0)}r.inflectionPoint=n;var l=this;function h(e){void 0===e&&(e=null);var a=0,o=0,h=new Date,c=t.base,u=t.periodicity,p=l.layout;if(t.goIntoFuture&&(!r.masterData.length||n>r.masterData[r.masterData.length-1].DT)){var d=r.masterData.length?r.masterData.pop():{DT:n},m=l.doCleanupGaps([d,{DT:s}],r,{cleanupGaps:"gap",noCleanupDates:!0});l.setMasterData(r.masterData.concat(m),r,{noCleanupDates:!0}),l.createDataSet(null,null,{appending:!0})}var g=r.dataSet,f=g.length;if(g&&0!==f){if("day"===c&&u&&"day"===u.interval){var y=t.multiplier;a=f<y?0:f-y,o=f-1}else if("today"===c&&g[f-1].DT.getDate()!=h.getDate()){for(var v=new Date(g[f-1].DT.getTime()),x=new Date(v.getTime()),b=f-1;b>=0;b--)if(g[b]&&g[b].DT.getDate()!=v.getDate()){v=new Date(+g[b+1].DT);break}x.getTime()==v.getTime()&&(v=new Date(+g[0].DT)),a=l.tickFromDate(v,r,null,!0),o=l.tickFromDate(x,r)}else a=n.getTime()>=g[0].DT.getTime()||t.goIntoPast?l.tickFromDate(n,r,null,!0):0,o=s.getTime()<=g[f-1].DT.getTime()||t.goIntoFuture?l.tickFromDate(s,r):f-1;var C=o-a+1;if(C<1)i&&i(e);else{var S=l.getLabelOffsetInPixels(l,r,p.chartType),w=Math.max(S,t.padding);o<f-1&&(w=0);var T=(r.width-w)/C;for(var M in l.setCandleWidth(T,r),r.scroll=C-(o-f)-1,l.micropixels=1,l.panels)l.calculateYAxisMargins(l.panels[M].yAxis);t.dontSaveRangeToLayout?delete p.range:(delete t.chart,delete p.setSpan,p.range=t),l.draw(),l.changeOccurred("layout"),i&&i(e)}}else i&&i(e)}var c,u,p,d,m,g,f,y=0;function v(t){return t&&0===y?(r.scroll=O,l.setCandleWidth(N),l.layout.interval=I,l.layout.periodicity=R,l.layout.timeUnit=z,void(i&&i(t))):++y>10?(console.log("CIQ.ChartEngine.setRange(): Too many loads (10) from server. Stopping. Check periodicity logic."),void h()):void(r.moreAvailable&&r.masterData[0]&&r.masterData[0].DT>n?l.quoteDriver.checkLoadMore(r,!0,!1,function(t){t?h(t):v()},!0):h())}if(this.quoteDriver){var x,b,C;if(a)x=this.layout.interval,C=this.layout.timeUnit,b=this.layout.periodicity;else if(t.periodicity){var S=e.cleanPeriodicity(t.periodicity.period,t.periodicity.interval,t.periodicity.timeUnit);x=S.interval,C=S.timeUnit,b=S.period}else{var w=s.getTime()-n.getTime();if(this.autoPickCandleWidth.turnOn){var T=0;T=this.autoPickCandleWidth.candleWidth?this.autoPickCandleWidth.candleWidth:this.barsHaveWidth[this.layout.chartType]?5:2;var M,D=r.width/T,E=this.dynamicRangePeriodicityMap;x=E[0].interval,b=1;for(var A=0;A<E.length;A++){var k=w/E[A].rangeInMS;if(k<D){E[A-1]?(x=E[A-1].interval,C=E[A-1].timeUnit,b=Math.ceil(M/D)):(x=E[A].interval,C=E[A].timeUnit,b=1);break}M=k}}else{for(var F=this.staticRangePeriodicityMap,_=null,P=0;P<F.length;P++){var L=F[P];if(w/L.rangeInMS<1.001){_=L;break}}x=_.interval,b=_.periodicity,C=_.timeUnit}}var O=this.chart.scroll,N=this.layout.candleWidth,I=this.layout.interval,R=this.layout.periodicity,z=this.layout.timeUnit;this.chart.scroll=this.chart.maxTicks=(c=s.getTime(),u=n.getTime(),p=x,d=b,m=C,this.dontRoll,g=0,f=c-u,e.ChartEngine.isDailyInterval(p)?g="month"==p?f/e.MONTH/d:"week"==p?f/e.WEEK/d:f/e.DAY/d:isNaN(p)||(g="millisecond"==m?f/(d*p):"second"==m?f/e.SECOND/(d*p):f/e.MINUTE/(d*p)),Math.round(g)),this.layout.candleWidth=this.chart.width/this.chart.maxTicks;var H=this.needDifferentData({period:b,interval:x,timeUnit:C});if(this.chart.masterData&&this.chart.masterData.length&&this.chart.masterData[0].DT>n&&(H=!0),!this.chart.masterData||!this.chart.masterData.length||H||t.forceLoad){this.layout.interval=x,this.layout.periodicity=b,this.layout.timeUnit=C,this.layout.timeUnit||(e.ChartEngine.isDailyInterval(this.layout.interval)?this.layout.timeUnit=null:"second"==this.layout.interval?this.layout.timeUnit="second":"tick"!=this.layout.interval&&(this.layout.timeUnit="minute"));var Y={symbol:r.symbol,symbolObject:r.symbolObject,chart:r,nodraw:!0};"tick"==this.layout.interval&&(Y.startDate=n,Y.endDate=s),this.displayInitialized||(Y.initializeChart=!0),Y.startDate=new Date(2*n-s),Y.startDate.setHours(0,0,0,0),this.quoteDriver.newChart(Y,v)}else this.layout.interval==x&&this.layout.periodicity==b&&this.layout.timeUnit==C&&this.chart.dataSegment&&this.chart.dataSegment[0]&&this.chart.dataSegment[0].DT==r.inflectionPoint||(this.layout.interval=x,this.layout.periodicity=b,this.layout.timeUnit=C,this.createDataSet()),v()}else h()},e.ChartEngine.prototype.setSpan=function(t,i){var a=arguments[0],r=arguments[1],n=arguments[2],s=arguments[3];if("object"==typeof t?(a=t.period?t.period:t.multiplier?t.multiplier:1,r=t.interval?t.interval:t.base?t.base:t.span?t.span:t.period,n=t.padding,s=t.chart):(t={period:a,interval:r,padding:n,chart:s},i=arguments[5]),s||(s=this.chart),"all"==(r=r.toLowerCase()))return t.dontSaveRangeToLayout=!0,void this.displayAll(t,i);var o=r,l=1;"today"==r?o="day":"year"==r&&(o="month",l=12);var h,c=e.shallowClone(t),u={begin:new Date,interval:o,period:l,outZone:this.dataZone};"ytd"!==r&&(h=s.market.newIterator(u));var p=this.convertToDataZone(new Date);function d(t){return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}if("ytd"===r)(p=d(p)).setMonth(0),p.setDate(1);else if("today"===r)h.next(),(p=h.previous())>u.begin&&(p=h.previous());else if("month"===r)(p=d(new Date)).setMonth(p.getMonth()-a);else if("year"===r)(p=d(new Date)).setFullYear(p.getFullYear()-a);else if("week"===r)(p=d(new Date)).setDate(p.getDate()-7*a);else if("day"===r&&1==a&&this.chart.market.isMarketDay()){var m=p.getHours(),g=p.getMinutes(),f=p.getSeconds(),y=p.getMilliseconds();(p=h.previous()).setHours(m),p.setMinutes(g),p.setSeconds(f),p.setMilliseconds(y)}else 1==a&&a++,p=h.previous(a-1);c.dtLeft=p,"today"===r&&(c.goIntoFuture=!0,c.dtRight=new Date(+p),c.dtRight.setDate(p.getDate()+1),c.dtRight=s.market._convertFromMarketTZ(c.dtRight,this.dataZone),c.dtLeft.setHours(h.market.zopen_hour),c.dtLeft.setMinutes(h.market.zopen_minute),c.dtLeft.setSeconds(0),c.dtLeft=s.market._convertFromMarketTZ(c.dtLeft,this.dataZone)),c.maintainPeriodicity&&(c.periodicity={},c.periodicity.interval=this.layout.interval,c.periodicity.period=this.layout.periodicity),s.spanLock=!1,c.dontSaveRangeToLayout=!0;var v=this;this.setRange(c,function(e){v.layout.setSpan=t,v.changeOccurred("layout"),"today"==r&&(s.spanLock=!0),i&&i(e)})},e.ChartEngine.prototype.getSpanCandleWidth=function(t){if(t&&t.base&&t.multiplier){var e=parseFloat(t.multiplier),i=t.base,a=new Date,r=new Date;"year"==i?r.setFullYear(r.getFullYear()-e):"month"==i?r.setMonth(r.getMonth()-e):"day"==i?r.setDate(r.getDate()-e):"week"==i?r.setDate(r.getDate()-7*e):"YTD"==i&&(r.setMonth(0),r.setDate(1));var n=(a.getTime()-r.getTime())/1e3/60/60/24;return n=5*n/7,this.chart.width/n}},e.ChartEngine.prototype.displayAll=function(t,i){var a=this.chart;t&&t.chart&&(a=t.chart);var r=this;function n(){if(a.masterData&&a.masterData.length){var n=e.clone(t);n.dtLeft=a.masterData[0].DT,n.dtRight=a.masterData[a.masterData.length-1].DT,n.periodicity={},n.periodicity.interval=r.layout.interval,n.periodicity.period=r.layout.periodicity,n.periodicity.timeUnit=r.layout.timeUnit,r.setRange(n,function(e){for(var a in r.layout.setSpan={base:t.base,multiplier:t.multiplier},r.changeOccurred("layout"),r.panels)r.calculateYAxisMargins(r.panels[a].yAxis);r.draw(),i&&i(e)})}}function s(t){t||r.quoteDriver.loadAll(a,n)}if(this.quoteDriver){var o=t.maintainPeriodicity?{period:this.layout.periodicity,interval:this.layout.interval}:{period:1,interval:"month"};o=t.periodicity?t.periodicity:o,o=e.cleanPeriodicity(o.period,o.interval,o.timeUnit);var l=this.needDifferentData(o);this.layout.periodicity=o.period,this.layout.interval=o.interval,this.layout.timeUnit=o.timeUnit,t.forceLoad||l?this.quoteDriver.newChart({noDraw:!0,symbol:this.chart.symbol,symbolObject:this.chart.symbolObject,chart:this.chart,initializeChart:!0,fetchMaximumBars:!0},s):a.moreAvailable?s():(this.createDataSet(),n())}else n()},t},__studies_=function(t){var e=t.CIQ;return e.Studies=function(){},e.Studies.DEFAULT_INPUTS={Period:14},e.Studies.DEFAULT_OUTPUTS={Result:"auto"},e.Studies.actualOutputs=[],e.Studies.studyPanelMap={},e.Studies.colorPickerDiv=null,e.Studies.StudyDescriptor=function(t,i,a,r,n,s){this.name=t,this.type=i,this.panel=a,this.inputs=r,this.outputs=n,this.parameters=s,this.outputMap={},this.min=null,this.max=null,this.startFrom=0;var o=e.Studies.studyLibrary[i];o||(o={},("chart"==a||!a&&s&&"chart"==s.chartName)&&(this.overlay=!0)),void 0===o.inputs&&(o.inputs=e.clone(e.Studies.DEFAULT_INPUTS)),void 0===o.outputs&&(o.outputs=e.clone(e.Studies.DEFAULT_OUTPUTS)),this.study=o,this.libraryEntry=o},e.Studies.generateID=function(t,i,a,r,n){var s=e.Studies.studyLibrary[i];if(s&&s.customRemoval)return n||i;var o="‌"+(n||i)+"‌";if(!e.isEmpty(a)){o+=" (";var l=!1;for(var h in a)if("id"!=h&&"display"!=h&&"Shading"!=h){var c=a[h];"field"!=c&&(c=c.toString(),void 0!==e.Studies.prettify[c]&&(c=e.Studies.prettify[c]),l?c&&(o+=","):l=!0,o+=c)}o+=")"}if(r&&0===r.indexOf(o))return r;if(t.layout.studies&&t.layout.studies[o])for(var u=2;u<50;u++){var p=o+"-"+u;if(!t.layout.studies[p]){o=p;break}}return o},e.Studies.DialogHelper=function(t){var i=this.stx=t.stx,a=this.sd=t.sd;this.name=a?a.type:t.name,this.inputs=[],this.outputs=[],this.parameters=[];var r=this.libraryEntry=a?a.study:e.Studies.studyLibrary[t.name];void 0===r.inputs&&(r.inputs=e.clone(e.Studies.DEFAULT_INPUTS)),void 0===r.outputs&&(r.outputs=e.clone(e.Studies.DEFAULT_OUTPUTS));var n,s=a&&i.panels[a.panel]?i.panels[a.panel]:{chart:i.chart},o=s.chart;function l(t,e){this.attributes[t]||(this.attributes[t]={}),e&&(this.attributes[t].hidden=!0)}for(var h in this.title=i.translateIf(r.name),this.attributes=r.attributes,this.attributes||(this.attributes={}),r.inputs){var c={};this.inputs.push(c),c.name=h,c.heading=i.translateIf(h);var u=r.inputs[h];if(a&&a.inputs&&void 0!==a.inputs[h]&&null!==a.inputs[h]?c.value=a.inputs[h]:c.value=r.inputs[h],c.defaultInput=r.inputs[h],this.attributes[h]||(this.attributes[h]=e.Studies.inputAttributeDefaultGenerator(c.defaultInput)),u.constructor==Number)c.type="number";else if(u.constructor==String){var p=e.Studies.movingAverageHelper(i,c.defaultInput);if(p){c.type="select",c.defaultInput=p;var d=e.Studies.movingAverageHelper(i,c.value);d||(d=c.value),c.value=d,c.options=e.Studies.movingAverageHelper(i,"options")}else if("field"==u){c.type="select",c.options={};t:for(var m in o.dataSet[o.dataSet.length-1]){if(-1==["Open","High","Low","Close","Adj_Close","hl/2","hlc/3","hlcc/4","ohlc/4",o.defaultPlotField].indexOf(m)){if(-1==e.Studies.actualOutputs.indexOf(m))continue;if(t.sd)for(var g in t.sd.outputMap)if(-1!=m.indexOf(g)&&-1==m.indexOf(g+"-"))continue t}c.options[m]=i.translateIf(m)}"field"==c.value&&(c.value="Close"),"field"==c.defaultInput&&(c.defaultInput="Close")}else c.type="text"}else if(u.constructor==Boolean)c.type="checkbox",!0!==c.value&&"true"!=c.value&&"on"!=c.value||(c.value=!0);else if(u.constructor==Array){c.type="select",c.options={};for(var f=0;f<u.length;f++)c.options[u[f]]=i.translateIf(u[f]);c.value.constructor==Array&&(c.value=c.value[0]),c.defaultInput=u[0]}}for(h in r.outputs){var y={name:h,heading:i.translateIf(h)};this.outputs.push(y),y.color=y.defaultOutput=r.outputs[h],a&&a.outputs&&a.outputs[h]&&(y.color=a.outputs[h]),"auto"==y.color&&(y.color=i.defaultColor)}var v=a?a.parameters:null;if(v){var x=i.getYAxisByName(s,a.name),b={"Panel Name":{panelName:v.panelName,value:a.overlay||a.underlay?a.panel:"Own panel"},Underlay:{underlay:v.underlayEnabled,value:a.underlay},"Y-Axis":{yaxisDisplay:v.yaxisDisplay,value:x&&x.position||(a.overlay||a.underlay?"shared":s.yAxis.position||s.chart.yAxis.position||"right"),color:x&&x.textStyle?x.textStyle:null}};for(var C in b)for(var S in b[C])if("value"!=S&&"color"!=S){var w=b[C][S];if("panel"==w){for(var T in w=[],i.panels)T!=a.name&&w.push(T);w.push("Own panel")}if(w&&w.constructor==Array){for(var M={},D=0;D<w.length;D++)M[w[D]]=i.translateIf(w[D]);n={name:S,heading:i.translateIf(C),defaultValue:w[0],value:b[C].value,options:M},void 0!==b[C].color?(n.defaultColor=i.defaultColor,n.color=b[C].color,v[S+"Value"]=n.value,v[S+"Color"]=n.color):v[S]=n.value,this.parameters.push(n)}else!w&&!1!==w||w.constructor!=Boolean||(n={name:S,heading:i.translateIf(C),defaultValue:!1,value:b[C].value},v[S+"Enabled"]=n.value,this.parameters.push(n))}l.call(this,"underlayEnabled",r.underlay),l.call(this,"panelName",null===r.seriesFN),l.call(this,"yaxisDisplayValue",null===r.seriesFN||r.yAxis&&r.yAxis.noDraw)}if(r.parameters){var E=r.parameters.init;E&&"studyOverZones"==r.parameters.template&&(n={name:"studyOverZones",heading:i.translateIf("Show Zones"),defaultValue:E.studyOverZonesEnabled,value:E.studyOverZonesEnabled},v&&(v.studyOverZonesEnabled||!1===v.studyOverZonesEnabled)&&(n.value=v.studyOverZonesEnabled),this.parameters.push(n),n={name:"studyOverBought",heading:i.translateIf("OverBought"),defaultValue:E.studyOverBoughtValue,value:E.studyOverBoughtValue,defaultColor:E.studyOverBoughtColor,color:E.studyOverBoughtColor},v&&v.studyOverBoughtValue&&(n.value=v.studyOverBoughtValue),v&&v.studyOverBoughtColor&&(n.color=v.studyOverBoughtColor),"auto"==n.color&&(n.color=i.defaultColor),this.parameters.push(n),n={name:"studyOverSold",heading:i.translateIf("OverSold"),defaultValue:E.studyOverSoldValue,value:E.studyOverSoldValue,defaultColor:E.studyOverSoldColor,color:E.studyOverSoldColor},v&&v.studyOverSoldValue&&(n.value=v.studyOverSoldValue),v&&v.studyOverSoldColor&&(n.color=v.studyOverSoldColor),"auto"==n.color&&(n.color=i.defaultColor),this.parameters.push(n),this.attributes.studyOverBoughtValue||(this.attributes.studyOverBoughtValue={}),this.attributes.studyOverSoldValue||(this.attributes.studyOverSoldValue={}))}},e.Studies.DialogHelper.prototype.updateStudy=function(t){var i={},a=this.sd,r=this.libraryEntry;r||(r={}),a||(a=r),i.inputs=e.shallowClone(a.inputs),i.outputs=e.clone(a.outputs),i.parameters=e.shallowClone(a.parameters),e.extend(i,t),i.parameters||(i.parameters={}),i.inputs&&i.inputs.id?this.sd=e.Studies.replaceStudy(this.stx,i.inputs.id,this.name,i.inputs,i.outputs,i.parameters,null,a.study):this.sd=e.Studies.addStudy(this.stx,this.name,i.inputs,i.outputs,i.parameters,null,a.study)},e.Studies.prepareStudy=function(t,i,a,r){if(void 0===i.calculateFN&&(i.useRawValues=!0),r&&r.replaceID&&(e.Studies.rejiggerDerivedStudies(t,r.replaceID,a.inputs.id,a.panel),delete r.replaceID),e.isEmpty(a.outputMap))for(var n in a.outputs)i.useRawValues?a.outputMap[n]=n:a.outputMap[n+" "+a.name]=n;(a.overlay||a.underlay)&&t.addOverlay(a),i.feed?t.attachTagAlongQuoteFeed(i.feed):t.currentlyImporting||(a.chart.dataSet&&t.createDataSet(),t.draw())},e.Studies.rejiggerDerivedStudies=function(t,i,a){var r=t.layout.studies;for(var n in r){var s=r[n];s.panel==i&&(s.panel=a);var o=s.inputs,l=o.id;if(-1!=o.id.indexOf(i)&&-1==o.id.indexOf(i+"-")){o.id.replace(i,a);for(var h=!1,c=e.Studies.getFieldInputs(s),u=0;u<c.length;u++)if(-1!=o[c[u]].indexOf(i)){s.name;for(var p in o[c[u]]=o[c[u]].replace(i,a),o.id=o.id.replace(i,a),o.display=o.display.replace(i,a),s.name=s.name.replace(i,a),s.outputMap={},s.outputs)s.study.useRawValues?s.outputMap[p]=p:s.outputMap[p+" "+s.name]=p;h=!0}h&&e.Studies.replaceStudy(t,l,s.type,s.inputs,s.outputs,s.parameters)}}},e.Studies.removeStudySymbols=function(t,e){if(t.series)for(var i in t.series)e.deleteSeries(t.series[i],null,{action:"remove-study"})},e.Studies.replaceStudy=function(t,i,a,r,n,s,o,l){s||(s={}),i&&(s.replaceID=i),r.id==r.display&&delete r.display,delete r.id;var h=t.layout.studies[s.replaceID];return e.Studies.removeStudySymbols(h,t),t.quoteDriver&&t.quoteDriver.updateSubscriptions(),e.Studies.addStudy(t,a,r,n,s,o,l)},e.Studies.addStudy=function(t,i,a,r,n,s,o){var l=o||e.Studies.studyLibrary[i];if(n||(n={}),l){if(l.inputs){var h=e.shallowClone(l.inputs);for(var c in h)h[c]instanceof Array&&(h[c]=h[c][0]);a=e.extend(h,a)}l.outputs&&(r=e.extend(e.clone(l.outputs),r));var u=l.parameters;u&&u.init&&(n=e.extend(e.shallowClone(u.init),n)),u&&!n.display&&(n.display=u.display)}a||(a=e.clone(e.Studies.DEFAULT_INPUTS)),r||(r=e.clone(e.Studies.DEFAULT_OUTPUTS)),n.chartName||(n.chartName="chart"),a.Period<1&&(a.Period=1),a.id||(a.id=e.Studies.generateID(t,i,a,n.replaceID,n.display));var p=null;if(p=l&&l.initializeFN?l.initializeFN(t,i,a,r,n,s,o):e.Studies.initializeFN(t,i,a,r,n,s,o)){o=p.study,p.chart=t.charts[n.chartName],t.layout.studies||(t.layout.studies={}),t.layout.studies[p.inputs.id]=p,p.type=i,p.permanent=o.permanent,p.customLegend=o.customLegend;var d=t.panels[p.panel];e.Studies.prepareStudy(t,o,p,n),t.quoteDriver&&t.quoteDriver.updateSubscriptions(),t.changeOccurred("layout");var m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_,P=!1,L=!(p.overlay||p.underlay);if(L&&o.horizontalCrosshairFieldFN&&(d.horizontalCrosshairField=o.horizontalCrosshairFieldFN(t,p)),t.editCallback?P=!0:L?(t.callbacks.studyPanelEdit||t.callbackListeners.studyPanelEdit&&t.callbackListeners.studyPanelEdit.length)&&(P=!0):(t.callbacks.studyOverlayEdit||t.callbackListeners.studyOverlayEdit&&t.callbackListeners.studyOverlayEdit.length)&&(P=!0),P){n.editMode=!0;var O,N=!1;for(var I in p.inputs)if("id"!=I&&"display"!=I){N=!0;break}if(!N)for(var R in p.outputs){N=!0;break}if(N)void 0!==p.study.edit?p.study.edit&&(A=t,k=p,F=a,_=r,O=function(){e.clearCanvas(A.chart.tempCanvas,A),k.study.edit(k,{stx:A,inputs:F,outputs:_,parameters:n})},t.setPanelEdit(d,O),p.editFunction=O):!L&&t.callbacks.studyOverlayEdit?(w=t,T=p,M=a,D=r,E=n,O=function(t){e.clearCanvas(w.chart.tempCanvas,w),w.dispatch("studyOverlayEdit",{stx:w,sd:T,inputs:M,outputs:D,parameters:E,forceEdit:t})},p.editFunction=O):t.editCallback?(x=t,b=p,C=a,S=r,O=function(){var t=x.editCallback(x,b);e.clearCanvas(x.chart.tempCanvas,x),e.Studies.studyDialog(x,i,t,{inputs:C,outputs:S,parameters:n})},"chart"!=d.name&&t.setPanelEdit(d,O)):(m=t,g=p,f=a,y=r,v=n,O=function(){e.clearCanvas(m.chart.tempCanvas,m),m.dispatch("studyPanelEdit",{stx:m,sd:g,inputs:f,outputs:y,parameters:v})},"chart"!=d.name&&(t.setPanelEdit(d,O),p.editFunction=O))}return t.draw(),p}console.log("CIQ.Studies.addStudy: initializeFN() returned null for "+i)},e.Studies.quickAddStudy=e.Studies.addStudy,e.Studies.removeStudy=function(t,e){if(e.overlay||e.underlay)t.removeOverlay(e.name),t.draw();else{var i=t.panels[e.panel];i&&t.panelClose(i)}},e.Studies.displayStudies=function(t,i,a){var r=t.layout.studies;if(r){a&&(e.Studies.actualOutputs=[]);var n={};for(var s in n[i.name]=!0,r){var o=r[s],l=o.study;if(l){if(a){if(!o.underlay)continue}else if(o.underlay)continue;var h=e.clone(l.renderer);!h||h instanceof Array||(h=[h]);var c=t.panels[o.panel];if(c){if(c.chart==i&&!c.hidden){if(!n[c.name]){var u=o.permanent||!t.manageTouchAndMouse;c.closeX?c.closeX.style.display=u?"none":"":c.close&&(c.close.style.display=u?"none":""),n[c.name]=u}var p=o.chart.dataSegment;for(var d in o.outputMap)e.Studies.actualOutputs.push(d),e.Studies.studyPanelMap[d]=o;var m=e.Studies.getFieldInputs(o);if(!(o.panel!=o.parameters.chartName||o.parameters&&o.parameters.panelName))for(var g=0;g<m.length;g++)if(o.inputs[m[g]]){var f=e.Studies.studyPanelMap[o.inputs[m[g]]];if(f){o.panel=f.panel;break}}if(void 0===l.seriesFN){if(h){o.overlay||e.Studies.createYAxis(t,o,p,c);for(var y=0;y<h.length;y++){var v=h[y];for(var x in o.outputMap)o.outputMap[x]==v.field&&(v.field=x);if(v.field){v.panel=o.panel;var b=v.binding;if(b)for(var C in b){var S=e.Studies.determineColor(o.outputs[b[C]]);S&&"auto"!=S&&(v[C]=S)}v.yAxis=null;var w=e.Renderer.produce(v.type,v);w.stx=t,w.attachSeries(null,v).draw()}}}else e.Studies.displaySeriesAsLine(t,o,p);c&&e.Studies.displayError(t,o)}else l.seriesFN&&c&&(l.seriesFN(t,o,p),e.Studies.displayError(t,o))}}else delete r[s]}}}},e.Studies.displayError=function(t,e,i){var a=i&&i.panel?i.panel:e.panel,r=t.panels[a].state;r.studyError||!e.error||"undefined"!=typeof practiceMode&&practiceMode||((i=i||{h:"center",v:"bottom"}).text=r.studyError=!0===e.error?t.translateIf("Not enough data to compute ")+t.translateIf(e.study.name):t.translateIf(e.error),t.watermark(a,i))},e.Studies.calculateMinMaxForDataPoint=function(t,e,i){for(var a=Number.MAX_VALUE,r=-1*Number.MAX_VALUE,n=0;n<i.length;n++){var s=i[n][e];null!=s&&(isNaN(s)||(a=Math.min(s,a),r=Math.max(s,r)))}return{min:a,max:r}},e.Studies.determineMinMax=function(t,e,i){},e.Studies.getYAxisParameters=function(t,e){var i={},a=t.layout.studies&&t.layout.studies[e.name];if(a){var r=a.study;r.yaxis||r.yAxisFN?i.noDraw=!0:(r.parameters&&r.parameters.excludeYAxis&&(i.noDraw=!0),i.ground=r.yAxis&&r.yAxis.ground,e&&("bypass"!=r.range&&("0 to 100"==r.range?i.range=[0,100]:"-1 to 1"==r.range?i.range=[-1,1]:"0 to max"==r.range?i.range=[0,Math.max(0,e.high)]:(r.centerline||0===r.centerline)&&(i.range=[Math.min(r.centerline,e.low),Math.max(r.centerline,e.high)])),i.range&&(e.low=i.range[0],e.high=i.range[1]),a.min&&(e.min=a.min),a.max&&(e.max=a.max),a.parameters&&a.parameters.studyOverZonesEnabled&&(i.noDraw=!0)))}return i},e.Studies.doPostDrawYAxis=function(t,i){for(var a in t.layout.studies){var r=t.layout.studies[a],n=t.panels[r.panel];if(n&&!n.hidden)if((t.getYAxisByName(r.panel,r.name)||n.yAxis)==i){var s=r.study;if(i.name==r.name&&(s.yaxis&&s.yaxis(t,r),s.yAxisFN&&s.yAxisFN(t,r)),e.Studies.drawZones(t,r),!r.error){var o=s.centerline;(o||0===o||null!==o&&i.highValue>0&&i.lowValue<0)&&e.Studies.drawHorizontal(t,r,null,o||0,i)}}}},e.Studies.createYAxis=function(t,e,i,a){},e.Studies.displaySeriesAsLine=function(t,i,a){if(a.length){var r=t.panels[i.panel];if(r&&!r.hidden)for(var n in i.outputMap)e.Studies.displayIndividualSeriesAsLine(t,i,r,n,a)}},e.Studies.displaySeriesAsHistogram=function(t,e,i){if(i.length){var a=t.panels[e.panel];if(a&&!a.hidden){var r=[];for(var n in e.outputMap){var s=e.outputs[e.outputMap[n]];if(s){var o=.3;"object"==typeof s&&(o=s.opacity,s=s.color);var l={field:n,fill_color_up:s,border_color_up:s,fill_color_down:s,border_color_down:s};e.underlay&&(l.opacity_up=l.opacity_down=o||.3),r.push(l)}}var h=e.inputs,c=t.getYAxisByName(a,e.name),u={name:e.name,type:h.HistogramType?h.HistogramType:"overlaid",panel:e.panel,yAxis:c,heightPercentage:h.HeightPercentage?h.HeightPercentage:c?1:.25,widthFactor:h.WidthFactor?h.WidthFactor:.5,bindToYAxis:"none"!=c.position};t.drawHistogram(u,r)}}},e.Studies.displayIndividualSeriesAsLine=function(t,i,a,r,n){a.height||(a.height=a.bottom-a.top);var s=t.chart.context,o=i.outputs[i.outputMap[r]];if(o){t.chart.context.save(),"string"==typeof o&&(o={color:o,width:1});var l=o.width||1;s.lineWidth=i.highlight?l+2:l;var h=o.color;"auto"==h&&(h=t.defaultColor),s.strokeStyle=h;var c=o.pattern;s.setLineDash(e.borderPatternToArray(s.lineWidth,c)),s.lineDashOffset=0;var u=0,p=i.study,d=t.getYAxisByName(a,i.name)||a.yAxis;u=t.decimalPlacesFromPriceTick(d.priceTick),(i.overlay||i.underlay)&&(u=null),(d.decimalPlaces||0===d.decimalPlaces)&&(u=d.decimalPlaces);var m=null;i.parameters&&(m=i.parameters.label);var g=p.parameters;g||(g={});var f="step"==g.plotType;if(i.series)for(var y in i.series){var v=i.series[y].parameters.type;v&&(f="step"==v)}g.noLabels&&(m=!1),i.noSlopes||!1===i.noSlopes||(i.noSlopes=g.noSlopes),i.extendToEnd||!1===i.extendToEnd||(i.extendToEnd=g.extendToEnd);var x=m||t.preferences.labels&&!1!==m,b=i.gaplines,C=i.inputs.Symbol,S=b?t.getGapColorFunction(C,r,o,b):null;t.plotDataSegmentAsLine(r,a,{yAxis:d,skipTransform:t.panels[i.panel].name!=i.chart.name,label:x,labelDecimalPlaces:u,noSlopes:i.noSlopes,step:f,extendToEndOfDataSet:i.extendToEnd,gapDisplayStyle:b},S),p.appendDisplaySeriesAsLine&&p.appendDisplaySeriesAsLine(t,i,n,r,a),t.chart.context.restore()}},e.Studies.drawHorizontal=function(t,e,i,a,r,n){var s=t.panels[e.panel];if(s){n||(n=r.textStyle);var o=t.pixelFromPrice(a,s,r);o>r.top&&o<r.bottom&&t.plotLine(s.left,s.right,o,o,n,"segment",t.chart.context,!1,{opacity:n&&n.opacity?n.opacity:.5})}},e.Studies.displayHistogramWithSeries=function(t,i,a){t.panels[i.panel];var r=.5;i.underlay&&(r=.3),e.Studies.createHistogram(t,i,a,!1,r),e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.drawZones=function(t,i,a){if(i.parameters&&i.parameters.studyOverZonesEnabled){var r=parseFloat(i.parameters.studyOverSoldValue),n=parseFloat(i.parameters.studyOverBoughtValue),s=i.parameters.studyOverSoldColor,o=i.parameters.studyOverBoughtColor,l=i.zoneOutput;l||(l="Result");var h=e.Studies.determineColor(i.outputs[l]);h&&"auto"!=h&&!e.isTransparent(h)||(h=t.defaultColor),s||(s=h),s&&"auto"!=s&&!e.isTransparent(s)||(s=t.defaultColor),o||(o=h),o&&"auto"!=o&&!e.isTransparent(o)||(o=t.defaultColor);var c=t.panels[i.panel],u=t.getYAxisByName(c,i.name)||c.yAxis,p=u.displayBorder;!1===t.axisBorders&&(p=!1),!0===t.axisBorders&&(p=!0),0===u.width&&(p=!1);var d="left"==u.position,m=u.justifyRight,g=Math.round(u.left+(d?u.width:0))+.5,f=p?3:0,y=t.chart.context,v=y.fillStyle;t.chart.context.globalAlpha=.2,t.startClip(c.name,!0),y.beginPath();var x=Math.round(t.pixelFromPrice(n,c,u))+.5;y.strokeStyle=o,y.moveTo(c.left,x),y.lineTo(c.right,x),y.stroke(),y.closePath(),t.chart.context.beginPath();var b=Math.round(t.pixelFromPrice(r,c,u))+.5;y.strokeStyle=s,y.moveTo(c.left,b),y.lineTo(c.right,b),y.stroke(),y.closePath();var C=new e.Plotter;if(C.newSeries("border","stroke",t.canvasStyle("stx_grid_border")),p){var S=d?g-f:g-.5,w=d?g+.5:g+f;C.moveTo("border",S,x),C.lineTo("border",w,x),C.moveTo("border",S,b),C.lineTo("border",w,b)}y.fillStyle=v;var T={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:l+" "+i.name,yAxis:u};if(e.preparePeakValleyFill(t,e.extend(T,{threshold:n,direction:1,color:o})),e.preparePeakValleyFill(t,e.extend(T,{threshold:r,direction:-1,color:s})),y.globalAlpha=1,!i.study||!i.study.yaxis){if(p){var M=Math.round(u.bottom)+.5;C.moveTo("border",g,u.top),C.lineTo("border",g,M),C.draw(t.chart.context,"border")}0!==u.width&&(t.canvasFont("stx_yaxis"),t.canvasColor("stx_yaxis"),y.textAlign=m?"right":"left",d?(textX=u.left+3,m&&(textX=u.left+u.width-f-3)):(textX=u.left+f+3,m&&(textX=u.left+u.width)),y.fillStyle=o,y.fillText(n,textX,x),y.fillStyle=s,y.fillText(r,textX,b),y.fillStyle=v)}t.endClip(),y.globalAlpha=1,u.name==i.name&&(u.yAxisPlotter=new e.Plotter)}},e.Studies.createHistogram=function(t,i,a,r,n){var s=t.panels[i.panel],o=t.getYAxisByName(s,i.name),l=o||s.yAxis;t.startClip(s.name);var h=t.layout.candleWidth-2;h<2&&(h=1);var c=t.pixelFromPrice(0,s,o);l.min>0&&(c=t.pixelFromPrice(l.min,s,o)),r&&(c=Math.floor(s.top+s.height/2));var u=t.chart.context,p=i.name+"_hist";i.outputs["Decreasing Bar"]||i.outputs["Negative Bar"]?u.globalAlpha=n||1:t.canvasColor("stx_histogram");for(var d=null,m=null,g=i.outputs,f=0;f<a.length;f++){var y=a[f];if(y){y.candleWidth&&(h=Math.floor(Math.max(1,y.candleWidth-2)));var v=Math.floor(t.pixelFromBar(f,s.chart)-h/2),x=Math.floor(h);if(null===d){var b=t.tickFromPixel(v,s.chart)-1;d=b<0?m:t.pixelFromPrice(t.chart.dataSet[b][p],s,o)-c}else d=m;m=t.pixelFromPrice(y[p],s,o)-c;var C=e.Studies.determineColor(g["Decreasing Bar"]),S=e.Studies.determineColor(g["Increasing Bar"]),w=e.Studies.determineColor(g["Positive Bar"]),T=e.Studies.determineColor(g["Negative Bar"]);C&&m>d?u.fillStyle=C:S&&m<d?u.fillStyle=S:w&&m<0?u.fillStyle=w:T&&m>0&&(u.fillStyle=T),u.fillRect(v,c,x,Math.floor(m))}}u.globalAlpha=1,t.endClip()},e.Studies.volumeChart=function(t,e,i,a){var r,n,s=-1*Number.MAX_VALUE;for(r in i)for(var o=0;o<i[r].length;o++)(n=i[r][o])&&n>s&&(s=n);var l=t.panels[e.panel],h=Math.floor(l.yAxis.bottom)+.5,c=h-(Math.floor(l.yAxis.top)+.5),u=t.layout.candleWidth,p=null;e.parameters&&e.parameters.displayBorder||(a=null);var d=0;a||(d=(u-t.chart.tmpWidth)/2);var m=t.chart.context;for(r in m.lineWidth=1,t.startClip(e.panel),i){a&&(p=a[r]),m.fillStyle=r,p&&(m.strokeStyle=p),m.beginPath();for(var g,f=h+.5,y=Math.floor(t.pixelFromBar(0,l.chart)),v=0;v<i[r].length;v++)if(t.chart.dataSegment[v]&&t.chart.dataSegment[v].candleWidth?(u=t.chart.dataSegment[v].candleWidth,a||(d=u/4)):(u=t.layout.candleWidth,a||(d=(u-t.chart.tmpWidth)/2)),0===v&&(g=y-=u/2),n=i[r][v]){var x,b,C=n*(c/s),S=Math.min(Math.floor(h-c+(c-C))+.5,h);x=Math.floor(g+d),b=Math.floor(g+u-d),x=Math.max(x,y),m.moveTo(x,h),m.lineTo(b,h),m.lineTo(b,S),m.lineTo(x,S),a?(f>S||0===v)&&m.lineTo(x,f):m.lineTo(x,h),f=S,g+=u}else f=h,g+=u;m.fill(),m.strokeStyle=p,a&&t.layout.candleWidth>=2&&m.stroke(),m.closePath()}t.endClip()},e.Studies.prettify={Close:"C",Open:"O",High:"H",Low:"L",simple:"ma",exponential:"ema","time series":"tsma",triangular:"tma",variable:"vma",VIDYA:"vdma",weighted:"wma","welles wilder":"smma",true:"y",false:"n"},e.Studies.prettyRE=/^.*\((.*?)\).*$/,e.Studies.prettyDisplay=function(t){var i=e.Studies.prettyRE.exec(t);if(!i)return t;var a=i[1];if(a){for(var r in e.Studies.prettify)a=a.replace(r,e.Studies.prettify[r]);t=t.replace(i[1],a)}return t},e.Studies.getFieldInputs=function(t){var e=[],i=t.study.inputs;for(var a in i)"field"==i[a]&&e.push(a);return e},e.Studies.initializeFN=function(t,i,a,r,n,s,o){function l(i,a,r){for(var n=null,s=e.Studies.getFieldInputs(h),o=(t.chart.highLowBars||t.highLowBars[t.layout.chartType],0);o<s.length;o++){var l=e.Studies.studyPanelMap[i[s[o]]];if(l){n=l.panel;break}}return n||(n=a.chartName),n}a||(a={id:i}),n||(n={}),a.display||(a.display=a.id);var h=new e.Studies.StudyDescriptor(a.id,i,a.id,a,r,n);a.Period&&(h.days=Math.max(1,parseInt(h.inputs.Period,10))),o?(o.inputs||(o.inputs=h.study.inputs),o.outputs||(o.outputs=h.study.outputs),h.study=o):o=h.study,o.display&&(a.display=o.display),s||(s=a.id);var c=!1,u=!1;"Own panel"==n.panelName?h.underlay=h.overlay=!1:(c=h.overlay||o.overlay||a.Overlay||!!n.panelName,(u=h.underlay||o.underlay||a.Underlay||n.panelName&&n.underlayEnabled)&&(h.underlay=!0),c&&(h.overlay=!0));var p=n.replaceID?t.layout.studies[n.replaceID]:null;if(p&&(t.panelExists(n.replaceID)||c||u))if(c||u)n.replaceID!=h.inputs.id&&(delete t.layout.studies[n.replaceID],delete t.overlays[n.replaceID]),e.deleteRHS(e.Studies.studyPanelMap,p),t.panelExists(n.replaceID)&&t.panelClose(t.panels[n.replaceID]),t.panels[n.panelName]?h.panel=n.panelName:h.panel=l(a,n,t.panels);else{h.panel=s;var d={};for(var m in t.panels)if(m==n.replaceID){var g=t.panels[m];g.name=s,g.yAxis&&(g.yAxis.name=s),g.display=a.display,d[s]=g,n.replaceID!=s&&e.deleteRHS(e.Studies.studyPanelMap,p),t.moveMarkers&&t.moveMarkers(n.replaceID,s)}else d[m]=t.panels[m];t.panels=d,n.replaceID!=h.inputs.id&&delete t.layout.studies[n.replaceID]}else if(t.panelExists(s))h.panel=s,c||u||(t.panels[s].yAxis.name=h.name),h.underlay||h.panel!=t.chart.name||(c=h.overlay=!0);else if(c||u)h.panel=l(a,n,t.panels);else{var f=o.panelHeight?o.panelHeight:null,y=new e.ChartEngine.YAxis(o.yAxis);y.name=h.name,p&&(n.replaceID!=h.inputs.id?e.Studies.removeStudy(t,p):delete t.overlays[n.replaceID]),t.createPanel(a.display,a.id,f,n.chartName,y)}var v=t.panels[h.panel],x=!0;if(p){var b=t.panels[p.panel],C=t.getYAxisByName(b,p.name);b&&C&&(C.name=h.name,(x=b!=v||C.position!=n.yaxisDisplayValue)?t.deleteYAxisIfUnused(b,C):n.yaxisDisplayColor&&"auto"!=n.yaxisDisplayColor?C.textStyle=e.colorToHex(n.yaxisDisplayColor):delete C.textStyle)}if(x){var S=o?e.clone(o.yAxis):null;if(S?e.extend(S,n.yAxis):S=n.yAxis,c||u){if((S||n.yaxisDisplayValue)&&"shared"!=n.yaxisDisplayValue){var w={name:h.name,position:n.yaxisDisplayValue};S&&(w=e.extend(S,w));var T=new e.ChartEngine.YAxis(w);"none"==T.position&&(T.width=0);var M=t.addYAxis(v,T);"none"==T.position&&(M.width=0),M.displayGridLines=!1,n.yaxisDisplayColor&&"auto"!=n.yaxisDisplayColor&&(M.textStyle=e.colorToHex(n.yaxisDisplayColor))}}else{if(S)(S=e.extend(v.yAxis,S)).ground&&(S.initialMarginBottom=0),(S.ground||S.initialMarginTop||0===S.initialMarginTop||S.initialMarginBottom||0===S.initialMarginBottom)&&t.calculateYAxisMargins(S);else{var D=o?o.parameters:null;D&&(D.zoom||0===D.zoom)?v.yAxis.zoom=D.zoom:v.yAxis.zoom||(v.yAxis.zoom=10)}n.yaxisDisplayValue&&"shared"!=n.yaxisDisplayValue?(v.yAxis.position=n.yaxisDisplayValue,v.yAxis.width="none"==n.yaxisDisplayValue?0:(new e.ChartEngine.YAxis).width,v.yAxis.justifyRight=null,n.yaxisDisplayColor&&"auto"!=n.yaxisDisplayColor?v.yAxis.textStyle=e.colorToHex(n.yaxisDisplayColor):delete v.yAxis.textStyle,t.calculateYAxisPositions()):S&&S.position&&t.calculateYAxisPositions()}}return!o.yAxis&&t.panels[a.id]&&(t.panels[a.id].yAxis.displayGridLines=t.displayGridLinesInStudies),h},e.Studies.overZones=e.Studies.drawZones,e.Studies.displayPSAR2=function(t,i,a){var r=t.panels[i.panel],n=t.getYAxisByName(r,i.name),s=r.name==r.chart.name&&!n;t.startClip(r.name);var o=t.chart.context,l="squarewave"==i.inputs["Plot Type"];for(var h in i.outputs){var c=h+" "+i.name;o.beginPath();for(var u=t.layout.candleWidth,p=Math.max(3,Math.floor(t.chart.tmpWidth/2)),d=0;d<a.length;d++){var m=a[d];if(m&&(m[c]||0===m[c])){m.candleWidth&&(u=m.candleWidth),s&&m.transform&&(m=m.transform);var g=t.pixelFromBar(d,r.chart);l&&(g-=u/2);var f=t.pixelFromTransformedValue(m[c],r,n);if(0!==d&&a[d-1]&&(a[d-1][c]||0===a[d-1][c])||o.moveTo(g,f),l){if(o.lineTo(g,f),o.lineTo(g+u,f),a[d+1]){var y=a[d+1];s&&y.transform&&(y=y.transform),y[c]||0===y[c]||o.lineTo(g+u,t.pixelFromTransformedValue(y[i.referenceOutput+" "+i.name],t.panels[i.panel],n))}}else o.moveTo(g-p/2,f),o.lineTo(g+p/2,f)}}o.lineWidth=1,i.highlight&&(o.lineWidth=3);var v=e.Studies.determineColor(i.outputs[h]);"auto"==v&&(v=t.defaultColor),o.strokeStyle=v,o.stroke(),o.closePath(),o.lineWidth=1}t.endClip()},e.Studies.initializeStochastics=function(t,i,a,r){return a.display=t.translateIf("Stoch")+" ("+a.Period+")",e.Studies.initializeFN.apply(null,arguments)},e.Studies.calculateVolume=function(t,i){var a=i.outputs,r=e.Studies.determineColor(a["Up Volume"]),n=e.Studies.determineColor(a["Down Volume"]);if("vol undr"!=i.type)t.setStyle("stx_volume_up","color",r),t.setStyle("stx_volume_down","color",n);else{if(!t||!t.chart.dataSet)return;var s=t.layout,o=i.parameters.removeStudy,l=s.volumeUnderlay;s.volumeUnderlay=!o,l!=s.volumeUnderlay&&t.changeOccurred("layout"),o?e.Studies.removeStudy(t,i):(t.setStyle("stx_volume_underlay_up","color",r),t.setStyle("stx_volume_underlay_down","color",n))}},e.Studies.MA=function(t,i,a,r,n,s,o,l){var h=new e.Studies.StudyDescriptor(n+" "+o.name,"ma",o.panel);h.chart=o.chart,h.days=parseInt(i,10),h.startFrom=o.startFrom,h.subField=l,h.inputs={},t&&(h.inputs.Type=t),a&&(h.inputs.Field=a),r&&(h.inputs.Offset=parseInt(r,10)),e.Studies.calculateMovingAverage(s,h)},e.Studies.movingAverage={conversions:{ma:"simple",sma:"simple",ema:"exponential",tsma:"time series",tma:"triangular",vma:"variable",vdma:"vidya",wma:"weighted",smma:"welles wilder"},translations:{simple:"Simple",exponential:"Exponential","time series":"Time Series",triangular:"Triangular",variable:"Variable",vidya:"VIDYA",weighted:"Weighted","welles wilder":"Welles Wilder"},typeMap:{ema:"Exponential",exponential:"Exponential",tsma:"TimeSeries","time series":"TimeSeries",tma:"Triangular",triangular:"Triangular",vma:"Variable",variable:"Variable",vdma:"VIDYA",vidya:"VIDYA",wma:"Weighted",weighted:"Weighted",smma:"Exponential","welles wilder":"Exponential"}},e.Studies.movingAverageHelper=function(t,i){if("options"==i){var a={};for(var r in e.Studies.movingAverage.translations)a[r]=t.translateIf(e.Studies.movingAverage.translations[r]);return a}return e.Studies.movingAverage.conversions[i]},e.Studies.volUnderlay=function(t,i,a){e.Studies.createVolumeChart(t,i,a)},e.Studies.createVolumeChart=function(t,i,a){var r=i.panel,n=i.inputs,s=i.underlay,o=i.overlay,l=s||o,h=s?"stx_volume_underlay":"stx_volume",c=[{field:"Volume",fill_color_up:t.canvasStyle(h+"_up").color,border_color_up:t.canvasStyle(h+"_up").borderLeftColor,opacity_up:t.canvasStyle(h+"_up").opacity,fill_color_down:t.canvasStyle(h+"_down").color,border_color_down:t.canvasStyle(h+"_down").borderLeftColor,opacity_down:t.canvasStyle(h+"_down").opacity}],u=c[0];s||"rgb(184, 44, 12)"!==u.border_color_down||(u.border_color_down="#000000",u.border_color_up="#000000");var p=t.getYAxisByName(r,i.name),d={name:"Volume",panel:r,yAxis:p,heightPercentage:n.HeightPercentage?n.HeightPercentage:l?.25:null,widthFactor:1,bindToYAxis:!p||"none"!=p.position};e.extend(d,i.study.parameters),e.extend(d,i.parameters),t.colorByCandleDirection&&(u.color_function=function(t){var e=t.Open,i=t.Close;return{fill_color:e>i?u.fill_color_down:u.fill_color_up,border_color:e>i?u.border_color_down:u.border_color_up,opacity:e>i?u.opacity_down:u.opacity_up}}),i.outputMap.Volume=null,t.drawHistogram(d,c)},e.Studies.calculateRSI=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{for(var a=e.startFrom;a<i.length;a++)if(a){var r=i[a],n=i[a-1],s=r.Close-n.Close,o=Math.min(a,e.days),l=n["_avgG "+e.name];l||(l=0),l-=l/o;var h=n["_avgL "+e.name];h||(h=0),h-=h/o,s>0?l+=s/o:h-=s/o,a>=e.days&&(r["RSI "+e.name]=0===(c=h)?100:100-100/(1+l/c)),r["_avgG "+e.name]=l,r["_avgL "+e.name]=h}var c;e.zoneOutput="RSI"}},e.Studies.calculateMACD=function(t,i){var a=i.chart.scrubbed,r=i.inputs,n=i.name;if(i.macd1Days||(i.macd1Days=parseFloat(r["Fast MA Period"])),i.macd2Days||(i.macd2Days=parseFloat(r["Slow MA Period"])),i.signalDays||(i.signalDays=parseFloat(r["Signal Period"])),i.days||(i.days=Math.max(i.macd1Days,i.macd2Days,i.signalDays)),a.length<i.days+1)i.error=!0;else{var s=i.inputs.Field;s&&"field"!=s||(s="Close");var o=r["Moving Average Type"];o||(o="exponential"),e.Studies.MA(o,i.macd1Days,s,0,"_MACD1",t,i),e.Studies.MA(o,i.macd2Days,s,0,"_MACD2",t,i);var l,h,c=Math.max(i.startFrom,i.days-1);for(l=c;l<a.length;l++)(h=a[l])["MACD "+n]=h["_MACD1 "+n]-h["_MACD2 "+n];var u=r["Signal MA Type"];u||(u="exponential"),e.Studies.MA(u,i.signalDays,"MACD "+n,0,"Signal",t,i);var p=n+"_hist";for(l=c;l<a.length;l++){var d=(h=a[l])["Signal "+n];(d||0===d)&&(h[p]=h["MACD "+n]-h["Signal "+n])}}},e.Studies.calculateStandardDeviation=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");var n=i.inputs["Moving Average Type"];n||(n=i.inputs.Type),e.Studies.MA(n,i.days,r,i.inputs.Offset,"_MA",t,i);var s=0,o=0,l=0,h=Number(i.inputs["Standard Deviations"]);h<0&&(h=2);var c,u,p,d=i.name;for(var m in i.outputs)d=m+" "+d;for(c=i.startFrom-1,p=0;c>=0&&p<i.days;c--,p++)u=a[c][r],isNaN(u)&&(u=0),s+=Math.pow(u,2),o+=u;for(c=i.startFrom;c<a.length;c++){var g=a[c];if(u=g[r],isNaN(u)&&(u=0),s+=Math.pow(u,2),o+=u,!(c<i.days-1)){if(c>=i.days){var f=a[c-i.days][r];isNaN(f)&&(f=0),s-=Math.pow(f,2),o-=f}l=g["_MA "+i.name],g[d]=Math.sqrt((s+i.days*Math.pow(l,2)-2*l*o)/i.days)*h}}}},e.Studies.calculateMovingAverage=function(t,i){if(i.chart.scrubbed){var a=i.inputs.Type;"ma"!=a&&a||(a="simple");var r=e.Studies.movingAverage.typeMap;if(a in r)return e.Studies["calculateMovingAverage"+r[a]](t,i);if("simple"===a){var n=i.chart.scrubbed,s=0,o=[],l=i.name;for(var h in i.outputs)l=h+" "+l;var c=i.inputs.Field;c&&"field"!=c||(c="Close");var u=parseInt(i.inputs.Offset,10);isNaN(u)&&(u=0);var p,d,m=i.startFrom,g=u;for(p=i.startFrom-1;p>=0;p--)if((d=n[p][c])||0===d)if(g>0)g--,m=p;else{if(o.length==i.days-1)break;s+=d,o.unshift(d)}for(o.length<i.days-1&&(o=[],m=0),p=m;p<n.length;p++){if((d=n[p][c])&&"object"==typeof d)d=d[i.subField||"Close"];var f=p+u>=0&&p+u<n.length?n[p+u]:null;d||0===d?(s+=d,o.push(d),o.length>i.days&&(s-=o.shift()),f&&(f[l]=o.length==i.days?s/i.days:null)):f&&(f[l]=null)}}}},e.Studies.calculateMovingAverageExponential=function(t,e){var i=e.inputs.Type,a=e.chart.scrubbed,r=0,n=0,s=0,o=2/(e.days+1);"welles wilder"!==i&&"smma"!==i||(o=1/e.days);var l=null,h=e.name;for(var c in e.outputs)h=c+" "+h;var u=e.inputs.Field;u&&"field"!=u||(u="Close");var p,d,m=parseInt(e.inputs.Offset,10);isNaN(m)&&(m=0);var g=e.startFrom,f=m;for(p=e.startFrom-1;p>=0;p--)if((d=a[p][h])||0===d){if(null===l&&(l=d),s=e.days,f<=0)break;f--,g=p}for(null===l&&(l=g=0),p=g;p<a.length;p++){d=a[p][u];var y=p+m>=0&&p+m<a.length?a[p+m]:null;d||0===d?(s==e.days-1?(n=(r+=d)/e.days,y&&(y[h]=n)):s<e.days-1?(n=(r+=d)/(s+1),y&&(y[h]=null)):0===s?(n=r+=d,y&&(y[h]=null)):(l||0===l)&&(n=(d-l)*o+l,y&&(y[h]=n)),l=n,s++):y&&(y[h]=null)}},e.Studies.calculateMovingAverageVariable=function(t,i){i.inputs.Type;var a=i.chart.scrubbed,r=2/(i.days+1),n=null,s=i.name;for(var o in i.outputs)s=o+" "+s;var l=i.inputs.Field;l&&"field"!=l||(l="Close"),i.cmo=new e.Studies.StudyDescriptor(i.name,"cmo",i.panel),i.cmo.chart=i.chart,i.cmo.days=9,i.cmo.startFrom=i.startFrom,i.cmo.outputs={_CMO:null},e.Studies.calculateChandeMomentum(t,i.cmo);var h,c,u=parseInt(i.inputs.Offset,10);isNaN(u)&&(u=0);var p=i.startFrom,d=u;for(h=i.startFrom-1;h>=0;h--)if((c=a[h][s])||0===c){if(null===n&&(n=c),d<=0)break;d--,p=h}for(null===n&&(n=p=0),h=p;h<a.length;h++){var m=a[h];c=m[l];var g=h+u>=0&&h+u<a.length?a[h+u]:null;if(c||0===c){if(m["_CMO "+i.name]||0===m["_CMO "+i.name]){var f=Math.abs(m["_CMO "+i.name])/100,y=r*f*c+(1-r*f)*n;n=y,h<i.days&&(y=null),g&&(g[s]=y)}}else g&&(g[s]=null)}},e.Studies.calculateMovingAverageVIDYA=function(t,i){i.inputs.Type;var a=i.chart.scrubbed,r=2/(i.days+1),n=null,s=i.name;for(var o in i.outputs)s=o+" "+s;var l=i.inputs.Field;l&&"field"!=l||(l="Close"),i.std=new e.Studies.StudyDescriptor(i.name,"sdev",i.panel),i.std.chart=i.chart,i.std.days=5,i.std.startFrom=i.startFrom,i.std.inputs={Field:l,"Standard Deviations":1,Type:"ma"},i.std.outputs={_STD:null},e.Studies.calculateStandardDeviation(t,i.std),e.Studies.MA("ma",20,"_STD "+i.name,0,"_MASTD",t,i);var h,c,u=parseInt(i.inputs.Offset,10);isNaN(u)&&(u=0);var p=i.startFrom,d=u;for(h=i.startFrom-1;h>=0;h--)if((c=a[h][s])||0===c){if(null===n&&(n=c),d<=0)break;d--,p=h}for(null===n&&(n=p=0),h=p;h<a.length;h++){var m=a[h];c=m[l];var g=h+u>=0&&h+u<a.length?a[h+u]:null;if(c||0===c){if(m["_MASTD "+i.name]||0===m["_MASTD "+i.name]){var f=m["_STD "+i.name]/m["_MASTD "+i.name],y=r*f*c+(1-r*f)*n;n=y,h<i.days&&(y=null),g&&(g[s]=y)}}else g&&(g[s]=null)}},e.Studies.calculateMovingAverageTimeSeries=function(t,i){i.ma=new e.Studies.StudyDescriptor(i.name,"ma",i.panel),i.ma.chart=i.chart,i.ma.days=i.days,i.ma.startFrom=i.startFrom,i.ma.inputs=i.inputs,e.Studies.calculateLinearRegressionIndicator(t,i.ma);var a=i.name;for(var r in i.outputs)a=r+" "+a;var n=parseInt(i.inputs.Offset,10);isNaN(n)&&(n=0);for(var s=i.chart.scrubbed,o=n,l=i.startFrom-1;l>=0;l--){var h=s[l][a];if(h||0===h){if(!(o>0))break;o--}}for(l++;l<s.length;l++){var c=s[l];l+n>=0&&l+n<s.length&&(s[l+n][a]=c["Forecast "+i.name])}},e.Studies.calculateMovingAverageTriangular=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var n=Math.ceil(i.days/2);e.Studies.MA("simple",n,i.inputs.Field,0,"TRI1",t,i),i.days%2==0&&n++,e.Studies.MA("simple",n,"TRI1 "+i.name,0,"TRI2",t,i);var s=i.name;for(var o in i.outputs)s=o+" "+s;var l=parseInt(i.inputs.Offset,10);isNaN(l)&&(l=0);for(var h=l,c=i.startFrom-1;c>=0;c--){var u=a[c][s];if(u||0===u){if(!(h>0))break;h--}}for(c++;c<a.length;c++)c+l>=0&&c+l<a.length&&(a[c+l][s]=a[c]["TRI2 "+i.name])},e.Studies.calculateMovingAverageWeighted=function(t,e){var i=e.chart.scrubbed,a=0,r=0,n=e.inputs.Field;n&&"field"!=n||(n="Close");var s=e.days*(e.days+1)/2,o=e.name;for(var l in e.outputs)o=l+" "+o;var h,c,u=parseInt(e.inputs.Offset,10);isNaN(u)&&(u=0);var p=[],d=e.startFrom,m=u;for(h=e.startFrom-1;h>=0;h--)if((c=i[h][n])||0===c)if(m>0)m--,d=h;else{if(p.length==e.days-1)break;p.unshift(c)}for(p.length<e.days-1&&(p=[],d=0),h=0;h<p.length;h++)a+=(h+1)*p[h],r+=p[h];for(h=d;h<i.length;h++){c=i[h][n];var g=h+u>=0&&h+u<i.length?i[h+u]:null;c||0===c?(p.push(c),p.length>e.days&&(a-=r,r-=p.shift()),a+=p.length*c,r+=c,h<e.days-1?g&&(g[o]=null):g&&(g[o]=a/s)):g&&(g[o]=null)}},e.Studies.calculateKlinger=function(t,i){var a=i.chart.scrubbed,r=Number(i.inputs["Short Cycle"]),n=Number(i.inputs["Long Cycle"]);if(a.length<Math.max(r,n)+1)i.error=!0;else{var s,o=i.name+"_hist",l="Klinger "+i.name,h="KlingerSignal "+i.name,c="_SV "+i.name,u="_EMA-S "+i.name,p="_EMA-L "+i.name;for(s=Math.max(1,i.startFrom);s<a.length;s++){var d=a[s].Volume;a[s]["hlc/3"]<a[s-1]["hlc/3"]&&(d*=-1),a[s][c]=d}for(e.Studies.MA("exponential",r,c,0,"_EMA-S",t,i),e.Studies.MA("exponential",n,c,0,"_EMA-L",t,i),s=Math.max(n,i.startFrom);s<a.length;s++)a[s][l]=a[s][u]-a[s][p];for(e.Studies.MA("exponential",Number(i.inputs["Signal Periods"]),l,0,"KlingerSignal",t,i),s=i.startFrom;s<a.length;s++)a[s][o]=a[s][l]-a[s][h]}},e.Studies.calculateStochastics=function(t,i){i.smooth||(i.smooth=i.inputs.Smooth);var a=i.inputs.Field;a&&"field"!=a||(a="Close");var r=i.inputs["%K Periods"];r||(r=i.days);var n=i.chart.scrubbed;if(n.length<Math.max(r,i.days)+1)i.error=!0;else{var s=i.inputs["%K Smoothing Periods"];s?i.smooth=!0:i.smooth&&(s=3);var o=i.inputs["%D Periods"];o||(o=3),i.outputMap={},i.outputMap["%K "+i.name]="Fast",i.outputMap["%D "+i.name]="Slow";for(var l=Math.max(r,i.startFrom);l<n.length;l++)n[l][i.name]=h(l,a,r);e.Studies.MA("simple",i.smooth?s:1,i.name,0,"%K",t,i),e.Studies.MA("simple",o,"%K "+i.name,0,"%D",t,i)}function h(t,e,i){for(var a=t-i+1,r=-1*Number.MAX_VALUE,s=Number.MAX_VALUE,o=a;o<=t;o++)s=Math.min(s,n[o].Low),r=Math.max(r,n[o].High);return r==s?0:(n[t][e]-s)/(r-s)*100}},e.Studies.calculateStudyATR=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else for(var r=0,n=e.name,s=Math.max(e.startFrom,1);s<i.length;s++){var o=i[s],l=i[s-1],h=o.trueRange;l["Sum True Range "+n]&&(r=l["Sum True Range "+n]),r+=h,s>a&&(r-=i[s-a]["True Range "+n]),o["True Range "+n]=h,o["Sum True Range "+n]=r,s==a?o["ATR "+n]=r/a:s>a&&(o["ATR "+n]=(l["ATR "+n]*(a-1)+h)/a)}},e.Studies.calculatePSAR=function(t,e){var i=e.chart.scrubbed,a=0,r=null,n=!1,s=0,o=parseFloat(e.inputs["Minimum AF"]),l=parseFloat(e.inputs["Maximum AF"]);function h(){a=0,r=null,n=!n}if(e.startFrom>0){s=i[e.startFrom-1]["Result "+e.name];var c=i[e.startFrom-1]["_state "+e.name];c&&3==c.length&&(a=c[0],r=c[1],n=c[2])}for(var u=e.startFrom-1;u<i.length-1;u++)if(!(u<0)){var p=s;if(n){(!r||r<i[u].High)&&(r=i[u].High,a=Math.min(a+o,l)),s=p+a*(r-p);var d=Math.min(i[Math.max(1,u)-1].Low,i[u].Low);s>i[u+1].Low?(s=r,h()):s>d&&(s=d)}else{(!r||r>i[u].Low)&&(r=i[u].Low,a=Math.min(a+o,l)),s=p+a*(r-p);var m=Math.max(i[Math.max(1,u)-1].High,i[u].High);s<i[u+1].High?(s=r,h()):s<m&&(s=m)}i[u+1]["Result "+e.name]=s,i[u+1]["_state "+e.name]=[a,r,n]}},e.Studies.calculateTRIX=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{for(var r=i.name,n=["Close","_MA1 "+r,"_MA2 "+r,"_MA3 "+r],s=0;s<n.length-1;s++)e.Studies.MA("exponential",i.days,n[s],0,"_MA"+(s+1).toString(),t,i);for(var o=n[3],l=Math.max(1,i.startFrom);l<a.length;l++){var h=a[l-1][o];h&&(a[l]["Result "+r]=100*(a[l][o]/h-1))}}},e.Studies.calculateIntradayMomentum=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else{var r=0,n=0;e.startFrom>1&&(r=i[e.startFrom-1]["_totUp "+e.name],n=i[e.startFrom-1]["_totDn "+e.name]);for(var s=e.startFrom;s<i.length;s++){var o=i[s].Close-i[s].Open;if(o>0?r+=o:n-=o,s>=a){var l=i[s-a].Close-i[s-a].Open;l>0?r-=l:n+=l}i[s]["Result "+e.name]=100*r/(r+n),i[s]["_totUp "+e.name]=r,i[s]["_totDn "+e.name]=n}}},e.Studies.calculateQStick=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{for(var r=i.startFrom;r<a.length;r++)a[r]["_Close-Open "+i.name]=a[r].Close-a[r].Open;e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_Close-Open "+i.name,0,"Result",t,i)}},e.Studies.calculateSchaff=function(t,i){var a=i.chart.scrubbed,r=i.days,n=Number(i.inputs["Short Cycle"]),s=Number(i.inputs["Long Cycle"]);if(a.length<Math.max(r,n,s)+1)i.error=!0;else{var o=i.inputs.Field;o&&"field"!=o||(o="Close");e.Studies.MA(i.inputs["Moving Average Type"],n,o,0,"_MACD1",t,i),e.Studies.MA(i.inputs["Moving Average Type"],s,o,0,"_MACD2",t,i);for(var l=0,h=0,c=i.startFrom;c<a.length;c++){var u=a[c];if(u["Result "+i.name]=h,!(c<s-1||(u["_MACD "+i.name]=u["_MACD1 "+i.name]-u["_MACD2 "+i.name],c<s+(r-1)))){var p=d(r,c,"_MACD");l=p[1]>p[0]?100*(u["_MACD "+i.name]-p[0])/(p[1]-p[0]):l,u["_PF "+i.name]=a[c-1]["_PF "+i.name]?a[c-1]["_PF "+i.name]+.5*(l-a[c-1]["_PF "+i.name]):l,c<s+2*(r-1)||(h=(p=d(r,c,"_PF"))[1]>p[0]?100*(u["_PF "+i.name]-p[0])/(p[1]-p[0]):h,u["Result "+i.name]=a[c-1]["Result "+i.name]?a[c-1]["Result "+i.name]+.5*(h-a[c-1]["Result "+i.name]):h)}}}function d(t,e,r){for(var n=null,s=null,o=e-t+1;o<=e;o++){var l=a[o][r+" "+i.name];l&&(n=null===n?l:Math.min(n,l),s=null===s?l:Math.max(s,l))}return[n,s]}},e.Studies.calculateStochMomentum=function(t,i){var a=Number(i.inputs["%K Periods"]),r=Number(i.inputs["%K Smoothing Periods"]),n=Number(i.inputs["%K Double Smoothing Periods"]),s=Number(i.inputs["%D Periods"]),o=i.chart.scrubbed;if(o.length<a+r+n-1||o.length<s)i.error=!0;else{var l;for(l=Math.max(a,i.startFrom)-1;l<o.length;l++){var h=o[l],c=u(a,l);h["_H "+i.name]=h.Close-(c[0]+c[1])/2,h["_DHL "+i.name]=c[1]-c[0]}for(e.Studies.MA("exponential",r,"_H "+i.name,0,"_HS1",t,i),e.Studies.MA("exponential",n,"_HS1 "+i.name,0,"_HS2",t,i),e.Studies.MA("exponential",r,"_DHL "+i.name,0,"_DHL1",t,i),e.Studies.MA("exponential",n,"_DHL1 "+i.name,0,"_DHL2",t,i),l=a-1;l<o.length;l++)o[l]["%K "+i.name]=o[l]["_HS2 "+i.name]/(.5*o[l]["_DHL2 "+i.name])*100;e.Studies.MA(i.inputs["%D Moving Average Type"],s,"%K "+i.name,0,"%D",t,i),i.zoneOutput="%K"}function u(t,e){for(var i=null,a=null,r=e-t+1;r<=e;r++)i=null===i?o[r].Low:Math.min(i,o[r].Low),a=null===a?o[r].High:Math.max(a,o[r].High);return[i,a]}},e.Studies.calculateEhlerFisher=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=0;e.startFrom>1&&(a=i[e.startFrom-1]["_n "+e.name]);for(var r=e.startFrom;r<i.length;r++){var n=i[r];if(r<e.days-1)n["EF "+e.name]=n["EF Trigger "+e.name]=a;else{var s=l(e.days,r);(a=.66*(((i[r].High+i[r].Low)/2-s[0])/Math.max(1e-6,s[1]-s[0])-.5)+.67*a)>0?a=Math.min(a,.9999):a<0&&(a=Math.max(a,-.9999));var o=r?i[r-1]["EF "+e.name]:0;n["EF "+e.name]=.5*Math.log((1+a)/(1-a))+.5*o,n["EF Trigger "+e.name]=o,n["_n "+e.name]=a}}}function l(t,e){for(var a=Number.MAX_VALUE,r=-1*Number.MAX_VALUE,n=e-t+1;n<=e;n++){var s=(i[n].High+i[n].Low)/2;a=Math.min(a,s),r=Math.max(r,s)}return[a,r]}},e.Studies.calculatePrettyGoodOscillator=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{e.Studies.MA("exponential",i.days,"trueRange",0,"_EMA",t,i),e.Studies.MA("simple",i.days,"Close",0,"_SMA",t,i);for(var r=Math.max(1,i.startFrom);r<a.length;r++)a[r]["_SMA "+i.name]&&a[r]["_EMA "+i.name]&&(a[r]["Result "+i.name]=(a[r].Close-a[r]["_SMA "+i.name])/a[r]["_EMA "+i.name])}},e.Studies.calculateUltimateOscillator=function(t,e){var i=e.chart.scrubbed,a=[e.inputs["Cycle 1"],e.inputs["Cycle 2"],e.inputs["Cycle 3"]],r=Math.max(a[0],a[1],a[2]);if(i.length<r+1)e.error=!0;else{var n=a[0]*a[1],s=a[0]*a[2],o=a[1]*a[2],l=[0,0,0],h=[0,0,0];e.startFrom&&(i[e.startFrom-1]["_accbp "+e.name]&&(l=i[e.startFrom-1]["_accbp "+e.name].slice()),i[e.startFrom-1]["_acctr "+e.name]&&(h=i[e.startFrom-1]["_acctr "+e.name].slice()));for(var c=Math.max(1,e.startFrom);c<i.length;c++){for(var u=Math.min(i[c].Low,i[c-1].Close),p=i[c].Close-u,d=Math.max(i[c].High,i[c-1].Close)-u,m=0;m<a.length;m++)if(l[m]+=p,h[m]+=d,c>a[m]){var g=Math.min(i[c-a[m]].Low,i[c-a[m]-1].Close),f=i[c-a[m]].Close-g,y=Math.max(i[c-a[m]].High,i[c-a[m]-1].Close)-g;l[m]-=f,h[m]-=y}if(i[c]["_accbp "+e.name]=l.slice(),i[c]["_acctr "+e.name]=h.slice(),!(c<r)){var v=o*l[0]/h[0]+s*l[1]/h[1]+n*l[2]/h[2],x=o+s+n;i[c]["Result "+e.name]=100*v/x}}}},e.Studies.calculatePriceVolumeTrend=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var a=e.chart.scrubbed,r=0;e.startFrom>1&&(r=a[e.startFrom-1]["Result "+e.name]);for(var n=Math.max(1,e.startFrom);n<a.length;n++)a[n][i]&&a[n-1][i]&&(r+=a[n].Volume*(a[n][i]-a[n-1][i])/a[n-1][i],a[n]["Result "+e.name]=r)},e.Studies.calculateOnBalanceVolume=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var a=e.inputs["Min Tick Value"],r=!1;a||0===a||(r=!0,a=0);for(var n,s,o=e.chart.scrubbed,l=0,h=e.startFrom;h<o.length;h++)if(n=o[h],h&&n[i]&&(o[h-1][i]&&(s=o[h-1]),s)){n[i]-s[i]>a?l=1:s[i]-n[i]>a?l=-1:r&&(l=0);var c=s["Result "+e.name];c||(c=0),c+=n.Volume*l,n["Result "+e.name]=c}},e.Studies.calculateVolumeIndex=function(t,i){var a=i.inputs.Field;a&&"field"!=a||(a="Close");var r=i.chart.scrubbed;if(r.length<i.days+1)i.error=!0;else{var n=100;i.startFrom>1&&(n=r[i.startFrom-1]["Index "+i.name]);for(var s=Math.max(1,i.startFrom);s<r.length;s++)r[s][a]&&r[s-1][a]&&(("Pos Vol"==i.type&&r[s].Volume>r[s-1].Volume||"Neg Vol"==i.type&&r[s].Volume<r[s-1].Volume)&&(n*=r[s][a]/r[s-1][a]),r[s]["Index "+i.name]=n);e.Studies.MA(i.inputs["Moving Average Type"],i.days,"Index "+i.name,0,"MA",t,i)}},e.Studies.calculateHistoricalVolatility=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.inputs["Standard Deviations"];r<0&&(r=1);var n,s=100*Math.sqrt((n=e.inputs["Days Per Year"],isNaN(n)&&(n=365),"day"==t.layout.interval?n:"week"==t.layout.interval?52:"month"==t.layout.interval?12:n))*r,o=[],l=0;e.startFrom>1&&(l=i[e.startFrom-1]["_state "+e.name][0],o=i[e.startFrom-1]["_state "+e.name][1].slice());for(var h=Math.max(1,e.startFrom);h<i.length;h++){var c=i[h-1][a];if(c){var u=Math.log(i[h][a]/c);if(o.push(u),l+=u,h>=e.days){var p=0;l/=e.days;for(var d=0;d<o.length;d++)p+=Math.pow(o[d]-l,2);l*=e.days,l-=o.shift(),i[h]["Result "+e.name]=Math.sqrt(p/e.days)*s}}i[h]["_state "+e.name]=[l,o.slice()]}}},e.Studies.calculateSwingIndex=function(t,e){var i=e.inputs["Limit Move Value"];(null===i||isNaN(i))&&(i=99999);var a=e.chart.scrubbed,r=0;e.startFrom>1&&(r=a[e.startFrom-1]["Result "+e.name]);for(var n=Math.max(1,e.startFrom);n<a.length;n++){var s=Math.abs(a[n].High-a[n-1].Close),o=Math.abs(a[n].Low-a[n-1].Close),l=Math.abs(a[n].High-a[n].Low),h=Math.abs(a[n-1].Close-a[n-1].Open),c=Math.max(s,o),u=Math.max(l,c),p=u+.25*h;u==s?p-=.5*o:u==o&&(p-=.5*s);var d=50*(a[n].Close-a[n-1].Close+.5*(a[n].Close-a[n].Open)+.25*(a[n-1].Close-a[n-1].Open))/p*(c/i);0!==p&&0!==i||(d=0),"Swing"==e.type&&(r=0),r+=d,a[n]["Result "+e.name]=r}},e.Studies.calculateADX=function(t,i){e.Studies.calculateStudyATR(t,i);var a=i.chart.scrubbed,r=i.days,n=parseInt(i.inputs["Smoothing Period"],10);if(n||0===n||(n=r),a.length<i.days+1)i.error=!0;else for(var s,o=0,l=0,h=0,c=0,u=Math.max(1,i.startFrom);u<a.length;u++){s=a[u];var p=Math.max(0,s.High-a[u-1].High),d=Math.max(0,a[u-1].Low-s.Low);if(p>d?d=0:p=d>p?0:d=0,u<=r?(l+=p,h+=d,o+=s["True Range "+i.name]):(l=a[u-1]["_sm+DM "+i.name]*(r-1)/r+p,h=a[u-1]["_sm-DM "+i.name]*(r-1)/r+d,o=a[u-1]["_smTR "+i.name]*(r-1)/r+s["True Range "+i.name]),s["_sm+DM "+i.name]=l,s["_sm-DM "+i.name]=h,s["_smTR "+i.name]=o,!(u<r)){var m=100*l/o,g=100*h/o,f=100*Math.abs(m-g)/(m+g);if(s["+DI "+i.name]=m,s["-DI "+i.name]=g,!1!==i.inputs.Series&&n)if(u<r+n-1){if(u==i.startFrom)for(var y=r;y<i.startFrom;y++)c+=100*Math.abs(a[y]["+DI "+i.name]-a[y]["-DI "+i.name])/(a[y]["+DI "+i.name]+a[y]["-DI "+i.name]);c+=f}else s["ADX "+i.name]=u==r+n-1?c/n:(a[u-1]["ADX "+i.name]*(n-1)+f)/n;if(i.inputs.Histogram){var v=i.name+"_hist";if(!s["+DI "+i.name]&&0!==s["+DI "+i.name])continue;if(!s["-DI "+i.name]&&0!==s["-DI "+i.name])continue;s[v]=s["+DI "+i.name]-s["-DI "+i.name],!1===i.inputs.Series&&(s["+DI "+i.name]=null,s["-DI "+i.name]=null)}}}},e.Studies.calculateRandomWalk=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else for(var a=Math.max(2,e.startFrom);a<i.length;a++){for(var r=0,n=i[a].High,s=i[a].Low,o=0,l=0,h=1;h<=e.days;h++){if(a<=h){o=l=0;break}var c=(r+=i[a-h].trueRange)/h*Math.sqrt(h);if(c){var u=(n-i[a-h].Low)/c,p=(i[a-h].High-s)/c;o=Math.max(o,u),l=Math.max(l,p)}}i[a]["Random Walk High "+e.name]=o,i[a]["Random Walk Low "+e.name]=l}},e.Studies.calculateRateOfChange=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;"Vol ROC"==e.type?a="Volume":a&&"field"!=a||(a="Close");var r=e.name;for(var n in e.outputs)r=n+" "+r;var s=e.inputs["Center Line"];s=s?parseInt(s,10):0;for(var o=Math.max(e.startFrom,e.days);o<i.length;o++)if("Momentum"==e.type)i[o][r]=i[o][a]-i[o-e.days][a]+s;else{var l=i[o-e.days][a];l&&(i[o][r]=100*(i[o][a]/l-1)+s)}}},e.Studies.calculateTypicalPrice=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.overlay||(e.error=!0);else{var r=e.name;for(var n in e.outputs)r=n+" "+r;var s="hlc/3";"Med Price"==e.type?s="hl/2":"Weighted Close"==e.type&&(s="hlcc/4");var o=0;e.startFrom<=a&&(e.startFrom=0);for(var l=e.startFrom;l<i.length;l++)l&&i[l-1][r]&&(o=i[l-1][r]*a),o+=i[l][s],l>=a&&(o-=i[l-a][s],i[l][r]=o/a)}},e.Studies.calculateElderRay=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{e.Studies.MA("exponential",i.days,"Close",0,"_EMA",t,i);for(var r=Math.max(i.startFrom,i.days-1);r<a.length;r++)a[r][i.name+"_hist1"]=a[r].High-a[r]["_EMA "+i.name],a[r][i.name+"_hist2"]=a[r].Low-a[r]["_EMA "+i.name]}},e.Studies.calculateElderForce=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{for(var r=Math.max(1,i.startFrom);r<a.length;r++)a[r]["_EF1 "+i.name]=a[r].Volume*(a[r].Close-a[r-1].Close);e.Studies.MA("exponential",i.days,"_EF1 "+i.name,0,"Result",t,i)}},e.Studies.calculateCenterOfGravity=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");for(var r=Math.max(e.startFrom,e.days-1);r<i.length;r++){for(var n=0,s=0,o=0;o<e.days;o++)n-=(o+1)*i[r-o][a],s+=i[r-o][a];s&&(i[r]["Result "+e.name]=n/s)}}},e.Studies.calculateEaseOfMovement=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{for(var r=Math.max(1,i.startFrom);r<a.length;r++){var n=((a[r].High+a[r].Low)/2-(a[r-1].High+a[r-1].Low)/2)/(a[r].Volume/1e8/(a[r].High-a[r].Low));isFinite(n)?a[r]["_EOM1 "+i.name]=n:a[r]["_EOM1 "+i.name]=NaN}e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_EOM1 "+i.name,0,"Result",t,i)}},e.Studies.calculateChaikinVolatility=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days)i.error=!0;else{var r;for(r=i.startFrom;r<a.length;r++)a[r]["_High-Low "+i.name]=a[r].High-a[r].Low;e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_High-Low "+i.name,0,"_MA",t,i);var n=i.inputs["Rate Of Change"];for(n||(n=i.days),r=Math.max(i.startFrom,n);r<a.length;r++)a[r-n]["_MA "+i.name]&&(a[r]["Result "+i.name]=100*(a[r]["_MA "+i.name]/a[r-n]["_MA "+i.name]-1))}},e.Studies.calculateChaikinMoneyFlow=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=0,r=0,n=i[e.startFrom-1];n&&(n["_sumMF "+e.name]&&(a=n["_sumMF "+e.name]),n["_sumV "+e.name]&&(r=n["_sumV "+e.name]));for(var s=e.startFrom;s<i.length;s++)i[s].High==i[s].Low?i[s]["_MFV "+e.name]=0:i[s]["_MFV "+e.name]=i[s].Volume*(2*i[s].Close-i[s].High-i[s].Low)/(i[s].High-i[s].Low),a+=i[s]["_MFV "+e.name],r+=i[s].Volume,s>e.days-1&&(a-=i[s-e.days]["_MFV "+e.name],(r-=i[s-e.days].Volume)&&(i[s]["Result "+e.name]=a/r)),i[s]["_sumMF "+e.name]=a,i[s]["_sumV "+e.name]=r}},e.Studies.calculateTwiggsMoneyFlow=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)e.error=!0;else{var a=0,r=0,n=i[e.startFrom-1];n&&(n["_sumMF "+e.name]&&(a=n["_sumMF "+e.name]),n["_sumV "+e.name]&&(r=n["_sumV "+e.name]));for(var s=Math.max(1,e.startFrom);s<i.length;s++){var o=Math.max(i[s-1].Close,i[s].High),l=Math.min(i[s-1].Close,i[s].Low);i[s]["_MFV "+e.name]=i[s].Volume*(2*i[s].Close-o-l)/(o-l==0?999999:o-l),s>e.days-1&&(a*=(e.days-1)/e.days,r*=(e.days-1)/e.days),a+=i[s]["_MFV "+e.name],r+=i[s].Volume,s>e.days-1&&r&&(i[s]["Result "+e.name]=a/(r>0?r:999999)),i[s]["_sumMF "+e.name]=a,i[s]["_sumV "+e.name]=r}}},e.Studies.calculateMassIndex=function(t,i){var a=i.chart.scrubbed;if(a.length<Math.max(9,i.days+1))i.error=!0;else{for(var r=i.startFrom;r<a.length;r++)a[r]["_High-Low "+i.name]=a[r].High-a[r].Low;e.Studies.MA("exponential",9,"_High-Low "+i.name,0,"_EMA",t,i),e.Studies.MA("exponential",9,"_EMA "+i.name,0,"_EMA2",t,i);var n=0;a[i.startFrom-1]&&a[i.startFrom-1]["_total "+i.name]&&(n=a[i.startFrom-1]["_total "+i.name]);for(var s=Math.max(17,i.startFrom);s<a.length;s++)n+=a[s]["_EMA "+i.name]/a[s]["_EMA2 "+i.name],s>=17+i.days-1&&(a[s]["Result "+i.name]=n,n-=a[s-i.days+1]["_EMA "+i.name]/a[s-i.days+1]["_EMA2 "+i.name]),a[s]["_total "+i.name]=n}},e.Studies.calculateMoneyFlowIndex=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=0,r=0,n=i[e.startFrom-1],s="_rawMF "+e.name,o="_cumMF "+e.name,l="Result "+e.name;n&&n[o]&&(a=n[o][0],r=n[o][1]);for(var h=e.startFrom;h<i.length;h++){var c=i[h]["hlc/3"];if(h>0){var u=i[h-1]["hlc/3"],p=c*i[h].Volume;if(c>u?a+=p:c<u?r-=p*=-1:p=0,h>e.days){var d=i[h-e.days][s];d>0?a-=d:r+=d,i[h][l]=0===r?100:100-100/(1+a/r)}i[h][s]=p,i[h][o]=[a,r]}}}},e.Studies.calculateChandeMomentum=function(t,e){var i=e.name;for(var a in e.outputs)i=a+" "+i;var r=e.chart.scrubbed;if(r.length<e.days+1)e.error=!0;else for(var n=0,s=0,o=[],l=e.startFrom-e.days+1;l<r.length;l++)if(!(l<1)){var h=r[l].Close-r[l-1].Close;if(o.push(h),n+=h,s+=Math.abs(h),o.length==e.days){r[l][i]=100*n/s;var c=o.shift();n-=c,s-=Math.abs(c)}}},e.Studies.calculateChandeForecast=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("time series",i.days,r,0,"MA",t,i);for(var n=Math.max(1,i.startFrom);n<a.length;n++)a[n]["Result "+i.name]=100*(1-a[n]["MA "+i.name]/a[n][r])}},e.Studies.calculateDetrendedPrice=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,r,0,"MA",t,i);for(var n=Math.max(i.startFrom,Math.floor(i.days/2+1));n<a.length;n++)a[n]["Result "+i.name]=a[n-Math.floor(i.days/2+1)][r]-a[n]["MA "+i.name]}},e.Studies.calculateAroon=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a,r=0,n=0,s=null,o=null;if(e.startFrom>0){var l=i[e.startFrom-1]["_state "+e.name];l&&(r=l[0],n=l[1],s=l[2],o=l[3])}for(var h=e.startFrom;h<i.length;h++){if(null===s&&(s=i[h].High),null===o&&(o=i[h].Low),(s=Math.max(s,i[h].High))==i[h].High)r=0;else if(++r>e.days)for(s=i[h].High,r=0,a=1;a<=e.days;a++)(s=Math.max(s,i[h-a].High))==i[h-a].High&&(r=a);if((o=Math.min(o,i[h].Low))==i[h].Low)n=0;else if(++n>e.days)for(o=i[h].Low,n=0,a=1;a<=e.days;a++)(o=Math.min(o,i[h-a].Low))==i[h-a].Low&&(n=a);i[h]["Aroon Up "+e.name]=100*(1-r/e.days),i[h]["Aroon Down "+e.name]=100*(1-n/e.days),i[h]["Aroon Oscillator "+e.name]=i[h]["Aroon Up "+e.name]-i[h]["Aroon Down "+e.name],i[h]["_state "+e.name]=[r,n,s,o]}}},e.Studies.calculatePrimeNumber=function(t,e){var i=[];function a(t){if(t<=0)return!1;if(t!=Math.floor(t))return!1;if(!0===i[t]||!1===i[t])return i[t];for(var e=parseInt(Math.sqrt(t),10),a=2;a<=e;a++)if(t%a==0)return i[t]=!1,!1;return i[t]=!0,!0}for(var r=e.chart.scrubbed,n=e.startFrom;n<r.length;n++){var s=r[n];if(s){for(var o=s.High,l=0;o>0&&o<=10;l++)o*=10;for(a(o)&&(o+=2),(o=Math.ceil(o))%2==0&&o++;!a(o);)o+=2;o/=Math.pow(10,l);for(var h=s.Low,c=0;h>0&&h<=10;c++)h*=10;if(a(h)&&(h-=2),(h=Math.floor(h))%2==0&&h--,h>0){for(;!a(h);)h-=2;h/=Math.pow(10,c)}if("Prime Number Bands"==e.type)s["Prime Bands Top "+e.name]=o,s["Prime Bands Bottom "+e.name]=Math.max(0,h);else{var u=0,p=e.inputs["Tolerance Percentage"]*(o-h)/100,d=o+h-2*s.Close;d<p?u=1:d>p&&(u=-1),u&&(s["Result "+e.name]=u)}}}},e.Studies.calculateVerticalHorizontalFilter=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{i.mhml=new e.Studies.StudyDescriptor(i.name,i.type,i.panel),i.mhml.chart=i.chart,i.mhml.days=i.days,i.mhml.startFrom=i.startFrom,i.mhml.inputs={},i.mhml.outputs={_MHML:null},e.Studies.calculateMaxHighMinLow(t,i.mhml);for(var r=0,n=[],s=Math.max(1,i.startFrom-i.days);s<a.length;s++){var o=Math.abs(a[s].Close-a[s-1].Close);n.push(o),r+=o,n.length==i.days&&(a[s]["Result "+i.name]=a[s]["_MHML "+i.name]/r,r-=n.shift())}}},e.Studies.calculatePriceOscillator=function(t,i){var a=i.chart.scrubbed,r=Number(i.inputs["Short Cycle"]),n=Number(i.inputs["Long Cycle"]);if(a.length<Math.max(r,n)+1)i.error=!0;else{var s=i.inputs.Field,o=i.inputs["Moving Average Type"];o||(o="simple"),s&&"field"!=s||(i.parameters.isVolume?(s="Volume",o="exponential"):s="Close");var l=i.inputs["Points Or Percent"];l||(l="Percent"),e.Studies.MA(o,r,s,0,"_Short MA",t,i),e.Studies.MA(o,n,s,0,"_Long MA",t,i);for(var h=Math.max(n,i.startFrom);h<a.length;h++){var c=a[h];c&&(c["Result "+i.name]="Points"==l?c["_Short MA "+i.name]-c["_Long MA "+i.name]:100*(c["_Short MA "+i.name]/c["_Long MA "+i.name]-1),i.outputs["Increasing Bar"]&&(c[i.name+"_hist"]=c["Result "+i.name]))}}},e.Studies.calculateKeltner=function(t,i){e.Studies.MA(i.inputs["Moving Average Type"],i.days,"Close",0,"MA",t,i),e.Studies.calculateStudyATR(t,i),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Shift,"MA "+i.name,"ATR "+i.name)},e.Studies.calculateCoppock=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var n=parseInt(i.inputs["Long RoC"],10);n||(n=14);var s=parseInt(i.inputs["Short RoC"],10);s||(s=11);var o=i.days;if(o||(o=10),!(n<s))if(a.length<Math.max(s,n,o)+1)i.error=!0;else{for(var l=Math.max(i.startFrom,n);l<a.length;l++){var h=a[l-s][r],c=a[l-n][r];h&&c&&(a[l]["_Sum "+i.name]=100*(a[l][r]/h+a[l][r]/c-2))}e.Studies.MA("weighted",o,"_Sum "+i.name,0,"Result",t,i)}},e.Studies.calculateLinearRegressionIndicator=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else{var a=e.inputs.Field;a&&"field"!=a||(a="Close");var r=e.days*(e.days+1)/2,n=Math.pow(r,2),s=r*(2*e.days+1)/3,o=0,l=0,h=0;if(e.startFrom){var c=i[e.startFrom-1]["_sums "+e.name];c&&(l=c[0],o=c[1],h=c[2])}for(var u=e.startFrom;u<i.length;u++)if((i[u][a]||0===i[u][a])&&(l+=e.days*i[u][a]-o,o+=i[u][a],h+=Math.pow(i[u][a],2),!(u<e.days-1))){if(u>e.days-1){if(!i[u-e.days][a]&&0!==i[u-e.days][a])continue;o-=i[u-e.days][a],h-=Math.pow(i[u-e.days][a],2)}var p=(e.days*l-r*o)/(e.days*s-n);i[u]["Slope "+e.name]=p;var d=(o-p*r)/e.days;i[u]["Intercept "+e.name]=d,i[u]["Forecast "+e.name]=d+p*e.days;var m=(e.days*s-n)/(e.days*h-Math.pow(o,2));i[u]["RSquared "+e.name]=p*p*m,i[u]["_sums "+e.name]=[l,o,h]}}},e.Studies.calculateBollinger=function(t,i){var a=i.inputs.Field;a&&"field"!=a||(a="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,a,0,"_MA",t,i),i.std=new e.Studies.StudyDescriptor(i.name,"STD Dev",i.panel),i.std.chart=i.chart,i.std.startFrom=i.startFrom,i.std.days=i.days,i.std.inputs={Field:a,"Standard Deviations":1,Type:i.inputs["Moving Average Type"]},i.std.outputs={"_STD Dev":null},e.Studies.calculateStandardDeviation(t,i.std),e.Studies.calculateGenericEnvelope(t,i,i.inputs["Standard Deviations"],"_MA "+i.name,"_STD Dev "+i.name),"Boll %b"==i.type&&(i.zoneOutput="%b")},e.Studies.calculateMAEnvelope=function(t,i){var a=i.inputs.Field;a&&"field"!=a||(a="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,a,0,"MA",t,i);var r=i.inputs["Shift Type"],n=i.inputs.Shift;r||(r="percent",n=i.inputs["Shift Percentage"]),"percent"==r?e.Studies.calculateGenericEnvelope(t,i,n/100,"MA "+i.name):"points"==r&&e.Studies.calculateGenericEnvelope(t,i,null,"MA "+i.name,null,Number(n))},e.Studies.calculateGenericEnvelope=function(t,e,i,a,r,n){i||(i=0),n||(n=0),a||(a="Close"),r||(r=a);for(var s=e.chart.scrubbed,o=e.startFrom;s&&o<s.length;o++){var l=s[o];if(l&&l[a]){var h=i*l[r]+n;l[e.type+" Top "+e.name]=l[a]+h,l[e.type+" Bottom "+e.name]=l[a]-h,l[e.type+" Median "+e.name]=l[a],l["Bandwidth "+e.name]=200*h/l[a],l["%b "+e.name]=50*((l.Close-l[a])/h+1)}}},e.Studies.calculateMaxHighMinLow=function(t,e){var i=e.chart.scrubbed,a=e.days,r=e.days;if(e.inputs["High Period"]&&(a=e.inputs["High Period"]),e.inputs["Low Period"]&&(r=e.inputs["Low Period"]),i.length<Math.max(a,r)+1)e.error=!0;else{var n,s=Number.MAX_VALUE,o=-1*Number.MAX_VALUE;if(e.startFrom>1){for(n=1;n<a;n++)o=Math.max(o,i[e.startFrom-n].High);for(n=1;n<r;n++)s=Math.min(s,i[e.startFrom-n].Low)}for(var l=Math.max(0,e.startFrom-1);l<i.length;l++){if(o=Math.max(o,i[l].High),s=Math.min(s,i[l].Low),l>=a&&i[l-a].High==o)for(o=i[l].High,n=1;n<a;n++)o=Math.max(o,i[l-n].High);if(l>=r&&i[l-r].Low==s)for(s=i[l].Low,n=1;n<r;n++)s=Math.min(s,i[l-n].Low);var h=0;if("HHV"==e.type)h=o;else if("LLV"==e.type)h=s;else if("Donchian Width"==e.type)h=o-s;else if("GAPO"==e.type||"Gopala"==e.type)h=Math.log(o-s)/Math.log(r);else{if("VT HZ Filter"==e.type){h=o-s,i[l]["_MHML "+e.name]=h;continue}if("Williams %R"==e.type){h=-100*(o-i[l].Close)/(o-s),i[l]["Result "+e.name]=h;continue}}if(l==i.length-1)break;"Donchian Channel"==e.type?(i[l+1]["Donchian High "+e.name]=o,i[l+1]["Donchian Low "+e.name]=s,i[l+1]["Donchian Median "+e.name]=(o+s)/2):i[l+1]["Result "+e.name]=h}}},e.Studies.calculateAccumulationDistribution=function(t,e){for(var i=e.chart.scrubbed,a=e.startFrom;a<i.length;a++)if(a){var r=i[a],n=i[a-1],s=0;r.Close>n.Close?s=r.Close-Math.min(r.Low,n.Close):r.Close<n.Close&&(s=r.Close-Math.max(r.High,n.Close)),e.inputs["Use Volume"]&&(s*=r.Volume);var o=n["Result "+e.name];o||(o=0),o+=s,r["Result "+e.name]=o}},e.Studies.calculateCCI=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{e.Studies.MA("simple",i.days,"hlc/3",0,"MA",t,i);for(var r=Math.max(i.startFrom,i.days-1);r<a.length;r++){var n=a[r];if(n){for(var s=0,o=0;o<i.days;o++)s+=Math.abs(a[r-o]["hlc/3"]-n["MA "+i.name]);s/=i.days,Math.abs(s)<1e-8?n["Result "+i.name]=0:n["Result "+i.name]=(n["hlc/3"]-n["MA "+i.name])/(.015*s)}}}},e.Studies.calculateFractalChaos=function(t,e){var i=e.chart.scrubbed,a=0,r=0,n=0;e.startFrom&&"Fractal Chaos Bands"==e.type&&(a=i[e.startFrom-1]["Fractal High "+e.name],r=i[e.startFrom-1]["Fractal Low "+e.name]);for(var s=Math.max(4,e.startFrom);s<i.length;s++){var o;for(i[s]["Result "+e.name]=0,n=0,o=0;o<=s&&i[s-o]&&!(i[s-o].High>i[s-2].High)&&!(o<2&&i[s-o].High==i[s-2].High);o++)if(i[s-o].High<i[s-2].High&&n++,4==n){a=i[s-2].High;break}for("Fractal Chaos Bands"==e.type?i[s]["Fractal High "+e.name]=a>0?a:null:4==n&&(i[s]["Result "+e.name]=1),n=0,o=0;o<=s&&i[s-o]&&!(i[s-o].Low<i[s-2].Low)&&!(o<2&&i[s-o].Low==i[s-2].Low);o++)if(i[s-o].Low>i[s-2].Low&&n++,4==n){r=i[s-2].Low;break}"Fractal Chaos Bands"==e.type?i[s]["Fractal Low "+e.name]=r>0?r:null:4==n&&(i[s]["Result "+e.name]=-1)}},e.Studies.displayRAVI=function(t,i,a){var r=t.panels[i.panel],n=t.getYAxisByName(r,i.name),s=t.pixelFromPrice(0,r,n),o=t.layout.candleWidth-2;o<2&&(o=1);var l=e.Studies.determineColor(i.outputs["Increasing Bar"]),h=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.startClip(i.panel),t.canvasColor("stx_histogram"),i.underlay||(t.chart.context.globalAlpha=1);for(var c=0;c<a.length;c++){var u=a[c],p=a[c-1];if(p||(p=t.getPreviousBar(t.chart,i.name+"_hist",c)),u){var d=0,m=0;i.parameters&&i.parameters.studyOverZonesEnabled&&(d=parseFloat(i.parameters.studyOverBoughtValue),m=parseFloat(i.parameters.studyOverSoldValue)),p?u[i.name+"_hist"]>d&&p[i.name+"_hist"]<u[i.name+"_hist"]?t.chart.context.fillStyle=l:u[i.name+"_hist"]<m&&p[i.name+"_hist"]>u[i.name+"_hist"]?t.chart.context.fillStyle=h:t.chart.context.fillStyle="#CCCCCC":t.chart.context.fillStyle="#CCCCCC",u.candleWidth&&(o=Math.floor(Math.max(1,u.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(c,r.chart)-o/2),Math.floor(s),Math.floor(o),Math.floor(t.pixelFromPrice(u[i.name+"_hist"],r,n)-s))}}t.endClip()},e.Studies.displayElderForce=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=e.Studies.determineColor(i.outputs.Result),n=t.panels[i.panel],s=t.getYAxisByName(n,i.name),o={skipTransform:n.name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:0,color:r,yAxis:s,direction:1};e.preparePeakValleyFill(t,o),o.direction=-1,e.preparePeakValleyFill(t,o)},e.Studies.displayElderRay=function(t,i,a){var r=t.panels[i.panel],n=t.getYAxisByName(r,i.name),s=t.pixelFromPrice(0,r,n),o=t.layout.candleWidth-2;function l(a,l,h,c){t.chart.context.fillStyle=e.Studies.determineColor(i.outputs[h]),t.chart.context.fillRect(Math.floor(t.pixelFromBar(a,r.chart)-o/2+o*l),Math.floor(s),Math.floor(o*(1-2*l)),Math.floor(t.pixelFromPrice(u[i.name+c],r,n)-s))}o<2&&(o=1),t.canvasColor("stx_histogram");var h=t.chart.context.fillStyle;i.underlay||(t.chart.context.globalAlpha=1),t.startClip(i.panel);for(var c=0;c<a.length;c++){var u=a[c];u&&(u.candleWidth&&(o=Math.floor(Math.max(1,u.candleWidth-2))),u[i.name+"_hist1"]>0&&l(c,0,"Elder Bull Power","_hist1"),u[i.name+"_hist2"]<0&&l(c,0,"Elder Bear Power","_hist2"),u[i.name+"_hist1"]<0&&l(c,.1,"Elder Bull Power","_hist1"),u[i.name+"_hist2"]>0&&l(c,.1,"Elder Bear Power","_hist2"))}t.endClip(),t.chart.context.fillStyle=h},e.Studies.displayADX=function(t,i,a){var r=i.underlay?.3:i.inputs.Series?.4:1;if(i.inputs.Series&&i.inputs.Shading){var n="+DI "+i.name,s="-DI "+i.name,o=e.Studies.determineColor(i.outputs[i.outputMap[n]]),l=e.Studies.determineColor(i.outputs[i.outputMap[s]]),h=t.getYAxisByName(i.panel,i.name),c={topBand:n,bottomBand:s,topColor:o,bottomColor:l,skipTransform:t.panels[i.panel].name!=i.chart.name,topAxis:h,bottomAxis:h};e.fillIntersecting(t,i.panel,c)}i.inputs.Histogram&&e.Studies.createHistogram(t,i,a,!1,r),!1!==i.inputs.Series?e.Studies.displaySeriesAsLine(t,i,a):i.inputs.Series||i.inputs.Histogram||t.watermark(i.panel,"center","bottom",t.translateIf(i.name)+": "+t.translateIf("Nothing to display"))},e.Studies.displayMassIndex=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=i.inputs["Bulge Threshold"],n=t.panels[i.panel],s=t.getYAxisByName(n,i.name),o=e.Studies.determineColor(i.outputs.Result);e.preparePeakValleyFill(t,{skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:r,direction:1,color:o,yAxis:s}),e.Studies.drawHorizontal(t,i,null,r,s,o)},e.Studies.displayChannel=function(t,i,a){if(i.inputs["Channel Fill"]){var r={panelName:i.panel};for(var n in i.outputs){var s=n.split(" ").pop();"Top"==s||"High"==s?r.topBand=n+" "+i.name:"Bottom"==s||"Low"==s?r.bottomBand=n+" "+i.name:"Median"!=s&&"Channel"!=s||(r.color=e.Studies.determineColor(i.outputs[n]))}i.parameters&&i.parameters.opacity&&(r.opacity=i.parameters.opacity);var o=t.panels[i.panel];r.skipTransform=o.name!=i.chart.name,r.yAxis=t.getYAxisByName(o,i.name),e.prepareChannelFill(t,r)}e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.inputAttributeDefaultGenerator=function(t){return(t||0===t)&&t.constructor==Number?Math.floor(t)==t?t>0?{min:1,step:1}:{step:1}:t>0?{min:0,step:.01}:{step:.01}:{}},e.Studies.getStudyList=function(t){var i={},a={Directional:!0,Gopala:!0,vchart:!0};for(var r in e.extend(a,t),e.Studies.studyLibrary)a[r]||(i[e.Studies.studyLibrary[r].name]=r);return i},e.Studies.determineColor=function(t){return t?"object"==typeof t?t.color:t:null},e.Studies.studyLibrary={rsi:{name:"RSI",inputs:{Period:14},calculateFN:e.Studies.calculateRSI,range:"0 to 100",outputs:{RSI:"auto"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},ma:{name:"Moving Average",overlay:!0,calculateFN:e.Studies.calculateMovingAverage,inputs:{Period:50,Field:"field",Type:"ma",Offset:0},outputs:{MA:"#FF0000"}},macd:{name:"MACD",calculateFN:e.Studies.calculateMACD,seriesFN:e.Studies.displayHistogramWithSeries,inputs:{"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},outputs:{MACD:"auto",Signal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},stochastics:{name:"Stochastics",range:"0 to 100",initializeFN:e.Studies.initializeStochastics,calculateFN:e.Studies.calculateStochastics,inputs:{Period:14,Smooth:!0},outputs:{Fast:"auto",Slow:"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},Aroon:{name:"Aroon",range:"0 to 100",calculateFN:e.Studies.calculateAroon,outputs:{"Aroon Up":"#00DD00","Aroon Down":"#FF0000"}},"Aroon Osc":{name:"Aroon Oscillator",calculateFN:e.Studies.calculateAroon,outputs:{"Aroon Oscillator":"auto"}},"Lin R2":{name:"Linear Reg R2",calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{RSquared:"auto"}},"Lin Fcst":{name:"Linear Reg Forecast",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Forecast:"auto"}},"Lin Incpt":{name:"Linear Reg Intercept",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Intercept:"auto"}},"Time Fcst":{name:"Time Series Forecast",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Forecast:"auto"}},"VT HZ Filter":{name:"Vertical Horizontal Filter",calculateFN:e.Studies.calculateVerticalHorizontalFilter,inputs:{Period:28}},TRIX:{name:"TRIX",calculateFN:e.Studies.calculateTRIX},"STD Dev":{name:"Standard Deviation",calculateFN:e.Studies.calculateStandardDeviation,inputs:{Period:14,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Trade Vol":{name:"Trade Volume Index",calculateFN:e.Studies.calculateOnBalanceVolume,inputs:{"Min Tick Value":.5}},Swing:{name:"Swing Index",calculateFN:e.Studies.calculateSwingIndex,inputs:{"Limit Move Value":.5}},"Acc Swing":{name:"Accumulative Swing Index",calculateFN:e.Studies.calculateSwingIndex,inputs:{"Limit Move Value":.5}},"Price ROC":{name:"Price Rate of Change",calculateFN:e.Studies.calculateRateOfChange,inputs:{Field:"field",Period:14}},"Vol ROC":{name:"Volume Rate of Change",calculateFN:e.Studies.calculateRateOfChange},Momentum:{name:"Momentum Indicator",calculateFN:e.Studies.calculateRateOfChange,inputs:{Period:14},centerline:0},"Price Vol":{name:"Price Volume Trend",calculateFN:e.Studies.calculatePriceVolumeTrend,inputs:{Field:"field"}},"Pos Vol":{name:"Positive Volume Index",calculateFN:e.Studies.calculateVolumeIndex,inputs:{Field:"field","Moving Average Type":"ma",Period:255},outputs:{Index:"auto",MA:"#FF0000"}},"Neg Vol":{name:"Negative Volume Index",calculateFN:e.Studies.calculateVolumeIndex,inputs:{Field:"field","Moving Average Type":"ma",Period:255},outputs:{Index:"auto",MA:"#FF0000"}},"On Bal Vol":{name:"On Balance Volume",calculateFN:e.Studies.calculateOnBalanceVolume,inputs:{}},"Stch Mtm":{name:"Stochastic Momentum Index",calculateFN:e.Studies.calculateStochMomentum,inputs:{"%K Periods":10,"%K Smoothing Periods":3,"%K Double Smoothing Periods":3,"%D Periods":10,"%D Moving Average Type":"ema"},outputs:{"%K":"auto","%D":"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:40,studyOverBoughtColor:"auto",studyOverSoldValue:-40,studyOverSoldColor:"auto"}}},"Hist Vol":{name:"Historical Volatility",calculateFN:e.Studies.calculateHistoricalVolatility,inputs:{Field:"field",Period:10,"Days Per Year":[252,365],"Standard Deviations":1},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Pretty Good":{name:"Pretty Good Oscillator",calculateFN:e.Studies.calculatePrettyGoodOscillator,parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:3,studyOverBoughtColor:"auto",studyOverSoldValue:-3,studyOverSoldColor:"auto"}}},Ultimate:{name:"Ultimate Oscillator",calculateFN:e.Studies.calculateUltimateOscillator,inputs:{"Cycle 1":7,"Cycle 2":14,"Cycle 3":28},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},"Vol Osc":{name:"Volume Oscillator",calculateFN:e.Studies.calculatePriceOscillator,inputs:{"Short Cycle":12,"Long Cycle":26,"Points Or Percent":["Points","Percent"]},parameters:{init:{isVolume:!0}}},Twiggs:{name:"Twiggs Money Flow",calculateFN:e.Studies.calculateTwiggsMoneyFlow,inputs:{Period:21}},"Chaikin MF":{name:"Chaikin Money Flow",calculateFN:e.Studies.calculateChaikinMoneyFlow,inputs:{Period:20}},"Chaikin Vol":{name:"Chaikin Volatility",calculateFN:e.Studies.calculateChaikinVolatility,inputs:{Period:14,"Rate Of Change":2,"Moving Average Type":"ma"}},"Price Osc":{name:"Price Oscillator",calculateFN:e.Studies.calculatePriceOscillator,inputs:{Field:"field","Long Cycle":26,"Short Cycle":12,"Moving Average Type":"ema","Points Or Percent":["Points","Percent"]}},EOM:{name:"Ease of Movement",calculateFN:e.Studies.calculateEaseOfMovement,inputs:{Period:14,"Moving Average Type":"ma"}},CCI:{name:"Commodity Channel Index",calculateFN:e.Studies.calculateCCI,inputs:{Period:20},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:-100,studyOverSoldColor:"auto"}},attributes:{Period:{min:2}}},Detrended:{name:"Detrended Price Oscillator",calculateFN:e.Studies.calculateDetrendedPrice,inputs:{Field:"field",Period:14,"Moving Average Type":"ma"}},"True Range":{name:"True Range",calculateFN:e.Studies.calculateStudyATR,inputs:{},outputs:{"True Range":"auto"}},ATR:{name:"Average True Range",calculateFN:e.Studies.calculateStudyATR,outputs:{ATR:"auto"}},"Ehler Fisher":{name:"Ehler Fisher Transform",calculateFN:e.Studies.calculateEhlerFisher,inputs:{Period:10},outputs:{EF:"auto","EF Trigger":"#FF0000"}},Schaff:{name:"Schaff Trend Cycle",range:"0 to 100",calculateFN:e.Studies.calculateSchaff,inputs:{Field:"field",Period:10,"Short Cycle":23,"Long Cycle":50,"Moving Average Type":"ema"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:75,studyOverBoughtColor:"auto",studyOverSoldValue:25,studyOverSoldColor:"auto"}}},QStick:{name:"QStick",calculateFN:e.Studies.calculateQStick,inputs:{Period:8,"Moving Average Type":"ma"}},Coppock:{name:"Coppock Curve",calculateFN:e.Studies.calculateCoppock,inputs:{Field:"field","Short RoC":11,"Long RoC":14,Period:10}},"Chande Mtm":{name:"Chande Momentum Oscillator",calculateFN:e.Studies.calculateChandeMomentum,inputs:{Period:9},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:50,studyOverBoughtColor:"auto",studyOverSoldValue:-50,studyOverSoldColor:"auto"}}},"Chande Fcst":{name:"Chande Forecast Oscillator",calculateFN:e.Studies.calculateChandeForecast,inputs:{Field:"field",Period:14}},"Intraday Mtm":{name:"Intraday Momentum Index",calculateFN:e.Studies.calculateIntradayMomentum,inputs:{Period:20},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},RAVI:{name:"RAVI",seriesFN:e.Studies.displayRAVI,calculateFN:e.Studies.calculatePriceOscillator,inputs:{Field:"field","Moving Average Type":"vdma","Short Cycle":7,"Long Cycle":65},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},centerline:0,parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:3,studyOverBoughtColor:"auto",studyOverSoldValue:-3,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:0,step:"0.1"},studyOverSoldValue:{max:0,step:"0.1"}}},"Random Walk":{name:"Random Walk Index",calculateFN:e.Studies.calculateRandomWalk,outputs:{"Random Walk High":"#FF0000","Random Walk Low":"#0000FF"}},ADX:{name:"ADX/DMS",calculateFN:e.Studies.calculateADX,seriesFN:e.Studies.displayADX,inputs:{Period:14,"Smoothing Period":14,Series:!0,Shading:!1,Histogram:!1},outputs:{"+DI":"#00FF00","-DI":"#FF0000",ADX:"auto","Positive Bar":"#00DD00","Negative Bar":"#FF0000"}},"High Low":{name:"High Low Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:function(t,i){i.inputs["Moving Average Type"]="triangular",e.Studies.calculateMAEnvelope(t,i)},inputs:{Field:"field",Period:10,"Shift Percentage":5,"Channel Fill":!0},outputs:{"High Low Top":"auto","High Low Median":"auto","High Low Bottom":"auto"},attributes:{"Shift Percentage":{min:.1,step:.1}}},"High-Low":{name:"High Minus Low",calculateFN:function(t,e){for(var i=e.chart.scrubbed,a=e.startFrom;a<i.length;a++)i[a]["Result "+e.name]=i[a].High-i[a].Low},inputs:{}},"Med Price":{name:"Median Price",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14}},"MA Env":{name:"Moving Average Envelope",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateMAEnvelope,inputs:{Field:"field",Period:50,"Shift Type":["percent","points"],Shift:5,"Moving Average Type":"ma","Channel Fill":!0},outputs:{"MA Env Top":"auto","MA Env Median":"auto","MA Env Bottom":"auto"},attributes:{Shift:{min:.1,step:.1}}},"Fractal Chaos Bands":{name:"Fractal Chaos Bands",overlay:!0,calculateFN:e.Studies.calculateFractalChaos,seriesFN:e.Studies.displayChannel,inputs:{"Channel Fill":!0},outputs:{"Fractal High":"auto","Fractal Low":"auto","Fractal Channel":"auto"}},"Fractal Chaos":{name:"Fractal Chaos Oscillator",range:"-1 to 1",calculateFN:e.Studies.calculateFractalChaos,inputs:{},centerline:null},GAPO:{name:"Gopalakrishnan Range Index",calculateFN:e.Studies.calculateMaxHighMinLow},"Prime Number Bands":{name:"Prime Number Bands",overlay:!0,calculateFN:e.Studies.calculatePrimeNumber,seriesFN:e.Studies.displayChannel,inputs:{"Channel Fill":!0},outputs:{"Prime Bands Top":"auto","Prime Bands Bottom":"auto","Prime Bands Channel":"auto"}},"Prime Number":{name:"Prime Number Oscillator",range:"-1 to 1",calculateFN:e.Studies.calculatePrimeNumber,centerline:0,inputs:{"Tolerance Percentage":5},attributes:{"Tolerance Percentage":{min:.1,step:.1}}},"Bollinger Bands":{name:"Bollinger Bands",overlay:!0,calculateFN:e.Studies.calculateBollinger,seriesFN:e.Studies.displayChannel,inputs:{Field:"field",Period:20,"Standard Deviations":2,"Moving Average Type":"ma","Channel Fill":!0},outputs:{"Bollinger Bands Top":"auto","Bollinger Bands Median":"auto","Bollinger Bands Bottom":"auto"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Donchian Channel":{name:"Donchian Channel",overlay:!0,calculateFN:e.Studies.calculateMaxHighMinLow,seriesFN:e.Studies.displayChannel,inputs:{"High Period":20,"Low Period":20,"Channel Fill":!0},outputs:{"Donchian High":"auto","Donchian Median":"auto","Donchian Low":"auto"}},HHV:{name:"Highest High Value",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14}},LLV:{name:"Lowest Low Value",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14}},"Mass Idx":{name:"Mass Index",seriesFN:e.Studies.displayMassIndex,calculateFN:e.Studies.calculateMassIndex,inputs:{Period:25,"Bulge Threshold":27},attributes:{"Bulge Threshold":{min:20,max:35,step:.1}}},Keltner:{name:"Keltner Channel",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateKeltner,inputs:{Period:50,Shift:5,"Moving Average Type":"ema","Channel Fill":!0},outputs:{"Keltner Top":"auto","Keltner Median":"auto","Keltner Bottom":"auto"},attributes:{Shift:{min:.1,step:.1}}},PSAR:{name:"Parabolic SAR",overlay:!0,calculateFN:e.Studies.calculatePSAR,seriesFN:e.Studies.displayPSAR2,inputs:{"Minimum AF":.02,"Maximum AF":.2}},Klinger:{name:"Klinger Volume Oscillator",seriesFN:e.Studies.displayHistogramWithSeries,calculateFN:e.Studies.calculateKlinger,inputs:{"Signal Periods":13,"Short Cycle":34,"Long Cycle":55},outputs:{Klinger:"auto",KlingerSignal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"Elder Ray":{name:"Elder Ray Index",seriesFN:e.Studies.displayElderRay,calculateFN:e.Studies.calculateElderRay,centerline:0,inputs:{Period:13},outputs:{"Elder Bull Power":"#00DD00","Elder Bear Power":"#FF0000"}},"Elder Force":{name:"Elder Force Index",calculateFN:e.Studies.calculateElderForce,seriesFN:e.Studies.displayElderForce,inputs:{Period:13}},"LR Slope":{name:"Linear Reg Slope",calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Slope:"auto"}},COG:{name:"Center Of Gravity",calculateFN:e.Studies.calculateCenterOfGravity,inputs:{Period:10,Field:"field"}},"Typical Price":{name:"Typical Price",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14}},"Weighted Close":{name:"Weighted Close",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14}},"M Flow":{name:"Money Flow Index",range:"0 to 100",calculateFN:e.Studies.calculateMoneyFlowIndex,inputs:{Period:14},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},"Williams %R":{name:"Williams %R",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:-20,studyOverBoughtColor:"auto",studyOverSoldValue:-80,studyOverSoldColor:"auto"}}},"W Acc Dist":{name:"Accumulation/Distribution",calculateFN:e.Studies.calculateAccumulationDistribution,inputs:{"Use Volume":!1}},volume:{name:"Volume Chart",range:"0 to max",yAxis:{ground:!0,initialMarginTop:0},seriesFN:e.Studies.createVolumeChart,calculateFN:e.Studies.calculateVolume,inputs:{},outputs:{"Up Volume":"#8cc176","Down Volume":"#b82c0c"},parameters:{zoom:0,widthFactor:1}},"vol undr":{name:"Volume Underlay",underlay:!0,range:"0 to max",yAxis:{ground:!0,initialMarginTop:0,position:"none"},seriesFN:e.Studies.createVolumeChart,calculateFN:e.Studies.calculateVolume,inputs:{},outputs:{"Up Volume":"#8cc176","Down Volume":"#b82c0c"},customRemoval:!0,removeFN:function(t,e){t.layout.volumeUnderlay=!1,t.changeOccurred("layout")},parameters:{zoom:0,widthFactor:1}}},t},__drawingAdvanced_=function(t){var e=t.CIQ,i=t.timezoneJS;return e.Drawing.channel=function(){this.name="channel",this.dragToDraw=!1,this.p2=null},e.Drawing.channel.ciqInheritsFrom(e.Drawing.segment),e.Drawing.channel.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.channel.prototype.move=function(t,e,i){if(this.penDown){if(this.copyConfig(),null===this.p2)this.p1=[e,i];else{var a=i-(this.p1[1]-this.p0[1])/(this.p1[0]-this.p0[0])*(e-this.p1[0]);this.p2=[this.p1[0],a]}this.render(t)}},e.Drawing.channel.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?(this.stx.undo(),!0):null!==this.p2?(this.setPoint(2,this.p2[0],this.p2[1],a.chart),!0):(this.setPoint(1,e,i,a.chart),this.p0[0]==this.p1[0]?(this.p1=null,!1):(this.p2=[this.p1[0],this.p1[1]],!1)):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.channel.prototype.boxIntersection=function(t,e){return!!(this.p0&&this.p1&&this.p2)&&(!(t>Math.max(this.p0[0],this.p1[0])||t<Math.min(this.p0[0],this.p1[0]))&&((this.p1[0]-this.p0[0])*(e-this.p0[1])-(this.p1[1]-this.p0[1])*(t-this.p0[0]))*((this.p2[0]-this.p0[0])*(e-(this.p0[1]+this.p2[1]-this.p1[1]))-(this.p1[1]-this.p0[1])*(t-this.p0[0]))<0)},e.Drawing.channel.prototype.intersected=function(t,i,a){return this.p0&&this.p1&&this.p2?this.pointIntersection(this.p0[0],this.p0[1],a)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(this.p1[0],this.p1[1],a)?(this.highlighted="p1",{action:"drag",point:"p1"}):this.pointIntersection(this.p2[0],this.p2[1],a)?(this.highlighted="p2",{action:"drag",point:"p2"}):this.boxIntersection(t,i)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),p2:e.clone(this.p2),tick:t,value:i}):null:null},e.Drawing.channel.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=null;this.p2&&(o=this.stx.pixelFromValueAdjusted(i,this.p2[0],this.p2[1]));var l=this.lineWidth,h=this.setLineColor(),c=this.fillColor;this.p2&&c&&!e.isTransparent(c)&&"auto"!=c&&(t.beginPath(),t.moveTo(a,n),t.lineTo(r,s),t.lineTo(r,o),t.lineTo(a,n+(o-s)),t.closePath(),t.globalAlpha=.2,t.fillStyle=c,t.fill(),t.globalAlpha=1);var u={pattern:this.pattern,lineWidth:l};if(this.stx.plotLine(a,r,n,s,h,"segment",t,i,u),this.p2&&this.stx.plotLine(a,r,n+(o-s),o,h,"segment",t,i,u),this.highlighted){var p="p0"==this.highlighted,d="p1"==this.highlighted,m="p2"==this.highlighted;this.littleCircle(t,a,n,p),this.littleCircle(t,r,s,d),this.littleCircle(t,r,o,m)}}},e.Drawing.channel.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.setPoint(1,e.p1[0]-n,e.p1[1]-s,r.chart),this.setPoint(2,e.p2[0]-n,e.p2[1]-s,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.render(t))}},e.Drawing.channel.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d1,this.v2,t.chart))},e.Drawing.channel.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},e.Drawing.channel.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,v2:this.v2}},e.Drawing.pitchfork=function(){this.name="pitchfork",this.dragToDraw=!1,this.p2=null},e.Drawing.pitchfork.ciqInheritsFrom(e.Drawing.channel),e.Drawing.pitchfork.prototype.configs=["color","lineWidth","pattern"],e.Drawing.pitchfork.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),null===this.p2?this.p1=[e,i]:this.p2=[e,i],this.render(t))},e.Drawing.pitchfork.prototype.lineIntersection=function(t,i,a,r){var n=this.p0,s=this.p1,o=this.p2,l=(this.stx.layout,this.stx.panels[this.panelName]);return n&&s&&o&&l&&e.boxIntersects(a.x0,a.y0,a.x1,a.y1,n[0],n[1],(s[0]+o[0])/2,(s[1]+o[1])/2,r,l.yAxis.semiLog)},e.Drawing.pitchfork.prototype.intersected=function(t,i,a){return this.p0&&this.p1&&this.p2?this.pointIntersection(this.p0[0],this.p0[1],a)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(this.p1[0],this.p1[1],a)?(this.highlighted="p1",{action:"drag",point:"p1"}):this.pointIntersection(this.p2[0],this.p2[1],a)?(this.highlighted="p2",{action:"drag",point:"p2"}):this.lineIntersection(t,i,a,"ray")?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),p2:e.clone(this.p2),tick:t,value:i}):null:null},e.Drawing.pitchfork.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.p2;i||(i=this.p1);var a=this.stx.pixelFromTick(this.p0[0],e.chart),r=this.stx.pixelFromTick(this.p1[0],e.chart),n=this.stx.pixelFromTick(i[0],e.chart),s=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),l=this.stx.pixelFromValueAdjusted(e,i[0],i[1]),h=this.lineWidth,c=this.setLineColor(),u={pattern:this.pattern,lineWidth:h},p=50,d=2*s-o-l,m=2*a-r-n;if(m<0&&(p*=-1),d=p*d/m,this.stx.plotLine(a,(r+n)/2,s,(o+l)/2,c,"ray",t,e,u),this.stx.plotLine(r,n,o,l,c,"segment",t,e,u),r==n&&o==l||(this.stx.plotLine(r,r-p,o,o-d,c,"ray",t,e,u),this.stx.plotLine(n,n-p,l,l-d,c,"ray",t,e,u)),this.highlighted){var g="p0"==this.highlighted,f="p1"==this.highlighted,y="p2"==this.highlighted;this.littleCircle(t,a,s,g),this.littleCircle(t,r,o,f),this.littleCircle(t,n,l,y)}}},e.Drawing.pitchfork.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d2,this.v2,t.chart))},e.Drawing.pitchfork.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.d2=e.d2,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.tzo2=e.tzo2,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},e.Drawing.pitchfork.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,d2:this.d2,tzo0:this.tzo0,tzo1:this.tzo1,tzo2:this.tzo2,v0:this.v0,v1:this.v1,v2:this.v2}},e.Drawing.gartley=function(){this.name="gartley",this.dragToDraw=!1,this.maxSegments=4,this.shape=null,this.points=[]},e.Drawing.gartley.ciqInheritsFrom(e.Drawing.continuous),e.Drawing.gartley.prototype.check=function(t,e){if(!e)return!0;if(t[0]>=e[0]||t[1]==e[1])return!1;if(1==this.segment)t[1]<e[1]?this.shape="M":this.shape="W";else if(2==this.segment){if("M"==this.shape&&t[1]<e[1])return!1;if("W"==this.shape&&t[1]>e[1])return!1;if((e[1]-t[1])/(this.points[0][1]-t[1])<.618)return!1;if((e[1]-t[1])/(this.points[0][1]-t[1])>=.786)return!1}else if(3==this.segment){if("M"==this.shape&&t[1]>e[1])return!1;if("W"==this.shape&&t[1]<e[1])return!1;if((e[1]-t[1])/(this.points[1][1]-t[1])<.618)return!1;if((e[1]-t[1])/(this.points[1][1]-t[1])>=.786)return!1}else if(4==this.segment){if("M"==this.shape&&(t[1]<e[1]||e[1]<this.points[0][1]))return!1;if("W"==this.shape&&(t[1]>e[1]||e[1]>this.points[0][1]))return!1;if((this.points[1][1]-e[1])/(this.points[1][1]-this.points[2][1])<1.27)return!1;if((this.points[1][1]-e[1])/(this.points[1][1]-this.points[2][1])>=1.618)return!1}return!0},e.Drawing.gartley.prototype.click=function(t,e,i){var a=this.stx.panels[this.panelName];if(a){if(this.copyConfig(),!this.penDown)return this.setPoint(0,e,i,a.chart),this.pts=[],this.penDown=!0,this.segment=1,!1;if(this.accidentalClick(e,i))return this.penDown=!0,!1;if(this.check(this.p0,this.p1)){if(1==this.segment&&this.points.push(this.p0),this.points.push(this.p1),this.drawDropZones=!0,this.setPoint(1,e,i,a.chart),this.segment++,this.segment>this.maxSegments)return this.setPoint(0,this.points[0][0],this.points[0][1],a.chart),!0;this.pts.push(this.d1,this.tzo1,this.v1),this.setPoint(0,e,i,a.chart)}return!1}},e.Drawing.gartley.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);if(2==this.segment)this.drawDropZone(t,.618*this.points[0][1]+.382*this.p0[1],.786*this.points[0][1]+.214*this.p0[1],this.p0[0]);else if(3==this.segment)this.drawDropZone(t,.618*this.points[1][1]+.382*this.p0[1],.786*this.points[1][1]+.214*this.p0[1],this.p0[0]);else if(4==this.segment){var o=1.618*this.points[2][1]-.618*this.points[1][1];o="M"==this.shape?Math.max(o,this.points[0][1]):Math.min(o,this.points[0][1]),this.drawDropZone(t,o,1.27*this.points[2][1]-.27*this.points[1][1],this.p0[0])}var l=this.lineWidth,h=this.setLineColor(),c={pattern:this.pattern,lineWidth:l};this.segment<=this.maxSegments&&this.stx.plotLine(a,r,n,s,h,this.name,t,i,c);var u=this.fillColor,p=[];if(this.points.length){t.beginPath();for(var d=1;d<this.points.length&&d<=4;d++){var m=this.stx.pixelFromTick(this.points[d-1][0],i.chart),g=this.stx.pixelFromTick(this.points[d][0],i.chart),f=this.stx.pixelFromValueAdjusted(i,this.points[d-1][0],this.points[d-1][1]),y=this.stx.pixelFromValueAdjusted(i,this.points[d][0],this.points[d][1]);1==d&&p.push(m,f),p.push(g,y),this.stx.plotLine(m,g,f,y,h,this.name,t,i,c)}if(2!=this.points.length&&4!=this.points.length||p.push(r,s),this.points[2]&&p.push(this.stx.pixelFromTick(this.points[2][0],i.chart),this.stx.pixelFromValueAdjusted(i,this.points[2][0],this.points[2][1])),u&&"auto"!=u&&!e.isTransparent(u)){for(var v=0;v<p.length;v+=2)0===v&&t.moveTo(p[0],p[1]),t.lineTo(p[v],p[v+1]);t.fillStyle=u,t.globalAlpha=.2,t.closePath(),t.fill(),t.globalAlpha=1}}}},e.Drawing.gartley.prototype.lineIntersection=function(t,i,a,r){var n=this.points,s=(this.stx.layout,this.stx.panels[this.panelName]);if(n.length!=this.maxSegments+1||!s)return!1;for(var o=0;o<n.length-1;o++)if(e.boxIntersects(a.x0,a.y0,a.x1,a.y1,n[o][0],n[o][1],n[o+1][0],n[o+1][1],"segment",s.yAxis.semiLog))return!0;return!1},e.Drawing.gartley.prototype.boxIntersection=function(t,e){if(!this.p0||!this.p1)return!1;if(t>Math.max(this.p0[0],this.p1[0])||t<Math.min(this.p0[0],this.p1[0]))return!1;for(var i=Math.min(this.p0[1],this.p1[1]),a=Math.max(this.p0[1],this.p1[1]),r=0;r<this.points.length;r++)i=Math.min(i,this.points[r][1]),a=Math.max(a,this.points[r][1]);return!(e>a||e<i)},e.Drawing.gartley.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i;e.tick=i;var s=e.value-a;if(e.value=a,"move"==e.action){this.pts=[];for(var o=0;o<this.points.length;o++)this.points[o][0]-=n,this.points[o][1]-=s,this.setPoint(1,this.points[o][0],this.points[o][1],r.chart),o&&o<this.points.length-1&&this.pts.push(this.d1,this.tzo1,this.v1),this.points[o]=this.p1;this.setPoint(0,this.points[0][0],this.points[0][1],r.chart),this.render(t)}}},e.Drawing.gartley.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.gartley.prototype.drawDropZone=function(t,e,i,a){var r=this.stx.panels[this.panelName];if(r){var n=this.stx.pixelFromPrice(e,r),s=this.stx.pixelFromPrice(i,r)-n,o=this.stx.pixelFromTick(a,r.chart),l=r.width-o;t.fillStyle="#008000",t.globalAlpha=.2,t.fillRect(o,n,l,s),t.globalAlpha=1}},e.Drawing.gartley.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.reconstructPoints(),this.setPoint(0,this.d0,this.v0,t.chart),this.points.unshift(this.p0),this.setPoint(1,this.d1,this.v1,t.chart),this.points.push(this.p1))},e.Drawing.gartley.prototype.reconstructPoints=function(){var t=this.stx.panels[this.panelName];if(t){this.points=[];for(var i=0;i<this.pts.length;i+=3){var a=e.strToDateTime(this.pts[i]);a.setMinutes(a.getMinutes()+Number(this.pts[i+1])-a.getTimezoneOffset()),this.points.push([this.stx.tickFromDate(e.yyyymmddhhmmssmmm(a),t.chart),this.pts[i+2]])}}},e.Drawing.gartley.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.pts=e.pts.split(","),this.adjust()},e.Drawing.gartley.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,pts:this.pts.join(",")}},e.Drawing.freeform=function(){this.name="freeform",this.splineTension=.3,this.dragToDraw=!0},e.Drawing.freeform.ciqInheritsFrom(e.Drawing.segment),e.Drawing.freeform.prototype.measure=function(){},e.Drawing.freeform.prototype.intersected=function(t,i,a){return t>this.hiX||t<this.lowX?null:i>this.hiY||i<this.lowY?null:(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),tick:t,value:i})},e.Drawing.freeform.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;"move"==e.action&&(this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.adjust(),this.render(t))}},e.Drawing.freeform.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r){if(!1===this.penDown){this.copyConfig(),this.startX=Math.round(this.stx.resolveX(this.stx.pixelFromTick(i,r.chart))),this.startY=Math.round(this.stx.resolveY(this.stx.pixelFromValueAdjusted(r,i,a)));var n=this.stx.dateFromTick(i,r.chart,!0);return this.d0=e.yyyymmddhhmmssmmm(n),this.tzo0=n.getTimezoneOffset(),this.v0=a,this.p0=[e.ChartEngine.crosshairX-this.startX,e.ChartEngine.crosshairY-this.startY],this.nodes=[this.p0[0],this.p0[1]],this.pNodes=[this.p0],this.candleWidth=this.stx.layout.candleWidth,this.multiplier=r.yAxis.multiplier,this.interval=this.stx.layout.interval,this.periodicity=this.stx.layout.periodicity,this.tempSplineTension=this.splineTension,this.splineTension=-1,document.body.style.cursor="pointer",this.penDown=!0,!1}return this.penDown=!1,this.splineTension=this.tempSplineTension,document.body.style.cursor="auto",!0}},e.Drawing.freeform.prototype.move=function(t,i,a){if(this.penDown){var r=this.stx.panels[this.panelName],n=this.stx.dateFromTick(i,r.chart,!0);return this.d1=e.yyyymmddhhmmssmmm(n),this.tzo1=n.getTimezoneOffset(),this.v1=a,this.p1=[e.ChartEngine.crosshairX-this.startX,e.ChartEngine.crosshairY-this.startY],this.pNodes.length>2&&(this.p1[0]==this.pNodes[this.pNodes.length-2][0]&&this.p1[0]==this.pNodes[this.pNodes.length-1][0]?(this.pNodes.length--,this.nodes.length-=2):this.p1[1]==this.pNodes[this.pNodes.length-2][1]&&this.p1[1]==this.pNodes[this.pNodes.length-1][1]&&(this.pNodes.length--,this.nodes.length-=2)),this.nodes.push(this.p1[0],this.p1[1]),this.pNodes.push(this.p1),this.render(t),!1}},e.Drawing.freeform.prototype.intervalRatio=function(t,i,a,r,n,s){function o(t,i){return e.Market.Symbology.isForexSymbol(i)?1440:390}var l=0;return t==i?l=1:isNaN(t)||isNaN(i)?isNaN(t)?"month"==t?"week"==i?l=5:"day"==i?l=30:isNaN(i)||(l=30*o(0,s)/i):"week"==t?("month"==i&&(l=.2),"day"==i?l=5:isNaN(i)||(l=5*o(0,s)/i)):"day"==t&&("week"==i?l=.2:"month"==i?l=1/30:isNaN(i)||(l=o(0,s)/i)):isNaN(t)||("month"==i?l=t/(30*o(0,s)):"week"==i?l=t/(5*o(0,s)):"day"==i&&(l=t/o(0,s))):l=t/i,l*=a/r},e.Drawing.freeform.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.intervalRatio(this.interval,this.stx.layout.interval,this.periodicity,this.stx.layout.periodicity,this.d0,e.chart.symbol);if(0!==i){var a=this.stx.layout.candleWidth/this.candleWidth,r=e.yAxis.multiplier/this.multiplier;this.setPoint(0,this.d0,this.v0,e.chart);for(var n=this.stx.pixelFromTick(this.p0[0],e.chart),s=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),o=[],l=this.lineWidth,h=this.setLineColor(),c={pattern:this.pattern,lineWidth:l},u=0;u<this.pNodes.length;u++){var p=i*a*this.pNodes[u][0]+n,d=r*this.pNodes[u][1]+s;o.push(p,d)}o.length&&(this.splineTension<0?this.stx.connectTheDots(o,h,this.name,t,e,c):this.stx.plotSpline(o,this.splineTension,h,this.name,t,!0,c))}}},e.Drawing.freeform.prototype.adjust=function(){var t=this.stx.panels[this.panelName];if(t){var e=[this.nodes[0],this.nodes[1]];this.pNodes=[e],this.lowX=this.nodes[0],this.hiX=this.nodes[0],this.lowY=this.nodes[1],this.hiY=this.nodes[1];for(var i=2;i<this.nodes.length;i+=2){var a=[this.nodes[i],this.nodes[i+1]];this.pNodes.push(a),this.lowX=Math.min(this.lowX,a[0]),this.hiX=Math.max(this.hiX,a[0]),this.lowY=Math.max(this.lowY,a[1]),this.hiY=Math.min(this.hiY,a[1])}var r=this.intervalRatio(this.interval,this.stx.layout.interval,this.periodicity,this.stx.layout.periodicity,this.d0,t.chart.symbol);if(0!==r){var n=this.stx.layout.candleWidth/this.candleWidth,s=t.yAxis.multiplier/this.multiplier;this.setPoint(0,this.d0,this.v0,t.chart);var o=this.stx.pixelFromTick(this.p0[0],t.chart),l=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1]);this.lowX=this.stx.tickFromPixel(Math.floor(r*n*this.lowX)+o,t.chart),this.hiX=this.stx.tickFromPixel(Math.ceil(r*n*this.hiX)+o,t.chart),this.lowY=this.stx.valueFromPixel(Math.floor(s*this.lowY)+l,t),this.hiY=this.stx.valueFromPixel(Math.ceil(s*this.hiY)+l,t)}}},e.Drawing.freeform.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,cw:Number(this.candleWidth.toFixed(4)),mlt:Number(this.multiplier.toFixed(4)),d0:this.d0,tzo0:this.tzo0,v0:this.v0,inter:this.interval,pd:this.periodicity,nodes:this.nodes}},e.Drawing.freeform.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.candleWidth=e.cw,this.multiplier=e.mlt,this.d0=e.d0,this.tzo0=e.tzo0,this.v0=e.v0,this.interval=e.inter,this.periodicity=e.pd,this.nodes=e.nodes,this.adjust()},e.Drawing.callout=function(){this.name="callout",this.arr=[],this.w=0,this.h=0,this.padding=4,this.text="",this.ta=null,this.fontSize=0,this.font={},this.stemEntry="",this.defaultWidth=50,this.defaultHeight=10},e.Drawing.callout.ciqInheritsFrom(e.Drawing.annotation),e.Drawing.callout.prototype.configs=["color","fillColor","lineWidth","pattern","font"],e.Drawing.callout.prototype.copyConfig=function(){e.Drawing.copyConfig(this),this.borderColor=this.color},e.Drawing.callout.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),this.p0=[e,i],this.render(t))},e.Drawing.callout.prototype.onChange=function(t){if(this.stx.panels[this.panelName]){var i=t.target;this.w=i.clientWidth,this.h=i.clientHeight;var a=this.context||this.stx.chart.tempCanvas.context;e.clearCanvas(a.canvas,this.stx),this.render(a),this.edit(a)}},e.Drawing.callout.prototype.render=function(t){this.context=t;var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]);if(!isNaN(r)){t.font=this.fontString,t.textBaseline="top";var n=a,s=r,o=this.w/2,l=this.h/2;this.penDown&&(o=this.defaultWidth,(l=this.defaultHeight)||(l=this.fontSize));var h=this.lineWidth;h||(h=1.1);var c=this.color;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor);var u,p,d,m,g=this.borderColor;("auto"==g||e.isTransparent(g))&&(g=this.stx.defaultColor),this.highlighted&&(g=this.stx.getCanvasColor("stx_highlight_vector"));var f=Math.min(Math.min(o,l)/2,8);if(this.stem){this.stem.t?(u=this.stx.pixelFromTick(this.stem.t),d=this.stx.pixelFromValueAdjusted(i,this.stem.t,this.stem.v)):this.stem.x&&(u=n,d=s,n+=this.stem.x,s+=this.stem.y);var y="";u>=n+o?(p=n+o,y="r"):u>n-o&&u<n+o?(p=n,y="c"):u<=n-o&&(p=n-o,y="l"),d>=s+l?(m=s+l,y+="b"):d>s-l&&d<s+l?(m=s,y+="m"):d<=s-l&&(m=s-l,y+="t"),this.stemEntry=y,"cm"!=y&&(u=Math.round(u),p=Math.round(p),d=Math.round(d),m=Math.round(m))}this.highlighted?this.stx.canvasColor("stx_annotation_highlight_bg",t):this.fillColor?(t.fillStyle=this.fillColor,t.globalAlpha=.4):this.stem&&(t.fillStyle=this.stx.containerColor),t.strokeStyle=g,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(h,this.pattern)),t.lineDashOffset=0),g&&(t.beginPath(),t.lineWidth=h,t.moveTo(n+o-f,s-l),"rt"!=this.stemEntry?t.quadraticCurveTo(n+o,s-l,n+o,s-l+f):(t.lineTo(u,d),t.lineTo(n+o,s-l+f)),t.lineTo(n+o,s-f/2),"rm"==this.stemEntry&&t.lineTo(u,d),t.lineTo(n+o,s+f/2),t.lineTo(n+o,s+l-f),"rb"!=this.stemEntry?t.quadraticCurveTo(n+o,s+l,n+o-f,s+l):(t.lineTo(u,d),t.lineTo(n+o-f,s+l)),t.lineTo(n+f/2,s+l),"cb"==this.stemEntry&&t.lineTo(u,d),t.lineTo(n-f/2,s+l),t.lineTo(n-o+f,s+l),"lb"!=this.stemEntry?t.quadraticCurveTo(n-o,s+l,n-o,s+l-f):(t.lineTo(u,d),t.lineTo(n-o,s+l-f)),t.lineTo(n-o,s+f/2),"lm"==this.stemEntry&&t.lineTo(u,d),t.lineTo(n-o,s-f/2),t.lineTo(n-o,s-l+f),"lt"!=this.stemEntry?t.quadraticCurveTo(n-o,s-l,n-o+f,s-l):(t.lineTo(u,d),t.lineTo(n-o+f,s-l)),t.lineTo(n-f/2,s-l),"ct"==this.stemEntry&&t.lineTo(u,d),t.lineTo(n+f/2,s-l),t.lineTo(n+o-f,s-l),t.fill(),t.globalAlpha=1,t.stroke()),this.highlighted?this.stx.canvasColor("stx_annotation_highlight",t):t.fillStyle=c,s+=this.padding;for(var v=0;v<this.arr.length;v++)t.fillText(this.arr[v],n-o+this.padding,s-l),s+=this.fontSize;if(t.textBaseline="alphabetic",this.highlighted&&!this.noHandles){var x="p0"==this.highlighted;this.littleCircle(t,u,d,x)}}}},e.Drawing.callout.prototype.click=function(t,e,i){if(!this.stx.overXAxis&&!this.stx.overYAxis){var a=this.stx.panels[this.panelName];return this.copyConfig(),this.setPoint(0,e,i,a.chart),this.penDown?(this.adjust(),this.edit(t),this.penDown=!1,!1):(this.stem={d:this.d0,v:this.v0},this.penDown=!0,this.adjust(),!1)}},e.Drawing.callout.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;e.stem?("drag"==e.action?this.stem={d:this.stx.dateFromTick(i,r.chart,!0),v:a}:"move"==e.action&&(this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.stem={d:this.stx.dateFromTick(this.stx.tickFromDate(e.stem.d,r.chart)-n),v:e.stem.v-s}),this.adjust()):this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.render(t)}},e.Drawing.callout.prototype.lineIntersection=function(t,i,a,r){var n=this.stx.panels[this.panelName],s=this.stem,o=this.p0;this.stx.layout;if(!o||!s||!n)return!1;var l=s.t||this.stx.tickFromDate(s.d,n.chart);return e.boxIntersects(a.x0,a.y0,a.x1,a.y1,o[0],o[1],l,s.v,r,n.yAxis.semiLog)},e.Drawing.callout.prototype.intersected=function(t,i,a){var r=this.stx.panels[this.panelName];if(!this.p0)return null;if(this.pointIntersection(this.stem.t,this.stem.v,a))return this.highlighted="p0",{action:"drag",stem:!0};var n=this.stx.pixelFromTick(this.p0[0],r.chart)-this.w/2,s=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1])-this.h/2,o=n+this.w,l=s+this.h;this.stem&&this.stem.x&&(n+=this.stem.x,o+=this.stem.x,s+=this.stem.y,l+=this.stem.y);var h=this.stx.pixelFromTick(t,r.chart),c=this.stx.pixelFromValueAdjusted(r,t,i);return h>=n&&h<=o&&c>=s&&c<=l?(this.highlighted=!0,{p0:e.clone(this.p0),tick:t,value:i}):this.lineIntersection(t,i,a,"segment")?(this.highlighted=!0,{action:"move",stem:e.clone(this.stem),p0:e.clone(this.p0),tick:t,value:i}):null},e.Drawing.fibprojection=function(){this.name="fibprojection",this.dragToDraw=!1,this.p2=null},e.Drawing.fibprojection.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibprojection.prototype.recommendedLevels=[0,.618,1,1.272,1.618,2.618,4.236],e.Drawing.fibprojection.prototype.click=function(t,i,a){var r=this.stx.panels[this.panelName];if(r)return this.copyConfig(),this.penDown?this.accidentalClick(i,a)?(this.stx.undo(),!0):null!==this.p2?(this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.parameters=e.clone(this.parameters),!0):(this.setPoint(1,i,a,r.chart),this.p2=[this.p1[0],this.p1[1]],!1):(this.setPoint(0,i,a,r.chart),this.penDown=!0,!1)},e.Drawing.fibprojection.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=this.p1[1]-this.p0[1],n=this.stx.pixelFromTick(this.p0[0],i.chart),s=this.stx.pixelFromTick(this.p1[0],i.chart),o=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),l=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),h=null,c=null;this.p2&&(h=this.stx.pixelFromTick(this.p2[0],i.chart),c=this.stx.pixelFromValueAdjusted(i,this.p2[0],this.p2[1]));this.parameters.trend||(this.parameters.trend={color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}});var u=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var p=t.measureText("161.8%").width+10,d=this.color;if(("auto"==d||e.isTransparent(d))&&(d=this.stx.defaultColor),this.p2)for(var m=0;m<this.parameters.fibs.length;m++){t.textAlign="left",t.fillStyle=d;var g=this.parameters.fibs[m];if(g.display){var f=this.stx.pixelFromValueAdjusted(i,this.p2[0],this.p2[1]+r*g.level),y=e.xIntersection({x0:n,x1:s,y0:o,y1:l},f),v=this.parameters.extendLeft?0:n,x=i.left+i.width;if(this.parameters.printLevels){var b=Math.round(1e3*g.level)/10+"%";x-=p,this.parameters.printValues&&(t.fillStyle=d,this.stx.canvasFont("stx_yaxis",t)),x<v&&(t.textAlign="right"),t.fillText(b,x,f),x<v?x+=5:x-=5}if(this.parameters.printValues&&y<i.width){var C=this.stx.transformedPriceFromPixel(f,i);C=a.priceFormatter?a.priceFormatter(this.stx,i,C):this.stx.formatYAxisPrice(C,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,C,f,d,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var S=g.color;("auto"==S||e.isTransparent(S))&&(S=this.color),("auto"==S||e.isTransparent(S))&&(S=this.stx.defaultColor);var w=g.color;("auto"==w||e.isTransparent(w))&&(w=this.fillColor),("auto"==w||e.isTransparent(w))&&(w=this.stx.defaultColor),t.fillStyle=w,this.stx.plotLine(v,x,f,f,S,"segment",t,i,g.parameters),t.globalAlpha=.05,t.beginPath(),t.moveTo(x,f),t.lineTo(v,f),v?t.lineTo(n,c):t.lineTo(v,c),t.lineTo(x,c),void 0!==w&&t.fill(),t.globalAlpha=1}}if(this.stx.plotLine(n,s,o,l,u,"segment",t,i,this.parameters.trend.parameters),this.p2&&this.stx.plotLine(s,h,l,c,u,"segment",t,i,this.parameters.trend.parameters),this.highlighted){var T="p0"==this.highlighted,M="p1"==this.highlighted,D="p2"==this.highlighted;this.littleCircle(t,n,o,T),this.littleCircle(t,s,l,M),this.littleCircle(t,h,c,D)}}}},e.Drawing.fibprojection.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),null===this.p2?this.p1=[e,i]:this.p2=[e,i],this.render(t))},e.Drawing.fibprojection.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName],n=e.tick-i,s=e.value-a;"move"==e.action?(this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.setPoint(1,e.p1[0]-n,e.p1[1]-s,r.chart),this.setPoint(2,e.p2[0]-n,e.p2[1]-s,r.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,a],this.setPoint(0,this.p0[0],this.p0[1],r.chart),this.setPoint(1,this.p1[0],this.p1[1],r.chart),this.setPoint(2,this.p2[0],this.p2[1],r.chart),this.render(t))}},e.Drawing.fibprojection.prototype.intersected=function(t,i,a){var r=this.p0,n=this.p1,s=this.p2,o=this.stx.layout;if(!r||!n||!s)return null;var l=e.boxIntersects(a.x0,a.y0,a.x1,a.y1,r[0],r[1],n[0],n[1],"segment",o.semiLog||"log"==o.chartScale),h=e.boxIntersects(a.x0,a.y0,a.x1,a.y1,s[0],s[1],n[0],n[1],"segment",o.semiLog||"log"==o.chartScale);return l||h?this.pointIntersection(r[0],r[1],a)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(n[0],n[1],a)?(this.highlighted="p1",{action:"drag",point:"p1"}):this.pointIntersection(s[0],s[1],a)?(this.highlighted="p2",{action:"drag",point:"p2"}):(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(n),p2:e.clone(s),tick:t,value:i}):null},e.Drawing.fibprojection.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d2,this.v2,t.chart))},e.Drawing.fibarc=function(){this.name="fibarc"},e.Drawing.fibarc.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibarc.prototype.recommendedLevels=[.382,.5,.618,1],e.Drawing.fibarc.prototype.setOuter=function(){this.outer={p0:e.clone(this.p0),p1:e.clone(this.p1)};var t=this.p0[1],i=this.p1[1],a=this.p0[0],r=this.p1[0],n=2*(t-i)+i,s=e.xIntersection({x0:a,x1:r,y0:t,y1:i},n);this.outer.p0[1]=n,this.outer.p0[0]=s},e.Drawing.fibarc.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),l=o<s,h=Math.abs((o-s)/(n-r)),c=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var u=this.color;("auto"==u||e.isTransparent(u))&&(u=this.stx.defaultColor);for(var p=0;p<this.parameters.fibs.length;p++){t.fillStyle=u;var d=this.parameters.fibs[p];if(!(d.level<0)&&d.display){var m=Math.abs(this.p1[1]-this.p0[1])*Math.sqrt(2)*d.level,g=this.p1[1]+m*(l?-1:1),f=this.stx.pixelFromValueAdjusted(i,this.p0[0],g),y=e.xIntersection({x0:r,x1:n,y0:s,y1:o},f);if(this.parameters.printLevels){t.textAlign="center";var v=Math.round(1e3*d.level)/10+"%";this.parameters.printValues&&(t.fillStyle=u,this.stx.canvasFont("stx_yaxis",t)),t.fillText(v,n,Math.round(f-5))}if(t.textAlign="left",this.parameters.printValues&&y<i.width){var x=g;x=a.priceFormatter?a.priceFormatter(this.stx,i,x):this.stx.formatYAxisPrice(x,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,x,f,u,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var b=d.color;("auto"==b||e.isTransparent(b))&&(b=this.color),("auto"==b||e.isTransparent(b))&&(b=this.stx.defaultColor),t.strokeStyle=b;var C=d.color;("auto"==C||e.isTransparent(C))&&(C=this.fillColor),("auto"==C||e.isTransparent(C))&&(C=this.stx.defaultColor),t.fillStyle=C,t.globalAlpha=d.parameters.opacity,t.lineWidth=d.parameters.lineWidth,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(t.lineWidth,d.parameters.pattern)),t.lineDashOffset=0),t.save(),t.beginPath(),t.scale(1/h,1),t.arc(n*h,o,Math.abs(f-o),0,Math.PI,!l),t.stroke(),t.globalAlpha=.05,t.fill(),t.restore(),t.setLineDash&&t.setLineDash([]),t.globalAlpha=1}}if(t.textAlign="left",this.stx.plotLine(n,2*r-n,o,2*s-o,c,"segment",t,i,this.parameters.trend.parameters),this.highlighted){var S="p0"==this.highlighted,w="p1"==this.highlighted;this.littleCircle(t,r,s,S),this.littleCircle(t,n,o,w)}}}},e.Drawing.fibfan=function(){this.name="fibfan"},e.Drawing.fibfan.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibfan.prototype.recommendedLevels=[0,.382,.5,.618,1],e.Drawing.fibfan.prototype.setOuter=function(){this.outer={p0:e.clone(this.p0),p1:e.clone(this.p1)};for(var t=this.p0[1],i=this.p1[1],a=this.p0[0],r=this.p1[0],n=0,s=0;s<this.parameters.fibs.length;s++){var o=this.parameters.fibs[s];if(!(o.level>=n)&&o.display){var l=(t-i)*o.level+i,h=e.xIntersection({x0:a,x1:r,y0:t,y1:i},l);n=o.level,this.outer.p1[1]=l,this.outer.p1[0]=h}}},e.Drawing.fibfan.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var a=i.yAxis;if(this.p1){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),l=Math.min(o,s),h=Math.max(o,s),c=h-l,u=(o-s)/(n-r)>0,p=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var d=t.measureText("161.8%").width+10,m=Number.MAX_VALUE,g=-1*Number.MAX_VALUE,f=this.color;("auto"==f||e.isTransparent(f))&&(f=this.stx.defaultColor);for(var y=0;y<this.parameters.fibs.length;y++){t.fillStyle=f;var v=this.parameters.fibs[y];if(v.display){var x=this.stx.pixelFromValueAdjusted(i,this.p0[0],(this.p0[1]-this.p1[1])*v.level+this.p1[1]),b=e.xIntersection({x0:n,x1:n,y0:s,y1:o},x),C=i.left;n>r&&(C+=i.width);var S=(C-r)*(x-s)/(b-r)+s;if(!(r>C-(this.parameters.printLevels?d+5:0)&&n>r||r<C+(this.parameters.printLevels?d+5:0)&&n<r)){if(this.parameters.printLevels){var w=Math.round(1e3*v.level)/10+"%";n>r?(C-=d,t.textAlign="left"):(C+=d,t.textAlign="right"),this.parameters.printValues&&(t.fillStyle=f,this.stx.canvasFont("stx_yaxis",t)),S=(C-r)*(x-s)/(b-r)+s,t.fillText(w,C,S),n>r?C-=5:C+=5}if(t.textAlign="left",this.parameters.printValues&&b<i.width){var T=this.stx.transformedPriceFromPixel(x,i);T=a.priceFormatter?a.priceFormatter(this.stx,i,T):this.stx.formatYAxisPrice(T,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,T,x,f,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var M=v.color;("auto"==M||e.isTransparent(M))&&(M=this.color),("auto"==M||e.isTransparent(M))&&(M=this.stx.defaultColor);var D=v.color;("auto"==D||e.isTransparent(D))&&(D=this.fillColor),("auto"==D||e.isTransparent(D))&&(D=this.stx.defaultColor),t.fillStyle=D,this.parameters.printLevels&&(S=(C-r)*(x-s)/(b-r)+s),this.stx.plotLine(r,C,s,S,v.level||!this.highlighted?M:p,"segment",t,i,v.parameters),t.globalAlpha=.05,t.beginPath(),t.moveTo(C,S),t.lineTo(r,s),t.lineTo(C,s),t.fill(),t.globalAlpha=1,x<m&&(m=x),x>g&&(g=x)}}}for(var E in{0:0,1:1}){var A=u?h-c*E:l+c*E;(A=Math.round(A))<m&&(m=A),A>g&&(g=A)}if(this.highlighted){var k="p0"==this.highlighted,F="p1"==this.highlighted;this.littleCircle(t,r,s,k),this.littleCircle(t,n,o,F)}}}},e.Drawing.fibtimezone=function(){this.name="fibtimezone"},e.Drawing.fibtimezone.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibtimezone.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=[1,0],l=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var h=this.p1[0]-this.p0[0],c=this.color;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor),t.textAlign="center";var u=a,p=i.yAxis.top,d=i.yAxis.bottom,m=0,g=this.parameters.timezone.color;("auto"==g||e.isTransparent(g))&&(g=this.color),("auto"==g||e.isTransparent(g))&&(g=this.stx.defaultColor);var f=this.parameters.timezone.color;("auto"==f||e.isTransparent(f))&&(f=this.fillColor),("auto"==f||e.isTransparent(f))&&(f=this.stx.defaultColor),this.parameters.printLevels&&(d-=13);do{if(u=this.stx.pixelFromTick(this.p0[0]+m*h,i.chart),a<r&&u>i.left+i.width)break;if(a>r&&u<i.left)break;this.parameters.printLevels&&(t.fillStyle=c,t.fillText(r>a?m:-1*m,u,d+7)),t.fillStyle=f,this.stx.plotLine(u,u,0,d,this.highlighted?l:g,"segment",t,i,this.parameters.timezone.parameters),t.globalAlpha=.05,t.beginPath(),t.moveTo(a,p),t.lineTo(u,p),t.lineTo(u,d),t.lineTo(a,d),t.fill(),t.globalAlpha=1,m=o[0]+o[1],o.unshift(m)}while(h);if(t.textAlign="left",this.stx.plotLine(a,r,n,s,l,"segment",t,i,this.parameters.trend.parameters),this.highlighted){var y="p0"==this.highlighted,v="p1"==this.highlighted;this.littleCircle(t,a,n,y),this.littleCircle(t,r,s,v)}}},e.Drawing.fibtimezone.prototype.intersected=function(t,i,a){var r=this.p0,n=this.p1,s=(this.stx.layout,this.stx.panels[this.panelName]);return r&&n&&s?this.pointIntersection(r[0],r[1],a)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(n[0],n[1],a)?(this.highlighted="p1",{action:"drag",point:"p1"}):e.boxIntersects(a.x0,a.y0,a.x1,a.y1,r[0],r[1],n[0],n[1],"segment",s.yAxis.semiLog)||a.x0<=r[0]&&a.x1>=r[0]?(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(n),tick:t,value:i}):null:null},e.Drawing.shape=function(){this.name="shape",this.radians=0,this.a=0,this.rotating=!1,this.textMeasure=!1,this.configurator="shape",this.dimension=[0,0],this.points=[]},e.Drawing.shape.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.shape.prototype.measure=function(){},e.Drawing.shape.prototype.render=function(t){if(this.points.length){var i=this.stx.panels[this.panelName];if(i){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]);if(this.p1){var n=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);t.globalAlpha=.5,t.fillStyle="#000000",this.rotating?(this.radians=Math.atan((s-r)/(n-a)),n<a?this.radians+=Math.PI:s<r&&(this.radians+=2*Math.PI),this.a=5*parseInt((36*this.radians/Math.PI).toFixed(0),10),this.a%=360,this.radians=this.a*Math.PI/180,this.textMeasure&&t.fillText(this.a+"°",n+10,s+10)):this.penDown&&(this.sx=Math.max(1,parseFloat(Math.abs(2*(n-a)/this.dimension[0]).toFixed(1))),n<a&&(this.sx*=-1),this.sy=Math.max(1,parseFloat(Math.abs(2*(s-r)/this.dimension[1]).toFixed(1))),s<r&&(this.sy*=-1),this.textMeasure&&t.fillText(this.sx+"x,"+this.sy+"x",n+this.sx+5,s+this.sy+5)),t.globalAlpha=1}var o=this.lineWidth;o||(o=1.1);var l={pattern:this.pattern,lineWidth:o};this.highlighted&&"none"==l.pattern&&(l.pattern="solid",.1==l.lineWidth&&(l.lineWidth=1));var h=this.color;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),this.highlighted&&(h=this.stx.getCanvasColor("stx_highlight_vector"),.1==o&&(o=1.1));var c,u,p=this.fillColor;for(o/=2*Math.abs(this.sx*this.sy)/(Math.abs(this.sx)+Math.abs(this.sy)),t.save(),t.translate(a,r),t.rotate(this.radians),t.scale(this.sx,this.sy),c=0;c<this.points.length;c++){for(t.beginPath(),u=0;u<this.points[c].length;u++){var d,m,g,f,y,v;"M"==this.points[c][u]?(d=this.points[c][++u]-(this.dimension[0]-1)/2,m=this.points[c][++u]-(this.dimension[1]-1)/2,t.moveTo(d,m)):"L"==this.points[c][u]?(d=this.points[c][++u]-(this.dimension[0]-1)/2,m=this.points[c][++u]-(this.dimension[1]-1)/2,t.lineTo(d,m)):"Q"==this.points[c][u]?(g=this.points[c][++u]-(this.dimension[0]-1)/2,y=this.points[c][++u]-(this.dimension[1]-1)/2,d=this.points[c][++u]-(this.dimension[0]-1)/2,m=this.points[c][++u]-(this.dimension[1]-1)/2,t.quadraticCurveTo(g,y,d,m)):"B"==this.points[c][u]&&(g=this.points[c][++u]-(this.dimension[0]-1)/2,y=this.points[c][++u]-(this.dimension[1]-1)/2,f=this.points[c][++u]-(this.dimension[0]-1)/2,v=this.points[c][++u]-(this.dimension[1]-1)/2,d=this.points[c][++u]-(this.dimension[0]-1)/2,m=this.points[c][++u]-(this.dimension[1]-1)/2,t.bezierCurveTo(g,y,f,v,d,m))}t.closePath(),p&&!e.isTransparent(p)&&"auto"!=p&&(t.fillStyle=p,t.fill()),h&&"none"!=this.pattern&&(t.strokeStyle=h,t.lineWidth=o,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(o,this.pattern)),t.lineDashOffset=0),t.stroke())}if(t.restore(),t.save(),t.translate(a,r),t.rotate(this.radians),this.highlighted){var x="p0"==this.highlighted,b="p1"==this.highlighted,C="p2"==this.highlighted;this.littleCircle(t,0,0,x),this.mover(t,0,0,x),this.littleCircle(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,b),this.resizer(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,b),this.littleCircle(t,this.sx*this.dimension[0]/2,0,C),this.rotator(t,this.sx*this.dimension[0]/2,0,C),t.globalAlpha=.5,t.fillStyle="#000000",this.textMeasure&&(t.fillText(this.sx+"x,"+this.sy+"x",this.sx*this.dimension[0]/2+12,this.sy*this.dimension[1]/2+5),t.fillText(this.a+"°",this.sx*this.dimension[0]/2+12,5)),t.globalAlpha=1}else this.penDown&&(this.rotating?this.rotator(t,this.sx*this.dimension[0]/2,0,!0):this.resizer(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,!0));t.restore()}}},e.Drawing.shape.prototype.reposition=function(t,e,i,a){if(e){var r=this.stx.panels[this.panelName];if("move"==e.action){var n=e.tick-i,s=e.value-a;this.setPoint(0,e.p0[0]-n,e.p0[1]-s,r.chart),this.render(t)}else{var o=this.stx.pixelFromTick(this.p0[0],r.chart),l=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]),h=this.stx.pixelFromTick(i,r.chart),c=this.stx.pixelFromValueAdjusted(r,i,a);"scale"==e.action?(this[e.point]=[i,a],this.sx=parseFloat((((h-o)*Math.cos(this.radians)+(c-l)*Math.sin(this.radians))/(this.dimension[0]/2)).toFixed(1)),Math.abs(this.sx)<1&&(this.sx/=Math.abs(this.sy)),this.sy=parseFloat((((c-l)*Math.cos(this.radians)-(h-o)*Math.sin(this.radians))/(this.dimension[1]/2)).toFixed(1)),Math.abs(this.sy)<1&&(this.sy/=Math.abs(this.sy)),this.render(t)):"rotate"==e.action&&(this[e.point]=[i,a],this.radians=Math.atan((c-l)/(h-o)),h<o?this.radians+=Math.PI:c<l&&(this.radians+=2*Math.PI),this.a=5*parseInt((36*this.radians/Math.PI).toFixed(0),10),this.sx<0&&(this.a=this.a+180),this.a%=360,this.radians=this.a*Math.PI/180,this.render(t))}}},e.Drawing.shape.prototype.intersected=function(t,i,a){if(!this.p0)return null;if(this.stx.repositioningDrawing==this&&this.stx.repositioningDrawing.repositioner)return this.stx.repositioningDrawing.repositioner;var r=this.stx.panels[this.panelName],n=this.stx.pixelFromTick(this.p0[0],r.chart),s=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]),o=this.stx.pixelFromTick(t,r.chart),l=this.stx.pixelFromValueAdjusted(r,t,i),h=l-=s,c=o-=n;o=Math.cos(this.radians)*c+Math.sin(this.radians)*h,l=Math.cos(this.radians)*h-Math.sin(this.radians)*c,o/=this.sx,l/=this.sy;var u=Math.pow(e.touchDevice?25:5+this.littleCircleRadius(),2),p=Math.abs(u/(this.sx*this.sy)),d=Math.pow(this.dimension[0]/2,2)+Math.pow(this.dimension[1]/2,2)>Math.pow(o,2)+Math.pow(l,2),m=(u-(Math.pow(o*this.sx,2)+Math.pow(l*this.sy,2)))/Math.abs(this.sx*this.sy),g=p-(Math.pow(o-this.dimension[0]/2,2)+Math.pow(l-this.dimension[1]/2,2)),f=p-(Math.pow(o-this.dimension[0]/2,2)+Math.pow(l,2));return g>0&&g>=f&&g>=m?(this.highlighted="p1",{action:"scale"}):f>0&&f>=g&&f>=m?(this.highlighted="p2",{action:"rotate"}):m>0&&m>=g&&m>=f?(this.highlighted="p0",{action:"move",p0:e.clone(this.p0),tick:t,value:i}):d?(this.highlighted=!0,{}):null},e.Drawing.shape.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.shape.prototype.littleCircleRadius=function(){return 3},e.Drawing.shape.prototype.click=function(t,e,i){if(!this.points.length)return!1;this.copyConfig();var a=this.stx.panels[this.panelName];return this.penDown?(this.setPoint(1,e,i,a.chart),this.rotating?(this.penDown=!1,this.rotating=!1,!0):(this.rotating=!0,!1)):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)},e.Drawing.shape.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.radians=Math.round(this.a/5)*Math.PI/36)},e.Drawing.shape.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.v0=e.v0,this.tzo0=e.tzo0,this.a=e.a,this.sx=e.sx,this.sy=e.sy,this.adjust()},e.Drawing.shape.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,v0:this.v0,tzo0:this.tzo0,a:this.a,sx:this.sx,sy:this.sy}},e.Drawing.xcross=function(){this.name="xcross",this.dimension=[7,7],this.points=[["M",1,0,"L",3,2,"L",5,0,"L",6,1,"L",4,3,"L",6,5,"L",5,6,"L",3,4,"L",1,6,"L",0,5,"L",2,3,"L",0,1,"L",1,0]]},e.Drawing.xcross.ciqInheritsFrom(e.Drawing.shape),e.Drawing.arrow=function(){this.name="arrow",this.dimension=[11,11],this.points=[["M",3,0,"L",7,0,"L",7,5,"L",10,5,"L",5,10,"L",0,5,"L",3,5,"L",3,0]]},e.Drawing.arrow.ciqInheritsFrom(e.Drawing.shape),e.Drawing.check=function(){this.name="check",this.dimension=[8,9],this.points=[["M",1,5,"L",0,6,"L",2,8,"L",7,1,"L",6,0,"L",2,6,"L",1,5]]},e.Drawing.check.ciqInheritsFrom(e.Drawing.shape),e.Drawing.star=function(){this.name="star",this.dimension=[12,12],this.points=[["M",0,4,"L",4,4,"L",5.5,0,"L",7,4,"L",11,4,"L",8,7,"L",9,11,"L",5.5,9,"L",2,11,"L",3,7,"L",0,4]]},e.Drawing.star.ciqInheritsFrom(e.Drawing.shape),e.Drawing.heart=function(){this.name="heart",this.dimension=[23,20],this.points=[["M",11,3,"B",11,2.4,10,0,6,0,"B",0,0,0,7.5,0,7.5,"B",0,11,4,15.4,11,19,"B",18,15.4,22,11,22,7.5,"B",22,7.5,22,0,16,0,"B",13,0,11,2.4,11,3]]},e.Drawing.heart.ciqInheritsFrom(e.Drawing.shape),e.Drawing.focusarrow=function(){this.name="focusarrow",this.dimension=[7,5],this.points=[["M",0,0,"L",2,2,"L",0,4,"L",0,0],["M",6,0,"L",4,2,"L",6,4,"L",6,0]]},e.Drawing.focusarrow.ciqInheritsFrom(e.Drawing.shape),e.Drawing.crossline=function(){this.name="crossline"},e.Drawing.crossline.ciqInheritsFrom(e.Drawing.horizontal),e.extend(e.Drawing.crossline.prototype,{measure:function(){},accidentalClick:function(t,e){return!1},adjust:function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=e.clone(this.p0))},intersected:function(t,i,a){if(!this.p0||!this.p1)return null;this.p1[0]+=1;var r=this.lineIntersection(t,i,a,"horizontal");return this.p1=e.clone(this.p0),r||(this.p1[1]+=1,r=this.lineIntersection(t,i,a,"vertical"),this.p1=e.clone(this.p0),r)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},render:function(t){var a=this.stx.panels[this.panelName];if(a){var r=this.stx.pixelFromTick(this.p0[0],a.chart),n=this.stx.pixelFromValueAdjusted(a,this.p0[0],this.p0[1]),s=this.setLineColor(),o={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(r,r+100,n,n,s,"horizontal",t,a,o),this.stx.plotLine(r,r,n,n+100,s,"vertical",t,a,o),this.axisLabel&&!this.repositioner){this.stx.endClip();var l=this.p0[1];if(a.chart.transformFunc&&(l=a.chart.transformFunc(this.stx,a.chart,l)),l=a.yAxis.priceFormatter?a.yAxis.priceFormatter(this.stx,a,l):this.stx.formatYAxisPrice(l,a),this.stx.createYAxisLabel(a,l,n,s),this.stx.startClip(a.name),this.p0[0]>=0&&!e.ChartEngine.hideDates()){var h,c;if(h=this.stx.dateFromTick(this.p0[0],a.chart,!0),e.ChartEngine.isDailyInterval(this.stx.layout.interval))h.setHours(0,0,0,0);else{var u=1e3*h.getSeconds()+h.getMilliseconds();this.stx.dataZone&&(c=new i.Date(h.getFullYear(),h.getMonth(),h.getDate(),h.getHours(),h.getMinutes(),this.stx.dataZone),h=new Date(c.getTime()+u)),this.stx.displayZone&&(c=new i.Date(h.getTime(),this.stx.displayZone),h=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes()),h=new Date(h.getTime()+u))}var p=e.mmddhhmm(e.yyyymmddhhmm(h));if(a.chart.xAxis.formatter)p=a.chart.xAxis.formatter(h);else if(this.stx.internationalizer){var d;0!==h.getHours()||0!==h.getMinutes()?(d=this.stx.internationalizer.monthDay.format(h),d+=" "+this.stx.internationalizer.hourMinute.format(h)):d=this.stx.internationalizer.yearMonthDay.format(h),p=d}this.stx.endClip(),this.stx.createXAxisLabel(a,p,r,s,null,!0),this.stx.startClip(a.name)}}}}},!0),e.Drawing.speedarc=function(){this.name="speedarc",this.printLevels=!0},e.Drawing.speedarc.ciqInheritsFrom(e.Drawing.segment),e.extend(e.Drawing.speedarc.prototype,{defaultOpacity:.25,configs:["color","fillColor","lineWidth","pattern"],lineIntersection:function(t,i,a,r){var n=this.p0,s=this.p1,o=(this.stx.layout,this.stx.panels[this.panelName]);return n&&s&&o&&e.boxIntersects(a.x0,a.y0,a.x1,a.y1,n[0],n[1],s[0],s[1],"segment",o.yAxis.semiLog)},copyConfig:function(){this.color=this.stx.currentVectorParameters.currentColor,this.fillColor=this.stx.currentVectorParameters.fillColor,this.lineWidth=this.stx.currentVectorParameters.lineWidth,this.pattern=this.stx.currentVectorParameters.pattern},render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=s<n,l=Math.abs((s-n)/(r-a)),h=this.color;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),t.strokeStyle=h;var c=this.fillColor;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor),t.fillStyle=c,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(this.lineWidth,this.pattern)),t.lineDashOffset=0),this.stx.canvasFont("stx_yaxis",t);for(var u=1;u<3;u++){var p=Math.abs(this.p1[1]-this.p0[1])*Math.sqrt(2)*u/3,d=this.p1[1]+p*(o?-1:1),m=this.stx.pixelFromValueAdjusted(i,this.p0[0],d);if(t.save(),t.beginPath(),t.scale(1/l,1),t.arc(r*l,s,Math.abs(m-s),0,Math.PI,!o),t.globalAlpha=this.defaultOpacity,t.stroke(),t.globalAlpha=.1,t.fill(),t.restore(),t.globalAlpha=1,this.printLevels){t.fillStyle=h,t.textAlign="center";var g=u+"/3";t.fillText(g,r,Math.round(m-5)),t.fillStyle=c}}t.textAlign="left";var f=this.setLineColor(),y={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.defaultOpacity};if(this.stx.plotLine(a,r,n,s,f,"segment",t,i,y),t.setLineDash&&t.setLineDash([]),this.highlighted){var v="p0"==this.highlighted,x="p1"==this.highlighted;this.littleCircle(t,a,n,v),this.littleCircle(t,r,s,x)}}},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}}},!0),e.Drawing.speedline=function(){this.name="speedline",this.printLevels=!0},e.Drawing.speedline.ciqInheritsFrom(e.Drawing.speedarc),e.extend(e.Drawing.speedline.prototype,{render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);this.stx.canvasFont("stx_yaxis",t);var o=this.setLineColor(),l=this.color;("auto"==l||e.isTransparent(l))&&(l=this.stx.defaultColor),t.strokeStyle=l;var h=this.fillColor;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),t.fillStyle=h;for(var c,u,p={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.defaultOpacity},d=["1","2/3","1/3","3/2","3"],m=[1,2/3,1/3,1.5,3],g=[],f=0;f<m.length;f++){var y=m[f];if(!(y>1)||this.extension){var v,x=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]-(this.p0[1]-this.p1[1])*y);y>1?(v=e.xIntersection({x0:a,x1:r,y0:n,y1:x},s),g.push(v)):(v=e.xIntersection({x0:r,x1:r,y0:n,y1:s},x),g.push(x));var b=y>1?v:r,C=y>1?s:x;if(this.confineToGrid||(b=i.left,r>a&&(b+=i.width),C=(b-a)*(x-n)/(r-a)+n),this.printLevels&&(1!=y||this.extension)){t.fillStyle=l;var S=0,w=0;n>s?(w=-5,t.textBaseline="bottom"):(w=5,t.textBaseline="top"),a>r?(S=5,t.textAlign="right"):(S=-5,t.textAlign="left"),y>1?t.fillText(d[f],v+(this.confineToGrid?0:S),s):t.fillText(d[f],r,x+(this.confineToGrid?0:w)),t.fillStyle=h}this.stx.plotLine(a,b,n,C,f||!this.highlighted?l:o,"segment",t,i,p),1==y&&(c=b,u=C),t.globalAlpha=.1,t.beginPath(),t.moveTo(b,C),t.lineTo(a,n),t.lineTo(c,u),t.fill(),t.globalAlpha=1}}if(t.textAlign="left",t.textBaseline="middle",this.confineToGrid&&(t.globalAlpha=.3,t.beginPath(),t.moveTo(a,n),t.lineTo(a,s),t.lineTo(r,s),t.lineTo(r,n),t.lineTo(a,n),t.moveTo(a,g[1]),t.lineTo(r,g[1]),t.moveTo(a,g[2]),t.lineTo(r,g[2]),this.extension&&(t.moveTo(g[3],n),t.lineTo(g[3],s),t.moveTo(g[4],n),t.lineTo(g[4],s)),t.stroke(),t.globalAlpha=1),this.highlighted){var T="p0"==this.highlighted,M="p1"==this.highlighted;this.littleCircle(t,a,n,T),this.littleCircle(t,r,s,M)}}}},!0),e.Drawing.gannfan=function(){this.name="gannfan",this.printLevels=!0},e.Drawing.gannfan.ciqInheritsFrom(e.Drawing.speedarc),e.extend(e.Drawing.gannfan.prototype,{render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);this.stx.canvasFont("stx_yaxis",t);var o=this.setLineColor(),l=this.color;("auto"==l||e.isTransparent(l))&&(l=this.stx.defaultColor),t.strokeStyle=l;var h=this.fillColor;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),t.fillStyle=h;for(var c,u,p={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.defaultOpacity},d=[1,2,3,4,8,.5,1/3,.25,1/8],m=0;m<d.length;m++){var g=d[m],f=a+(r-a)/g,y=n-g*(n-s),v=i.left;r>a&&(v+=i.width);var x=(v-a)*(y-n)/(r-a)+n;if(this.printLevels){t.fillStyle=l;var b=0,C=0;n>s?(C=5,t.textBaseline="top"):(C=-5,t.textBaseline="botttom"),a>r?(b=5,t.textAlign="left"):(b=-5,t.textAlign="right"),g>1?t.fillText(g+"x1",f+b,s):t.fillText("1x"+1/g,r,y+C),t.fillStyle=h}this.stx.plotLine(a,v,n,x,m||!this.highlighted?l:o,"segment",t,i,p),1==g&&(c=v,u=x),t.globalAlpha=.1,t.beginPath(),t.moveTo(v,x),t.lineTo(a,n),t.lineTo(c,u),t.fill(),t.globalAlpha=1}if(t.textAlign="left",t.textBaseline="middle",this.highlighted){var S="p0"==this.highlighted,w="p1"==this.highlighted;this.littleCircle(t,a,n,S),this.littleCircle(t,r,s,w)}}}},!0),e.Drawing.timecycle=function(){this.name="timecycle",this.printLevels=!0},e.Drawing.timecycle.ciqInheritsFrom(e.Drawing.speedarc),e.extend(e.Drawing.timecycle.prototype,{intersected:function(t,i,a){var r=this.p0,n=this.p1,s=(this.stx.layout,this.stx.panels[this.panelName]);return r&&n&&s?this.pointIntersection(r[0],r[1],a)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(n[0],n[1],a)?(this.highlighted="p1",{action:"drag",point:"p1"}):e.boxIntersects(a.x0,a.y0,a.x1,a.y1,r[0],r[1],n[0],n[1],"segment",s.yAxis.semiLog)||a.x0<=this.p0[0]&&a.x1>=r[0]?(this.highlighted=!0,{action:"move",p0:e.clone(r),p1:e.clone(n),tick:t,value:i}):null:null},render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=0,l=this.setLineColor();t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var h=this.p1[0]-this.p0[0];t.textAlign="center";var c=a,u=i.yAxis.top,p=i.yAxis.bottom,d=this.color;("auto"==d||e.isTransparent(d))&&(d=this.stx.defaultColor);var m=this.fillColor;("auto"==m||e.isTransparent(m))&&(m=this.stx.defaultColor),this.printLevels&&(p-=13);var g={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.defaultOpacity},f=[];t.save(),t.fillStyle=m,t.globalAlpha=.05;do{if(c=this.stx.pixelFromTick(this.p0[0]+o*h,i.chart),o++,a<r&&c>i.left+i.width)break;if(a>r&&c<i.left)break;c<i.left||c>i.left+i.width||(t.beginPath(),t.moveTo(a,u),t.lineTo(c,u),t.lineTo(c,p),t.lineTo(a,p),t.fill(),f.push({c:o,x:c}))}while(h);t.globalAlpha=1;for(var y=0,v=0;v<f.length;v++){if(this.stx.plotLine(f[v].x,f[v].x,0,p,this.highlighted?l:d,"segment",t,i,g),this.printLevels)t.fillStyle=d,this.stx.chart.context.measureText(f[v].c).width+3<this.stx.layout.candleWidth+y?(t.fillText(f[v].c,f[v].x,p+7),y=0):y+=this.stx.layout.candleWidth}if(t.restore(),t.textAlign="left",this.stx.plotLine(a,r,n,s,l,"segment",t,i,g),this.highlighted){var x="p0"==this.highlighted,b="p1"==this.highlighted;this.littleCircle(t,a,n,x),this.littleCircle(t,r,s,b)}}}},!0),e.Drawing.regression=function(){this.name="regression"},e.Drawing.regression.ciqInheritsFrom(e.Drawing.segment),e.extend(e.Drawing.regression.prototype,{chartsOnly:!0,click:function(t,e,i){if(!(e<0)){this.copyConfig();var a=this.stx.panels[this.panelName];return this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,a.chart),this.penDown=!1,!0):(this.setPoint(0,e,i,a.chart),this.penDown=!0,!1)}},lineIntersection:function(t,i,a,r){var n=this.p0,s=this.p1,o=(this.stx.layout,this.stx.panels[this.panelName]);return n&&s&&o&&e.boxIntersects(a.x0,a.y0,a.x1,a.y1,n[0],n[1],s[0],s[1],"segment",o.yAxis.semiLog)},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1&&!(this.p0[0]<0||this.p1[0]<0)){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<e.left&&a<e.left||i>e.right&&a>e.right)){for(var r=[],n=0,s=0,o=0,l=Math.min(this.p1[0],this.p0[0]);l<=Math.max(this.p1[0],this.p0[0]);l++){if(this.stx.chart.dataSet[l]){var h=this.stx.chart.dataSet[l].Close;(h||0===h)&&r.push(h)}o++}for(l=0;l<r.length;l++)s+=r.length*r[l]-n,n+=r[l];var c,u,p=r.length,d=p*(p+1)/2,m=(p*s-d*n)/(p*(d*(2*p+1)/3)-Math.pow(d,2)),g=(n-m*d)/p;this.p0[0]<this.p1[0]?(c=this.stx.pixelFromValueAdjusted(e,this.p0[0],g),u=this.stx.pixelFromValueAdjusted(e,this.p1[0],m*o+g)):(c=this.stx.pixelFromValueAdjusted(e,this.p0[0],m*o+g),u=this.stx.pixelFromValueAdjusted(e,this.p1[0],g));var f=this.setLineColor(),y={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(i,a,c,u,f,"segment",t,e,y),this.stx.plotLine(i,i,c-20,c+20,f,"segment",t,e,y),this.stx.plotLine(a,a,u-20,u+20,f,"segment",t,e,y),this.highlighted){var v="p0"==this.highlighted,x="p1"==this.highlighted;this.littleCircle(t,i,c,v),this.littleCircle(t,a,u,x)}else this.p0[0]<this.p1[0]?(this.setPoint(0,this.p0[0],g,e.chart),this.setPoint(1,this.p1[0],m*o+g,e.chart)):(this.setPoint(0,this.p0[0],m*o+g,e.chart),this.setPoint(1,this.p1[0],g,e.chart))}}}},!0),e.Drawing.trendline=function(){this.name="trendline"},e.Drawing.trendline.ciqInheritsFrom(e.Drawing.segment),e.Drawing.trendline.prototype.configs=["color","fillColor","lineWidth","pattern","font"],e.Drawing.trendline.prototype.measure=function(){},e.Drawing.trendline.prototype.reconstruct=function(t,i){e.Drawing.segment.prototype.reconstruct.call(this,t,i),this.callout=new e.Drawing.callout,this.callout.reconstruct(t,i.callout)},e.Drawing.trendline.prototype.serialize=function(){var t=e.Drawing.segment.prototype.serialize.call(this);return t.callout=this.callout.serialize(),t},e.Drawing.trendline.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){if(e.Drawing.segment.prototype.render.call(this,t),!this.callout){this.callout=new e.Drawing.callout;var a=e.Drawing.segment.prototype.serialize.call(this);this.callout.reconstruct(this.stx,a)}this.callout.p0=e.clone(this.p0);var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);if(isFinite(s)&&isFinite(o)){var l=(r+n)/2,h=(s+o)/2;this.fontSize=e.stripPX(this.font&&this.font.size||13);var c=1.2*this.callout.w+("c"==this.callout.stemEntry[0]?0:50),u=c/(Math.sqrt(Math.pow(n-r,2)+Math.pow(o-s,2))||c)*(this.p1[1]<this.p0[1]?1:-1),p=-(o-h)*u+l,d=(n-l)*u+h;this.callout.p0[0]=this.stx.tickFromPixel(p,i.chart),this.callout.p0[1]=this.stx.priceFromPixel(d,i),this.callout.v0=this.callout.p0[1],this.callout.p1=e.clone(this.p0),this.callout.stx=this.stx,this.callout.fillColor=this.fillColor||this.callout.fillColor,this.callout.borderColor=this.color,this.callout.font=this.font||this.callout.font,this.callout.noHandles=!0;var m=this.p1[1]-this.p0[1];this.callout.text=Number(m).toFixed(2)+(0===this.p0[1]?"":" ("+Number(100*m/this.p0[1]).toFixed(2)+"%) ")+Math.abs(this.p1[0]-this.p0[0])+" Bars";var g,f=Math.floor((this.p0[0]+this.p1[0])/2);if(Math.abs(this.p0[0]-this.p1[0])>1&&Math.abs(this.p0[0]-this.p1[0])<20){var y=s+(o-s)/(n-r)*(this.stx.pixelFromTick(f,i.chart)-r);g=this.stx.priceFromPixel(y,i)||h}else g=this.stx.priceFromPixel(h,i);if(this.callout.stem={t:f,v:g},this.callout.renderText(),this.callout.render(t),this.highlighted){var v="p0"==this.highlighted,x="p1"==this.highlighted;this.littleCircle(t,r,s,v),this.littleCircle(t,n,o,x)}}}},e.Drawing.trendline.prototype.lineIntersection=function(t,i,a,r){return e.Drawing.BaseTwoPoint.prototype.lineIntersection.call(this,t,i,a,"segment")},e.Drawing.trendline.prototype.intersected=function(t,i,a){if(!this.p0||!this.p1)return null;var r=this.callout.intersected(t,i,a),n=e.Drawing.segment.prototype.intersected.call(this,t,i,a);return this.callout.highlighted=!(!r&&!n),n||(r?{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}:null)},e.Drawing.average=function(){this.name="average"},e.Drawing.average.ciqInheritsFrom(e.Drawing.regression),e.extend(e.Drawing.average.prototype,{configs:["color","lineWidth","pattern","axisLabel"],measure:function(){},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1&&!(this.p0[0]<0||this.p1[0]<0)){var i=this.stx.pixelFromTick(this.p0[0],e.chart),a=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<e.left&&a<e.left||i>e.right&&a>e.right)){for(var r=0,n=0,s=Math.min(this.p1[0],this.p0[0]);s<=Math.max(this.p1[0],this.p0[0]);s++){if(this.stx.chart.dataSet[s]){var o=this.stx.chart.dataSet[s].Close;(o||0===o)&&(n++,r+=o)}0}if(n){var l=r/n;y=this.stx.pixelFromValueAdjusted(e,this.p0[0],l);var h=this.setLineColor(),c={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(i,a,y,y,h,"segment",t,e,c),this.stx.plotLine(i,i,y-20,y+20,h,"segment",t,e,c),this.stx.plotLine(a,a,y-20,y+20,h,"segment",t,e,c),this.axisLabel&&!this.highlighted&&!this.penDown&&(i>=e.chart.left&&i<=e.chart.right||a>=e.chart.left&&a<=e.chart.right)){this.stx.endClip();var u=l;e.chart.transformFunc&&(u=e.chart.transformFunc(this.stx,e.chart,u)),u=e.yAxis.priceFormatter?e.yAxis.priceFormatter(this.stx,e,u):this.stx.formatYAxisPrice(u,e),this.stx.createYAxisLabel(e,u,y,h),this.stx.startClip(e.name)}if(this.highlighted){var p="p0"==this.highlighted,d="p1"==this.highlighted;this.littleCircle(t,i,y,p),this.littleCircle(t,a,y,d)}else this.setPoint(0,this.p0[0],l),this.setPoint(1,this.p1[0],l)}}}},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.axisLabel=e.al,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,al:this.axisLabel}}},!0),e.Drawing.quadrant=function(){this.name="quadrant"},e.Drawing.quadrant.ciqInheritsFrom(e.Drawing.speedarc),e.extend(e.Drawing.quadrant.prototype,{chartsOnly:!0,render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){for(var a=this.stx.pixelFromTick(this.p0[0],i.chart),r=this.stx.pixelFromTick(this.p1[0],i.chart),n=null,s=null,o=Math.min(this.p1[0],this.p0[0]);o<=Math.max(this.p1[0],this.p0[0]);o++)if(this.stx.chart.dataSet[o]){var l=this.stx.chart.dataSet[o].Close;(l||0===l)&&((null===n||l>n)&&(n=l),(null===s||l<s)&&(s=l))}var h=(n+s)/2,c=this.stx.pixelFromValueAdjusted(i,this.p0[0],n),u=this.stx.pixelFromValueAdjusted(i,this.p0[0],(n+h)/2),p=this.stx.pixelFromValueAdjusted(i,this.p0[0],(2*n+s)/3),d=this.stx.pixelFromValueAdjusted(i,this.p0[0],h),m=this.stx.pixelFromValueAdjusted(i,this.p0[0],(n+2*s)/3),g=this.stx.pixelFromValueAdjusted(i,this.p0[0],(s+h)/2),f=this.stx.pixelFromValueAdjusted(i,this.p0[0],s),y=this.setLineColor(),v=this.fillColor;("auto"==v||e.isTransparent(v))&&(v=this.stx.defaultColor),t.fillStyle=v;var x={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(a,r,c,c,y,"segment",t,i,x),this.stx.plotLine(a,r,f,f,y,"segment",t,i,x),"quadrant"==this.name?(this.stx.plotLine(a,r,u,u,y,"segment",t,i,x),this.stx.plotLine(a,r,g,g,y,"segment",t,i,x)):"tirone"==this.name&&(this.stx.plotLine(a,r,p,p,y,"segment",t,i,x),this.stx.plotLine(a,r,m,m,y,"segment",t,i,x)),this.stx.plotLine(a,a,c,f,y,"segment",t,i,x),this.stx.plotLine(r,r,c,f,y,"segment",t,i,x),this.stx.plotLine(a,r,d,d,y,"segment",t,i,e.extend(x,{opacity:"tirone"==this.name?.2:1})),t.globalAlpha=.1,t.beginPath(),t.fillRect(a,c,r-a,f-c),"quadrant"==this.name?t.fillRect(a,u,r-a,g-u):"tirone"==this.name&&t.fillRect(a,p,r-a,m-p),t.globalAlpha=1,this.highlighted){var b="p0"==this.highlighted,C="p1"==this.highlighted;this.littleCircle(t,a,d,b),this.littleCircle(t,r,d,C)}else this.setPoint(0,this.p0[0],h,i.chart),this.setPoint(1,this.p1[0],h,i.chart)}}},!0),e.Drawing.tirone=function(){this.name="tirone"},e.Drawing.tirone.ciqInheritsFrom(e.Drawing.quadrant),t},__equations_=function(t){var e=t.CIQ;return e.formatEquation=function(t){for(var e="",i=[],a="",r=!1,n=1;n<t.length;n++){var s=t[n].toUpperCase();"["!=s||r?"]"==s&&r?(r=!1,""!==a&&(i.push(a),e+="["+a+"]"),a=""):r?a+=s:"+"==s||"-"==s||"*"==s||"/"==s||":"==s||"%"==s||"("==s||")"==s?(""!==a&&isNaN(a)?(i.push(a),e+="["+a+"]"):e+=a,":"==s&&(s="/"),e+=s,a=""):" "!=s&&(a+=s):r=!0}return""!==a&&isNaN(a)?(i.push(a),e+="["+a+"]"):e+=a,{equation:e,symbols:i}},e.fetchEquationChart=function(t,i){var a=e.formatEquation(t.symbol),r=a.symbols,n=[],s=t.stx;t.stx=null;for(var o=0;o<r.length;o++){var l=e.shallowClone(t);l.stx=s,l.symbol=r[o],n.push(l)}t.stx=s,s.quoteDriver.quoteFeed.multiFetch(n,function(r){var s={};t.loadMoreReplace=!0;for(var o={charge:0},l=0;l<r.length;l++){var h=r[l];if(h.dataCallback.error)return void i({error:h.dataCallback.error});s[h.params.symbol]=h.dataCallback.quotes,t.loadMoreReplace=t.loadMoreReplace&&h.params.loadMoreReplace,t.moreToLoad=t.moreToLoad||h.dataCallback.moreAvailable;var c=h.dataCallback.attribution;c.charge&&(o.charge+=c.charge),o.source=c.source,void 0===o.exchange?o.exchange=c.exchange:o.exchange!=c.exchange&&(o.exchange="")}if(n.length||!t.loadMore&&!t.update)try{var u=e.computeEquationChart(a.equation,s);i({quotes:u,moreAvailable:t.moreToLoad,attribution:o})}catch(t){var p={error:"Invalid equation: "+a.equation};t.name&&"NoException"==t.name&&(p.suppressAlert=!0),i(p)}})},e.computeEquationChart=function(t,i){t=t.replace(/[:]/,"/").toUpperCase();var a=0;for(var r in i){var n=new RegExp("\\["+r.replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\$/g,"\\$").replace(/\^/g,"\\^").replace(/[+\-*/%()]/g,"\\$&")+"\\]","g");t=t.replace(n,"symbol"+a),a++}var s,o=function(){function t(t){function e(){}return e.prototype=t,new e}var i=0,a=1,r=2,n=3,s=4;function o(t,e,o,l){this.type_=t,this.index_=e||0,this.prio_=o||0,this.number_=null!=l?l:0,this.toString=function(){switch(this.type_){case i:return this.number_;case a:case r:case n:return this.index_;case s:return"CALL";default:return"Invalid Token"}}}function l(t,e,i,a){this.tokens=t,this.ops1=e,this.ops2=i,this.functions=a}var h=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function u(t,e){return Number(t)+Number(e)}function p(t,e){return t-e}function d(t,e){return t*e}function m(t,e){return t/e}function g(t,e){return t%e}function f(t,e){return""+t+e}function y(t,e){return t==e}function v(t,e){return t!=e}function x(t,e){return t>e}function b(t,e){return t<e}function C(t,e){return t>=e}function S(t,e){return t<=e}function w(t,e){return Boolean(t&&e)}function T(t,e){return Boolean(t||e)}function M(t){return Math.sinh?Math.sinh(t):(Math.exp(t)-Math.exp(-t))/2}function D(t){return Math.cosh?Math.cosh(t):(Math.exp(t)+Math.exp(-t))/2}function E(t){return Math.tanh?Math.tanh(t):t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function A(t){return Math.asinh?Math.asinh(t):t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function k(t){return Math.acosh?Math.acosh(t):Math.log(t+Math.sqrt(t*t-1))}function F(t){return Math.atanh?Math.atanh(t):Math.log((1+t)/(1-t))/2}function _(t){return Math.log(t)*Math.LOG10E}function P(t){return-t}function L(t){return Math.trunc?Math.trunc(t):t<0?Math.ceil(t):Math.floor(t)}function O(t){return Math.random()*(t||1)}function N(t){for(var e=t=Math.floor(t);t>1;)e*=--t;return e}function I(){if(Math.hypot)return Math.hypot.apply(this,arguments);for(var t=0,e=arguments.length,i=0;i<e;i++){if(arguments[i]===1/0||arguments[i]===-1/0)return 1/0;t+=arguments[i]*arguments[i]}return Math.sqrt(t)}function R(t,e,i){return t?e:i}function z(t,e){return"[object Array]"!=Object.prototype.toString.call(t)?[t,e]:((t=t.slice()).push(e),t)}function H(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:M,cosh:D,tanh:E,asinh:A,acosh:k,atanh:F,sqrt:Math.sqrt,log:Math.log,lg:_,log10:_,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:L,"-":P,exp:Math.exp},this.ops2={"+":u,"-":p,"*":d,"/":m,"%":g,"^":Math.pow,",":z,"||":f,"==":y,"!=":v,">":x,"<":b,">=":C,"<=":S,and:w,or:T},this.functions={random:O,fac:N,min:Math.min,max:Math.max,hypot:I,pyt:I,pow:Math.pow,atan2:Math.atan2,if:R},this.consts={E:Math.E,PI:Math.PI}}e.extend(l.prototype,{simplify:function(e){e=e||{};var s,h,c,u,p=[],d=[],m=this.tokens.length,g=0;for(g=0;g<m;g++){var f=(u=this.tokens[g]).type_;if(f===i)p.push(u);else if(f===n&&u.index_ in e)u=new o(i,0,0,e[u.index_]),p.push(u);else if(f===r&&p.length>1)h=p.pop(),s=p.pop(),c=this.ops2[u.index_],u=new o(i,0,0,c(s.number_,h.number_)),p.push(u);else if(f===a&&p.length>0)s=p.pop(),c=this.ops1[u.index_],u=new o(i,0,0,c(s.number_)),p.push(u);else{for(;p.length>0;)d.push(p.shift());d.push(u)}}for(;p.length>0;)d.push(p.shift());return new l(d,t(this.ops1),t(this.ops2),t(this.functions))},substitute:function(e,i){i instanceof l||(i=(new H).parse(String(i)));var a,r=[],s=this.tokens.length,h=0;for(h=0;h<s;h++)if((a=this.tokens[h]).type_===n&&a.index_===e)for(var c=0;c<i.tokens.length;c++){var u=i.tokens[c],p=new o(u.type_,u.index_,u.prio_,u.number_);r.push(p)}else r.push(a);return new l(r,t(this.ops1),t(this.ops2),t(this.functions))},evaluate:function(t){t=t||{};var e,o,l,h,c=[],u=this.tokens.length,p=0;for(p=0;p<u;p++){var d=(h=this.tokens[p]).type_;if(d===i)c.push(h.number_);else if(d===r)o=c.pop(),e=c.pop(),l=this.ops2[h.index_],c.push(l(e,o));else if(d===n)if(h.index_ in t)c.push(t[h.index_]);else{if(!(h.index_ in this.functions))throw new Error("undefined variable: "+h.index_);c.push(this.functions[h.index_])}else if(d===a)e=c.pop(),l=this.ops1[h.index_],c.push(l(e));else{if(d!==s)throw new Error("invalid Expression");if(e=c.pop(),!(l=c.pop()).apply||!l.call)throw new Error(l+" is not a function");"[object Array]"==Object.prototype.toString.call(e)?c.push(l.apply(void 0,e)):c.push(l.call(void 0,e))}}if(c.length>1)throw new Error("invalid Expression (parity)");return c[0]},toString:function(t){var e,o,l,u,p,d=[],m=this.tokens.length,g=0;for(g=0;g<m;g++){var f=(u=this.tokens[g]).type_;if(f===i)d.push("string"==typeof(p=u.number_)?(h.lastIndex=0,h.test(p)?"'"+p.replace(h,function(t){var e=c[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+p+"'"):p);else if(f===r)o=d.pop(),e=d.pop(),l=u.index_,t&&"^"==l?d.push("Math.pow("+e+","+o+")"):d.push("("+e+l+o+")");else if(f===n)d.push(u.index_);else if(f===a)e=d.pop(),"-"===(l=u.index_)?d.push("("+l+e+")"):d.push(l+"("+e+")");else{if(f!==s)throw new Error("invalid Expression");e=d.pop(),l=d.pop(),d.push(l+"("+e+")")}}if(d.length>1)throw new Error("invalid Expression (parity)");return d[0]},variables:function(){for(var t=this.tokens.length,e=[],i=0;i<t;i++){var a=this.tokens[i];a.type_===n&&-1==e.indexOf(a.index_)&&e.push(a.index_)}return e}},!0),H.parse=function(t){return(new H).parse(t)},H.evaluate=function(t,e){return H.parse(t).evaluate(e)},H.Expression=l,H.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:M,cosh:D,tanh:E,asinh:A,acosh:k,atanh:F,sqrt:Math.sqrt,log:Math.log,lg:_,log10:_,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:L,random:O,fac:N,exp:Math.exp,min:Math.min,max:Math.max,hypot:I,pyt:I,pow:Math.pow,atan2:Math.atan2,if:R,E:Math.E,PI:Math.PI};return e.extend(H.prototype,{parse:function(e){this.errormsg="",this.success=!0;var h=[],c=[];this.tmpprio=0;var u=77,p=0;for(this.expression=e,this.pos=0;this.pos<this.expression.length;){var d;if(this.isOperator())this.isSign()&&64&u?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",p++,this.addfunc(c,h,a)),u=77):this.isComment()||(0==(2&u)&&this.error_parsing(this.pos,"unexpected operator"),p+=2,this.addfunc(c,h,r),u=77);else if(this.isNumber())0==(1&u)&&this.error_parsing(this.pos,"unexpected number"),d=new o(i,0,0,this.tokennumber),c.push(d),u=50;else if(this.isString())0==(1&u)&&this.error_parsing(this.pos,"unexpected string"),d=new o(i,0,0,this.tokennumber),c.push(d),u=50;else if(this.isLeftParenth())0==(8&u)&&this.error_parsing(this.pos,'unexpected "("'),128&u&&(p+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(c,h,s)),u=333;else if(this.isRightParenth())256&u?(d=new o(i,0,0,[]),c.push(d)):0==(16&u)&&this.error_parsing(this.pos,'unexpected ")"'),u=186;else if(this.isComma())0==(32&u)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(c,h,r),p+=2,u=77;else if(this.isConst()){0==(1&u)&&this.error_parsing(this.pos,"unexpected constant");var m=new o(i,0,0,this.tokennumber);c.push(m),u=50}else if(this.isOp2())0==(4&u)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(c,h,r),p+=2,u=8;else if(this.isOp1())0==(4&u)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(c,h,a),p++,u=8;else if(this.isVar()){0==(1&u)&&this.error_parsing(this.pos,"unexpected variable");var g=new o(n,this.tokenindex,0,0);c.push(g),u=186}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg))}for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');h.length>0;){var f=h.pop();c.push(f)}return p+1!==c.length&&this.error_parsing(this.pos,"parity"),new l(c,t(this.ops1),t(this.ops2),t(this.functions))},evaluate:function(t,e){return this.parse(t).evaluate(e)},error_parsing:function(t,e){throw this.success=!1,this.errormsg="parse error [column "+t+"]: "+e,this.column=t,new Error(this.errormsg)},addfunc:function(t,e,i){for(var a=new o(i,this.tokenindex,this.tokenprio+this.tmpprio,0);e.length>0&&a.prio_<=e[e.length-1].prio_;)t.push(e.pop());e.push(a)},isNumber:function(){for(var t=!1,e="";this.pos<this.expression.length;){var i=this.expression.charCodeAt(this.pos);if(!(i>=48&&i<=57||46===i))break;e+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(e),t=!0}return t},unescape:function(t,e){for(var i=[],a=!1,r=0;r<t.length;r++){var n=t.charAt(r);if(a){switch(n){case"'":i.push("'");break;case"\\":i.push("\\");break;case"/":i.push("/");break;case"b":i.push("\b");break;case"f":i.push("\f");break;case"n":i.push("\n");break;case"r":i.push("\r");break;case"t":i.push("\t");break;case"u":var s=parseInt(t.substring(r+1,r+5),16);i.push(String.fromCharCode(s)),r+=4;break;default:throw this.error_parsing(e+r,"Illegal escape sequence: '\\"+n+"'")}a=!1}else"\\"==n?a=!0:i.push(n)}return i.join("")},isString:function(){var t=!1,e="",i=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){if("'"==this.expression.charAt(this.pos)&&"\\"!=e.slice(-1)){this.pos++,this.tokennumber=this.unescape(e,i),t=!0;break}e+=this.expression.charAt(this.pos),this.pos++}return t},isConst:function(){for(var t in this.consts){var e=t.length;if(t===this.expression.substr(this.pos,e))return this.tokennumber=this.consts[t],this.pos+=e,!0}return!1},isOperator:function(){var t=this.expression.charCodeAt(this.pos);if(43===t)this.tokenprio=2,this.tokenindex="+";else if(45===t)this.tokenprio=2,this.tokenindex="-";else if(62===t)61===this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenprio=1,this.tokenindex=">="):(this.tokenprio=1,this.tokenindex=">");else if(60===t)61===this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenprio=1,this.tokenindex="<="):(this.tokenprio=1,this.tokenindex="<");else if(124===t){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="||"}else if(61===t){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="=="}else if(33===t){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="!="}else if(97===t){if(110!==this.expression.charCodeAt(this.pos+1)||100!==this.expression.charCodeAt(this.pos+2))return!1;this.pos++,this.pos++,this.tokenprio=0,this.tokenindex="and"}else if(111===t){if(114!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="or"}else if(42===t||8729===t||8226===t)this.tokenprio=3,this.tokenindex="*";else if(47===t)this.tokenprio=4,this.tokenindex="/";else if(37===t)this.tokenprio=4,this.tokenindex="%";else{if(94!==t)return!1;this.tokenprio=5,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var t=this.expression.charCodeAt(this.pos-1);return 45===t||43===t},isPositiveSign:function(){return 43===this.expression.charCodeAt(this.pos-1)},isNegativeSign:function(){return 45===this.expression.charCodeAt(this.pos-1)},isLeftParenth:function(){return 40===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},isRightParenth:function(){return 41===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){return 44===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var t=this.expression.charCodeAt(this.pos);return(32===t||9===t||10===t||13===t)&&(this.pos++,!0)},isOp1:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&t in this.ops1&&(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0)},isOp2:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&t in this.ops2&&(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0)},isVar:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&(this.tokenindex=t,this.tokenprio=4,this.pos+=t.length,!0)},isComment:function(){return 47===this.expression.charCodeAt(this.pos-1)&&42===this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},!0),H}().parse(t),l=[],h={},c=0,u=null,p=!1,d=[];for(r in i){var m={sym:r,map:i[r]};i[r]?d.unshift(m):d.push(m)}for(var g=0;g<d.length;g++){var f=d[g];h[f.sym]={i:0,s:f.sym},f.map?(c++,s=f.map[0]):1==c&&(p=f.sym),s.DT||(s.DT=e.strToDateTime(s.Date)),h[f.sym].d=s.DT,u||(u=h[f.sym])}var y=0===c,v=1==c&&-1==t.indexOf("%");function x(t){if(t.i++,i[t.s]){if(t.i>=i[t.s].length)return 0;s=i[t.s][t.i]}return s.DT||(s.DT=e.strToDateTime(s.Date)),t.d=s.DT,1}function b(){var t=null,e=null;for(var i in h)e?h[i].d.getTime()<e.d.getTime()?t=e=h[i]:h[i].d.getTime()>e.d.getTime()&&(t=e):e=h[i];return t?x(t)?-1:0:1}t:for(;;){var C=b();if(!C)break;if(1==C){var S;if(p){var w=i[u.s][u.i][p];w&&(w.Close||0===w.Close)&&(w=w.Close);var T=o.evaluate({symbol0:i[u.s][u.i].Close,symbol1:w});T=Number(T.toFixed(8)),(S={DT:u.d,Close:T,Adj_Close:T})[u.s]=i[u.s][u.i].Close,isNaN(T)||T==1/0||l.push(S)}else{if(y){var M=o.evaluate({});throw e.alert(t+"="+M),{name:"NoException",message:""}}a=0;var D={Adj_Close:{},Close:{},Open:{},High:{},Low:{},Volume:{}};for(r in i){for(var E in D)D[E]["symbol"+a]=i[r][h[r].i][E];a++}(S={DT:u.d}).Adj_Close=o.evaluate(D.Adj_Close),S.Close=o.evaluate(D.Close),S.Open=o.evaluate(D.Open),S.Volume=o.evaluate(D.Volume),isNaN(S.Volume)&&(S.Volume=0),v?(S.High=o.evaluate(D.High),S.Low=o.evaluate(D.Low)):(S.High=Math.max(S.Open,S.Close),S.Low=Math.min(S.Open,S.Close)),isNaN(S.Close)||S.Close==1/0||l.push(S),isNaN(S.High)||(S.High=Number(S.High.toFixed(8))),isNaN(S.Low)||(S.Low=Number(S.Low.toFixed(8))),isNaN(S.Open)||(S.Open=Number(S.Open.toFixed(8))),isNaN(S.Close)||(S.Close=Number(S.Close.toFixed(8))),isNaN(S.Adj_Close)?S.Adj_Close=S.Close:S.Adj_Close=Number(S.Adj_Close.toFixed(8))}for(r in i)if(!x(h[r]))break t}}return l},t},__renderersAdvanced_=function(t){var e=t.CIQ;return e.Renderer.Shading=function(t){this.construct(t),this.beenSetup=!1,this.errTimeout=null,this.params.useChartLegend=!1,this.shading=[],"rangechannel"==this.params.type&&(this.highLowBars=!0)},e.Renderer.Shading.ciqInheritsFrom(e.Renderer.Lines,!1),e.Renderer.Shading.requestNew=function(t,i){for(var a=null,r=0;r<t.length;r++){"rangechannel"==t[r]&&(a="rangechannel")}return null===a?null:new e.Renderer.Shading({params:e.extend(i,{type:a})})},e.Renderer.Shading.prototype.setShading=function(t){t.constructor!=Array&&(t=[t]),this.shading=t},e.Renderer.Shading.prototype.draw=function(){var t=this.stx,i=t.panels[this.params.panel].chart;if("rangechannel"==this.params.type)if(this.beenSetup)this.seriesParams.length>2&&this.removeSeries(this.seriesParams[2].id);else{this.beenSetup=!0,this.params.display=this.seriesParams[0].display,this.params.yAxis=this.seriesParams[0].yAxis;var a=this.seriesParams[0].color||"auto",r=this.seriesParams[0].symbol;r&&r+".",this.removeAllSeries(!0);var n=this.params.name;t.addSeries(null,{symbol:r,loadData:!!r,field:"High",renderer:"Shading",name:n,style:"stx_line_up",display:this.params.display}),t.addSeries(null,{symbol:r,loadData:!!r,field:"Low",renderer:"Shading",name:n,style:"stx_line_down",display:this.params.display}),this.setShading({primary:this.seriesParams[0].id,secondary:this.seriesParams[1].id,color:a})}if(!this.shading&&!this.errTimeout){console.log("Warning: no shading scheme set.  Use myRenderer.setShading(scheme) to set.");var s=this;this.errTimeout=setTimeout(function(){s.errTimeout=null},1e4)}var o,l={};for(o=0;o<this.seriesParams.length;o++){var h={};i.series[this.seriesParams[o].id]&&(h=e.clone(i.series[this.seriesParams[o].id].parameters)),l[this.seriesParams[o].id]={parameters:e.extend(e.extend(h,this.params),this.seriesParams[o]),yValueCache:this.caches[this.seriesParams[o].id]}}if(t.drawSeries(i,l,this.params.yAxis,this),i.legend&&"rangechannel"==this.params.type){i.legend.colorMap||(i.legend.colorMap={});var c=this.params.display,u=[t.getCanvasColor("stx_line_up"),t.getCanvasColor("stx_line_down")];i.legend.colorMap[c]={color:u,display:c,isBase:this==t.mainSeriesRenderer}}for(o in l)this.caches[o]=l[o].yValueCache;function p(t){var e=l[t];if(e){var i=e.parameters.field,a=e.parameters.subField;return i+(a?"."+a:"")}return t}for(o=0;o<this.shading.length;o++){var d=this.shading[o],m=d.color;if("auto"==d.color&&(m=t.defaultColor),d.primary||(d.primary="Close"),d.secondary||(d.secondary=this.seriesParams[0].field),d.secondary&&m&&(l[d.primary]||"Close"==d.primary)&&l[d.secondary]&&("Close"!=d.primary||this.params.yAxis==i.yAxis)){var g=p(d.primary).split("."),f=p(d.secondary).split("."),y={topBand:g[0],topSubBand:g[1],topColor:d.greater||m,topAxis:this.params.yAxis,bottomBand:f[0],bottomSubBand:f[1],bottomColor:d.lesser||m,bottomAxis:"Close"==d.primary?null:this.params.yAxis,tension:this.params.tension||i.tension,opacity:.1};e.fillIntersecting(t,this.params.panel,y)}}},e.Renderer.Histogram=function(t){this.construct(t),this.params.type="histogram",this.params.highlightable=!1,this.barsHaveWidth=this.standaloneBars=!0,this.params.yAxis&&(this.params.bindToYAxis=!0)},e.Renderer.Histogram.ciqInheritsFrom(e.Renderer,!1),e.Renderer.Histogram.prototype.adjustYAxis=function(){this.params.yAxis&&(this.params.yAxis.min=0,this.params.yAxis.highValue/=this.params.heightPercentage||1)},e.Renderer.Histogram.prototype.draw=function(){this.stx.drawHistogram(e.clone(this.params),this.seriesParams)},e.Renderer.Heatmap=function(t){this.construct(t),this.params.type="heatmap",this.params.highlightable=!1,this.barsHaveWidth=this.standaloneBars=!0},e.Renderer.Heatmap.ciqInheritsFrom(e.Renderer,!1),e.Renderer.Heatmap.prototype.draw=function(){this.stx.drawHeatmap(e.clone(this.params),this.seriesParams)},e.Renderer.Scatter=function(t){this.construct(t),this.standaloneBars=this.barsHaveWidth=!0},e.Renderer.Scatter.ciqInheritsFrom(e.Renderer.Lines,!1),e.Renderer.Scatter.requestNew=function(t,i){for(var a=null,r=0;r<t.length;r++){"scatterplot"==t[r]&&(a="scatter")}return null===a?null:new e.Renderer.Scatter({params:e.extend(i,{type:a})})},e.Renderer.Scatter.prototype.drawIndividualSeries=function(t,e){panel=this.stx.panels[e.panel]||t.panel;var i={colors:[]};return this.stx.scatter?i=this.stx.scatter(panel,e):console.warn("Error, Scatter renderer requires customChart.js"),i},t},__share_=function(t){var e,i=t.CIQ;function a(t,a,r){a||(a={});var n=document.querySelector("body");if(a.hide&&a.hide instanceof Array)for(var s=a.hide.join(", "),o=document.querySelectorAll(s),l=0;l<o.length;l++)i.appendClassName(o[l],"ciq-no-share");i.appendClassName(n,"sharing"),e(t.chart.container,{allowTaint:!1,logging:!1,width:a.width?a.width:null,height:a.height?a.height:null,background:a.background?a.background:null,useCORS:!0}).then(function(t){if(r)return i.unappendClassName(n,"sharing"),a.data?r(null,t.toDataURL("image/png")):r(null,t)})}return i.Share=function(){},t.STXSocial=i.Share,i.Share.FullChart2PNG=function(t,r,n){if(t&&t.chart){if("undefined"==typeof html2canvas)return function(t){{if("undefined"!=typeof html2canvas)return e=html2canvas,t();if("undefined"!=typeof requirejs)try{return requirejs(["html2canvas"],function(i){return e=i,t()})}catch(t){console.warn("Require loading has failed, attempting to load html2canvas manually.")}i.loadScript(function(){if(i.Share.html2canvasLocation)return i.Share.html2canvasLocation;for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var a=t[e];if(a.src&&a.src.indexOf("share.js")>-1)return a.src.replace(/advanced\/share\.js/,"")+"thirdparty/"}return"js/thirdparty/"}()+"/html2canvas.js",function(){return e=html2canvas,t()})}}(function(){return a(t,r,n)});e=html2canvas,a(t,r,n)}},i.Share.createImage=function(t,e,a){var r=[].slice.call(arguments);a=r.pop(),null!==e&&"object"==typeof e||(e={widthPX:r[1],heightPX:r[2],imageType:r[3]});var n=e.widthPX,s=e.heightPX,o=e.imageType,l=t.chart.canvas.height,h=t.chart.canvas.width;t.chart.canvas.style.height&&(l=i.stripPX(t.chart.canvas.style.height),h=i.stripPX(t.chart.canvas.style.width)),n&&s?(l=s,h=n):s?h=t.chart.canvas.width*(l/t.chart.canvas.height):n&&(h=n,l=t.chart.canvas.height*(n/t.chart.canvas.width));var c=o?"image/"+o:"image/png",u=document.createElement("img");u.onload=function(){i.Share.FullChart2PNG(t,{image:this,width:h,height:l,hide:e.hide},function(t,e){try{a(e.toDataURL(c))}catch(t){console.warn("Safari devices do not handle CORS enabled images. Using the charts' canvas as a fallback."),a(u.src)}})},u.src=t.chart.canvas.toDataURL(c)},i.Share.uploadImage=function(t,e,a,r){a||(a={}),a.image=t,i.postAjax(e,JSON.stringify(a),function(t,e){200==t?r(null,e):r(t,null)})||r(0,null)},i.Share.shareChart=function(t,e,a){i.Share.createImage(t,{},function(r){var n=i.uniqueID(),s="https://share.chartiq.com",o=s+"/upload/"+n;e&&(e.host&&(s=e.host),e.path&&(o=s+e.path+"/"+n));var l=t.getStartDateOffset(),h={id:n,image:r,config:{layout:t.exportLayout(),drawings:t.exportDrawings(),xOffset:l,startDate:t.chart.dataSegment[l].Date,endDate:t.chart.dataSegment[t.chart.dataSegment.length-1].Date,id:n,symbol:t.chart.symbol}};i.Share.uploadImage(r,o,h,function(t,e){null!==t?i.alert("error sharing chart: ",t):a(s+e)})})},t},__studiesAdvanced_=function(t){var e=t.CIQ;return e.Studies.calculateValuationLines=function(t,e,i){for(var a="field"==e.inputs.Field?"Close":e.inputs.Field,r=e.inputs["Average Type"],n=e.inputs["Display Average"],s=e.inputs["Display 1 Standard Deviation (1σ)"],o=e.inputs["Display 2 Standard Deviation (2σ)"],l=e.inputs["Display 3 Standard Deviation (3σ)"],h=[],c=0;c<i.length;++c)i[c]&&h.push(i[c][a]);var u=function(t,e){var i=t.length,a=0,r=0,n=0;switch(e){case"mean":for(r=i;n<i;++n)a+=t[n];break;case"harmonic":for(a=i;n<i;++n)r+=1/t[n];break;case"median":var s=Math.floor(i/2),o=t.slice().sort(function(t,e){return t>e?1:t<e?-1:0});i%1==0?(a=o[s]+o[s-1],r=2):(a=o[s],r=1)}return a/r}(h,r),p=!(s||o||l)||function(t,e){for(var i=t.length,a=0,r=0;r<i;++r)a+=Math.pow(t[r]-e,2);return Math.sqrt(a/i)}(h,u);e.data={Average:n?[u]:null,"1 Standard Deviation (1σ)":s?[u+p,u-p]:null,"2 Standard Deviation (2σ)":o?[u+2*p,u-2*p]:null,"3 Standard Deviation (3σ)":l?[u+3*p,u-3*p]:null};var d=p;if(e.parameters||(e.parameters={}),l?e.parameters.range=[u-3*p-d,u+3*p+d]:o?e.parameters.range=[u-2*p-d,u+2*p+d]:s?e.parameters.range=[u-p-d,u+p+d]:n&&(e.parameters.range=[u-d,u+d]),e.panel){var m=t.panels[e.panel],g=t.getYAxisByName(m,e.name);if(g){g.decimalPlaces=m.chart.yAxis.printDecimalPlaces;var f={yAxis:g};t.calculateYAxisRange(m,g,e.parameters.range[0],e.parameters.range[1]),t.createYAxis(m,f),t.drawYAxis(m,f)}}},e.Studies.displayValuationLines=function(t,i){var a,r,n,s,o,l,h,c,u,p=t.panels[i.panel],d=t.getYAxisByName(p,i.name),m=i.chart.context,g=i.data,f=i.parameters.labels,y=i.inputs["Average Type"],v={mean:"AVG",median:"MED",harmonic:"HAVG"},x=t.canvasStyle("ciq-valuation-average-line"),b=t.canvasStyle("ciq-valuation-deviation-line"),C=t.getCanvasFontSize("stx_yaxis")+6;for(var S in g)if(g[S])for(a="Average"==S,r=e.Studies.determineColor(i.outputs[S]),n=g[S],s=0;s<n.length;++s)if(o=n[s],!((l=t.pixelFromPrice(o,p,d))<=p.top||l>=p.yAxis.bottom))if(u=a?{pattern:"none"!=x.borderStyle&&x.borderStyle||"solid",lineWidth:parseFloat(x.borderWidth)||1,opacity:parseFloat(x.opacity)||1,yAxis:d}:{pattern:"none"!=b.borderStyle&&b.borderStyle||"dashed",lineWidth:parseFloat(b.borderWidth)||1,opacity:parseFloat(b.opacity)||1,yAxis:d},t.plotLine(p.left,p.right,l,l,r,"line",m,p,u),"yaxis"!==f){if(!((l+=Math.floor(u.lineWidth/2))+C>=p.yAxis.bottom)){h=(a?v[y]+": ":S[0]+"σ: ")+t.formatYAxisPrice(o,p),c=m.measureText(h).width;var w=p.right-c-3;d&&"left"==d.position&&(w=p.left+3),m.strokeText(h,w,l+C/2+.5)}}else t.createYAxisLabel(p,t.formatYAxisPrice(o,p),l,r,null,m,d)},e.Studies.calculateCorrelationCoefficient=function(t,e){var i=e.chart.scrubbed,a=e.days;if(i.length<a+1)e.error=!0;else{if(e.compare=e.inputs["Compare To"],!e.compare)for(var r in e.compare=[],e.outputs={},e.outputMap={},t.chart.series){var n=t.chart.series[r];n.parameters.color&&(e.compare.push(n.display),e.outputs["Result "+n.display]=n.parameters.color,e.outputMap["Result "+n.display+" "+e.name]="Result "+n.display)}if(e.compare.length){for(var s=0;s<e.compare.length;s++)for(var o=0,l=0,h=0,c=0,u=0,p=e.compare[s],d=0,m=e.startFrom-a;m<i.length;m++)if(i[m]){var g=i[m][p];if(g&&"object"==typeof g&&(g=g.Close),g||0===g||(g=m>0&&i[m-1]&&i[m-1]["_temps "+e.name].c?i[m-1]["_temps "+e.name].c:0),g&&"object"==typeof g&&(g=g.Close),i[m]["_temps "+e.name]={},o+=i[m]["_temps "+e.name].b=i[m].Close,l+=i[m]["_temps "+e.name].c=g,h+=i[m]["_temps "+e.name].b2=Math.pow(i[m].Close,2),c+=i[m]["_temps "+e.name].c2=Math.pow(g,2),u+=i[m]["_temps "+e.name].bc=i[m].Close*g,d>=a){o-=i[m-a]["_temps "+e.name].b,l-=i[m-a]["_temps "+e.name].c,h-=i[m-a]["_temps "+e.name].b2,c-=i[m-a]["_temps "+e.name].c2,u-=i[m-a]["_temps "+e.name].bc;var f=h/a-Math.pow(o/a,2),y=c/a-Math.pow(l/a,2),v=(u/a-o*l/Math.pow(a,2))/Math.sqrt(f*y);i[m]["Result "+p+" "+e.name]=v}d++}}else e.error="Correlation Coefficient requires at least one comparison symbol"}},e.Studies.prettify=e.extend({"2-exponential":"dema","3-exponential":"tema",hull:"hma"},e.Studies.prettify),e.extend(e.Studies.movingAverage,{conversions:{hma:"hull",dema:"2-exponential",tema:"3-exponential"},translations:{hull:"Hull","2-exponential":"Double Exponential","3-exponential":"Triple Exponential"},typeMap:{hma:"Hull",hull:"Hull",dema:"DoubleExponential","2-exponential":"DoubleExponential",tema:"TripleExponential","3-exponential":"TripleExponential"}}),e.Studies.calculateMovingAverageHull=function(t,i){var a,r,n=i.chart.scrubbed,s=i.inputs.Field;for(s&&"field"!=s||(s="Close"),e.Studies.MA("wma",i.days,s,0,"_WMA1",t,i),e.Studies.MA("wma",Math.ceil(i.days/2),s,0,"_WMA2",t,i),a=i.startFrom-1;a>=0&&(!(r=n[a][s])&&0!==r);a--);for(a++;a<n.length;a++){var o=n[a];o["_MMA "+i.name]=2*o["_WMA2 "+i.name]-o["_WMA1 "+i.name]}var l=parseInt(i.inputs.Offset,10);isNaN(l)&&(l=0);var h=Math.floor(Math.sqrt(i.days));e.Studies.MA("wma",h,"_MMA "+i.name,l,"_HMA",t,i);var c=i.name;for(var u in i.outputs)c=u+" "+c;for(a=Math.max(i.days+h-1,i.startFrom);a<n.length;a++)n[a][c]=n[a]["_HMA "+i.name]},e.Studies.calculateMovingAverageDoubleExponential=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("ema",i.days,r,0,"_EMA1",t,i),e.Studies.MA("ema",i.days,"_EMA1 "+i.name,0,"_EMA2",t,i);var n,s,o=parseInt(i.inputs.Offset,10);isNaN(o)&&(o=0);var l=o;for(n=i.startFrom-1;n>=0;n--)if((s=a[n][r])||0===s){if(!(l>0))break;l--}var h=i.name;for(var c in i.outputs)h=c+" "+h;for(n++;n<a.length;n++)if(!(n<2*(i.days-1))){var u=a[n];a[n+o]&&(a[n+o][h]=2*u["_EMA1 "+i.name]-u["_EMA2 "+i.name])}},e.Studies.calculateMovingAverageTripleExponential=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("ema",i.days,r,0,"_EMA1",t,i),e.Studies.MA("ema",i.days,"_EMA1 "+i.name,0,"_EMA2",t,i),e.Studies.MA("ema",i.days,"_EMA2 "+i.name,0,"_EMA3",t,i);var n,s,o=parseInt(i.inputs.Offset,10);isNaN(o)&&(o=0);var l=o;for(n=i.startFrom-1;n>=0;n--)if((s=a[n][r])||0===s){if(!(l>0))break;l--}var h=i.name;for(var c in i.outputs)h=c+" "+h;for(n++;n<a.length;n++)if(!(n<3*(i.days-1))){var u=a[n];a[n+o]&&(a[n+o][h]=3*u["_EMA1 "+i.name]-3*u["_EMA2 "+i.name]+u["_EMA3 "+i.name])}},e.Studies.calculateATRBands=function(t,i){e.Studies.calculateStudyATR(t,i);var a=i.inputs.Field;a&&"field"!=a||(a="Close"),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Shift,a,"ATR "+i.name)},e.Studies.calculateSTARCBands=function(t,i){e.Studies.calculateStudyATR(t,i),e.Studies.MA("simple",i.inputs["MA Period"],"Close",0,"_MA",t,i),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Multiplier,"_MA "+i.name,"ATR "+i.name)},e.Studies.calculateATRStops=function(t,i){var a=i.chart.scrubbed;if(a){e.Studies.calculateStudyATR(t,i);for(var r=i.inputs.HighLow,n=Math.max(i.startFrom-1,1);n<a.length-1;n++){var s=a[n],o=a[n-1],l=s["Buy Stops "+i.name];if(l||(l=s["Sell Stops "+i.name]),l||(l=0),s&&o){var h=s.Close,c=h,u=s["ATR "+i.name]*i.inputs.Multiplier;s.Close>l&&o.Close>l?(r&&(h=s.High),c=Math.max(l,h-u)):s.Close<=l&&o.Close<=l?(r&&(h=s.Low),c=Math.min(l,h+u)):s.Close>l?(r&&(h=s.High),c=h-u):s.Close<=l&&(r&&(h=s.Low),c=h+u),h<=c?(a[n+1]["Buy Stops "+i.name]=c,delete a[n+1]["Sell Stops "+i.name]):h>c&&(a[n+1]["Sell Stops "+i.name]=c,delete a[n+1]["Buy Stops "+i.name]),a[n+1]["All Stops "+i.name]=c,i.referenceOutput="All Stops"}}}},e.Studies.calculateAwesomeOscillator=function(t,i){var a=i.chart.scrubbed;if(a.length<33)i.error=!0;else{e.Studies.MA("simple",5,"hl/2",0,"_MA5",t,i),e.Studies.MA("simple",34,"hl/2",0,"_MA34",t,i);for(var r=Math.max(i.startFrom,33);r<a.length;r++)a[r]&&(a[r][i.name+"_hist"]=a[r]["_MA5 "+i.name]-a[r]["_MA34 "+i.name])}},e.Studies.calculateRelativeVolatility=function(t,i){i.days=Number(i.inputs["Smoothing Period"]);var a=Number(i.inputs["STD Period"]),r=i.chart.scrubbed;if(r.length<i.days+a)i.error=!0;else{var n=i.inputs.Field;n&&"field"!=n||(n="Close"),i.std=new e.Studies.StudyDescriptor(i.name,"sdev",i.panel),i.std.chart=i.chart,i.std.days=a,i.std.startFrom=i.startFrom,i.std.inputs={Field:n,"Standard Deviations":1,Type:"ma"},i.std.outputs={STD:null},e.Studies.calculateStandardDeviation(t,i.std);var s,o,l=0,h=0;i.startFrom>1&&(l=r[i.startFrom-1]["_avgG "+i.name],h=r[i.startFrom-1]["_avgL "+i.name]);for(var c=Math.max(i.startFrom,i.days);c<r.length;c++){var u=r[c];u[n]>r[c-1][n]?(l=(l*(i.days-1)+u["STD "+i.name])/i.days,h=h*(i.days-1)/i.days):(h=(h*(i.days-1)+u["STD "+i.name])/i.days,l=l*(i.days-1)/i.days),u["Rel Vol "+i.name]=(s=l)+(o=h)===0?100:100*s/(s+o),u["_avgG "+i.name]=l,u["_avgL "+i.name]=h}i.zoneOutput="Rel Vol"}},e.Studies.calculatePMO=function(t,i){var a={Smooth:Number(i.inputs["Smoothing Period"])-1,Double:Number(i.inputs["Double Smoothing Period"])-1,Signal:Number(i.inputs["Signal Period"])},r=i.chart.scrubbed;if(r.length<a.Smooth+a.Double)i.error=!0;else{var n,s=i.inputs.Field;for(s&&"field"!=s||(s="Close"),n=i.startFrom;n<r.length;n++)if(r[n]&&r[n-1]){var o=r[n-1][s];o&&(r[n]["_ROCx10 "+i.name]=1e3*(r[n][s]/o-1))}e.Studies.MA("exponential",a.Smooth,"_ROCx10 "+i.name,0,"_EMAx10",t,i),e.Studies.MA("exponential",a.Double,"_EMAx10 "+i.name,0,"PMO",t,i),e.Studies.MA("exponential",a.Signal,"PMO "+i.name,0,"PMOSignal",t,i),i.zoneOutput="PMO"}},e.Studies.calculateElderImpulse=function(t,i){var a,r=i.chart.scrubbed,n=i.outputs.Bullish,s=i.outputs.Bearish,o=i.outputs.Neutral;e.Studies.MA("exponential",13,"Close",0,"_MA",t,i),i.macd=new e.Studies.StudyDescriptor("_"+i.name,"macd",i.panel),i.macd.chart=i.chart,i.macd.days=i.days,i.macd.startFrom=i.startFrom,i.macd.inputs={"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},i.macd.outputs={_MACD:null,_Signal:null},e.Studies.calculateMACD(t,i.macd);for(var l=i.startFrom;l<r.length;l++)a=0===l?o:r[l]["_MA "+i.name]>r[l-1]["_MA "+i.name]&&r[l]["_"+i.name+"_hist"]>r[l-1]["_"+i.name+"_hist"]?n:r[l]["_MA "+i.name]<r[l-1]["_MA "+i.name]&&r[l]["_"+i.name+"_hist"]<r[l-1]["_"+i.name+"_hist"]?s:o,r[l]["Result "+i.name]=a},e.Studies.calculatePivotPoints=function(t,i){var a=i.chart.scrubbed,r="day";if("day"==t.layout.interval)r="month";else if(e.ChartEngine.isDailyInterval(t.layout.interval))r="year";else if("second"==t.layout.interval||"millisecond"==t.layout.interval||"second"==t.layout.timeUnit||"millisecond"==t.layout.timeUnit)r="15min";else{var n=t.layout.periodicity;"minute"!=t.layout.interval&&(n*=t.layout.interval),n>=30&&(r="week")}var s=e.Market.Symbology.isForexSymbol(t.chart.symbol),o=e.Market.Symbology.isForexMetal(t.chart.symbol),l=null;var h,c,u,p={pivotPoint:NaN,high:0,low:0,prevHigh:0,prevLow:0,hlSpread:0};function d(){p.pivotPoint=(p.high+p.low+a[m-1].Close)/3,p.prevHigh=p.high,p.prevLow=p.low,p.hlSpread=p.high-p.low,p.high=p.low=0}i.startFrom>1&&(p=e.clone(a[i.startFrom-1]["_pointers "+i.name]));for(var m=Math.max(1,i.startFrom);m<a.length;m++)if(a[m-1]){if(p.high=Math.max(p.high,a[m-1].High),p.low=Math.min(p.low>0?p.low:a[m-1].Low,a[m-1].Low),i.inputs.Continuous)d();else if("year"==r&&a[m].DT.getYear()!=a[m-1].DT.getYear())d();else if("month"==r&&a[m].DT.getMonth()!=a[m-1].DT.getMonth())d();else if("week"==r&&a[m].DT.getDay()<a[m-1].DT.getDay())d();else if("day"==r){null===l&&(h=a[m].DT,c=void 0,u=void 0,c=s?"America/New_York":t.chart.market.market_tz,u=new Date(h.getTime()+6e4*h.getTimezoneOffset()),c&&-1!=c.indexOf("UTC")||(u=e.convertTimeZone(u,"UTC",c)),l=new Date(u.getFullYear(),u.getMonth(),u.getDate(),u.getHours(),u.getMinutes(),u.getSeconds(),u.getMilliseconds()).getTime()-h.getTime(),s&&(l+=60*(o?6:7)*60*1e3));var g=new Date(new Date(+a[m].DT).setMilliseconds(a[m].DT.getMilliseconds()+l));new Date(new Date(+a[m-1].DT).setMilliseconds(a[m-1].DT.getMilliseconds()+l)).getDate()!==g.getDate()&&t.chart.market.isMarketDate(g)&&(l=null,d())}else"15min"!=r||a[m].DT.getHours()==a[m-1].DT.getHours()&&Math.floor(a[m].DT.getMinutes()/15)==Math.floor(a[m-1].DT.getMinutes()/15)||d();a[m]["Pivot "+i.name]=p.pivotPoint,"fibonacci"==i.inputs.Type.toLowerCase()?(a[m]["Resistance 1 "+i.name]=p.pivotPoint+.382*p.hlSpread,a[m]["Resistance 2 "+i.name]=p.pivotPoint+.618*p.hlSpread,a[m]["Resistance 3 "+i.name]=p.pivotPoint+p.hlSpread,a[m]["Support 1 "+i.name]=p.pivotPoint-.382*p.hlSpread,a[m]["Support 2 "+i.name]=p.pivotPoint-.618*p.hlSpread,a[m]["Support 3 "+i.name]=p.pivotPoint-p.hlSpread):(a[m]["Resistance 1 "+i.name]=2*p.pivotPoint-p.prevLow,a[m]["Resistance 2 "+i.name]=p.pivotPoint+p.hlSpread,a[m]["Resistance 3 "+i.name]=p.prevHigh+2*(p.pivotPoint-p.prevLow),a[m]["Support 1 "+i.name]=2*p.pivotPoint-p.prevHigh,a[m]["Support 2 "+i.name]=p.pivotPoint-p.hlSpread,a[m]["Support 3 "+i.name]=p.prevLow-2*(p.prevHigh-p.pivotPoint)),a[m]["_pointers "+i.name]=e.clone(p)}},e.Studies.calculateVWAP=function(t,i){var a=i.chart.scrubbed;if(e.ChartEngine.isDailyInterval(t.layout.interval))i.error="VWAP is Intraday Only";else{var r,n,s,o=e.Market.Symbology.isForexSymbol(t.chart.symbol),l=e.Market.Symbology.isForexMetal(t.chart.symbol),h=null,c=0,u=0,p=!1;i.startFrom>1&&(c=a[i.startFrom-1]["_V "+i.name],u=a[i.startFrom-1]["_VxP "+i.name]);for(var d=i.startFrom;d<a.length;d++){if(null===h&&(r=a[d].DT,n=void 0,s=void 0,n=o?"America/New_York":t.chart.market.market_tz,s=new Date(r.getTime()+6e4*r.getTimezoneOffset()),n&&-1!=n.indexOf("UTC")||(s=e.convertTimeZone(s,"UTC",n)),h=new Date(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()).getTime()-r.getTime(),o&&(h+=60*(l?6:7)*60*1e3)),a[d-1]&&a[d-1].DT){var m=new Date(new Date(+a[d].DT).setMilliseconds(a[d].DT.getMilliseconds()+h));new Date(new Date(+a[d-1].DT).setMilliseconds(a[d-1].DT.getMilliseconds()+h)).getDate()!=m.getDate()&&t.chart.market.isMarketDate(m)&&(h=null,c=u=0)}var g=a[d]["hlc/3"];c+=a[d].Volume,u+=a[d].Volume*g,c&&(a[d]["VWAP "+i.name]=u/c,a[d]["_V "+i.name]=c,a[d]["_VxP "+i.name]=u,p=!0)}p||(i.error="VWAP Requires Volume")}},e.Studies.calculateMFI=function(t,e){var i,a=e.chart.scrubbed,r=0,n=e.inputs["Scale Factor"];n||(n=e.study.inputs["Scale Factor"]);var s,o=Math.pow(10,Number(n));for(e.startFrom>1&&(r=a[e.startFrom-1]["_high "+e.name]),s=e.startFrom;s<a.length;s++)a[s]&&a[s].Volume&&(a[s][e.name+"_hist"]=i=o*(a[s].High-a[s].Low)/a[s].Volume,a[s]["_high "+e.name]=r=Math.max(r,i))},e.Studies.calculateAlligator=function(t,i){var a={J:Number(i.inputs["Jaw Period"]),T:Number(i.inputs["Teeth Period"]),L:Number(i.inputs["Lips Period"])},r=i.chart.scrubbed;if(r.length<Math.max(a.J,a.T,a.L)+1)i.error=!0;else{e.Studies.MA("welles wilder",a.J,"hl/2",i.inputs["Jaw Offset"],"Jaw",t,i),e.Studies.MA("welles wilder",a.T,"hl/2",i.inputs["Teeth Offset"],"Teeth",t,i),e.Studies.MA("welles wilder",a.L,"hl/2",i.inputs["Lips Offset"],"Lips",t,i);for(var n=i.startFrom;n<r.length;n++)if(r[n]&&("Gator"==i.type&&(r[n][i.name+"_hist1"]=Math.abs(r[n]["Jaw "+i.name]-r[n]["Teeth "+i.name]),r[n][i.name+"_hist2"]=-Math.abs(r[n]["Teeth "+i.name]-r[n]["Lips "+i.name])),i.inputs["Show Fractals"])){if(!(r[n-2]&&r[n-1]&&r[n]&&r[n+1]&&r[n+2]))continue;r[n-2].High&&r[n-1].High&&r[n].High&&r[n+1].High&&r[n+2].High&&r[n].High>r[n-1].High&&r[n].High>r[n-2].High&&r[n].High>r[n+1].High&&r[n].High>r[n+2].High&&(r[n]["Fractal High "+i.name]=1),r[n-2].Low&&r[n-1].Low&&r[n].Low&&r[n+1].Low&&r[n+2].Low&&r[n].Low<r[n-1].Low&&r[n].Low<r[n-2].Low&&r[n].Low<r[n+1].Low&&r[n].Low<r[n+2].Low&&(r[n]["Fractal Low "+i.name]=1)}}},e.Studies.calculateRelativeVigor=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r;for(r=i.startFrom;r<a.length;r++)a[r]["_Change "+i.name]=a[r].Close-a[r].Open,a[r]["_Range "+i.name]=a[r].High-a[r].Low;e.Studies.MA("triangular",4,"_Change "+i.name,0,"_Numer",t,i),e.Studies.MA("triangular",4,"_Range "+i.name,0,"_Denom",t,i);var n=[],s=[];for(r=Math.max(i.startFrom-i.days,0);r<a.length;r++){n.push(a[r]["_Numer "+i.name]),s.push(a[r]["_Denom "+i.name]),n.length>i.days&&(n.shift(),s.shift());var o,l=0,h=0;for(o=0;o<n.length;o++)l+=n[o];for(o=0;o<s.length;o++)h+=s[o];0===h&&(h=1e-8),r<i.startFrom||(a[r]["Rel Vig "+i.name]=l/h)}for(e.Studies.MA("triangular",4,"Rel Vig "+i.name,0,"RelVigSignal",t,i),r=i.startFrom;r<a.length;r++)a[r][i.name+"_hist"]=a[r]["Rel Vig "+i.name]-a[r]["RelVigSignal "+i.name]}},e.Studies.calculateUlcerIndex=function(t,i){var a=i.chart.scrubbed;if(a.length<2*i.days-1)i.error=!0;else{var r,n=i.inputs.Field;for(n&&"field"!=n||(n="Close"),r=Math.max(i.startFrom,i.days-1);r<a.length;r++)a[r]["_PD2 "+i.name]=Math.pow(100*(a[r][n]/s(i.days,r,n)-1),2);for(e.Studies.MA("simple",i.days,"_PD2 "+i.name,0,"_MA",t,i),r=Math.max(i.startFrom,2*(i.days-1));r<a.length;r++)a[r]["Result "+i.name]=Math.sqrt(a[r]["_MA "+i.name])}function s(t,e,i){for(var r=null,n=e-t+1;n<=e;n++)n<0||(r=null===r?a[n][i]:Math.max(r,a[n][i]));return r}},e.Studies.calculateChoppiness=function(t,i){e.Studies.calculateStudyATR(t,i);var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else for(var r=Math.max(i.startFrom,i.days);r<a.length;r++)if(a[r]){var n=s(i.days,r);a[r]["Sum True Range "+i.name]?a[r]["Result "+i.name]=100*Math.log(a[r]["Sum True Range "+i.name]/Math.max(1e-6,n[1]-n[0]))/Math.log(i.days):a[r]["Result "+i.name]=0}function s(t,e){for(var i=-1*Number.MAX_VALUE,r=Number.MAX_VALUE,n=e-t+1;n<=e;n++)n<0||(i=Math.max(i,a[n].High),r=Math.min(r,a[n].Low));return[r,i]}},e.Studies.calculateDisparity=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,r,0,"_MA",t,i);for(var n=Math.max(i.startFrom,i.days-1);n<a.length;n++)a[n]&&(a[n]["Result "+i.name]=100*(a[n][r]/a[n]["_MA "+i.name]-1))}},e.Studies.calculateRainbow=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");for(var n=r,s=1;s<=10;s++)e.Studies.MA("simple",i.days,n,0,"SMA"+s,t,i),n="SMA"+s+" "+i.name;for(var o=Math.max(i.startFrom,10);o<a.length;o++)if(a[o]){var l=0,h=-1*Number.MAX_VALUE,c=Number.MAX_VALUE;for(s=1;s<=10;s++){var u=a[o]["SMA"+s+" "+i.name];l+=u,h=Math.max(h,u),c=Math.min(c,u)}if(i.name.indexOf("Osc")>-1){var p=d(i.inputs["HHV/LLV Lookback"],o);a[o][i.name+"_hist"]=100*(a[o][r]-l/10)/Math.max(1e-6,p[1]-p[0]),a[o]["Over "+i.name]=100*(h-c)/Math.max(1e-6,p[1]-p[0]),a[o]["Under "+i.name]=-a[o]["Over "+i.name],a[o]["Zero "+i.name]=0}}i.name.indexOf("Osc")>-1&&(i.outputMap["Over "+i.name]=i.outputMap["Under "+i.name]=i.outputMap["Zero "+i.name]=null)}function d(t,e){for(var i=-1*Number.MAX_VALUE,r=Number.MAX_VALUE,n=e-t+1;n<=e;n++)n<0||(i=Math.max(i,a[n].Close),r=Math.min(r,a[n].Close));return[r,i]}},e.Studies.calculateKST=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var n={},s={};n[1]=Number(i.inputs["Lightest Rate of Change Period"]),n[2]=Number(i.inputs["Light Rate of Change Period"]),n[3]=Number(i.inputs["Heavy Rate of Change Period"]),n[4]=Number(i.inputs["Heaviest Rate of Change Period"]),s[1]=Number(i.inputs["Lightest SMA Period"]),s[2]=Number(i.inputs["Light SMA Period"]),s[3]=Number(i.inputs["Heavy SMA Period"]),s[4]=Number(i.inputs["Heaviest SMA Period"]);var o,l,h=Number(i.inputs["Signal Period"]);for(o=i.startFrom;o<a.length;o++)if(a[o])for(l=1;l<=4;l++)o>=n[l]&&a[o-n[l]]&&a[o-n[l]][r]&&(a[o]["_ROC"+l+" "+i.name]=100*(a[o][r]/a[o-n[l]][r]-1));for(l=1;l<=4;l++)e.Studies.MA("simple",s[l],"_ROC"+l+" "+i.name,0,"_SMA"+l,t,i);for(o=i.startFrom;o<a.length;o++)for(a[o]["KST "+i.name]=0,l=1;l<=4;l++)a[o]["KST "+i.name]+=l*a[o]["_SMA"+l+" "+i.name];e.Studies.MA("simple",h,"KST "+i.name,0,"KSTSignal",t,i)},e.Studies.calculateSpecialK=function(t,i){var a=i.chart.scrubbed,r=i.inputs.Field;r&&"field"!=r||(r="Close");var n=i.inputs.Interval;n||(n="daily");var s,o,l={daily:[10,15,20,30,50,65,75,100,195,265,390,530],weekly:[4,5,6,8,10,13,15,20,39,52,78,104]},h={daily:[10,10,10,15,50,65,75,100,130,130,130,195],weekly:[4,5,6,8,10,13,15,20,26,26,26,39]};for(s=i.startFrom;s<a.length;s++)if(a[s])for(o=0;o<l[n].length;o++)s>=l[n][o]&&a[s-l[n][o]]&&a[s-l[n][o]][r]&&(a[s]["_ROC"+o+" "+i.name]=100*(a[s][r]/a[s-l[n][o]][r]-1));for(o=0;o<h[n].length;o++)e.Studies.MA("daily"==n?"simple":"exponential",h[n][o],"_ROC"+o+" "+i.name,0,"_MA"+o,t,i);for(s=i.startFrom;s<a.length;s++)for(a[s]["Result "+i.name]=0,o=0;o<h[n].length;o++)a[s]["Result "+i.name]+=(o%4+1)*a[s]["_MA"+o+" "+i.name]},e.Studies.calculateDarvas=function(t,i){var a=i.chart.scrubbed,r=0,n=parseInt(i.inputs["ATH Lookback Period"],10);i.inputs["Volume Spike"]&&e.Studies.MA("simple",n,"Volume",0,"ADV",t,i);var s,o=parseFloat(i.inputs["Volume % of Avg"])/100,l="none",h={},c=null,u=null,p=null,d=parseFloat(i.inputs["Level Offset"]);var m={};for(["Darvas","Ghost","Profit","Loss","ATH","ADV","Spike"].forEach(function(t){m[t]=t+" "+i.name}),s=i.startFrom-1;s>0;s--){var g=a[s];if(!g[m.Darvas]&&!g[m.Ghost]){r=g[m.ATH]||0,u=g[m.Profit],p=g[m.Loss];break}for(var f in m)g[f]=null}for(;s<a.length;s++){var y=a[s];if(y){if(parseFloat(i.inputs["Price Minimum"])<=a[r].Close){if(!c||c.End&&s!=c.End+1||(a[s-1].Close>h.High?h={State:1,High:2*h.High-h.Low,Low:h.High,Start:s,End:2*h.End-h.Start+1}:c=null,c&&(y[m.Ghost]=e.clone(h),h.State=0,a[h.End]&&(a[h.End][m.Ghost]=e.clone(h)),c={Start:h.Start,End:h.End},u=h.High+d,(!p||p<h.Low-d)&&(p=h.Low-d))),y[m.Profit]=u,y[m.Loss]=p,y.Close>=u?u=null:"high/low"==i.inputs["Exit Field"]&&y.High>=u&&(u=null),"none"==l&&s==r+3&&!a[r+2][m.Darvas]&&!a[r+1][m.Darvas]&&!a[r][m.Darvas]&&a[r].High>y.High&&(l="high"),"high"==l&&(y.High>a[r].High?l="none":a[s-3].Low<a[s-2].Low&&a[s-3].Low<a[s-1].Low&&a[s-3].Low<y.Low&&(h={State:1,High:a[r].High,Low:a[s-3].Low,Start:r},a[r][m.Darvas]=e.clone(h),l="darvas",c&&(c.End>s&&a[c.Start]&&(y[m.Ghost]=e.clone(a[c.Start][m.Ghost]),y[m.Ghost].End=s,a[c.End]&&delete a[c.End][m.Ghost]),y[m.Ghost].State=0,a[c.Start][m.Ghost].End=s,c=null),u=h.High+d,(!p||p<h.Low-d)&&(p=h.Low-d))),"darvas"==l&&(y.Close>h.High?c={}:"high/low"==i.inputs["Exit Field"]&&y.High>h.High?c={}:y.Close<h.Low?l="none":"high/low"==i.inputs["Exit Field"]&&y.Low<h.Low&&(l="none"),c?l="none":"none"==l&&(u=null,p=null),i.inputs["Ghost Boxes"]||(c=null),"none"==l)){for(var v=h.Start+1;v<s;v++)a[v][m.Darvas]=e.clone(h);h.State=0,h.End=s,y[m.Darvas]=e.clone(h),y[m.ATH]=r;continue}p&&(y.Close<h.Low||"high/low"==i.inputs["Exit Field"]&&y.Low<h.Low)&&("darvas"==l&&(l="none"),(y.Close<p||"high/low"==i.inputs["Exit Field"]&&y.Low<p)&&(u=null,p=null),c&&(c.End>s&&a[c.Start]&&(y[m.Ghost]=e.clone(a[c.Start][m.Ghost]),y[m.Ghost].End=s,a[c.End]&&delete a[c.End][m.Ghost]),y[m.Ghost].State=0,a[c.Start][m.Ghost].End=s,c=null))}if(y.High>=a[r].High&&(r=s),(s<3||y.High>=a[s-1].High&&y.High>=a[s-2].High&&y.High>=a[s-3].High)&&s-r>=n){r=s;for(var x=0;x<n&&!(s-x<0);x++)a[s-x].High>a[r].High&&(r=s-x);0}i.inputs["Volume Spike"]&&s>n&&s==r&&y[m.ADV]*o<y.Volume&&(y[m.Spike]=1),y[m.ATH]=r}}},e.Studies.calculateSupertrend=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{e.Studies.calculateStudyATR(t,i);for(var r=i.startFrom;r<a.length;r++){var n=a[r];if(n){var s=(n.High+n.Low)/2,o=i.inputs.Multiplier*n["ATR "+i.name],l=s-o,h=s+o;r&&(a[r-1]&&a[r-1].Close&&a[r-1].Close>a[r-1]["_Uptrend "+i.name]&&a[r-1]["_Uptrend "+i.name]>l&&(l=a[r-1]["_Uptrend "+i.name]),a[r-1]&&a[r-1].Close&&a[r-1].Close<a[r-1]["_Downtrend "+i.name]&&a[r-1]["_Downtrend "+i.name]<h&&(h=a[r-1]["_Downtrend "+i.name])),n["_Direction "+i.name]=1,r&&(n["_Direction "+i.name]=a[r-1]["_Direction "+i.name],n.Close>a[r-1]["_Downtrend "+i.name]?n["_Direction "+i.name]=1:n.Close<a[r-1]["_Uptrend "+i.name]&&(n["_Direction "+i.name]=-1)),n["_Uptrend "+i.name]=l,n["_Downtrend "+i.name]=h,n["Trend "+i.name]=n["_Direction "+i.name]>0?l:h}}i.outputMap={},i.outputMap["Trend "+i.name]="Trend"}},e.Studies.fetchAdditionalInstruments=function(t,i,a,r){if(t.quoteDriver){var n,s,o,l=t.panels[i.panel].chart;for(i.symbols=a,n=0;n<a.length;n++){s=o=a[n],"object"==typeof o?s=o.symbol:o={symbol:s};var h={symbol:s,symbolObject:o,bucket:"study",studyName:i.name,chartName:l.name,action:"add-study"};e.extend(h,r);var c=h.loadData;t.currentlyImporting&&(h.loadData=!1),i.series||(i.series={}),i.series[s]=t.addSeries(null,h,u),i.series[s].parameters.loadData=c}}else console.log("CIQ.Studies.fetchAdditionalInstruments: No quotefeed to fetch symbol");function u(){t.createDataSet(),t.draw()}},e.Studies.initPriceRelative=function(t,i,a,r,n,s){var o=e.Studies.initializeFN(t,i,a,r,n,s),l=[o.inputs["Comparison Symbol"].toUpperCase()];return e.Studies.fetchAdditionalInstruments(t,o,l),o},e.Studies.calculatePriceRelative=function(t,i){var a=i.chart.scrubbed,r=i.inputs["Comparison Symbol"].toUpperCase();r||(r=i.study.inputs["Comparison Symbol"]);var n={},s=t.chart.symbol.replace(/=/,"");if(n[s=s.replace(/[+\-*\\%]/g,"")]=a.slice(i.startFrom),n[s].length){s!=r&&(n[r]=null);for(var o=e.computeEquationChart("["+s+"]/["+r+"]",n),l=0,h=i.startFrom;h<a.length&&l<o.length;h++){for(;l<o.length&&a[h].DT.getTime()>o[l].DT.getTime();)l++;a[h].DT.getTime()<o[l].DT.getTime()||(a[h]["Result "+i.name]=o[l].Close,l++)}}},e.Studies.calculatePerformance=function(t,i){var a=i.chart.scrubbed,r=i.inputs["Comparison Symbol"].toUpperCase();if(r||(r=i.study.inputs["Comparison Symbol"]),i.days||(i.days=i.study.inputs.Period),a.length<i.days+1)i.error=!0;else{e.Studies.MA("ma",i.days,"Close",0,"_MA Base",t,i),e.Studies.MA("ma",i.days,r,0,"_MA Comp",t,i);for(var n=i.startFrom;n<a.length;n++){var s=a[n][r];s&&(s.Close||0===s.Close)&&(s=s.Close),a[n]["Result "+i.name]=a[n].Close/s*(a[n]["_MA Comp "+i.name]/a[n]["_MA Base "+i.name])}}},e.Studies.calculateBeta=function(t,i){var a=i.chart.scrubbed,r=i.inputs["Comparison Symbol"].toUpperCase();if(r||(r=i.study.inputs["Comparison Symbol"]),i.days||(i.days=i.study.inputs.Period),a.length<i.days+1)i.error=!0;else{for(var n=Math.max(i.startFrom,1);n<a.length;n++){a[n]["_BaseChange "+i.name]=a[n].Close/a[n-1].Close-1;var s=a[n][r];s&&(s.Close||0===s.Close)&&(s=s.Close);var o=a[n-1][r];o&&(o.Close||0===o.Close)&&(o=o.Close),a[n]["_CompChange "+i.name]=s/o-1}for(e.Studies.MA("ma",i.days,"_BaseChange "+i.name,0,"_MA Base",t,i),e.Studies.MA("ma",i.days,"_CompChange "+i.name,0,"_MA Comp",t,i),n=Math.max(i.startFrom,i.days);n<a.length;n++)a[n]["_COVARn "+i.name]=(a[n]["_BaseChange "+i.name]-a[n]["_MA Base "+i.name])*(a[n]["_CompChange "+i.name]-a[n]["_MA Comp "+i.name]),a[n]["_VARn "+i.name]=Math.pow(a[n]["_CompChange "+i.name]-a[n]["_MA Comp "+i.name],2);for(e.Studies.MA("ma",i.days,"_COVARn "+i.name,0,"_COVAR",t,i),e.Studies.MA("ma",i.days,"_VARn "+i.name,0,"_VAR",t,i),n=Math.max(i.startFrom,2*i.days-1);n<a.length;n++)a[n]["Result "+i.name]=a[n]["_COVAR "+i.name]/a[n]["_VAR "+i.name]}},e.Studies.calculateVortex=function(t,i){var a=i.chart.scrubbed,r=i.days;if(a.length<r+1)i.error=!0;else{var n={tr:0,vmPlus:0,vmMinus:0};i.startFrom>1&&(n=e.clone(a[i.startFrom-1]["_totals "+i.name]));for(var s=Math.max(i.startFrom,1);s<a.length;s++){var o=a[s],l=a[s-1],h=Math.abs(o.High-l.Low),c=Math.abs(o.Low-l.High),u=Math.max(o.High,l.Close)-Math.min(o.Low,l.Close);n.tr+=u,n.vmPlus+=h,n.vmMinus+=c,s>r&&(n.tr-=a[s-r]["_True Range "+i.name],n.vmPlus-=a[s-r]["_VMPlus "+i.name],n.vmMinus-=a[s-r]["_VMMinus "+i.name]),o["_True Range "+i.name]=u,o["_VMPlus "+i.name]=h,o["_VMMinus "+i.name]=c,s>=r&&(o["+VI "+i.name]=n.vmPlus/n.tr,o["-VI "+i.name]=n.vmMinus/n.tr),o["_totals "+i.name]=e.clone(n)}}},e.Studies.calculateBalanceOfPower=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{for(var r=i.startFrom;r<a.length;r++){var n=a[r];n["_Ratio "+i.name]=n.Close-n.Open,0!==n["_Ratio "+i.name]&&(n["_Ratio "+i.name]/=n.High-n.Low)}e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_Ratio "+i.name,0,"Result",t,i)}},e.Studies.calculateTrendIntensity=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA("ma",i.days,r,0,"_SMA",t,i);var n,s,o,l,h=0,c=0,u=[],p=Math.ceil(i.days/2);for(n=Math.max(0,i.startFrom-p);n<a.length;n++)(a[n]["_SMA "+i.name]||0===a[n]["_SMA "+i.name])&&((s=a[n][r]-a[n]["_SMA "+i.name])<0?c+=-1*s:h+=s,u.push(s),u.length>p&&((s=u.shift())<0?c-=-1*s:h-=s),n<i.startFrom||(a[n]["TII "+i.name]=(o=h,l=c,Math.abs(l)<1e-8?100:100-100/(1+o/l))));e.Studies.MA("ema",i.inputs["Signal Period"],"TII "+i.name,0,"Signal",t,i),i.zoneOutput="TII"}},e.Studies.calculateZigZag=function(t,e){var i=e.chart.scrubbed;if(i&&i.length){for(var a=e.highLowChart,r=null,n=null,s=e.inputs["Distance(%)"],o=0,l=0,h=0,c=null,u=null,p=0,d=Math.min(i.length-1,e.startFrom);d>=0;d--)if(p=d,i[d]["_state "+e.name]){var m=i[d]["_state "+e.name];r=m[0],n=m[1],o=m[2],l=m[3],h=m[4],c=m[5],u=m[6];break}for(var g=p;g<i.length;g++){var f=i[g][a?"High":"Close"],y=i[g][a?"Low":"Close"];if(null===n||n<f)if(o<0&&(r=y),c=(1-s/100)*(n=f),o>-1){if(null!==u&&n>u){i[l]["Result "+e.name]=i[l][a?"Low":"Close"],v(h,l),o=-1,r=y,h=l,l=g;continue}}else l=g;if(null===r||r>y)if(o>0&&(n=f),u=(1+s/100)*(r=y),o<1){if(null!==c&&r<c){i[l]["Result "+e.name]=i[l][a?"High":"Close"],v(h,l),o=1,n=f,h=l,l=g;continue}}else l=g}i[l]["Result "+e.name]=i[l][a?1==o?"Low":"High":"Close"],i[l]["_state "+e.name]=[r,n,o,l,h,c,u],v(h,l),i[i.length-1]["Result "+e.name]=i[i.length-1][a?1==o?"High":"Low":"Close"],v(l,i.length-1)}function v(t,a){for(var r=t+1;r<a;r++)i[r]["ShadowResult "+e.name]=(i[a]["Result "+e.name]-i[t]["Result "+e.name])*(r-t)/(a-t)+i[t]["Result "+e.name],delete i[r]["Result "+e.name]}},e.Studies.calculatePsychologicalLine=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)e.error=!0;else for(var a=[],r=100/e.days,n=0,s=Math.max(e.startFrom-e.days,1);s<i.length;s++){var o=Number(i[s].Close>i[s-1].Close);o&&(n+=r),a.push(o),a.length>e.days&&(n-=a.shift()*r),s<e.startFrom||(i[s]["Result "+e.name]=n)}},e.Studies.calculateMADev=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r=i.inputs.Field;r&&"field"!=r||(r="Close");var n=i.inputs["Points Or Percent"];n||(n="Points");var s=i.inputs["Moving Average Type"];s||(s="exponential"),e.Studies.MA(s,i.days,r,0,"_MA",t,i);for(var o=i.name+"_hist",l=Math.max(i.startFrom,i.days-1);l<a.length;l++){var h=a[l];h[o]="Points"==n?h[r]-h["_MA "+i.name]:100*(h[r]/h["_MA "+i.name]-1)}}},e.Studies.calculateShinohara=function(t,i){var a=i.chart.scrubbed;if(a.length<i.days+1)i.error=!0;else{var r={weakNum:0,weakDen:0,strongNum:0,strongDen:0};i.startFrom>1&&(r=e.clone(a[i.startFrom-1]["_accums "+i.name]));for(var n=i.startFrom;n<a.length;n++)r.weakNum+=a[n].High-a[n].Close,r.weakDen+=a[n].Close-a[n].Low,n>0&&(r.strongNum+=a[n].High-a[n-1].Close,r.strongDen+=a[n-1].Close-a[n].Low),n>=i.days&&(r.weakNum-=a[n-i.days].High-a[n-i.days].Close,r.weakDen-=a[n-i.days].Close-a[n-i.days].Low,a[n]["Weak Ratio "+i.name]=100*r.weakNum/r.weakDen,n>i.days&&(r.strongNum-=a[n-i.days].High-a[n-i.days-1].Close,r.strongDen-=a[n-i.days-1].Close-a[n-i.days].Low,a[n]["Strong Ratio "+i.name]=100*r.strongNum/r.strongDen)),a[n]["_accums "+i.name]=e.clone(r)}},e.Studies.calculateIchimoku=function(t,e){var i,a,r=e.chart.scrubbed,n={Base:Number(e.inputs["Base Line Period"]),Conv:Number(e.inputs["Conversion Line Period"]),LeadB:Number(e.inputs["Leading Span B Period"]),Lag:Number(e.inputs["Lagging Span Period"])};function s(t,e){for(var i=Number.MAX_VALUE,a=-1*Number.MAX_VALUE,n=e-t+1;n<=e;n++)n<0||(i=Math.min(i,r[n].Low),a=Math.max(a,r[n].High));return[i,a]}for(i=e.startFrom;i<r.length;i++)r[i]&&(a=s(n.Conv,i),r[i]["Conversion Line "+e.name]=(a[1]+a[0])/2,a=s(n.Base,i),r[i]["Base Line "+e.name]=(a[1]+a[0])/2,i<n.Lag||(r[i-n.Lag]["Lagging Span "+e.name]=r[i].Close));for(e.futureA=[],e.futureB=[],i=Math.max(0,e.startFrom-n.Base);i<r.length;i++){a=s(n.LeadB,i);var o=(r[i]["Conversion Line "+e.name]+r[i]["Base Line "+e.name])/2,l=(a[1]+a[0])/2;r[i+n.Base]?(r[i+n.Base]["Leading Span A "+e.name]=o,r[i+n.Base]["Leading Span B "+e.name]=l):(e.futureA.push(o),e.futureB.push(l))}},e.Studies.displayIchimoku=function(t,i,a){var r="Leading Span A "+i.name,n="Leading Span B "+i.name,s=e.Studies.determineColor(i.outputs[i.outputMap[r]]),o=e.Studies.determineColor(i.outputs[i.outputMap[n]]),l=t.getYAxisByName(i.panel,i.name),h={topBand:r,bottomBand:n,topColor:s,bottomColor:o,skipTransform:t.panels[i.panel].name!=i.chart.name,topAxis:l,bottomAxis:l};function c(a,r){var n={color:!1===r?o:r?s:"transparent",opacity:.3,panelName:i.panel,yAxis:l};e.fillArea(t,a,n),t.endClip()}e.fillIntersecting(t,i.panel,h);var u=t.panels[i.panel],p=t.pixelFromBar(a.length-1,u.chart),d=t.pixelFromPrice(a[a.length-1][r],u,l),m=[[p,t.pixelFromPrice(a[a.length-1][n],u,l)],[p,d]],g=null,f=i.futureA,y=i.futureB;if(i.chart.dataSegment.length>=i.chart.scroll){for(var v=0;f&&v<f.length-1;v++)if(null!==f[v]&&!isNaN(f[v])&&null!==y[v]&&!isNaN(y[v])){var x=t.pixelFromBar(a.length+v,u.chart),b=t.pixelFromBar(a.length+v+1,u.chart),C=t.pixelFromPrice(f[v],u,l),S=t.pixelFromPrice(f[v+1],u,l),w=t.pixelFromPrice(y[v],u,l),T=t.pixelFromPrice(y[v+1],u,l);if(m.push([x,C]),m.unshift([x,w]),(g=C<w)&&S>T||!g&&S<T){var M=e.intersectLineLineX(x,b,C,S,x,b,w,T),D=e.intersectLineLineY(x,b,C,S,x,b,w,T);m.push([M,D]),c(m,g),m=[[M,D]],g=null}}m.length>2&&c(m,g)}e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.displayDarvas=function(t,i,a){var r=e.Studies.determineColor(i.outputs.Levels);r&&"auto"!=r&&!e.isTransparent(r)||(r=t.defaultColor);var n=e.Studies.determineColor(i.outputs.Darvas);n&&"auto"!=n&&!e.isTransparent(n)||(n=t.defaultColor);var s=e.Studies.determineColor(i.outputs.Ghost);s&&"auto"!=s&&!e.isTransparent(s)||(s=t.defaultColor);var o,l,h,c=t.panels[i.panel],u=t.layout.candleWidth-2;if(u<2&&(u=1),t.startClip(i.panel),i.inputs["Stop Levels"]){for(t.chart.context.setLineDash&&t.chart.context.setLineDash([2,2]),t.chart.context.lineWidth=2,t.chart.context.strokeStyle=r,t.chart.context.beginPath(),o=0;o<a.length;o++){l=a[o];var p=a[o-1];if(l){h=l["Loss "+i.name]?Math.floor(t.pixelFromPrice(l["Loss "+i.name],c)):null;var d=p&&p["Loss "+i.name]?Math.floor(t.pixelFromPrice(p["Loss "+i.name],c)):null;if(h){l.candleWidth&&(u=Math.floor(Math.max(1,l.candleWidth)));var m=Math.floor(t.pixelFromBar(o,c.chart)+u/2),g=Math.floor(t.pixelFromBar(o,c.chart)-u/2);d&&d>=h?t.chart.context.lineTo(g,h):0===o?t.chart.context.moveTo(t.chart.left,h):t.chart.context.moveTo(g,h),t.chart.context.lineTo(m,h)}}}t.chart.context.stroke(),t.chart.context.setLineDash&&t.chart.context.setLineDash([]),t.chart.context.lineWidth=1}var f,y,v,x,b=-10,C=0,S=-10,w=0,T=!1,M=!1,D=t.chart.context.measureText("▲").width/2;for(o=0;o<a.length;o++)if(a[o]){if(a[o]["Spike "+i.name]){t.chart.context.fillStyle=n,t.chart.context.textBaseline="bottom";var E=t.pixelFromPrice(a[o].High,t.chart.panel);t.chart.context.fillText("▼",t.pixelFromBar(o)-D,E-5)}a[o].candleWidth&&(u=Math.floor(Math.max(1,a[o].candleWidth))),a[o]["Darvas "+i.name]&&(1!=(l=a[o]["Darvas "+i.name]).State||T?0===l.State&&(C=Math.floor(t.pixelFromBar(o,c.chart)+u/2)-b,f=Math.floor(t.pixelFromPrice(l.High,c)),y=Math.floor(t.pixelFromPrice(l.Low,c))-f,t.chart.context.strokeStyle=n,t.chart.context.fillStyle=n,i.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.strokeRect(b,f,C,y),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(b,f,C,y),t.chart.context.globalAlpha=1,T=!1):(b=Math.floor(t.pixelFromBar(o,c.chart)-u/2),f=Math.floor(t.pixelFromPrice(l.High,c)),y=Math.floor(t.pixelFromPrice(l.Low,c))-f,T=!0)),a[o]["Ghost "+i.name]&&i.inputs["Ghost Boxes"]&&(1!=(l=a[o]["Ghost "+i.name]).State||M?0===l.State&&(l.Start==l.End&&(S=Math.floor(t.pixelFromBar(o,c.chart)-u/2)),w=Math.floor(t.pixelFromBar(o,c.chart)+u/2)-S,v=Math.floor(t.pixelFromPrice(l.High,c)),x=Math.floor(t.pixelFromPrice(l.Low,c))-v,t.chart.context.strokeStyle=s,t.chart.context.fillStyle=s,i.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.strokeRect(S,v,w,x),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(S,v,w,x),t.chart.context.globalAlpha=1,M=!1):(S=Math.floor(t.pixelFromBar(o,c.chart)-u/2),v=Math.floor(t.pixelFromPrice(l.High,c)),w=Math.floor((l.End-l.Start+1)*t.layout.candleWidth+u/2),x=Math.floor(t.pixelFromPrice(l.Low,c))-v,M=!0))}if(T&&(C=Math.floor(t.pixelFromBar(o,c.chart)+u/2)-b,t.chart.context.strokeStyle=n,t.chart.context.fillStyle=n,i.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.beginPath(),t.chart.context.moveTo(b+2*C,f),t.chart.context.lineTo(b,f),t.chart.context.lineTo(b,f+y),t.chart.context.lineTo(b+2*C,f+y),t.chart.context.stroke(),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(b,f,2*C,y),t.chart.context.globalAlpha=1),M&&(t.chart.context.strokeStyle=s,t.chart.context.fillStyle=s,i.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.strokeRect(S,v,w,x),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(S,v,w,x),t.chart.context.globalAlpha=1),T||M){if(i.inputs["Stop Levels"]){t.chart.context.setLineDash&&t.chart.context.setLineDash([2,2]),t.chart.context.lineWidth=2,t.chart.context.strokeStyle=r;var A=Math.floor(t.pixelFromBar(o-1,c.chart)+u/2);void 0,h&&(t.chart.context.beginPath(),t.chart.context.moveTo(A,h),t.chart.context.lineTo(T?b+2*C:S+w,h),t.chart.context.stroke()),t.chart.context.setLineDash&&t.chart.context.setLineDash([]),t.chart.context.lineWidth=1}T=!1,M=!1}t.endClip()},e.Studies.displaySupertrend=function(t,e,i){var a=t.panels[e.panel],r=t.getYAxisByName(a,e.name);function n(t,i,a){return i&&i["_Direction "+e.name]<0?e.outputs.Downtrend:e.outputs.Uptrend}var s={skipTransform:a.name!=e.chart.name,skipProjections:!0,label:t.preferences.labels,yAxis:r},o=t.chart.context;o.strokeStyle=n(0,i[i.length-1]),o.lineWidth=2,e.highlight&&(o.lineWidth=3);for(var l="Trend "+e.name,h=0;a.chart.transformFunc&&r!=a.chart.yAxis&&h<i.length;h++){var c=i[h];c&&c.transform&&(c.transform[l]=a.chart.transformFunc(t,a.chart,c[l]))}t.plotDataSegmentAsLine(l,a,s,n),o.lineWidth=1,t.startClip(e.panel);var u,p=t.chart.context.measureText("▲").width/2;for(u=0;u<i.length;u++)if(i[u]&&i[u-1])if(i[u-1]["_Direction "+e.name]>i[u]["_Direction "+e.name]){t.chart.context.fillStyle=e.outputs.Downtrend,t.chart.context.textBaseline="bottom";for(var d=t.pixelFromPrice(i[u].High,a,r),m=5;m<=45;m+=10)t.chart.context.fillText("▼",t.pixelFromBar(u)-p,d-m)}else if(i[u-1]["_Direction "+e.name]<i[u]["_Direction "+e.name]){t.chart.context.fillStyle=e.outputs.Uptrend,t.chart.context.textBaseline="top";for(var g=t.pixelFromPrice(i[u].Low,a,r),f=5;f<=45;f+=10)t.chart.context.fillText("▲",t.pixelFromBar(u)-p,g+f)}t.endClip()},e.Studies.displayVsComparisonSymbol=function(t,i,a){var r=i.inputs["Comparison Symbol"].toUpperCase();if(t.getSeries({symbol:r,chart:i.chart}).length){for(var n={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:i.study.centerline,yAxis:t.getYAxisByName(t.panels[i.panel],i.name)},s=a.length-1;s>=0;s--)if(a[s]&&a[s][r])return e.Studies.displaySeriesAsLine(t,i,a),void((i.study.centerline||0===i.study.centerline)&&(i.outputs.Gain&&e.preparePeakValleyFill(t,e.extend(n,{direction:1,color:i.outputs.Gain})),i.outputs.Loss&&e.preparePeakValleyFill(t,e.extend(n,{direction:-1,color:i.outputs.Loss}))))}else t.watermark(i.panel,"center","bottom",t.translateIf(i.study.name)+": "+t.translateIf("Not Available"))},e.Studies.displayMFI=function(t,e,i){var a=t.panels[e.panel],r=t.getYAxisByName(a,e.name)||a.yAxis,n=r.bottom,s=t.layout.candleWidth-2;s<2&&(s=1);var o=e.outputs.Green,l=e.outputs.Fade,h=e.outputs.Fake,c=e.outputs.Squat;t.canvasColor("stx_histogram"),e.underlay||(t.chart.context.globalAlpha=1),t.chart.context.fillStyle="#CCCCCC",t.startClip(e.panel);for(var u=0;u<i.length;u++){var p=i[u],d=i[u-1];d||(d=t.getPreviousBar(t.chart,e.name+"_hist",u)),p&&(d&&(d[e.name+"_hist"]<p[e.name+"_hist"]?d.Volume<p.Volume?t.chart.context.fillStyle=o:d.Volume>p.Volume&&(t.chart.context.fillStyle=h):d[e.name+"_hist"]>p[e.name+"_hist"]&&(d.Volume<p.Volume?t.chart.context.fillStyle=c:d.Volume>p.Volume&&(t.chart.context.fillStyle=l))),p.candleWidth&&(s=Math.floor(Math.max(1,p.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(u,a.chart)-s/2),Math.floor(n),Math.floor(s),Math.floor(t.pixelFromPrice(p[e.name+"_hist"],a,r)-n)))}t.endClip()},e.Studies.displayAwesomeOscillator=function(t,i,a){var r=t.panels[i.panel],n=t.getYAxisByName(r,i.name),s=t.pixelFromPrice(0,r,n),o=t.layout.candleWidth-2;o<2&&(o=1);var l=e.Studies.determineColor(i.outputs["Increasing Bar"]),h=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.canvasColor("stx_histogram"),i.underlay||(t.chart.context.globalAlpha=1),t.chart.context.fillStyle="#CCCCCC",t.startClip(i.panel);for(var c=0;c<a.length;c++){var u=a[c],p=a[c-1];p||(p=t.getPreviousBar(t.chart,i.name+"_hist",c)),u&&(p&&(p[i.name+"_hist"]<u[i.name+"_hist"]?t.chart.context.fillStyle=l:p[i.name+"_hist"]>u[i.name+"_hist"]&&(t.chart.context.fillStyle=h)),u.candleWidth&&(o=Math.floor(Math.max(1,u.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(c,r.chart)-o/2),Math.floor(s),Math.floor(o),Math.floor(t.pixelFromPrice(u[i.name+"_hist"],r,n)-s)))}t.endClip()},e.Studies.displayGator=function(t,i,a){var r=t.panels[i.panel],n=t.getYAxisByName(r,i.name),s=t.pixelFromPrice(0,r,n),o=t.layout.candleWidth-2;o<2&&(o=1);var l=e.Studies.determineColor(i.outputs["Increasing Bar"]),h=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.canvasColor("stx_histogram"),i.underlay||(t.chart.context.globalAlpha=1),t.chart.context.fillStyle="#CCCCCC",t.startClip(i.panel);for(var c=0;c<a.length;c++){var u=a[c],p=a[c-1];if(u)for(var d=1;d<=2;d++)p||(p=t.getPreviousBar(t.chart,i.name+"_hist"+d,c)),p?Math.abs(p[i.name+"_hist"+d])<Math.abs(u[i.name+"_hist"+d])?t.chart.context.fillStyle=l:Math.abs(p[i.name+"_hist"+d])>Math.abs(u[i.name+"_hist"+d])&&(t.chart.context.fillStyle=h):t.chart.context.fillStyle="#CCCCCC",u.candleWidth&&(o=Math.floor(Math.max(1,u.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(c,r.chart)-o/2),Math.floor(s),Math.floor(o),Math.floor(t.pixelFromPrice(u[i.name+"_hist"+d],r,n)-s))}t.endClip()},e.Studies.initElderImpulse=function(t,i,a,r,n,s){var o=e.Studies.initializeFN(t,i,a,r,n,s);return t.chart.customChart={chartType:"colored_bar",colorFunction:function(t,e,i){return e["Result "+o.name]}},t.setMainSeriesRenderer(),o},e.Studies.displayPivotPoints=function(t,i,a){if(i.noSlopes=!i.inputs.Continuous,e.Studies.displaySeriesAsLine(t,i,a),i.inputs.Shading){var r=t.panels[i.panel],n={noSlopes:i.noSlopes,opacity:i.parameters.opacity?i.parameters.opacity:.2,skipTransform:r.name!=i.chart.name,yAxis:t.getYAxisByName(r,i.name)};e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Resistance 3 "+i.name,bottomBand:"Resistance 2 "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 3"])},n)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Resistance 2 "+i.name,bottomBand:"Resistance 1 "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 2"])},n)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Resistance 1 "+i.name,bottomBand:"Pivot "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 1"])},n)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Support 1 "+i.name,bottomBand:"Pivot "+i.name,color:e.Studies.determineColor(i.outputs["Support 1"])},n)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Support 2 "+i.name,bottomBand:"Support 1 "+i.name,color:e.Studies.determineColor(i.outputs["Support 2"])},n)),e.prepareChannelFill(t,e.extend({panelName:i.panel,topBand:"Support 3 "+i.name,bottomBand:"Support 2 "+i.name,color:e.Studies.determineColor(i.outputs["Support 3"])},n))}},e.Studies.displayAlligator=function(t,i,a){function r(e,i){var r;"high"==e?(t.chart.context.fillStyle=t.defaultColor,t.chart.context.textBaseline="bottom",r=t.pixelFromPrice(a[i].High,n,s),t.chart.context.fillText("▲",t.pixelFromBar(o,t.chart)-t.chart.context.measureText("▲").width/2+1,r-5)):"low"==e&&(t.chart.context.fillStyle=t.defaultColor,t.chart.context.textBaseline="top",r=t.pixelFromPrice(a[i].Low,n,s),t.chart.context.fillText("▼",t.pixelFromBar(o,t.chart)-t.chart.context.measureText("▼").width/2+1,r+5))}var n=t.panels[i.panel],s=t.getYAxisByName(n,i.name);if(e.Studies.displaySeriesAsLine(t,i,a),i.inputs["Show Fractals"]){t.startClip(i.panel),t.chart.context.globalAlpha=i.underlay?.3:1;for(var o=2;o<a.length-2;o++)a[o]&&(a[o]["Fractal High "+i.name]&&r("high",o),a[o]["Fractal Low "+i.name]&&r("low",o));t.endClip()}},e.Studies.displayRainbowMA=function(t,i,a){for(var r=t.panels[i.panel],n=10;n>0;n--)e.Studies.displayIndividualSeriesAsLine(t,i,r,"SMA"+n+" "+i.name,a)},e.Studies.displayRainbowOsc=function(t,i,a){e.Studies.displaySeriesAsLine(t,i,a);var r=t.panels[i.panel],n=t.getYAxisByName(r,i.name);t.startClip(i.panel);var s=t.pixelFromPrice(0,r,n),o=r.name!=i.chart.name,l=e.Studies.determineColor(i.outputs["Positive Bar"]);t.chart.context.strokeStyle=l,t.plotDataSegmentAsLine("Over "+i.name,r,{skipTransform:o,label:!1,yAxis:n});var h=t.chart.context.createLinearGradient(0,s,0,r.yAxis.top);h.addColorStop(0,t.containerColor),h.addColorStop(1,l),e.prepareChannelFill(t,{skipTransform:o,color:h,opacity:1,panelName:i.panel,topBand:"Over "+i.name,bottomBand:"Zero "+i.name,yAxis:n});var c=e.Studies.determineColor(i.outputs["Negative Bar"]);t.chart.context.strokeStyle=c,t.plotDataSegmentAsLine("Under "+i.name,r,{skipTransform:o,label:!1,yAxis:n});var u=t.chart.context.createLinearGradient(0,s,0,r.yAxis.bottom);u.addColorStop(0,t.containerColor),u.addColorStop(1,c),e.prepareChannelFill(t,{skipTransform:o,color:u,opacity:1,panelName:i.panel,topBand:"Zero "+i.name,bottomBand:"Under "+i.name,yAxis:n});var p=t.layout.candleWidth-2;p<2&&(p=1),t.canvasColor("stx_histogram"),i.underlay||(t.chart.context.globalAlpha=1),t.chart.context.fillStyle="#CCCCCC";for(var d=0;d<a.length;d++){var m=a[d];m&&(m[i.name+"_hist"]>0?t.chart.context.fillStyle=l:m[i.name+"_hist"]<0&&(t.chart.context.fillStyle=c),m.candleWidth&&(p=Math.floor(Math.max(1,m.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(d,r.chart)-p/2),Math.floor(s),Math.floor(p),Math.floor(t.pixelFromPrice(m[i.name+"_hist"],r,n)-s)))}t.endClip()},e.Studies.displayZigZag=function(t,i,a){var r=t.chart.highLowBars||t.highLowBars[t.layout.chartType];i.highLowChart!=r&&(i.highLowChart=r,i.startFrom=0,i.study.calculateFN(t,i));for(var n=t.chart,s=0;s<a.length;s++)a[s]&&a[s]["_shadowCopy "+i.name]&&(delete a[s]["Result "+i.name],a[s].transform&&delete a[s].transform["Result "+i.name],delete a[s]["_shadowCopy "+i.name]);var o=a[0],l=a[a.length-1];o&&!o["Result "+i.name]&&o["ShadowResult "+i.name]&&(o["Result "+i.name]=o["ShadowResult "+i.name],o.transform&&(o.transform["Result "+i.name]=n.transformFunc(t,n,o["ShadowResult "+i.name])),o["_shadowCopy "+i.name]=1),l&&!l["Result "+i.name]&&l["ShadowResult "+i.name]&&(l["Result "+i.name]=l["ShadowResult "+i.name],l.transform&&(l.transform["Result "+i.name]=n.transformFunc(t,n,l["ShadowResult "+i.name])),l["_shadowCopy "+i.name]=1),e.Studies.displaySeriesAsLine(t,i,a)},e.Studies.displayVolumeProfile=function(t,i,a){if(t&&t.chart.dataSet){var r=t.chart,n=i.parameters.numberOfBars,s=i.parameters.widthPercentage,o=i.parameters.displayBorder,l=i.parameters.displayVolume;(!n||n<0)&&(n=30),n=Math.ceil(n),(!s||s<0)&&(s=.25),!1!==o&&(o=!0),!0!==l&&(l=!1);var h=(r.highValue-r.lowValue)/n;if(0!==h){for(var c=[],u=r.lowValue;u<r.highValue+.1;u+=h)c.push([u,0]);if(c.length<2)t.watermark("chart","center","top",t.translateIf("Not enough data to render the Volume Profile"));else{for(var p=0,d=0;d<a.length;d++){var m=a[d];if(m){var g=m.Volume;i.panel==r.name&&m.transform&&(m=m.transform);for(var f=c[0][0],y=0,v=1;v<c.length;v++)y=c[v][0],(m.Low>=f&&m.Low<=y||m.Low<f&&m.High>y||m.High>=f&&m.High<=y)&&(c[v][1]+=g,c[v][1]>p&&(p=c[v][1])),f=y}}if(0!==p){t.setStyle("stx_volume_profile","color",e.Studies.determineColor(i.outputs["Bars Color"]));var x=r.context,b="stx-float-date";t.canvasFont(b,x);var C=t.getCanvasFontSize(b),S=r.panel,w=S.yAxis.bottom,T=Math.round(r.width)-.5,M=r.width*s,D=t.canvasStyle("stx_volume_profile").borderColor,E=!e.isTransparent(t.canvasStyle("stx_volume_profile").borderColor)&&o,A=t;k("stx_volume_profile",!1),E&&k("stx_volume_profile",!0),x.globalAlpha=1}else t.watermark("chart","center","top",t.translateIf("Not enough data to render the Volume Profile"))}}}function k(t,i){i||(T-=2),A.canvasColor(t),e.isIE8&&(x.globalAlpha=.5),x.beginPath();for(var a=c[0][0],r=T,n=1;n<c.length;n++){if(c[n][1]){var s=Math.round(T-c[n][1]*M/p)-.5,o=Math.round(A.pixelFromTransformedValue(a,S))+.5,h=Math.round(A.pixelFromTransformedValue(c[n][0],S))+.5;if(i||(o-=.5,h+=.5,s+=.5),o>w&&(o=w),h<w)if(x.moveTo(T,o),x.lineTo(T,h),x.lineTo(s,h),x.lineTo(s,o),i)(r>s||1==n)&&x.lineTo(r,o);else if(x.lineTo(T,o),l){var u=e.condenseInt(c[n][1]),d=o-h;if(C<=d-2){var m;try{m=x.measureText(u).width}catch(t){m=0}x.textBaseline="top";var g=x.fillStyle;x.fillStyle=D,x.fillText(u,s-m-3,h+(d/2-C/2)),x.fillStyle=g}}r=s}else r=T;a=c[n][0]}i||x.fill(),x.strokeStyle=D,i&&x.stroke(),x.closePath()}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"val lines":{name:"Valuation Lines",calculateFN:function(){},seriesFN:function(t,i,a){e.Studies.calculateValuationLines(t,i,a),e.Studies.displayValuationLines(t,i)},overlay:!0,yAxisFN:function(){},inputs:{Field:"field","Average Type":["mean","median","harmonic"],"Display Average":!0,"Display 1 Standard Deviation (1σ)":!1,"Display 2 Standard Deviation (2σ)":!1,"Display 3 Standard Deviation (3σ)":!1},outputs:{Average:"#00afed","1 Standard Deviation (1σ)":"#e1e1e1","2 Standard Deviation (2σ)":"#85c99e","3 Standard Deviation (3σ)":"#fff69e"}},correl:{name:"Correlation Coefficient",range:"-1 to 1",calculateFN:e.Studies.calculateCorrelationCoefficient,outputs:{}},PMO:{name:"Price Momentum Oscillator",calculateFN:e.Studies.calculatePMO,inputs:{Field:"field","Smoothing Period":35,"Double Smoothing Period":20,"Signal Period":10},outputs:{PMO:"auto",PMOSignal:"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:2.5,studyOverBoughtColor:"auto",studyOverSoldValue:-2.5,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:0,step:"0.05"},studyOverSoldValue:{max:0,step:"0.05"}}},"Rel Vol":{name:"Relative Volatility",range:"0 to 100",calculateFN:e.Studies.calculateRelativeVolatility,inputs:{Field:"field","STD Period":10,"Smoothing Period":14},outputs:{"Rel Vol":"auto"},centerline:50,parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},Awesome:{name:"Awesome Oscillator",seriesFN:e.Studies.displayAwesomeOscillator,calculateFN:e.Studies.calculateAwesomeOscillator,inputs:{},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"W MFI":{name:"Market Facilitation Index",seriesFN:e.Studies.displayMFI,calculateFN:e.Studies.calculateMFI,yAxis:{ground:!0},range:"0 to max",inputs:{"Scale Factor":6},outputs:{Green:"#8bc176",Fade:"#ab611f",Fake:"#5f7cb8",Squat:"#ffd0cf"}},"ATR Bands":{name:"ATR Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateATRBands,inputs:{Period:5,Shift:3,Field:"field","Channel Fill":!0},outputs:{"ATR Bands Top":"auto","ATR Bands Bottom":"auto","ATR Bands Channel":"auto"},attributes:{Shift:{min:.1,step:.1}}},"STARC Bands":{name:"STARC Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateSTARCBands,inputs:{Period:15,"MA Period":5,Multiplier:1.3,"Channel Fill":!0},outputs:{"STARC Bands Top":"auto","STARC Bands Median":"auto","STARC Bands Bottom":"auto"},attributes:{Multiplier:{min:.1,step:.1}}},"ATR Trailing Stop":{name:"ATR Trailing Stops",overlay:!0,seriesFN:e.Studies.displayPSAR2,calculateFN:e.Studies.calculateATRStops,inputs:{Multiplier:3,Period:21,"Plot Type":["points","squarewave"],HighLow:!1},outputs:{"Buy Stops":"#FF0000","Sell Stops":"#00FF00"},attributes:{Multiplier:{min:.1,step:.1}}},"Boll %b":{name:"Bollinger %b",calculateFN:e.Studies.calculateBollinger,inputs:{Field:"field",Period:20,"Standard Deviations":2,"Moving Average Type":"ma"},outputs:{"%b":"auto"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:0,studyOverSoldColor:"auto"}},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Boll BW":{name:"Bollinger Bandwidth",calculateFN:e.Studies.calculateBollinger,inputs:{Field:"field",Period:20,"Standard Deviations":2,"Moving Average Type":"ma"},outputs:{Bandwidth:"auto"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Donchian Width":{name:"Donchian Width",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{"High Period":20,"Low Period":20}},"Rel Vig":{name:"Relative Vigor Index",seriesFN:e.Studies.displayHistogramWithSeries,calculateFN:e.Studies.calculateRelativeVigor,inputs:{Period:10},outputs:{"Rel Vig":"auto",RelVigSignal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"Elder Impulse":{name:"Elder Impulse System",calculateFN:e.Studies.calculateElderImpulse,initializeFN:e.Studies.initElderImpulse,seriesFN:null,customRemoval:!0,underlay:!0,inputs:{},outputs:{Bullish:"#8BC176",Bearish:"#DD3E39",Neutral:"#5F7CB8"},removeFN:function(t,e){t.chart.customChart=null,t.setMainSeriesRenderer()}},"Pivot Points":{name:"Pivot Points",overlay:!0,seriesFN:e.Studies.displayPivotPoints,calculateFN:e.Studies.calculatePivotPoints,inputs:{Type:["standard","fibonacci"],Continuous:!1,Shading:!1},outputs:{Pivot:"auto","Resistance 1":"rgb(184,44,11)","Support 1":"rgb(105,145,88)","Resistance 2":"rgb(227,100,96)","Support 2":"rgb(179,217,135)","Resistance 3":"rgb(255,208,207)","Support 3":"rgb(211,232,174)"},parameters:{init:{opacity:.2}}},VWAP:{name:"VWAP",overlay:!0,calculateFN:e.Studies.calculateVWAP,inputs:{},outputs:{VWAP:"#FF0000"}},Alligator:{name:"Alligator",overlay:!0,seriesFN:e.Studies.displayAlligator,calculateFN:e.Studies.calculateAlligator,inputs:{"Jaw Period":13,"Jaw Offset":8,"Teeth Period":8,"Teeth Offset":5,"Lips Period":5,"Lips Offset":3,"Show Fractals":!1},outputs:{Jaw:"#0000FF",Teeth:"#FF0000",Lips:"#00DD00"}},Gator:{name:"Gator Oscillator",seriesFN:e.Studies.displayGator,calculateFN:e.Studies.calculateAlligator,inputs:{"Jaw Period":13,"Jaw Offset":8,"Teeth Period":8,"Teeth Offset":5,"Lips Period":5,"Lips Offset":3},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},centerline:0},"Ichimoku Clouds":{name:"Ichimoku Clouds",overlay:!0,calculateFN:e.Studies.calculateIchimoku,seriesFN:e.Studies.displayIchimoku,inputs:{"Conversion Line Period":9,"Base Line Period":26,"Leading Span B Period":52,"Lagging Span Period":26},outputs:{"Conversion Line":"#0000FF","Base Line":"#FF0000","Leading Span A":"#00FF00","Leading Span B":"#FF0000","Lagging Span":"#808000"}},"P Rel":{name:"Price Relative",initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculatePriceRelative,centerline:0,inputs:{"Comparison Symbol":"SPY"},deferUpdate:!0},"Perf Idx":{name:"Performance Index",centerline:1,initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculatePerformance,inputs:{Period:120,"Comparison Symbol":"SPY"},outputs:{Result:"auto",Gain:"#00DD00",Loss:"#FF0000"},deferUpdate:!0},Beta:{name:"Beta",centerline:1,initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculateBeta,inputs:{Period:20,"Comparison Symbol":"SPY"},deferUpdate:!0},Ulcer:{name:"Ulcer Index",calculateFN:e.Studies.calculateUlcerIndex,inputs:{Field:"field",Period:14}},"Bal Pwr":{name:"Balance of Power",range:"-1 to 1",centerline:0,calculateFN:e.Studies.calculateBalanceOfPower,inputs:{Period:14,"Moving Average Type":"ma"}},"Trend Int":{name:"Trend Intensity Index",calculateFN:e.Studies.calculateTrendIntensity,range:"0 to 100",inputs:{Field:"field",Period:14,"Signal Period":9},outputs:{TII:"auto",Signal:"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},Choppiness:{name:"Choppiness Index",calculateFN:e.Studies.calculateChoppiness,centerline:50,parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:61.8,studyOverBoughtColor:"auto",studyOverSoldValue:38.2,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:50,step:"0.1"},studyOverSoldValue:{max:50,step:"0.1"}}},Disparity:{name:"Disparity Index",calculateFN:e.Studies.calculateDisparity,inputs:{Field:"field",Period:14,"Moving Average Type":"ma"}},"Rainbow MA":{name:"Rainbow Moving Average",overlay:!0,calculateFN:e.Studies.calculateRainbow,seriesFN:e.Studies.displayRainbowMA,inputs:{Field:"field",Period:2},outputs:{SMA1:"#FF0000",SMA2:"#FF7F00",SMA3:"#FFFF00",SMA4:"#7FFF00",SMA5:"#00FF7F",SMA6:"#00FFFF",SMA7:"#007FFF",SMA8:"#0000FF",SMA9:"#7F00FF",SMA10:"#FF00FF"}},"Rainbow Osc":{name:"Rainbow Oscillator",calculateFN:e.Studies.calculateRainbow,seriesFN:e.Studies.displayRainbowOsc,centerline:0,inputs:{Field:"field",Period:2,"HHV/LLV Lookback":10},outputs:{"Positive Bar":"#00DD00","Negative Bar":"#FF0000"}},"Pring KST":{name:"Pring's Know Sure Thing",calculateFN:e.Studies.calculateKST,inputs:{Field:"field","Lightest Rate of Change Period":10,"Lightest SMA Period":10,"Light Rate of Change Period":15,"Light SMA Period":10,"Heavy Rate of Change Period":20,"Heavy SMA Period":10,"Heaviest Rate of Change Period":30,"Heaviest SMA Period":15,"Signal Period":9},outputs:{KST:"#00DD00",KSTSignal:"#FF0000"}},"Pring Sp-K":{name:"Pring's Special K",calculateFN:e.Studies.calculateSpecialK,inputs:{Field:"field",Interval:["daily","weekly"]}},Darvas:{name:"Darvas Box",underlay:!0,calculateFN:e.Studies.calculateDarvas,seriesFN:e.Studies.displayDarvas,inputs:{"ATH Lookback Period":100,"Exit Field":["close","high/low"],"Ghost Boxes":!0,"Stop Levels":!1,"Level Offset":.01,"Price Minimum":5,"Volume Spike":!1,"Volume % of Avg":400},outputs:{Darvas:"#5F7CB8",Ghost:"#699158",Levels:"auto"},customRemoval:!0,attributes:{"Price Minimum":{min:.01,step:.01},yaxisDisplayValue:{hidden:!0},panelName:{hidden:!0}}},Supertrend:{name:"Supertrend",overlay:!0,seriesFN:e.Studies.displaySupertrend,calculateFN:e.Studies.calculateSupertrend,inputs:{Period:7,Multiplier:3},outputs:{Uptrend:"#8cc176",Downtrend:"#b82c0c"},attributes:{Multiplier:{min:.1,step:.1}}},"vol profile":{name:"Volume Profile",underlay:!0,seriesFN:e.Studies.displayVolumeProfile,calculateFN:null,inputs:{},outputs:{"Bars Color":"#b64a96"},customRemoval:!0,parameters:{init:{displayBorder:!0,displayVolume:!1,numberOfBars:30,widthPercentage:.25}},attributes:{yaxisDisplayValue:{hidden:!0},panelName:{hidden:!0}}},Vortex:{name:"Vortex Indicator",calculateFN:e.Studies.calculateVortex,centerline:1,outputs:{"+VI":"#00FF00","-VI":"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:1.1,studyOverBoughtColor:"auto",studyOverSoldValue:.9,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:1,step:"0.01"},studyOverSoldValue:{max:1,step:"0.01"}}},ZigZag:{name:"ZigZag",overlay:!0,seriesFN:e.Studies.displayZigZag,calculateFN:e.Studies.calculateZigZag,inputs:{"Distance(%)":10},parameters:{init:{label:!1}},attributes:{"Distance(%)":{min:.1,step:.1}}},PSY:{name:"Psychological Line",range:"0 to 100",calculateFN:e.Studies.calculatePsychologicalLine,inputs:{Period:20}},"MA Dev":{name:"Moving Average Deviation",calculateFN:e.Studies.calculateMADev,seriesFN:e.Studies.displayHistogramWithSeries,inputs:{Field:"field",Period:12,"Moving Average Type":"ma","Points Or Percent":["Points","Percent"]},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},Shinohara:{name:"Shinohara Intensity Ratio",calculateFN:e.Studies.calculateShinohara,inputs:{Period:26},outputs:{"Strong Ratio":"#E99B54","Weak Ratio":"#5F7CB8"}}}),t},__core_=function(t,e){t.SplinePlotter||(t.SplinePlotter={});var i=t.CIQ,a=(t.$$$,t.SplinePlotter);return t.SplinePlotter.plotSpline||(t.SplinePlotter.plotSpline=function(t,e,i,a){window.splineWarning||console.log("Warning: Cannot find implementation of splining.  Try loading splines.js"),window.splineWarning=1;var r=0;i.moveTo(t[0],t[1]);for(var n=2;n<t.length;n+=2){if(a&&r<a.length){var s=a[r];s.coord[0]==t[n-2]&&s.coord[1]==t[n-1]&&(i.stroke(),i.strokeStyle=s.color,i.setLineDash(s.pattern),i.lineDashOffset=0,i.lineWidth=s.width,i.beginPath(),i.moveTo(t[n-2],t[n-1]),r++)}i.lineTo(t[n],t[n+1])}}),i.getETDateTime=function(){var t=new Date;return i.convertTimeZone(new Date(t.getTime()+6e4*t.getTimezoneOffset()),"UTC","America/New_York")},i.fromET=function(t){var e=new Date,i=4;(e.getMonth()<2||2==e.getMonth()&&e.getDate()<11||e.getMonth()>10||10==e.getMonth()&&e.getDate()>=4)&&(i=5);var a=t.getTime()+36e5*i;return new Date(a)},i.convertFutureMonth=function(t){var e=t.toString();if(e.length<=0||e.length>2)return"";switch(e){case"1":return"F";case"2":return"G";case"3":return"H";case"4":return"J";case"5":return"K";case"6":return"M";case"7":return"N";case"8":return"Q";case"9":return"U";case"10":return"V";case"11":return"X";case"12":return"Z";case"F":return"1";case"G":return"2";case"H":return"3";case"J":return"4";case"K":return"5";case"M":return"6";case"N":return"7";case"Q":return"8";case"U":return"9";case"V":return"10";case"X":return"11";case"Z":return"12"}return e},i.money=function(t,e,a){return a||(a="$"),3==a.length&&(a+=" "),e||0===e||(e=2),a+i.commas((Math.round(1e4*t)/1e4).toFixed(e))},i.convertCurrencyCode=function(t){var e={JPY:"¥",USD:"$",AUD:"A$",BRL:"R$",CAD:"CA$",CNY:"CN¥",CZK:"Kč",DKK:"kr",EUR:"€",GBP:"£",HKD:"HK$",HUF:"Ft",ILS:"₪",INR:"₹",KRW:"₩",MXN:"MX$",NOK:"kr",NZD:"NZ$",PLN:"zł",RUB:"руб",SAR:"﷼",SEK:"kr",SGD:"S$",THB:"฿",TRY:"₺",TWD:"NT$",VND:"₫",XAF:"FCFA",XCD:"EC$",XOF:"CFA",XPF:"CFPF",ZAR:"R"}[t];return e||t},i.commas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},i.alert=function(t){alert(t)},i.withinElement=function(t,e,i){var a=t.getBoundingClientRect();return!(e<=a.left)&&(!(i<=a.top)&&(!(e>=a.left+t.offsetWidth)&&!(i>=a.top+t.offsetHeight)))},i.efficientDOMUpdate=function(t,e,i){t[e]!==i&&(t[e]=i)},i.safeMouseOut=function(t,e){var a,r;t.addEventListener("mouseout",(a=t,r=e,function(t){void 0===t.pageX&&(t.pageX=t.clientX,t.pageY=t.clientY),i.withinElement(a,t.pageX,t.pageY)||(a.stxMouseOver=!1,r(t))}))},i.safeMouseOver=function(t,e){var a,r;t.addEventListener("mouseover",(a=t,r=e,function(t){if(void 0===t.pageX&&(t.pageX=t.clientX,t.pageY=t.clientY),i.withinElement(a,t.pageX,t.pageY)){if(a.stxMouseOver)return;a.stxMouseOver=!0,r(t)}}))},i.installTapEvent=function(t,e){i.safeClickTouch(t,function(t){var i=document.createEvent("Event");i.initEvent("stxtap",!0,!0),void 0===t.pageX&&(t.pageX=t.clientX,t.pageY=t.clientY),i.pageX=t.pageX,i.pageY=t.pageY,t.target.dispatchEvent(i),e&&e.stopPropagation&&t.stopPropagation()},e)},i.safeClickTouch=function(t,e,a){a||(a={});var r={};function n(t,a,r){return function(n){if(!i.safeClickTouchEvent){if(!r.t)return;var s=r.t;if(r.t=null,s+1e3<(new Date).getTime())return}if(!(a.safety&&a.safety.recentlyDragged||(n||(n=event),n.which&&n.which>=2||n.button&&n.button>=2))){if(a.preventUnderlayClick)"INPUT"!==n.target.tagName&&n.preventDefault();else{if(a.lastType!=t&&Date.now()<a.allowAnotherDevice)return;a.lastType=t,a.allowAnotherDevice=Date.now()+1e3}e(n)}}}function s(t,e){return function(i){var a=i.clientX?i.clientX:i.pageX,r=i.clientY?i.clientY:i.pageY;e?(t.t=(new Date).getTime(),t.x=a,t.y=r):t.x&&Math.pow(t.x-a,2)+Math.pow(t.y-r,2)>16&&(t.t=null)}}a.allowMultiple||i.clearSafeClickTouches(t),!1!==a.preventUnderlayClick&&(a.preventUnderlayClick=!0),!1!==a.absorbDownEvent&&(a.absorbDownEvent=!0),a.allowAnotherDevice=0,a.registeredClick=!1;var o=t.safeClickTouchEvents;o||(o=t.safeClickTouchEvents=[]);var l=n("mouseup",a,r),h=n("touchend",a,r),c=n("pointerup",a,r),u=function(t){t.stopPropagation()},p={};if(i.safeClickTouchEvent){var d=n(i.safeClickTouchEvent,a);t.addEventListener(i.safeClickTouchEvent,d),p[i.safeClickTouchEvent]=d,o.push(p)}else"onpointerup"in document?(t.addEventListener("pointerdown",s(r,!0)),t.addEventListener("pointermove",s(r)),t.addEventListener("pointerup",c),p.pointerup=c,a.absorbDownEvent&&(t.addEventListener("pointerdown",u),p.pointerdown=u),o.push(p)):(t.addEventListener("mousedown",s(r,!0)),t.addEventListener("mousemove",s(r)),t.addEventListener("touchstart",s(r,!0)),t.addEventListener("touchmove",s(r)),t.addEventListener("mouseup",l),t.addEventListener("touchend",h),p.mouseup=l,p.touchend=h,a.absorbDownEvent&&(t.addEventListener("mousedown",u),p.mousedown=u,t.addEventListener("touchstart",u),p.touchstart=u),o.push(p))},i.clearSafeClickTouches=function(t){var e=t.safeClickTouchEvents;if(e){for(var i=0;i<e.length;i++){var a=e[i];for(var r in a){var n=a[r];t.removeEventListener(r,n)}}t.safeClickTouchEvents=null}},i.safeDrag=function(t,e,a,r){var n=100,s=!1,o=0,l=0,h={recentlyDragged:!1};function c(t){var c={mousedown:{move:"mousemove",up:"mouseup"},pointerdown:{move:"pointermove",up:"pointerup"},touchstart:{move:"touchmove",up:"touchend"}};function u(t){if(t.touches){if(t.touches.length>=1)return t.touches[0].pageX;if(t.changedTouches&&t.changedTouches.length>=1)return t.changedTouches[0].pageX}return void 0===t.pageX?t.clientX:t.pageX}function p(t){if(t.touches){if(t.touches.length>=1)return t.touches[0].pageY;if(t.changedTouches&&t.changedTouches.length>=1)return t.changedTouches[0].pageY}return void 0===t.pageY?t.clientY:t.pageY}return function(d){if(!s){s=!0,i.ChartEngine.ignoreTouch=!0;var m=function(t){t&&t.preventDefault&&t.preventDefault(),h.recentlyDragged=!0,t.displacementX=u(t)-o,t.displacementY=p(t)-l,a(t)};a&&document.body.addEventListener(c[t].move,m),document.body.addEventListener(c[t].up,function(e){var n;i.ChartEngine.ignoreTouch=!1,a&&document.body.removeEventListener(c[t].move,m),document.body.removeEventListener(c[t].up,arguments.callee),e.displacementX=u(e)-o,e.displacementY=p(e)-l,r&&r(e),setTimeout((n=h,function(){n.recentlyDragged=!1}),50)}),setTimeout(function(){s=!1},n),o=u(d),l=p(d),e&&e(d)}}}return t.addEventListener("mousedown",c("mousedown")),t.addEventListener("pointerdown",c("pointerdown")),t.addEventListener("touchstart",c("touchstart")),h},i.isSurface&&(i.gesture=new MSGesture,i.gesture.target=document.body,i.gesturePointerId=null),i.inputKeyEvents=function(t,e){t.addEventListener("keyup",function(i){switch(window.event?event.keyCode:i.keyCode){case 13:e();break;case 27:t.value=""}},!1)},i.fixScreen=function(){window.scrollTo(0,0)},i.setCaretPosition=function(t,e){if(t.style.zIndex=5e3,t.setSelectionRange){i.focus(t);try{t.setSelectionRange(e,e)}catch(t){}}else if(t.createTextRange){var a=t.createTextRange();a.collapse(!0),a.moveEnd("character",e),a.moveStart("character",e),a.select()}},i.setValueIfNotActive=function(t,e){document.activeElement!=t&&(t.value=e)},i.hideKeyboard=function(t){var e=document.activeElement;"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName||(e.blur(),window.focus(),t&&(t===document.body||document.body.contains(t))&&t.focus())},i.boxIntersects=function(t,e,a,r,n,s,o,l,h,c){var u=n,p=o;if(n>o&&(u=o,p=n),p>a&&(p=a),u<t&&(u=t),"segment"==h&&u>p)return!1;c&&(s=i.log10(s),l=i.log10(l),e=i.log10(e),r=i.log10(r));var d=s,m=l,g=o-n;if(Math.abs(g)>1e-7){var f=(l-s)/g,y=s-f*n;d=f*u+y,m=f*p+y}if(d>m){var v=m;m=d,d=v}if(m>e&&(m=e),d<r&&(d=r),"segment"==h)return d<=m;function x(t,e){return(s-l)*t+(o-n)*e+(n*l-o*s)}var b=x(t,e),C=x(t,r),S=x(a,e),w=x(a,r);return!(b>0&&C>0&&S>0&&w>0)&&!(b<0&&C<0&&S<0&&w<0)},i.linesIntersect=function(t,e,i,a,r,n,s,o,l){var h=(o-s)*(e-t)-(n-r)*(a-i),c=(n-r)*(i-s)-(o-s)*(t-r),u=(e-t)*(i-s)-(a-i)*(t-r);if(0===h)return 0===c&&0===u;var p=c/h,d=u/h;if("segment"==l){if(p>=0&&p<=1&&d>=0&&d<=1)return!0}else if("line"==l||"horizontal"==l||"vertical"==l){if(p>=0&&p<=1)return!0}else if("ray"==l&&p>=0&&p<=1&&d>=0)return!0;return!1},i.yIntersection=function(t,e){var i=t.x0,a=t.x1,r=e,n=e,s=t.y0,o=t.y1,l=1e4*(a-i)-(n-r)*(o-s),h=(n-r)*(s-0)-1e4*(i-r),c=h/l;if(0===l){if(0!==h)return null;c=1}return s+c*(o-s)},i.xIntersection=function(t,e){var i=t.x0,a=t.x1,r=t.y0,n=(e-e)*(a-i)-1e4*(t.y1-r),s=1e4*(r-e)-(e-e)*(i-0),o=s/n;if(0===n){if(0!==s)return null;o=1}return i+o*(a-i)},i.intersectLineLineX=function(t,e,i,a,r,n,s,o){return t+((n-r)*(i-s)-(o-s)*(t-r))/((o-s)*(e-t)-(n-r)*(a-i))*(e-t)},i.intersectLineLineY=function(t,e,i,a,r,n,s,o){return i+((n-r)*(i-s)-(o-s)*(t-r))/((o-s)*(e-t)-(n-r)*(a-i))*(a-i)},i.privateBrowsingAlert=!1,i.localStorage="undefined"!=typeof localStorage?localStorage:{},i.localStorageSetItem=function(t,e){try{i.localStorage.setItem(t,e)}catch(t){i.privateBrowsingAlert||(i.alert("No storage space available.  Possible causes include browser being in Private Browsing mode, or maximum storage space has been reached."),i.privateBrowsingAlert=!0)}},i.loadUI=function(t,e){var a=document.createElement("iframe");a.src=t+"?"+i.uniqueID(),a.hidden=!0,a.addEventListener("load",function(){var t=null;try{t=a.contentDocument||a.contentWindow.document}catch(t){return e(t)}if(t&&!t.title){var r=t.body.innerHTML,n=document.createElement("div");document.body.removeChild(a),i.innerHTML(n,r);for(var s=0;s<n.children.length;s++){var o=n.children[s].cloneNode(!0);document.body.appendChild(o)}e(null)}else e(new Error("iFrame not found or document has a title"))},!1),document.body.appendChild(a)},i.loadScript=function(t,e){if(i.loadedScripts||(i.loadedScripts={}),i.loadedScripts[t])e&&e();else{var a=document.createElement("SCRIPT");a.async=!0,a.onload=function(){i.loadedScripts[t]=!0,e&&e()},"undefined"!=typeof isIE8&&(a.onreadystatechange=function(){"loaded"==a.readyState&&(i.loadedScripts[t]=!0,e&&setTimeout(e,0))});var r=t;r=-1==r.indexOf("?")?r+"?"+Date.now():r+"&"+Date.now(),a.src=r;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n.nextSibling)}},i.loadStylesheet=function(t,e){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.media="screen",i.href=t+"?"+Date.now(),i.onload=function(){this.loaded||(this.loaded=!0,e&&e())};var a=document.getElementsByTagName("link"),r=a[a.length-1];r.parentNode.insertBefore(i,r.nextSibling)},i.loadWidget=function(t,e){i.loadStylesheet(t+".css",function(){i.loadUI(t+".html",function(a){a?e(a):i.loadScript(t+".js",e)})})},i.fillTransparentCanvas=function(t,e,i,a){var r=t.globalCompositeOperation;t.globalCompositeOperation="destination-over",t.fillStyle=e,t.fillRect(0,0,i,a),t.globalCompositeOperation=r},i.tickedRect=function(t){i.rect(t);var e=Math.round(t.top+t.height/2)+.5;t.ctx.beginPath(),t.ctx.moveTo(t.x-2,e),t.ctx.lineTo(t.x,e),t.ctx.stroke(),t.ctx.closePath()},i.roundRect=function(t,e){9===arguments.length&&(t={ctx:arguments[0],x:arguments[1],top:arguments[2],width:arguments[3],height:arguments[4],radius:arguments[5],fill:arguments[6],stroke:arguments[7],edge:arguments[8]});var a=t.stroke,r=t.x,n=t.top,s=t.width,o=t.height,l=t.radius,h=t.fill,c=t.ctx;void 0===a&&(a=!0),void 0===l&&(l=5,s<0&&(l=-5));var u=s<0?-1*l:l;l&&!e&&(r-=1);var p=r+l,d=r+s,m=n+u,g=n+o,f=d-l,y=g-u;if(c.beginPath(),c.moveTo(p,n),c.lineTo(f,n),c.quadraticCurveTo(d,n,d,m),c.lineTo(d,y),c.quadraticCurveTo(d,g,f,g),c.lineTo(p,g),"flush"==e)c.lineTo(r,g),c.lineTo(r,n);else if("arrow"==e){c.quadraticCurveTo(r,g,r-l,y);var v=s<0?1:-1;c.lineTo(r+o/2*v,n+o/2),c.lineTo(r-l,m),c.quadraticCurveTo(r,n,p,n)}else c.quadraticCurveTo(r,g,r,y),c.lineTo(r,m),c.quadraticCurveTo(r,n,p,n);c.closePath(),t.backgroundColor&&(c.fillStyle=t.backgroundColor),a&&c.stroke(),h&&c.fill(),t.txt&&i.createLabel(t)},i.createLabel=function(t){t.ctx.textBaseline="middle",t.ctx.fillStyle=t.color?t.color:i.chooseForegroundColor(t.backgroundColor),t.ctx.fillStyle===t.backgroundColor&&("#FFFFFF"==t.backgroundColor.toUpperCase()?t.ctx.fillStyle="#000000":t.ctx.fillStyle="#FFFFFF"),t.ctx.fillText(t.txt,t.x+t.margin.left,t.y+t.margin.top),t.ctx.textAlign="left"},i.roundRectArrow=function(t){i.roundRect(t,"arrow")},i.semiRoundRect=function(t){i.roundRect(t,"flush")},i.rect=function(t){t.radius=0,i.roundRect(t)},i.noop=function(t){i.createLabel(t)},i.getLines=function(t,e,i){for(var a=e.split(" "),r=[],n="",s=!1,o=0;o<a.length;o++){var l=a[o];if(t.measureText(n+l).width<i?(s&&(n+=" "),s=!0,n+=l):(r.push(n),n=l),o===a.length-1){r.push(n);break}}return r},i.readablePeriodicity=function(t){var e=t.layout.periodicity,i=t.layout.interval;return"number"==typeof t.layout.interval&&t.layout.timeUnit?(e=t.layout.interval*t.layout.periodicity,i=t.layout.timeUnit):"number"!=typeof t.layout.interval||t.layout.timeUnit||(e=t.layout.interval*t.layout.periodicity,i="minute"),e%60==0&&"minute"==i&&(e/=60,i="hour"),e+" "+t.translateIf(i.capitalize())},i.translatableTextNode=function(t,e,i){if(t.translationCallback){var a=document.createElement("translate");return a.setAttribute("original",e),a.innerHTML=t.translationCallback(e,i),a}return document.createTextNode(e)},i.clearCanvas=function(t,e){t.isDirty=!1;var a=t.context;if(a.clearRect(0,0,t.width,t.height),i.isAndroid&&!i.is_chrome){i.ChartEngine.useOldAndroidClear&&e&&(a.fillStyle=e.containerColor,a.fillRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height));var r=t.width;t.width=1,t.width=r}},i.monthLetters=["J","F","M","A","M","J","J","A","S","O","N","D"],i.monthAbv=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i.MILLISECOND=1,i.SECOND=1e3,i.MINUTE=60*i.SECOND,i.HOUR=60*i.MINUTE,i.DAY=24*i.HOUR,i.WEEK=7*i.DAY,i.MONTH=31*i.DAY,i.YEAR=366*i.DAY,i.DECADE=10*i.YEAR-7*i.DAY,i.monthAsDisplay=function(t,e,a){return e?a&&a.monthLetters?a.monthLetters[t]:i.monthLetters[t]:a&&a.monthAbv?a.monthAbv[t]:i.monthAbv[t]},i.timeAsDisplay=function(t,e,a){var r=e?e.internationalizer:null;if(r)return a==i.SECOND?r.hourMinuteSecond.format(t):a==i.MILLISECOND?r.hourMinuteSecond.format(t)+"."+t.getMilliseconds():r.hourMinute.format(t);var n=t.getMinutes();n<10&&(n="0"+n);var s=t.getHours()+":"+n,o="";if(a<=i.SECOND&&((o=t.getSeconds())<10&&(o="0"+o),s+=":"+o),a==i.MILLISECOND){var l=t.getMilliseconds();l<10?l="00"+l:l<100&&(l="0"+l),s+="."+l}return s},i.displayableDate=function(t,e,a){function r(t){return t<10?"0"+t:t}var n="",s=t.layout.interval,o=i.ChartEngine.isDailyInterval(s);if(e.xAxis.formatter)n=e.xAxis.formatter(a);else if(t.internationalizer)n=t.internationalizer.monthDay.format(a),o?n="month"==s?t.internationalizer.yearMonth.format(a):t.internationalizer.yearMonthDay.format(a):n+=" "+t.internationalizer.hourMinute.format(a);else{var l=r(a.getMonth()+1),h=r(a.getDate()),c=r(a.getHours()),u=r(a.getMinutes());if(o)n="month"==s?l+"-":l+"-"+h+"-",n+=a.getFullYear();else{n=l+"/"+h+" "+c+":"+u;var p=e.xAxis.activeTimeUnit&&e.xAxis.activeTimeUnit<=i.SECOND||"second"==t.layout.timeUnit,d=e.xAxis.activeTimeUnit&&e.xAxis.activeTimeUnit<=i.MILLISECOND||"millisecond"==t.layout.timeUnit;if(p||d)if(n+=":"+r(a.getSeconds()),d){var m=r(a.getMilliseconds());m<100&&(m="0"+m),n+=":"+m}}}return n},i.fixPrice=function(t){if(!t&&0!==t)return null;for(var e=t.toFixed(10),i=e.length-1;i>1&&"0"==e.charAt(i);i--);return e=e.substring(0,i+1),parseFloat(e)},i.condenseInt=function(t){return null==t?"":t===1/0||t===-1/0?"n/a":t=t>0?t>1e12?Math.round(t/1e11)/10+"t":t>1e11?Math.round(t/1e9)+"b":t>1e10?(Math.round(t/1e8)/10).toFixed(1)+"b":t>1e9?(Math.round(t/1e7)/100).toFixed(2)+"b":t>1e8?Math.round(t/1e6)+"m":t>1e7?(Math.round(t/1e5)/10).toFixed(1)+"m":t>1e6?(Math.round(t/1e4)/100).toFixed(2)+"m":t>1e5?Math.round(t/1e3)+"k":t>1e4?(Math.round(t/100)/10).toFixed(1)+"k":t>1e3?(Math.round(t/10)/100).toFixed(2)+"k":t.toString():t<-1e12?Math.round(t/1e11)/10+"t":t<-1e9?Math.round(t/1e8)/10+"b":t<-1e6?Math.round(t/1e5)/10+"m":t<-1e3?Math.round(t/100)/10+"k":t.toString()},i.calculateTradingDecimalPlaces=function(t){var e=t.chart,i=2,a=e.masterData;if(a&&a.length>50)for(var r=2;r<50;r++){var n=a.length-r;if(n<0)break;var s=a[n];if(s.Close&&"number"==typeof s.Close){var o=s.Close.toString(),l=o.indexOf(".");if(-1!=l){var h=o.length-l-1;h>i&&(i=h)}}}var c=e.yAxis.maxDecimalPlaces;return i>c&&(i=c),i},i.fillArea=function(t,e,i){if(e.length){var r=t.chart.context,n=r.globalAlpha,s=arguments[2],o=arguments[3],l=arguments[4],h=0,c=null;i&&"object"==typeof i&&(s=i.color,o=i.opacity,h=i.tension,l=i.panelName,c=i.yAxis),o||0===o||(o=.2),"auto"==s&&(s=t.defaultColor),r.globalAlpha=o,s&&(r.fillStyle=s);var u,p=Number.MAX_VALUE,d=-1*p,m=t.panels[l];if(m&&(d=(c||m.yAxis).top,p=(c||m.yAxis).bottom,r.save(),r.beginPath(),r.rect(m.left,d,m.width,p-d),r.clip()),r.beginPath(),h){var g=[];for(u=0;u<e.length-2;u++)g.push(e[u][0],e[u][1]);for(a.plotSpline(g,h,r),u=e.length-2;u<e.length;u++)r.lineTo(Math.round(e[u][0]),Math.round(e[u][1]))}else for(r.moveTo(e[0][0],e[0][1]),u=1;u<e.length;u++)r.lineTo(e[u][0],e[u][1]);r.closePath(),r.fill(),m&&r.restore(),r.globalAlpha=n}},i.prepareChannelFill=function(t,e){(!e||e instanceof Array)&&(e=arguments[2]),e.gapDisplayStyle||!1===e.gapDisplayStyle||(e.gapDisplayStyle=e.gaps);var a=t.panels[e.panelName],r=(t.chart.context.strokeStyle,{noDraw:e.noDraw,gapDisplayStyle:e.gapDisplayStyle}),n=i.ensureDefaults(e,{noDraw:!0,gapDisplayStyle:{},yAxis:a.yAxis}),s=t.plotDataSegmentAsLine(e.topBand,a,n),o=t.plotDataSegmentAsLine(e.bottomBand,a,n);e.noDraw=r.noDraw,e.gapDisplayStyle=r.gapDisplayStyle;for(var l=[],h=0;h<s.points.length;h+=2)l.push([s.points[h],s.points[h+1]]);for(var c=o.points.length-1;c>=0;c-=2)l.push([o.points[c-1],o.points[c]]);i.fillArea(t,l,e)},i.preparePeakValleyFill=function(t,e){(!e||e instanceof Array)&&(e=arguments[2]),e.gapDisplayStyle||!1===e.gapDisplayStyle||(e.gapDisplayStyle=e.gaps);var a=t.panels[e.panelName],r=a.yAxis,n=t.chart,s=n.context,o=(s.strokeStyle,{noDraw:e.noDraw,gapDisplayStyle:e.gapDisplayStyle}),l=t.plotDataSegmentAsLine(e.band,a,i.ensureDefaults(e,{noDraw:!0,gapDisplayStyle:{}}));e.noDraw=o.noDraw,e.gapDisplayStyle=o.gapDisplayStyle;var h=e.threshold,c=e.direction,u=e.reverse,p=e.gapDisplayStyle;e.yAxis&&(r=e.yAxis);var d=-Number.MAX_VALUE,m=Number.MAX_VALUE,g=u?d:m;(h||0===h)&&(g=t.pixelFromPrice(h,a,r));for(var f=[],y=l.points.length,v=0;v<y;v+=2){var x,b,C=l.points[v],S=l.points[v+1];if(!isNaN(S))S>g&&c>0||S<g&&c<0||(f.push([C,S]),d=Math.max(S,d),m=Math.min(S,m)),v<y-3&&(x=l.points[v+2],b=l.points[v+3],(S<g&&b>g||S>g&&b<g)&&(C+=(g-S)*(x-C)/(b-S),f.push([C,g])))}if(y=f.length){var w=e.edgeParameters;if(e.edgeHighlight){w.lineWidth>100&&(w.lineWidth=1);for(var T=0;T<y-1;T++){var M=f[T],D=f[T+1];if(M[1]!=g||D[1]!=g){if(M[0]==D[0]&&t.layout.candleWidth>=1){if(M[1]==g&&f[T-1]&&f[T-1][1]==g)continue;if(D[1]==g&&f[T+2]&&f[T+2][1]==g)continue}t.plotLine(M[0],D[0],M[1],D[1],e.edgeHighlight,"segment",n.context,a,w)}}}h||0===h||(g=u?Math.min(m,r.top):Math.max(d,r.bottom)),f.push([f[y-1][0],g],[f[0][0],g]);var E=e.opacity;if(E||0===E||(e.opacity=.3),i.fillArea(t,f,e),p&&p.color&&p.fillMountain&&!e.tension&&!i.isTransparent(p.color)&&!i.isTransparent(e.color)){if(s.save(),s.fillStyle instanceof CanvasGradient){var A=s.createLinearGradient(0,1===c?a.top:a.bottom,0,g);A.addColorStop(0,i.hexToRgba(i.colorToHex(p.color),60)),A.addColorStop(1,i.hexToRgba(i.colorToHex(p.color),10)),s.fillStyle=A}else s.fillStyle=p.color;var k=[],F={opacity:e.opacity,panelName:e.panelName};for(v=0;v<l.gapAreas.length;v++){var _=l.gapAreas[v],P=_.start,L=_.end,O=_.threshold;P?k=[[P[0],P[1]],[P[0],O]]:k.push([L[0],O],[L[0],e.step?k[0][1]:L[1]]),4==k.length&&(i.fillArea(t,k,F),e.step?(t.plotLine(k[0][0],k[3][0],k[0][1],k[0][1],p,"segment",s,a,p),t.plotLine(k[3][0],k[3][0],k[0][1],k[3][1],p,"segment",s,a,p)):t.plotLine(k[0][0],k[3][0],k[0][1],k[3][1],p,"segment",s,a,p))}s.restore()}e.opacity=E}},i.fillIntersecting=function(t,e,a){(!a||a instanceof Array)&&(a=arguments[3]);var r=a.topBand,n=a.bottomBand,s=a.topSubBand,o=a.bottomSubBand,l=a.topColor,h=a.bottomColor,c=e;c.panel&&(c.outputs&&c.outputMap&&(l||(l=c.outputs[c.outputMap[r]]),h||(h=c.outputs[c.outputMap[n]])),c=c.panel),c=t.panels[c];var u=t.chart.context,p=t.scratchContext;if(!p){var d=u.canvas.cloneNode(!0);(p=t.scratchContext=d.getContext("2d")).canvas=d}p.canvas.height=u.canvas.height,p.canvas.width=u.canvas.width,p.drawImage(u.canvas,0,0),u.clearRect(0,0,u.canvas.width,u.canvas.height);var m=.3;a.opacity&&(m=a.opacity),u.save(),u.globalCompositeOperation="xor";var g={band:r,subField:s,color:l,opacity:1,panelName:c.name,yAxis:a.topAxis,skipTransform:a.skipTransform,tension:a.tension};i.preparePeakValleyFill(t,g),i.extend(g,{band:n,subField:o,color:h,yAxis:a.bottomAxis}),i.preparePeakValleyFill(t,g),u.globalAlpha=m,u.globalCompositeOperation="copy",u.scale(1/t.adjustedDisplayPixelRatio,1/t.adjustedDisplayPixelRatio),u.drawImage(u.canvas,0,0),u.globalAlpha=1,u.globalCompositeOperation="destination-over",u.drawImage(t.scratchContext.canvas,0,0),u.restore()},i.drawLegendItem=function(t,e,i,a,r){r||(r=1);var n=e[0],s=e[1],o=t.chart.context;return o.globalAlpha=r,o.fillStyle=a,o.fillRect(n,s,10,10),o.globalAlpha=1,n+=12,o.fillStyle=t.defaultColor,o.fillText(i,n,s),[n+=o.measureText(i).width+6,s]},i.drawLegend=function(t,e){var a=e.coordinates,r=t.chart.context;r.textBaseline="top";var n=r.font;t.canvasFont("stx-legend",r),a||(a=e.chart.legend);for(var s=[a.x,a.y],o=t.defaultColor,l=0;l<2;l++)for(var h in e.legendColorMap){var c=e.legendColorMap[h];if((!c.isBase||!l&&!e.noBase)&&(c.isBase||l)){var u;if(c.color instanceof Array){var p=c.color;for(u=p.length-1;u>=0;u--)i.isTransparent(p[u])&&p.splice(u,1);if(p.length>1){var d=r.createLinearGradient(s[0],s[1],s[0]+10,s[1]);for(u=0;u<p.length;u++)d.addColorStop(u/(p.length-1),p[u]);o=d}else o=p.length>0?p[0]:t.getCanvasColor("stx_line_chart")}else o=null;if(o){var m=h;c.display&&(m=c.display),m||(m=e.chart.symbolDisplay?e.chart.symbolDisplay:e.chart.symbol),s=i.drawLegendItem(t,s,m,o,c.opacity)}}}r.font=n},i.minMax=function(t,e,i,a){var r=Number.MAX_VALUE,n=-1*Number.MAX_VALUE;i||(i="Close");for(var s=a?"High":i,o=a?"Low":i,l=0;l<t.length;l++){var h=t[l];if(h){var c=h[e];if(c||0===c){var u=c;"object"==typeof c&&(u=c[s]),isNaN(u)||!u&&0!==u||(n=Math.max(n,u)),"object"==typeof c&&(u=c[o]),isNaN(u)||!u&&0!==u||(r=Math.min(r,u))}}}return[r,n]},i.symbolEqual=function(t,e){if(!t||!e)return!1;if("object"!=typeof t&&(t={symbol:t}),"object"!=typeof e&&(e={symbol:e}),"function"==typeof t.equals)return t.equals(e);var i=t.symbol,a=e.symbol;return i&&(i=i.toUpperCase()),a&&(a=a.toUpperCase()),i==a&&t.source==e.source},i.addMemberToMasterdata=function(t){t.constructor===i.ChartEngine&&(t={stx:arguments[0],label:arguments[1],data:arguments[2],fields:arguments[3],createObject:arguments[4],fieldForLabel:arguments[5]});var e=t.stx,a=t.label,r=t.data,n=t.fields,s=t.createObject,o=t.fieldForLabel,l=t.chart?t.chart:e.chart;t.noCleanupDates||e.doCleanupDates(r,e.layout.interval);var h=e.getSeries({symbolObject:a,chart:l});if(r&&r.constructor==Object&&(r=[r]),r&&r.length){var c,u,p=0,d=0,m=l.masterData,g=e.layout;m||(m=[]);for(var f=e.chart&&e.chart.defaultPlotField?e.chart.defaultPlotField:null,y=!e.chart.highLowBars&&!e.highLowBars[e.layout.chartType];r&&p<m.length&&d<r.length;){if(u=r[d],c=m[p],u.DT&&void 0!==u.DT?("number"==typeof u.DT&&(u.DT=new Date(u.DT)),u.Date&&17==u.Date.length||(u.Date=i.yyyymmddhhmmssmmm(u.DT))):u.DT=i.strToDateTime(u.Date),0===d)for(var v=0;v<h.length;v++)(!h[v].endPoints.begin||h[v].endPoints.begin>u.DT)&&(h[v].endPoints.begin=u.DT);+u.DT!=+c.DT?u.DT<c.DT?m.splice(p,0,{DT:u.DT,Date:u.Date}):D(u.DT):(M(c,u),d++,p++)}if(p>=m.length)for(;r&&d<r.length;)(u=r[d]).DT&&void 0!==u.DT?("number"==typeof u.DT&&(u.DT=new Date(u.DT)),u.Date&&17==u.Date.length||(u.Date=i.yyyymmddhhmmssmmm(u.DT))):u.DT=i.strToDateTime(u.Date),M(c={DT:u.DT,Date:u.Date},u),m.push(c),d++;if(t.fillGaps&&m.length)for(var x=m[0],b=1;b<m.length;b++){var C=m[b];if(n)for(var S=0;S<n.length;S++){var w=n[S];void 0===C[w]&&void 0!==x[w]&&(C[w]=x[w])}else void 0===C[a]&&void 0!==x[a]&&(C[a]=x[a]);x=C}for(var T=0;T<h.length;T++)(!h[T].endPoints.end||h[T].endPoints.end<=c[a].DT)&&(h[T].lastQuote=c[a],h[T].endPoints.end=c[a].DT);e.setMasterData(m,l,{noCleanupDates:!0})}function M(t,e){if(n&&n.length)if("*"==n[0])i.extend(t,e);else for(var r=0;r<n.length;r++)t[n[r]]=e[n[r]];else if(s){if(void 0!==e.Value)return void(t[a]=e.Value);t[a]="aggregate"==s?function(t,e){if(!t||"object"!=typeof t)return t=e;var i={Close:t.Close,High:t.High,Low:t.Low,Open:t.Open,Volume:t.Volume};for(var a in t=e,i)null===t.Close&&void 0!==t[a]?t[a]=null:"number"!=typeof t[a]?t[a]=i[a]:"number"==typeof i[a]&&("Open"==a?t.Open=i.Open:"Low"==a&&t.Low>i.Low?t.Low=i.Low:"High"==a&&t.High<i.High?t.High=i.High:"Volume"==a&&(t.Volume+=i.Volume));return t}(t[a],e):e;var l=t[a];if("number"==typeof l.Close){"number"!=typeof l.Open&&(l.Open=l.Close);var h=Math.max(l.Open,l.Close),c=Math.min(l.Open,l.Close);("number"!=typeof l.High||l.High<h)&&(l.High=h),("number"!=typeof l.Low||l.Low>c)&&(l.Low=c)}l.Volume&&"number"!=typeof l.Volume&&(l.Volume=parseInt(l.Volume,10))}else o?t[a]=e[o]:y&&f&&void 0!==e[f]?t[a]=e[f]:g.adj&&void 0!==e.Adj_Close?t[a]=e.Adj_Close:void 0!==e.Close?t[a]=e.Close:void 0!==e.Value?t[a]=e.Value:t[a]=e[a]}function D(t){var e=p,i=m.length-1;if(m[i].DT<t)p=i+1;else if(+m[i].DT!=+t){p++;for(var a=0;++a<100;){switch(+m[p].DT==+t?0:m[p].DT<t?1:m[p-1].DT>t?-1:(+m[p-1].DT==+t&&p--,0)){case 0:return;case 1:e=p;break;case-1:i=p}p=Math.round((i+e)/2)}a>=100&&(console.log("!!!Warning: addMemberToMasterdata() did not find insertion point."),p=m.length-1)}else p=i}},i.ThemeHelper=function(t){this.params=t;var e=t.stx,a="#FFFFFF";e.chart.container&&(a=getComputedStyle(e.chart.container).backgroundColor,i.isTransparent(a)&&(a=e.containerColor)),this.settings.chart.Background.color=i.hexToRgba(a),this.settings.chart["Grid Lines"].color=i.hexToRgba(e.canvasStyle("stx_grid").color),this.settings.chart["Grid Dividers"].color=i.hexToRgba(e.canvasStyle("stx_grid_dark").color),this.settings.chart["Axis Text"].color=i.hexToRgba(e.canvasStyle("stx_xaxis").color),this.settings.chartTypes["Candle/Bar"].up.color=i.hexToRgba(e.canvasStyle("stx_candle_up").color),this.settings.chartTypes["Candle/Bar"].down.color=i.hexToRgba(e.canvasStyle("stx_candle_down").color),this.settings.chartTypes["Candle/Bar"].up.wick=i.hexToRgba(e.canvasStyle("stx_candle_shadow_up").color),this.settings.chartTypes["Candle/Bar"].down.wick=i.hexToRgba(e.canvasStyle("stx_candle_shadow_down").color),this.settings.chartTypes["Candle/Bar"].even.wick=i.hexToRgba(e.canvasStyle("stx_candle_shadow_even").color),this.settings.chartTypes["Candle/Bar"].up.border=i.hexToRgba(e.canvasStyle("stx_candle_up").borderLeftColor),this.settings.chartTypes["Candle/Bar"].down.border=i.hexToRgba(e.canvasStyle("stx_candle_down").borderLeftColor),i.isTransparent(e.canvasStyle("stx_candle_up").borderLeftColor)&&(this.settings.chartTypes["Candle/Bar"].up.border=null),i.isTransparent(e.canvasStyle("stx_candle_down").borderLeftColor)&&(this.settings.chartTypes["Candle/Bar"].down.border=null),this.settings.chartTypes.Line.color=i.hexToRgba(e.canvasStyle("stx_line_chart").color),this.settings.chartTypes.Mountain.color=i.hexToRgba(e.canvasStyle("stx_mountain_chart").backgroundColor)},i.ThemeHelper.prototype.settings={chart:{Background:{color:null},"Grid Lines":{color:null},"Grid Dividers":{color:null},"Axis Text":{color:null}},chartTypes:{"Candle/Bar":{up:{color:null,wick:null,border:null},down:{color:null,wick:null,border:null},even:{color:null,wick:null,border:null}},Line:{color:null},Mountain:{color:null}}},i.ThemeHelper.prototype.update=function(t){t||(t=this.params.stx);var e={stx_candle_up:{stx_candle_up:!0,stx_bar_up:!0,stx_hollow_candle_up:!0,stx_line_up:!0,stx_baseline_up:!0},stx_candle_down:{stx_candle_down:!0,stx_bar_down:!0,stx_hollow_candle_down:!0,stx_line_down:!0,stx_baseline_down:!0},stx_shadow_up:{stx_candle_shadow_up:!0},stx_shadow_down:{stx_candle_shadow_down:!0},stx_shadow_even:{stx_candle_shadow_even:!0},stx_line_chart:{stx_bar_chart:!0,stx_line_chart:!0},stx_grid:{stx_grid:!0},stx_grid_dark:{stx_grid_dark:!0},stx_xaxis:{stx_xaxis_dark:!0,stx_xaxis:!0,stx_yaxis:!0,stx_yaxis_dark:!0,stx_grid_border:!0},stx_mountain_chart:{stx_mountain_chart:!0},stx_market_session:{stx_market_session:!0}};function a(i,a,r){var n=e[i];for(var s in n)t.setStyle(s,a,r)}t.chart.container.style.backgroundColor=this.settings.chart.Background.color,a("stx_grid","color",this.settings.chart["Grid Lines"].color),a("stx_grid_dark","color",this.settings.chart["Grid Dividers"].color),a("stx_xaxis","color",this.settings.chart["Axis Text"].color);var r=this.settings.chartTypes["Candle/Bar"];r.even||(r.even={color:null,wick:i.hexToRgba(t.canvasStyle("stx_candle_shadow_even").color),border:null}),a("stx_candle_up","color",r.up.color),a("stx_candle_down","color",r.down.color),a("stx_shadow_up","color",r.up.wick),a("stx_shadow_down","color",r.down.wick),a("stx_shadow_even","color",r.even.wick),t.setStyle("stx_candle_up","borderLeftColor",r.up.border),t.setStyle("stx_candle_down","borderLeftColor",r.down.border),a("stx_line_chart","color",this.settings.chartTypes.Line.color),t.setStyle("stx_mountain_chart","borderTopColor",this.settings.chartTypes.Mountain.color),t.setStyle("stx_mountain_chart","backgroundColor",i.hexToRgba(this.settings.chartTypes.Mountain.color,.8)),t.setStyle("stx_mountain_chart","color",i.hexToRgba(this.settings.chartTypes.Mountain.color,.1)),t.draw()},i.NameValueStore=function(){},i.NameValueStore.prototype.toJSONIfNecessary=function(t){if(t.constructor==String)return t;try{return JSON.stringify(t)}catch(e){return console.log("Cannot convert to JSON: "+t),null}},i.NameValueStore.prototype.fromJSONIfNecessary=function(t){try{return JSON.parse(t)}catch(e){return t}},i.NameValueStore.prototype.get=function(t,e){var a=i.localStorage.getItem(t);e&&e(null,this.fromJSONIfNecessary(a))},i.NameValueStore.prototype.set=function(t,e,a){i.localStorageSetItem(t,this.toJSONIfNecessary(e)),a&&a(null)},i.NameValueStore.prototype.remove=function(t,e){i.localStorage.removeItem(t),e&&e(null)},i.Plotter=function(){this.seriesArray=[],this.seriesMap={}},i.extend(i.Plotter.prototype,{Series:function(t,e,a,r,n,s){this.name=t,this.strokeOrFill=e,this.color=a,this.moves=[],this.text=[],(!r||r>1||r<0)&&(r=1),this.opacity=r,(!n||n>25||n<1)&&(n=1),this.width=n,this.pattern=i.borderPatternToArray(n,s)},newSeries:function(t,e,i,a,r){var n;n=i.constructor==String?new this.Series(t,e,i,a,r):new this.Series(t,e,i.color,i.opacity,r,i.borderTopStyle),this.seriesArray.push(n),this.seriesMap[t]=n},reset:function(t){for(var e in this.seriesMap)if(!t||t==e){var i=this.seriesMap[e];i&&(i.moves=[],i.text=[])}},moveTo:function(t,e,i){this.seriesMap[t].moves.push({action:"moveTo",x:e,y:i})},lineTo:function(t,e,i){var a=this.seriesMap[t],r=a.pattern;a.moves.push({action:"lineTo",x:e,y:i,pattern:r})},dashedLineTo:function(t,e,i,a){this.seriesMap[t].moves.push({action:"lineTo",x:e,y:i,pattern:a})},quadraticCurveTo:function(t,e,i,a,r){var n=this.seriesMap[t],s=n.pattern;n.moves.push({action:"quadraticCurveTo",x0:e,y0:i,x:a,y:r,pattern:s})},bezierCurveTo:function(t,e,i,a,r,n,s){var o=this.seriesMap[t],l=o.pattern;o.moves.push({action:"bezierCurveTo",x0:e,y0:i,x1:a,y1:r,x:n,y:s,pattern:l})},addText:function(t,e,i,a,r,n,s){this.seriesMap[t].text.push({text:e,x:i,y:a,bg:r})},drawText:function(t,e){for(var i=0;i<e.text.length;i++){var a=e.text[i];if(a.bg){var r=a.width?a.width:t.measureText(a.text).width,n=a.height?a.height:12,s=t.fillStyle;t.fillStyle=a.bg,"right"==t.textAlign?t.fillRect(a.x,a.y-n/2,-r,-n):t.fillRect(a.x,a.y-n/2,r,n),t.fillStyle=s}t.fillText(a.text,a.x,a.y)}},draw:function(t,e){for(var i=t.lineWidth,a=t.fillStyle,r=t.strokeStyle,n=t.globalAlpha,s=0;s<this.seriesArray.length;s++){var o=this.seriesArray[s];if(!e||o.name==e){t.beginPath(),t.lineWidth=o.width,t.globalAlpha=o.opacity,t.fillStyle=o.color,t.strokeStyle=o.color,t.save();for(var l=0;l<o.moves.length;l++){var h=o.moves[l];h.pattern?(t.setLineDash(h.pattern),t.lineDashOffset=0):t.setLineDash([]),"quadraticCurveTo"==h.action?t[h.action](h.x0,h.y0,h.x,h.y):"bezierCurveTo"==h.action?t[h.action](h.x0,h.y0,h.x1,h.y1,h.x,h.y):t[h.action](h.x,h.y)}"fill"==o.strokeOrFill?t.fill():t.stroke(),t.closePath(),t.restore(),this.drawText(t,o),t.lineWidth=1}}t.lineWidth=i,t.fillStyle=a,t.strokeStyle=r,t.globalAlpha=n}},!0),i.EaseMachine=function(t,e,i,a){this.fc=t,this.ms=e,(i||0===i)&&this.reset(i,a)},i.EaseMachine.prototype.reset=function(t,e){for(var i in t||0===t||(t=this.currentValues),this.hasCompleted=!1,this.running=!1,this.okayToRun=!0,this.useNameValuePairs="object"==typeof e,this.startTime=Date.now(),this.useNameValuePairs?(this.startValues=t,this.endValues=e):(this.startValues={default:t},this.endValues={default:e}),this.changeValues={},this.currentValues={},this.startValues)this.changeValues[i]=this.endValues[i]-this.startValues[i]},i.EaseMachine.prototype.next=function(){var t=Date.now();for(var e in t>=this.startTime+this.ms&&(t=this.startTime+this.ms,this.hasCompleted=!0,this.running=!1),this.currentValues={},this.changeValues)this.currentValues[e]=this.fc(t-this.startTime,this.startValues[e],this.changeValues[e],this.ms);return this.useNameValuePairs?this.currentValues:this.currentValues.default},i.EaseMachine.prototype.hasCompleted=!0,i.EaseMachine.prototype.run=function(t,e,i,a){this.afid&&cancelAnimationFrame(this.afid),e||0===e?this.reset(e,i):(i||0===i)&&this.reset(this.currentValues,i);var r=this;function n(){if(r.afid=null,r.okayToRun){var e=r.next();t(e),r.hasCompleted||(r.afid=requestAnimationFrame(n))}}this.running=!0,a?this.afid=requestAnimationFrame(n):n()},i.EaseMachine.prototype.stop=function(){return this.afid&&cancelAnimationFrame(this.afid),this.afid=null,this.okayToRun=!1,this.running=!1,void 0===this.useNameValuePairs?{}:this.useNameValuePairs?this.currentValues:this.currentValues.default},i.Renderer=function(){},i.Renderer.produce=function(t,e){var a=null;if(t)for(var r in i.Renderer){var n=i.Renderer[r];if(n.requestNew&&(a=n.requestNew(t.split("_"),e)),a)return a}return e.type="line",new i.Renderer.Lines({params:e})},i.Renderer.colorFunctions={},i.Renderer.registerColorFunction=function(t,e){i.Renderer.colorFunctions[t]=e},i.Renderer.unregisterColorFunction=function(t){delete i.Renderer.colorFunctions[t]},i.Renderer.prototype.performCalculations=function(){},i.Renderer.prototype.adjustYAxis=function(){},i.Renderer.prototype.draw=function(){},i.Renderer.prototype.drawIndividualSeries=function(t,e){},i.Renderer.prototype.construct=function(t){t||(t={});var e=t.params?t.params:{};e.name||(e.name=i.uniqueID()),e.heightPercentage||(e.heightPercentage=.7),e.opacity||(e.opacity=1),!1!==e.highlightable&&(e.highlightable=!0),e.panel||(e.panel="chart"),this.cb=t.callback,this.params=e,this.seriesParams=[],this.caches={},this.colors={}},i.Renderer.prototype.attachSeries=function(t,e){var a=this.stx;if(!a)return this;var r=this.stx.chart.series[t];r||(r={parameters:{}});var n=this.params,s=(r.parameters,{id:t,chartType:n.type,display:r.parameters.display,border_color_up:n.defaultBorders?"auto":null,fill_color_up:r.parameters.color,opacity_up:n.opacity,border_color_down:n.defaultBorders?"auto":null,fill_color_down:r.parameters.color,opacity_down:n.opacity,color:r.parameters.color,symbol:r.parameters.symbol,symbolObject:i.clone(r.parameters.symbolObject)});if("string"==typeof e)s.color=s.fill_color_down=s.fill_color_up=e;else if("object"==typeof e){for(var o in e)s[o]=e[o];var l=s.color,h=s.border_color;l&&(s.fill_color_up||(s.fill_color_up=l),s.fill_color_down||(s.fill_color_down=l),s.fill_color_even||(s.fill_color_even=l)),h&&(s.border_color_up||(s.border_color_up=h),s.border_color_down||(s.border_color_down=h),s.border_color_even||(s.border_color_even=h))}s.symbol&&s.field!=s.symbol&&(s.subField=s.field,s.field=s.symbol),s.symbol||s.field||this.highLowBars||(s.field="Close"),s.id||(s.id=i.uniqueID());for(var c=0;c<this.seriesParams.length;++c)if(this.seriesParams[c].id===s.id){this.removeSeries(s.id,!0);break}return this.seriesParams.splice(c,0,s),s.fill_color_up!=s.fill_color_down?(this.colors[t+" up"]={color:s.fill_color_up,opacity:s.opacity_up,display:s.display?s.display+" up":t+" up"},this.colors[t+" dn"]={color:s.fill_color_down,opacity:s.opacity_down,display:s.display?s.display+" down":t+" down"}):this.colors[t]={color:s.fill_color_up,opacity:s.opacity_up,display:s.display?s.display:t},n.yAxis&&(n.yAxis=a.addYAxis(a.panels[n.panel],n.yAxis),n.yAxis.needsInitialPadding=!0),this},i.Renderer.prototype.removeSeries=function(t,e){for(var i=0;i<this.seriesParams.length;i++)if(this.seriesParams[i].id==t){this.seriesParams.splice(i,1);break}if(delete this.colors[t+" up"],delete this.colors[t+" dn"],delete this.colors[t],!e){var a=!1;for(var r in this.stx.chart.seriesRenderers){for(var n=this.stx.chart.seriesRenderers[r],s=0;s<n.seriesParams.length;s++)if(n.seriesParams[s].id==t){a=!0;break}if(a)break}a||this.stx.deleteSeries(t,this.stx.chart)}return this.stx.deleteYAxisIfUnused(this.stx.panels[this.params.panel],this.params.yAxis),this},i.Renderer.prototype.removeAllSeries=function(t){if(t){for(var e=[],i=0;i<this.seriesParams.length;i++)e.push(this.seriesParams[i].id);for(var a=0;a<e.length;a++)this.removeSeries(e[a])}return this.seriesParams=[],this.colors={},this.stx.deleteYAxisIfUnused(this.stx.panels[this.params.panel],this.params.yAxis),this},i.Renderer.prototype.ready=function(){return this.stx.createDataSet(),this.stx.draw(),this},i.Renderer.Lines=function(t){this.construct(t);var e=this.params;if(e.type||(e.type="line"),!e.style)switch(e.type){case"mountain":e.baseline?e.style="stx_baseline_delta_mountain":e.colored?e.style="stx_colored_mountain_chart":e.style="stx_mountain_chart";break;default:e.style="stx_line_chart"}this.supportsAnimation=!0,"wave"==e.type?(e.step=e.vertex=e.baseline=e.colored=!1,this.highLowBars=this.barsHaveWidth=!0,this.supportsAnimation=!1):"step"==e.type&&(e.step=!0)},i.Renderer.Lines.ciqInheritsFrom(i.Renderer,!1),i.Renderer.Lines.requestNew=function(t,e){for(var a=null,r=e.step,n=e.colored,s=e.baseline,o=e.vertex,l=0;l<t.length;l++){var h=t[l];switch(h){case"line":case"mountain":case"wave":a=h;break;case"baseline":s=!0;break;case"colored":n=!0;break;case"step":r=!0;break;case"vertex":o=!0;break;case"delta":break;default:return null}}return null!==a||s||r?new i.Renderer.Lines({params:i.extend(e,{type:a,step:r,colored:n,baseline:s,vertex:o})}):null},i.Renderer.Lines.prototype.draw=function(){var t,e=this.stx,a=this.stx.panels[this.params.panel].chart,r={},n=this.seriesParams,s=this.params.colorFunction;function o(t){var i=t.fill_color_up||e.getCanvasColor("stx_line_up"),a=t.fill_color_down||e.getCanvasColor("stx_line_down"),r=t.color||e.getCanvasColor("stx_line_chart");return function(t,e,n){return e.iqPrevClose||0===e.iqPrevClose?e.Close>e.iqPrevClose?i:e.Close<e.iqPrevClose?a:r:r}}for(this.params.vertex&&!e.scatter&&(console.warn("Error, vertex option requires customChart.js"),this.params.vertex=!1),t=0;t<n.length;t++){var l=n[t];if(this.params.colored){for(var h=["_color_up","_color_down","_color"],c=0;c<h.length;c++){var u=l["border"+h[c]];u&&"auto"!=u&&(l["fill"+h[c]]=u)}s||(s=o(l)),this.params.colorFunction=s}var p={};a.series[l.id]&&(p=i.clone(a.series[l.id].parameters)),r[l.id]={parameters:i.extend(i.extend(p,this.params),l),yValueCache:this.caches[l.id]},this==e.mainSeriesRenderer&&a.customChart&&a.customChart.colorFunction&&(r[l.id].parameters.colorFunction=a.customChart.colorFunction)}for(t in e.drawSeries(a,r,this.params.yAxis,this),r)this.caches[t]=r[t].yValueCache},i.Renderer.Lines.prototype.drawIndividualSeries=function(t,e){if(!e.invalid){var a=this.stx,r=t.context,n=null,s=e.colorFunction,o=a.panels[e.panel]||t.panel;if("string"!=typeof s||(s=i.Renderer.colorFunctions[s]))return e.vertex&&(r.save(),r.lineJoin="bevel"),"wave"==e.type?n=a.drawWaveChart(o,e):e.baseline?n=a.drawBaselineChart(o,e):"mountain"==e.type?(e.returnObject=!0,n=a.drawMountainChart(o,e,s)):(e.returnObject=!0,n=a.drawLineChart(o,e.style,s,e)),e.vertex&&(a.scatter(o,{yAxis:e.yAxis,field:e.symbol||e.field,subField:e.subField,symbol:e.symbol,color:e.vertex_color,overlayScaling:e.overlayScaling}),r.restore()),n}},i.Renderer.OHLC=function(t){this.construct(t);var e=this.params;e.type||(e.type="candle"),this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.histogram&&(e.type="candle",this.highLowBars=!1,e.volume=e.hollow=!1),"bar"==e.type&&(e.volume=e.hollow=e.histogram=!1),"candle"==e.type&&(e.hlc=e.colored=!1),e.volume&&(e.hollow=!0)},i.Renderer.OHLC.ciqInheritsFrom(i.Renderer,!1),i.Renderer.OHLC.requestNew=function(t,e){for(var a=null,r=e.hlc,n=e.colored,s=e.hollow,o=e.volume,l=e.histogram,h=0;h<t.length;h++){var c=t[h];switch(c){case"bar":case"candle":a=c;break;case"volume":o=!0;break;case"hollow":s=!0;break;case"colored":n=!0;break;case"histogram":l=!0,a="candle";break;case"hlc":r=!0,a="bar";break;default:return null}}return null===a?null:new i.Renderer.OHLC({params:i.extend(e,{type:a,hlc:r,colored:n,hollow:s,volume:o,histogram:l})})},i.Renderer.OHLC.prototype.draw=function(){var t,e=this.stx,a=this.stx.panels[this.params.panel].chart,r={},n=this.seriesParams;for(t=0;t<n.length;t++){var s=n[t],o={};a.series[s.id]&&(o=i.clone(a.series[s.id].parameters)),r[s.id]={parameters:i.extend(i.extend(o,this.params),s)},this==e.mainSeriesRenderer&&a.customChart&&a.customChart.colorFunction&&(r[s.id].parameters.colorFunction=a.customChart.colorFunction)}for(t in e.drawSeries(a,r,this.params.yAxis,this),r)r[t].yValueCache&&(this.caches[t]=r[t].yValueCache)},i.Renderer.OHLC.prototype.getColor=function(t,e,a,r,n,s){var o=s||a.color;if(r&&!(o=s||a.borderLeftColor||a["border-left-color"]))return null;if(!n)return o;var l=t.pixelFromTransformedValue(e.chart.highValue,e);isNaN(l)&&(l=0);var h=a.backgroundColor;if(o&&!i.isTransparent(o)){var c=t.chart.context.createLinearGradient(0,l,0,2*e.yAxis.bottom-l);return c.addColorStop(0,o),c.addColorStop(1,h),c}return h},i.Renderer.OHLC.prototype.drawIndividualSeries=function(t,e){if(!e.invalid){var a=this.stx,r=(t.context,e.colorFunction),n=a.panels[e.panel]||t.panel;if("string"!=typeof r||(r=i.Renderer.colorFunctions[r])){var s=a.layout.candleWidth-t.tmpWidth<=2&&t.tmpWidth<=3;t.state.chartType||(t.state.chartType={});var o=t.state.chartType.pass={},l=a.colorByCandleDirection;e.colorBasis&&(l="open"==e.colorBasis);var h=e.histogram,c=e.type,u=e.hollow,p=a.noWicksOnCandles[c];a.startClip(n.name);var d=null,m={colors:[],cache:[]},g=[];if(r){var f={isHistogram:h,field:e.field,yAxis:e.yAxis,volume:e.volume,overlayScaling:e.overlayScaling,highlight:e.highlight};h||"bar"!=c?("candle"!=c||p||a.drawShadows(n,r,f),m=a.drawCandles(n,r,f),f.isOutline=!0,!u&&s||a.drawCandles(n,r,f)):(f.type=e.hlc?"hlc":"bar",m=a.drawBarChart(n,"stx_bar_chart",r,f))}else for(var y=h&&!1!==e.gradient,v=[{type:"histogram",drawType:"histogram",style:"stx_histogram_up",condition:8,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0,useBorderStyleProp:!0},{type:"histogram",drawType:"histogram",style:"stx_histogram_down",condition:16,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0,useBorderStyleProp:!0},{type:"histogram",drawType:"histogram",style:"stx_histogram_even",condition:32,fill:"fill_color_even",border:"border_color_even",skipIfPass:!0,useColorInMap:!0,useBorderStyleProp:!0},{type:"bar",drawType:"bar",style:e.style||"stx_bar_chart",border:"border_color",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_up",condition:l?8:1,border:"border_color_up",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_down",condition:l?16:2,border:"border_color_down",useColorInMap:!0},{type:"bar",drawType:"bar",style:"stx_bar_even",condition:l?32:4,border:"border_color_even",skipIfPass:!0,useColorInMap:!0},{type:"candle",drawType:"shadow",style:"stx_candle_shadow",border:"border_color_up"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_up",condition:8,border:"border_color_up"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_down",condition:16,border:"border_color_down"},{type:"candle",drawType:"shadow",style:"stx_candle_shadow_even",condition:32,border:"border_color_even",skipIfPass:!0},{type:"candle",drawType:"candle",style:"stx_candle_up",condition:8,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0,useBorderStyleProp:!0},{type:"candle",drawType:"candle",style:"stx_candle_down",condition:16,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0,useBorderStyleProp:!0},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_up",condition:1,border:"border_color_up"},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_down",condition:2,border:"border_color_down"},{type:"hollow",drawType:"shadow",style:"stx_hollow_candle_even",condition:4,border:"border_color_even",skipIfPass:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_up",condition:17,fill:"fill_color_up",border:"border_color_up",useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_down",condition:18,fill:"fill_color_down",border:"border_color_down",useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_even",condition:20,fill:"fill_color_even",border:"border_color_even",skipIfPass:!0,useColorInMap:!0},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_up",condition:9,fill:"fill_color_up",border:"border_color_up"},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_down",condition:10,fill:"fill_color_down",border:"border_color_down"},{type:"hollow",drawType:"candle",style:"stx_hollow_candle_even",condition:12,fill:"fill_color_even",border:"border_color_even"}],x=0;x<v.length;x++){var b=v[x];if(!b.skipIfPass||o.even){if(h){if("histogram"!=b.type)continue}else if("bar"==c){if("bar"!=b.type)continue;if(e.colored&&!b.condition)continue;if(!e.colored&&b.condition)continue}else if(u){if("hollow"!=b.type)continue;if("shadow"==b.drawType&&p)continue}else{if("candle"!=c)continue;if("candle"!=b.type)continue;if("shadow"==b.drawType){if(p)continue;var C=e.border_color_up||a.getCanvasColor("stx_candle_shadow_up"),S=e.border_color_down||a.getCanvasColor("stx_candle_shadow_down"),w=e.border_color_even||a.getCanvasColor("stx_candle_shadow_even");if(i.colorsEqual(C,S)&&i.colorsEqual(C,w)&&i.colorsEqual(C,a.defaultColor)){if(b.condition)continue}else if(!b.condition)continue}}var T=a.canvasStyle(b.style),M=this.getColor(a,n,T,!1,!1,e[b.fill]),D=this.getColor(a,n,T,!1,y,e[b.fill]),E=this.getColor(a,n,T,b.useBorderStyleProp&&!s,y,e[b.border]);"candle"==b.drawType&&("hollow"==b.type?(!i.isTransparent(D)&&i.colorsEqual(E,D)&&(E=b.useColorInMap?"transparent":D),b.useColorInMap||(D=a.containerColor)):"candle"==b.type&&s&&(i.isTransparent(D)?D=E:E=D)),g.push(a.drawBarTypeChartInner({fillColor:D,borderColor:E,condition:b.condition,style:b.style,type:e.hlc?"hlc":b.drawType,panel:n,field:e.field,yAxis:e.yAxis,volume:e.volume,overlayScaling:e.overlayScaling,highlight:e.highlight})),d||(d={}),b.useColorInMap&&(d[M]=1)}}for(var A in a.endClip(),d)e.hollow&&i.equals(A,a.containerColor)||m.colors.push(A);for(A=0;A<g.length;A++)for(var k=0;k<g[A].cache.length;k++){var F=g[A].cache[k];(F||0===F)&&(m.cache[k]=F)}return m}}},i.Renderer.Bars=function(t){this.construct(t);var e=this.params;e.type="bar",this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.hlc=e.volume=e.hollow=e.histogram=!1},i.Renderer.Bars.ciqInheritsFrom(i.Renderer.OHLC,!1),i.Renderer.HLC=function(t){this.construct(t);var e=this.params;e.type="bar",e.hlc=!0,this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.volume=e.hollow=e.histogram=!1},i.Renderer.HLC.ciqInheritsFrom(i.Renderer.Bars,!1),i.Renderer.Candles=function(t){this.construct(t);var e=this.params;e.type="candle",this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.hlc=e.colored=e.histogram=!1,e.volume&&(e.hollow=!0)},i.Renderer.Candles.ciqInheritsFrom(i.Renderer.OHLC,!1),i.Renderer.SimpleHistogram=function(t){this.construct(t);var e=this.params;e.type="candle",e.histogram=!0,this.barsHaveWidth=this.standaloneBars=!0,this.highLowBars=!1,e.hlc=e.colored=e.hollow=e.volume=!1},i.Renderer.SimpleHistogram.ciqInheritsFrom(i.Renderer.Candles,!1),t},__engine_=function(t,e){var i=t.CIQ,a=t.$$,r=t.$$$,n=t.SplinePlotter,s=t.timezoneJS;return i.ChartEngine=function(t){var e;(t||(t={container:null}),t.constructor==HTMLDivElement)&&(t={container:t});(this.markers={},this.panels={},this.overlays={},this.charts={},this.eventListeners=[],this.animations={zoom:new i.EaseMachine(Math.easeOutCubic,400)},this.callbacks={studyOverlayEdit:null,studyPanelEdit:null,tap:null,rightClick:null,longhold:null,move:null,layout:null,drawing:null,preferences:null,theme:null,symbolChange:null,symbolImport:null,calculateTradingDecimalPlaces:i.calculateTradingDecimalPlaces},this.controls={},this.goneVertical=!1,this.pinchingScreen=!1,this.grabbingScreen=!1,this.grabStartX=0,this.grabStartY=0,this.grabStartScrollX=0,this.grabStartScrollY=0,this.swipe={},this.yTolerance=100,this.minimumLeftBars=1,this.grabStartCandleWidth=0,this.grabStartZoom=0,this.grabOverrideClick=!1,this.grabMode="",this.vectorsShowing=!1,this.mouseMode=!0,this.reverseMouseWheel=!1,this.mouseWheelAcceleration=!0,this.minimumCandleWidth=1,this.minimumZoomTicks=9,this.allowZoom=!0,this.allowScroll=!0,this.allowSideswipe=!0,this.allowThreeFingerTouch=!1,this.bypassRightClick={series:!1,study:!1,drawing:!1},this.anyHighlighted=!1,this.accessoryTimer=null,this.lastAccessoryUpdate=(new Date).getTime(),this.displayCrosshairs=!0,this.hrPanel=null,this.editingAnnotation=!1,this.openDialog="",this.displayIconsUpDown=!0,this.displayIconsSolo=!0,this.displayIconsClose=!0,this.displayPanelResize=!0,this.soloPanelToFullScreen=!1,this.markerDelay=0,this.useBackingStore=!0,this.disableBackingStoreDuringTouch=i.isMobile,this.manageTouchAndMouse=!0,this.captureTouchEvents=!0,this.captureMouseWheelEvents=!0,this.touches=[],this.changedTouches=[],this.crosshairTick=null,this.crosshairValue=null,this.yaxisLabelStyle="roundRectArrow",this.axisBorders=null,this.pt={x1:-1,x2:-1,y1:-1,y2:-1},this.moveA=-1,this.moveB=-1,this.touchStartTime=-1,this.gestureStartDistance=-1,this.grabStartPeriodicity=1,this.grabEndPeriodicity=-1,this.scrollEvent=null,this.cmd=!1,this.ctrl=!1,this.shift=!1,this.userPointerDown=!1,this.cloneDrawing=!1,this.singleDrawingHighlight=!0,this.crosshairXOffset=-40,this.crosshairYOffset=-40,this.displayInitialized=!1,this.cx=null,this.cy=null,this.extendLastTick=!1,this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},this.cancelTouchSingleClick=!1,this.layout={interval:"day",periodicity:1,timeUnit:null,candleWidth:8,volumeUnderlay:!1,adj:!0,crosshair:!1,chartType:"candle",extended:!1,marketSessions:{},aggregationType:"ohlc",chartScale:"linear",studies:{},panels:{},setSpan:{}},this.preferences={highlightsRadius:10,highlightsTapRadius:30,currentPriceLine:!1,magnet:!1,horizontalCrosshairField:null,labels:!0,language:null,timeZone:null,whitespace:50,zoomInSpeed:null,zoomOutSpeed:null,zoomAtCurrentMousePosition:!1},this.streamParameters={count:0,maxWait:1e3,maxTicks:100,timeout:-1,fillGaps:!0},this.translationCallback=null,this.locale=null,this.dataZone=null,this.displayZone=null,this.timeZoneOffset=0,this.changeCallback=null,this.masterData=null,this.transformDataSetPre=null,this.transformDataSetPost=null,this.dataCallback=null,this.dontRoll=!1,this.allowEquations=!0,this.drawingObjects=[],this.undoStamps=[],this.cleanupGaps=!1,this.staticRange=!1,this.maxDataSetSize=2e4,this.maxMasterDataSize=0,this.resizeDetectMS=1e3,this.xAxisAsFooter=!0,this.xaxisHeight=30,this.displayGridLinesInStudies=!1,this.escapeOnSerialize=!0,this.chart=new i.ChartEngine.Chart,this.chart.name="chart",this.chart.canvas=null,this.chart.tempCanvas=null,this.chart.container=t.container,this.chart.market=new i.Market,this.candleWidthPercent=.65,this.colorByCandleDirection=!1,this.noWicksOnCandles={renko:!0,linebreak:!0},this.fetchMaximumBars={rangebars:!0,kagi:!0,renko:!0,linebreak:!0,pandf:!0},this.mainSeriesRenderer=null,this.highLowBars={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,wave:!0,rangechannel:!0,none:!0},this.standaloneBars={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,histogram:!0,scatterplot:!0},this.barsHaveWidth={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,histogram:!0,scatterplot:!0,wave:!0},this.autoPickCandleWidth={turnOn:!1,candleWidth:5},this.staticRangePeriodicityMap=[{rangeInMS:i.WEEK,periodicity:1,interval:5,timeUnit:"minute"},{rangeInMS:i.MONTH,periodicity:1,interval:30,timeUnit:"minute"},{rangeInMS:i.YEAR,periodicity:1,interval:"day"},{rangeInMS:i.DECADE,periodicity:1,interval:"week"},{rangeInMS:10*i.DECADE,periodicity:1,interval:"month"},{rangeInMS:Number.MAX_VALUE,periodicity:12,interval:"month"}],this.dynamicRangePeriodicityMap=[{interval:1,timeUnit:"minute",rangeInMS:i.MINUTE},{interval:5,timeUnit:"minute",rangeInMS:5*i.MINUTE},{interval:30,timeUnit:"minute",rangeInMS:30*i.MINUTE},{interval:60,timeUnit:"minute",rangeInMS:60*i.MINUTE},{interval:"day",rangeInMS:i.DAY},{interval:"month",rangeInMS:i.MONTH},{interval:"year",rangeInMS:i.YEAR}],this.charts.chart=this.chart,this.styles={},this.currentVectorParameters=i.clone(i.ChartEngine.currentVectorParameters),i.extend(this,t),t.container)&&(this.registerHTMLElements(),this.chart.width=this.chart.container.clientWidth-this.chart.yAxis.width,this.setCandleWidth(this.layout.candleWidth,this.chart),this.chart.canvasHeight=this.chart.container.clientHeight,i.useOldWheelLogic&&!i.FireFoxWheelWorkaround&&(e=i.isIE?function(t){if(i.ChartEngine.insideChart){t.preventDefault();for(var e=0;e<i.ChartEngine.registeredContainers.length;e++){var a=i.ChartEngine.registeredContainers[e].stx;i.ChartEngine.crosshairX>=a.left&&i.ChartEngine.crosshairX<=a.right&&i.ChartEngine.crosshairY>=a.top&&i.ChartEngine.crosshairY<=a.bottom&&a.mouseWheel(t,"onmousewheel")}}}:function(t){i.ChartEngine.insideChart&&t.preventDefault()},this.addDomEventListener(document.body,"wheel",e),i.FireFoxWheelWorkaround=!0));this.construct()},i.ChartEngine.drawingLine=!1,i.ChartEngine.resizingPanel=null,i.ChartEngine.vectorType="",i.ChartEngine.crosshairX=0,i.ChartEngine.crosshairY=0,i.ChartEngine.insideChart=!1,i.ChartEngine.overXAxis=!1,i.ChartEngine.overYAxis=!1,i.ChartEngine.currentColor="auto",i.ChartEngine.drawingTools={},i.ChartEngine.useAnimation=!0,i.ChartEngine.ipadMaxTicks=1500,i.ChartEngine.enableCaching=!1,i.ChartEngine.ignoreTouch=!1,i.ChartEngine.useOldAndroidClear=!0,i.ChartEngine.currentVectorParameters={vectorType:null,pattern:"solid",lineWidth:1,fillColor:"#7DA6F5",currentColor:"auto",axisLabel:!0,fibonacci:{trend:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},fibs:[{level:-.786,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:-.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:-.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:0,color:"auto",parameters:{pattern:"solid",lineWidth:1},display:!0},{level:.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.786,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1,color:"auto",parameters:{pattern:"solid",lineWidth:1},display:!0},{level:1.272,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:1.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:2.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:4.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}],extendLeft:!1,printLevels:!0,printValues:!1,timezone:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}},annotation:{font:{style:null,size:null,weight:null,family:null}}},i.ChartEngine.defaultDisplayTimeZone=null,i.ChartEngine.Chart=function(){this.xAxis=new i.ChartEngine.XAxis,this.yAxis=new i.ChartEngine.YAxis,this.symbolObject={symbol:null},this.series={},this.seriesRenderers={},this.xaxis=[],this.state={},this.endPoints={},this.defaultChartStyleConfig={},this.baseline=i.clone(this.baseline)},i.ChartEngine.YAxis=function(t){for(var e in t)this[e]=t[e];this.name||(this.name=i.uniqueID())},i.ChartEngine.XAxis=function(t){for(var e in t)this[e]=t[e]},i.ChartEngine.Panel=function(t,e){this.yAxis=e||new i.ChartEngine.YAxis,this.name=t,this.state={}},i.extend(i.ChartEngine.YAxis.prototype,{high:null,low:null,shadow:null,logHigh:null,logLow:null,logShadow:null,multiplier:null,bottom:null,top:null,height:null,left:null,width:null},!0),i.ChartEngine.YAxis.prototype.maxDecimalPlaces=5,i.ChartEngine.YAxis.prototype.max=null,i.ChartEngine.YAxis.prototype.min=null,i.ChartEngine.YAxis.prototype.decimalPlaces=null,i.ChartEngine.YAxis.prototype.idealTickSizePixels=null,i.ChartEngine.YAxis.prototype.minimumPriceTick=null,i.ChartEngine.YAxis.prototype.fractional=null,i.ChartEngine.YAxis.prototype.displayBorder=!0,i.ChartEngine.YAxis.prototype.displayGridLines=!0,i.ChartEngine.YAxis.prototype.noDraw=null,i.ChartEngine.YAxis.prototype.drawCurrentPriceLabel=!0,i.ChartEngine.YAxis.prototype.drawSeriesPriceLabels=!0,i.ChartEngine.YAxis.prototype.drawPriceLabels=!0,i.ChartEngine.YAxis.prototype.goldenRatioYAxis=!0,i.ChartEngine.YAxis.prototype.yaxisLabelStyle=null,i.ChartEngine.YAxis.prototype.justifyRight=null,i.ChartEngine.YAxis.prototype.textBackground=!1,i.ChartEngine.YAxis.prototype.priceFormatter=null,i.ChartEngine.YAxis.prototype.bottomOffset=0,i.ChartEngine.YAxis.prototype.topOffset=0,i.ChartEngine.YAxis.prototype.initialMarginTop=10,i.ChartEngine.YAxis.prototype.initialMarginBottom=10,i.ChartEngine.YAxis.prototype.zoom=0,i.ChartEngine.YAxis.prototype.scroll=0,i.ChartEngine.YAxis.prototype.width=50,i.ChartEngine.YAxis.prototype.textStyle=null,i.ChartEngine.YAxis.prototype.position=null,i.ChartEngine.YAxis.defaultShadowBreaks=[[1e3,2],[5,4],[.001,8]],i.ChartEngine.YAxis.smallChartShadowBreaks=[[10,2],[1,4]],i.ChartEngine.YAxis.prototype.pretty=!0,i.ChartEngine.YAxis.prototype.increments=[1,2.5,5],i.ChartEngine.YAxis.prototype.prettySemiLog=!0,i.ChartEngine.YAxis.prototype.shadowBreaks=i.ChartEngine.YAxis.defaultShadowBreaks,i.extend(i.ChartEngine.Panel.prototype,{name:null,display:null,chart:null,yAxis:null,shareChartXAxis:null,top:null,bottom:null,height:null,percent:null},!0),i.extend(i.ChartEngine.XAxis.prototype,{formatter:null,adjustTimeZone:!0,idealTickSizePixels:null,timeUnit:null,timeUnitMultiplier:null,displayBorder:!0,displayGridLines:!0,noDraw:null,minimumLabelWidth:50,futureTicks:!0,futureTicksInterval:1},!0),i.extend(i.ChartEngine.Chart.prototype,{symbol:null,symbolObject:{symbol:null},symbolDisplay:null,series:{},seriesRenderers:{},scroll:0,standStill:0,maxTicks:0,tension:null,masterData:null,dataSet:null,scrubbed:null,dataSegment:null,segmentImage:null,baseline:{includeInDataSegment:!1,defaultLevel:null,userLevel:null,actualLevel:null},xAxis:null,xaxis:[],xaxisFactor:30,decimalPlaces:2,dynamicYAxis:!1,quoteTextLength:0,roundit:100,legendRenderer:i.drawLegend,customChart:null,yaxisPaddingRight:null,yaxisPaddingLeft:null,tickCache:{},allowScrollPast:!0,allowScrollFuture:!0,hideDrawings:!1,defaultPlotField:"Close",defaultChartStyleConfig:{},lockScroll:!1,includeOverlaysInMinMax:!0,gaplines:null,lineStyle:null,lineApproximation:!0,highLowBars:!1,standaloneBars:!1,barsHaveWidth:!1},!0),i.ChartEngine.prototype.convertToDataZone=function(t){if((t||0===t)&&this.dataZone){var e=i.convertTimeZone(t,null,this.dataZone);t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}return t},i.ChartEngine.isDailyInterval=function(t){return"day"==t||("week"==t||"month"==t)},i.ChartEngine.prototype.needDifferentData=function(t){var e=this.layout,a=i.ChartEngine.isDailyInterval(t.interval),r=i.ChartEngine.isDailyInterval(e.interval),n=!1;return this.dontRoll||!r?e.interval!=t.interval&&(n=!0):a!=r&&(n=!0),a||t.timeUnit||(t.timeUnit="minute"),r||e.timeUnit||(e.timeUnit="minute"),t.timeUnit!=e.timeUnit&&(n=!0),n},i.ChartEngine.chartShowsHighs=function(t){return console.warn("CIQ.ChartEngine.chartShowsHighs() has been deprecated. Please check one of the appropriate renderer properties instead: stxx.chart.highLowBars, stxx.chart.standaloneBars, or stxx.chart.barsHaveWidth."),1!={line:1,colored_line:1,mountain:1,colored_mountain:1,baseline_delta:1,baseline_delta_mountain:1,histogram:1,scatterplot:1,step:1,colored_step:1}[t]},i.ChartEngine.prototype.debug=function(){},i.ChartEngine.prototype.fps=function(t,e){t=t||5;var a=(new Date).getTime(),r=0,n=this;console.log("Running fps() for "+t+" seconds"),function s(){var o=((new Date).getTime()-a)/1e3;if(o>t){var l=r/o;return console.log("FPS="+l),void(e&&e(l))}n.draw(),r++,i.ChartEngine.useAnimation?requestAnimationFrame(s):setTimeout(s,0)}()},t.STXChart=i.ChartEngine,i.ChartEngine.DrawingDescriptor={name:"",render:null,intersected:null,click:null,abort:null},i.ChartEngine.prototype.prepend=function(t,e){var a,r="prepend"+t;return this instanceof i.ChartEngine?(a=this.hasOwnProperty(r)?this[r]:[],this[r]=[e].concat(a)):(a=i.ChartEngine.prototype[r]||[],i.ChartEngine.prototype[r]=[e].concat(a)),{method:r,func:e}},i.ChartEngine.prototype.append=function(t,e){var a,r="append"+t;return this instanceof i.ChartEngine?(a=this.hasOwnProperty(r)?this[r]:[],this[r]=a.concat(e)):(a=i.ChartEngine.prototype[r]||[],i.ChartEngine.prototype[r]=a.concat(e)),{method:r,func:e}},i.ChartEngine.prototype.removeInjection=function(t){var e,a=t.method;if(this instanceof i.ChartEngine){if(!this[a])return;for(e=0;e<this[a].length;e++)if(this[a][e]==t.func)return void this[a].splice(e,1)}else{if(!i.ChartEngine.prototype[a])return;for(e=0;e<i.ChartEngine.prototype[a].length;e++)if(i.ChartEngine.prototype[a][e]==t.func)return void i.ChartEngine.prototype[a].splice(e,1)}},i.ChartEngine.prototype.remove=function(t){this instanceof i.ChartEngine?(delete this["append"+t],delete this["prepend"+t]):(delete i.ChartEngine.prototype["append"+t],delete i.ChartEngine.prototype["prepend"+t])},i.ChartEngine.registeredContainers=[],i.ChartEngine.handleContextMenu=function(t){t||(t=event);for(var e=0;e<i.ChartEngine.registeredContainers.length;e++){var a=i.ChartEngine.registeredContainers[e].stx;if(a&&a.anyHighlighted)return t.preventDefault&&t.preventDefault(),!1}},i.ChartEngine.prototype.positionMarkers=function(){},i.ChartEngine.prototype.plugins={},i.ChartEngine.htmlControls={annotationSave:'<span class="stx-btn stx_annotation_save" style="display: none;">save</span>',annotationCancel:'<span class="stx-btn stx_annotation_cancel" style="display: none; margin-left:10px;">cancel</span>',mSticky:'<div id="mSticky"> <span id="mStickyInterior"></span> <span id="mStickyRightClick" class=""><span class="overlayEdit stx-btn" style="display:none"><span>&nbsp;</span></span> <span id="overlayTrashCan" class="stx-btn" style="display:none"><span>&nbsp;</span></span> <span id="mouseDeleteInstructions"><span>(</span><span id="mouseDeleteText">right-click to delete</span><span id="mouseManageText">right-click to manage</span><span>)</span></span></span></div>',crossX:'<div class="stx_crosshair stx_crosshair_x" style="display: none;"></div>',crossY:'<div class="stx_crosshair stx_crosshair_y" style="display: none;"></div>',chartControls:'<div class="stx_chart_controls" style="display: none; bottom: 22px;"><div id="chartSize"><span id="zoomOut" class="stx-zoom-out"></span><span id="zoomIn" class="stx-zoom-in"></span></div></div>',home:'<div id="home" class="stx_jump_today home" style="display:none"><span></span></div>',floatDate:'<div class="stx-float-date" style="visibility: hidden;"></div>',handleTemplate:'<div class="stx-ico-handle" style="display: none;"><span></span></div> ',iconsTemplate:'<div class="stx-panel-control"><div class="stx-panel-title"></div><div class="stx-btn-panel"><span class="stx-ico-up"></span></div><div class="stx-btn-panel"><span class="stx-ico-focus"></span></div><div class="stx-btn-panel"><span class="stx-ico-down"></span></div><div class="stx-btn-panel"><span class="stx-ico-edit"></span></div><div class="stx-btn-panel"><span class="stx-ico-close"></span></div></div>',baselineHandle:'<div class="stx-baseline-handle" style="display: none;"></div>'},i.ChartEngine.prototype.registerHTMLElements=function(){var t=this.chart.container;for(var e in i.ChartEngine.htmlControls)if(void 0===this.chart[e]&&void 0===this.controls[e]){if(!this.allowZoom&&"chartControls"==e)continue;var a=r("#"+e,t);if(a)this.chart[e]=a,this.controls[e]=a;else{var n=i.ChartEngine.htmlControls[e];if(!n)continue;var s=document.createElement("DIV");s.innerHTML=n,a=s.firstChild,t.appendChild(a),this.chart[e]=a,this.controls[e]=a,a.id=e}}var o,l,h,c=this.controls.chartControls,u=this.controls.home;if(c){var p=r("#zoomIn",c),d=r("#zoomOut",c);i.safeClickTouch(p,(l=this,function(t){l.zoomIn(t),t.stopPropagation()})),i.safeClickTouch(d,(o=this,function(t){o.zoomOut(t),t.stopPropagation()})),i.touchDevice||(this.makeModal(p),this.makeModal(d))}u&&(i.safeClickTouch(u,(h=this,function(t){h.home({animate:!0}),t.stopPropagation()})),i.touchDevice||this.makeModal(u))},i.ChartEngine.prototype.makeModal=function(t){var e=this;t.onmouseover=function(t){e.modalBegin()},t.onmouseout=function(t){e.modalEnd()}},i.ChartEngine.prototype.cloneStyle=function(t){var e={},a=!1;function r(t){return t[1].toUpperCase()}for(var n in t){var s=t[n];if("backgroundAttachment"==n&&(a=!0),a)s&&s.constructor==String&&isNaN(n)&&(e[n]=s);else if(isNaN(n)){e[n.replace(i.camelCaseRegExp,r)]=s}else{var o=t.getPropertyValue(s);if(o){for(var l=0,h=(s=s.split("-")).length,c=s[0];++l<h;)c+=s[l].charAt(0).toUpperCase()+s[l].slice(1);e[c]=o}}}return e},i.ChartEngine.prototype.canvasStyle=function(t){var e=this.styles[t];if(!e){var i=document.createElement("div");i.className=t,this.container.appendChild(i);var a=getComputedStyle(i);e=this.styles[t]=this.cloneStyle(a),this.container.removeChild(i),a||(this.styles[t]=null)}return e},i.ChartEngine.prototype.colorOrStyle=function(t){return-1!=t.indexOf("#")?t:-1!=t.indexOf("(")?t:"transparent"==t?t:this.canvasStyle(t)},i.ChartEngine.prototype.clearStyles=function(){this.styles={}},i.ChartEngine.prototype.setStyle=function(t,e,a){this.styles[t]||this.canvasStyle(t),this.styles[t]||(this.styles[t]={}),this.styles[t][i.makeCamelCase(e)]=a},i.ChartEngine.prototype.canvasFont=function(t,e){e||(e=this.chart.context);var i=this.canvasStyle(t);if(i){var a=i.fontStyle+" "+i.fontWeight+" "+i.fontSize+" "+i.fontFamily;-1==a.indexOf("undefined")?e.font=a:(this.styles[t]=null,console.log("bad css style for class "+t))}},i.ChartEngine.prototype.canvasColor=function(t,e){e||(e=this.chart.context);var i=this.canvasStyle(t);if(i){var a=i.color;a||(a=this.defaultColor),e.globalAlpha=1,e.fillStyle=a,e.strokeStyle=a;var r=i.opacity;void 0!==r&&(e.globalAlpha=r)}},i.ChartEngine.prototype.getCanvasFontSize=function(t){var e=this.canvasStyle(t).fontSize;return e||(e="12"),parseInt(i.stripPX(e),10)},i.ChartEngine.prototype.getCanvasColor=function(t){return this.canvasStyle(t).color},i.ChartEngine.hideDates=function(){return!1},i.ChartEngine.prototype.runPrepend=function(t,e,a){var r="prepend"+t,n=this.hasOwnProperty(r)?this[r]:[];if(!(n=n.concat(i.ChartEngine.prototype[r]||[])).length)return!1;a||(a=this);for(var s=0;s<n.length;s++){var o=n[s].apply(a,e);if(o)return o}return!1},i.ChartEngine.prototype.runAppend=function(t,e,a){var r="append"+t,n=this.hasOwnProperty(r)?this[r]:[];if(!(n=n.concat(i.ChartEngine.prototype[r]||[])).length)return!1;a||(a=this);for(var s=0;s<n.length;s++){var o=n[s].apply(a,e);if(o)return o}return!1},i.ChartEngine.registerDrawingTool=function(t,e){i.ChartEngine.drawingTools[t]=e},i.ChartEngine.prototype.createBlock=function(t,e,i,a,r,n){n||(n=this.chart.context),void 0!==a&&(this.canvasColor(r,n),n.fillRect(t,i,e,a),n.globalAlpha=1)},i.ChartEngine.prototype.changeOccurred=function(t){if(!this.currentlyImporting){this.changeCallback&&(console.warn("CIQ.ChartEngine.changeCallback has been deprecated. Please use addEventListener()"),this.changeCallback(this,t));var e={stx:this,symbol:this.chart.symbol,symbolObject:this.chart.symbolObject,layout:this.layout,drawings:this.drawingObjects};"layout"==t?this.dispatch("layout",e):"vector"==t?this.dispatch("drawing",e):"theme"==t?this.dispatch("theme",e):"preferences"==t&&this.dispatch("preferences",e)}},i.ChartEngine.prototype.setChartType=function(t){var e=this.layout,i=this.chart;"ohlc"!=e.aggregationType&&(e.aggregationType="ohlc",i.canvas&&this.createDataSet()),e.chartType=t,this.setMainSeriesRenderer(!0),i.defaultChartStyleConfig={type:t},this.displayInitialized&&this.draw(),this.changeOccurred("layout")},i.ChartEngine.prototype.setAggregationType=function(t){this.layout.chartType="candle";var e=this.chart;!1!==e.baseline.userLevel&&(e.baseline.userLevel=e.baseline.defaultLevel,e.panel.yAxis.scroll=i.ChartEngine.YAxis.prototype.scroll),this.layout.aggregationType=t,this.setMainSeriesRenderer(),e.canvas&&(this.createDataSet(),this.draw()),this.changeOccurred("layout")},i.ChartEngine.prototype.setChartScale=function(t){var e=this.chart,a={percent:!0,relative:!0};if(t||(t="linear"),a[t])this.setComparison(t,e,i.Comparison.initialPrice);else if(a[this.layout.chartScale]){var r=!1;for(var n in e.series)e.series[n].parameters.isComparison&&(r=!0);r||this.setComparison(!1,e)}this.layout.chartScale=t,e.canvas&&this.draw(),this.changeOccurred("layout")},i.ChartEngine.prototype.setAdjusted=function(t){this.layout.adj=t,this.chart.canvas&&(this.createDataSet(),this.draw()),this.changeOccurred("layout")},i.ChartEngine.prototype.setVolumeUnderlay=function(t){this.layout.volumeUnderlay=t,this.chart.canvas&&this.draw(),this.changeOccurred("layout")},i.ChartEngine.prototype.serializeDrawings=function(){return console.warn("CIQ.ChartEngine.serializeDrawings() has been deprecated. Please use exportDrawings()"),this.exportDrawings()},i.ChartEngine.prototype.exportDrawings=function(){for(var t=[],e=0;e<this.drawingObjects.length;e++)t.push(this.drawingObjects[e].serialize());return t},i.ChartEngine.prototype.abortDrawings=function(){for(var t=0;t<this.drawingObjects.length;t++)this.drawingObjects[t].abort(!0);this.drawingObjects=[]},i.ChartEngine.prototype.reconstructDrawings=function(t){console.warn("CIQ.ChartEngine.reconstructDrawings() has been deprecated. Please use importDrawings()"),this.importDrawings(t)},i.ChartEngine.prototype.importDrawings=function(t){if(i.Drawing)for(var e=0;e<t.length;e++){var a=t[e];"fibonacci"==a.name&&(a.name="retracement");var r=i.ChartEngine.drawingTools[a.name];if(r||i.Drawing[a.name]&&(r=i.Drawing[a.name],i.ChartEngine.registerDrawingTool(a.name,r)),r){var n=new r;n.reconstruct(this,a),this.drawingObjects.push(n)}}},i.ChartEngine.prototype.clearDrawings=function(t){var e=i.shallowClone(this.drawingObjects);this.abortDrawings(),t?this.undoStamps=[]:this.undoStamp(e,i.shallowClone(this.drawingObjects)),this.changeOccurred("vector"),this.cancelTouchSingleClick=!0,i.clearCanvas(this.chart.tempCanvas,this),this.draw();var a=this.controls.mSticky;a&&(a.style.display="none",a.children[0].innerHTML="")},i.ChartEngine.prototype.createDrawing=function(t,e){if(i.Drawing){var a=new i.Drawing[t];a.reconstruct(this,e);var r=new i.Drawing[t];for(var n in r.stx=this,r.copyConfig(),r)a[n]=a[n]||r[n];return this.drawingObjects.push(a),this.draw(),a}},i.ChartEngine.prototype.removeDrawing=function(t){for(var e=0;e<this.drawingObjects.length;e++)if(this.drawingObjects[e]==t)return this.drawingObjects.splice(e,1),this.changeOccurred("vector"),void this.draw()},i.ChartEngine.prototype.dateFromTick=function(t,e,a){e||(e=this.chart);var r,n,s=e.dataSet.length,o=!1;return 0===s&&(e.dataSet[0]={},e.dataSet[0].DT=new Date,s=e.dataSet.length,o=!0),r=t<0?this.standardMarketIterator(e.dataSet[0].DT).previous(Math.abs(t)):t>=s?this.standardMarketIterator(e.dataSet[s-1].DT).next(t-(s-1)):e.dataSet[t].DT,n=a?new Date(r.getTime()):i.yyyymmddhhmm(r),o&&delete e.dataSet[0].DT,n},i.ChartEngine.prototype.calculateYAxisMargins=function(t){t.zoom=t.initialMarginTop+t.initialMarginBottom,t.scroll=(t.initialMarginTop-t.initialMarginBottom)/2,t.zoom>t.height&&(t.zoom=0,t.scroll=0)},i.ChartEngine.prototype.getLabelOffsetInPixels=function(t,e){var i=!(this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[e]);if(!("roundRectArrow"!=this.yaxisLabelStyle||i&&this.extendLastTick&&0!==t.yaxisPaddingRight)){return.66*(this.getCanvasFontSize("stx_yaxis")+6)}return 0},i.ChartEngine.prototype.home=function(t){this.swipe.amplitude=0;var e=this.layout;function i(t){for(var e in t.panels)for(var i=t.panels[e].yaxisLHS.concat(t.panels[e].yaxisRHS),a=0;a<i.length;a++)t.calculateYAxisMargins(i[a])}function a(t,e,a){return function(){i(t),e.scroll=a,t.draw()}}if("object"!=typeof t&&(t={maintainWhitespace:t}),void 0===t.maintainWhitespace&&(t.maintainWhitespace=!0),this.cancelTouchSingleClick=!0,this.chart.dataSet&&this.chart.dataSet.length){this.micropixels=0;var r=Math.floor(this.chart.width/e.candleWidth);for(var n in this.charts){var s=this.charts[n];if(!t.chart||t.chart==s){var o=0;t.maintainWhitespace&&this.preferences.whitespace>=0&&(o=this.preferences.whitespace),(t.whitespace||0===t.whitespace)&&(o=t.whitespace);var l=this.getLabelOffsetInPixels(s,e.chartType);l>o&&(o=l);var h=Math.min(r,s.dataSet.length);for(this.chart.allowScrollPast&&(h=r),this.micropixels=this.chart.width-h*e.candleWidth-o,this.preferences.whitespace=o;this.micropixels>e.candleWidth;)h++,this.micropixels-=e.candleWidth;for(;this.micropixels<0;)h--,this.micropixels+=e.candleWidth;if(this.micropixels-=e.candleWidth,h++,this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[e.chartType]||(this.micropixels+=e.candleWidth/2),t.animate){this.scrollTo(s,h,a(this,s,h))}else s.scroll=h,i(this)}}this.draw()}else this.draw()},i.ChartEngine.prototype.isHome=function(){var t=this.chart,e=t.dataSet,i=t.animatingHorizontalScroll;return this.pixelFromTick(e.length-(i?2:1),t)<t.width+t.panel.left},i.ChartEngine.prototype.tickFromDate=function(t,e,a,r){if(e||(e=this.chart),!e.dataSet||!e.dataSet.length)return 0;a||(a=0),e||(e=this.chart);var n=t.constructor==Date?t:i.strToDateTime(t);i.ChartEngine.isDailyInterval(this.layout.interval)||n.setMinutes(n.getMinutes()+a);var s=n.getTime(),o=e.tickCache[s];if(o||0===o)return o;var l=e.dataSet[0].DT,h=e.dataSet[e.dataSet.length-1].DT;if(n>=l&&n<=h){for(var c=0,u=e.dataSet.length,p=0;++p<100;){var d=Math.floor((u+c)/2),m=e.dataSet[d].DT;if(+m==+n)return e.tickCache[s]=d,d;if(m<n&&(c=d),m>n){if(e.dataSet[d-1].DT<n)return e.tickCache[s]=r?d:d-1,e.tickCache[s];if(+e.dataSet[d-1].DT==+n)return e.tickCache[s]=d-1,d-1;u=d}}if(p>=100)return console.log("!!!Warning: tickFromDate() did not find match."),e.dataSet.length}var g=n<l,f=g?l:h,y=this.standardMarketIterator(f).futureTick({end:n});return o=g?-1*y:e.dataSet.length-1+y,r&&g&&o++,r||g||o--,e.tickCache[s]=o,o},i.ChartEngine.XAxisLabel=function(t,e,i){this.hz=t,this.grid=e,this.text=i},i.ChartEngine.prototype.createXAxis=function(t){if(t.dataSegment.length<=0)return null;if(i.ChartEngine.hideDates())return null;var e=[t],a=this.runPrepend("createXAxis",e);return a||(a=this.createTickXAxisWithDates(t),this.headsUpHR(),this.runAppend("createXAxis",e),a)},i.ChartEngine.prototype.adjustYAxisHeightOffset=function(t,e){var i=e.topOffset,a=e.bottomOffset;i+a>t.height&&(console.log("The sum of yAxis.topOffset and yAxis.bottomOffset cannot be greater than the panel height. Both values will be reset to 0."),e.bottomOffset=0,e.topOffset=0),this.xaxisHeight||0===this.xaxisHeight||(this.xaxisHeight=this.getCanvasFontSize("stx_xaxis")+4,(this.chart.xAxis.displayBorder||this.axisBorders)&&(this.xaxisHeight+=3)),(this.xAxisAsFooter&&t.bottom>this.chart.canvasHeight-this.xaxisHeight||!this.xAxisAsFooter&&t==this.chart.panel)&&(a+=this.xaxisHeight),e.top=t.top+i,e.bottom=t.bottom-a},i.ChartEngine.prototype.plotYAxisGrid=function(t){if(!this.runPrepend("plotYAxisGrid",arguments)){var e=this.chart.context;t.yAxis.yAxisPlotter&&t.yAxis.yAxisPlotter.draw(e,"grid"),this.runAppend("plotYAxisGrid",arguments)}},i.ChartEngine.prototype.plotYAxisText=function(t){if(!this.runPrepend("plotYAxisText",arguments)){for(var e=t.yaxisLHS.concat(t.yaxisRHS),i=0;i<e.length;i++){var a=e[i];if(a.yAxisPlotter&&(!a.noDraw&&a.width)){this.canvasFont("stx_yaxis"),this.canvasColor("stx_yaxis");var r=this.chart.context;r.textBaseline="middle",a.justifyRight?r.textAlign="right":r.textAlign="left",a.yAxisPlotter.draw(r,"text"),r.textBaseline="alphabetic",r.textAlign="left"}}this.runAppend("plotYAxisText",arguments)}},i.ChartEngine.prototype.decimalPlacesFromPriceTick=function(t){return t<1e-4?8:t<.01?4:t<.1?2:t<1?1:0},i.ChartEngine.prototype.formatYAxisPrice=function(t,e,a,r){if(null==t||isNaN(t))return"";var n=r||e.yAxis,s=a;s||0===s||(s=n.printDecimalPlaces),s||0===s||(s=this.decimalPlacesFromPriceTick(n.priceTick));var o=n==e.chart.yAxis?2e4:1e3;if(n.priceTick>=o)return i.condenseInt(t);var l=this.internationalizer;if(l){var h=l.priceFormatters.length;s>=h&&(s=h-1),t=l.priceFormatters[s].format(t)}else t=t.toFixed(s);return t},i.ChartEngine.prototype.padOutPrice=function(t,e){if(0!==t&&(!t||"number"!=typeof t))return"";e||0===e||(e=t);var i=""+e,a=i.substring(i.indexOf(".")).length-1;a=e>=1e3?Math.max(a,0):e<2?Math.max(a,4):Math.max(a,2);var r=this.internationalizer;if(r){var n=r.priceFormatters.length;a>=n&&(a=n-1),t=r.priceFormatters[a].format(t)}else t=t.toFixed(a);return t},i.ChartEngine.prototype.formatPrice=function(t,e){if(0!==t&&(!t||void 0===t))return"";if(e||(e=this.currentPanel),e||(e=this.chart.panel),!e)return t;var i=e.decimalPlaces;if(i||0===i||(i=e.chart.decimalPlaces),!i&&0!==i)return t;var a=this.internationalizer;if(a){var r=a.priceFormatters.length;i>=r&&(i=r-1),t=a.priceFormatters[i].format(t)}else t=t.toFixed(i);return t},i.ChartEngine.prototype.createCrosshairs=function(){if(!this.runPrepend("createCrosshairs",arguments)&&this.manageTouchAndMouse){var t=this.controls.crossX,e=this.controls.crossY;t&&(t.onmousedown||(t.onmousedown=function(t){return t||(t=event),t.preventDefault&&t.preventDefault(),!1})),e&&(e.onmousedown||(e.onmousedown=function(t){return t||(t=event),t.preventDefault&&t.preventDefault(),!1})),this.runAppend("createCrosshairs",arguments)}},i.ChartEngine.prototype.determineMinMax=function(t,e,a,r,n){var s=-1*Number.MAX_VALUE,o=Number.MAX_VALUE,l=!1,h=t.length;n&&(h=n);for(var c=0;c<=h+1;c++){var u;if(e.length&&(u=c==h?this.getPreviousBar(this.chart,e[0],0):c==h+1?this.getNextBar(this.chart,e[0],h-1):t[c]),u){if(!r)if(u.transform)l=!0,u=u.transform;else if(l)continue;for(var p=0,d=0;d<e.length;d++){var m=i.existsInObjectChain(u,e[d]);if(m){var g=m.obj[m.member];"number"==typeof g&&(g=[g]);for(var f=0;f<g.length;f++){var y=g[f];(y||0===y)&&(a?((p+=y)>s&&(s=p),p<o&&(o=p)):(y>s&&(s=y),y<o&&(o=y)))}}}}}return s==-1*Number.MAX_VALUE&&(s=0),o==Number.MAX_VALUE&&(o=0),[o,s]},i.ChartEngine.prototype.calculateYAxisRange=function(t,e,i,a){i==Number.MAX_VALUE&&(i=0,a=0);var r=t.height,n=null,s=null;this.adjustYAxisHeightOffset(t,e),e.height=e.bottom-e.top;var o=Math.round(Math.abs(r/5));if(e.zoom>=0&&r-Math.abs(e.scroll)<o&&(e.scroll=(r-o)*(e.scroll<0?-1:1)),i||0===i){if(a-i==0){var l=Math.pow(10,-(i.toString()+".").split(".")[1].length);1==l&&(l=100),n=i+l,s=i-l}else if((this.layout.semiLog||"log"==this.layout.chartScale)&&n){var h=Math.log(i)/Math.LN10,c=Math.log(a)/Math.LN10;n=Math.pow(10,c),s=Math.pow(10,h)}else n=a,s=i;e.high=n,e.low=s}if((e.max||0===e.max)&&(e.high=e.max),(e.min||0===e.min)&&(e.low=e.min),e.shadow=e.high-e.low,t.chart.name===t.name&&t.yAxis.name===e.name){var u=this.layout.semiLog||"log"==this.layout.chartScale;(t.chart.isComparison||"pandf"==this.layout.aggregationType)&&(u=!1),e.semiLog!=u&&(this.clearPixelCache(),e.semiLog=u)}},i.ChartEngine.prototype.renderYAxis=function(t){if(!this.runPrepend("renderYAxis",arguments)){for(var e in this.rendererAction(t,"yAxis"),this.panels){var a=this.panels[e];if(a.chart==t){var r,n,s=a.yaxisRHS.concat(a.yaxisLHS),o={};for(r=0;r<s.length;r++)n=s[r],this.calculateYAxisRange(a,n,n.lowValue,n.highValue),i.Studies&&(o=i.Studies.getYAxisParameters(this,n)),o.yAxis=n,this.createYAxis(a,o),this.drawYAxis(a,o),i.Studies&&i.Studies.doPostDrawYAxis(this,n)}}this.runAppend("renderYAxis",arguments)}},i.ChartEngine.prototype.initializeDisplay=function(t){if(!this.runPrepend("initializeDisplay",arguments)){var e,a=[],r=this,n=null,s=Math.floor((t.width-this.micropixels)/this.layout.candleWidth);t.scroll>t.maxTicks&&t.maxTicks>s+1&&(n=t.dataSegment.length-1);var o=[];for(var l in this.panels){var h=this.panels[l];o=h.yaxisLHS.concat(h.yaxisRHS);for(var c=0;c<o.length;c++){var u=o[c];a=[];var p=t.transformFunc&&u==t.panel.yAxis;if(y(u,null,h),e=this.determineMinMax(t.dataSegment,a,null,!p,n),this.mainSeriesRenderer&&!this.mainSeriesRenderer.highLowBars||!this.highLowBars[this.layout.chartType]){var d=this.mainSeriesRenderer||{};if(t.panel==h&&d.params&&d.params.baseline&&"mountain"!=d.params.type){var m=t.baseline.actualLevel;if(m||0===m){p&&(m=t.transformFunc(this,t,m));var g=Math.max(m-e[0],e[1]-m);this.repositioningBaseline?e=[t.lowValue,t.highValue]:(e[0]=m-g,e[1]=m+g)}}}u.lowValue=e[0],u.highValue=e[1],u==t.panel.yAxis&&(t.lowValue=u.lowValue,t.highValue=u.highValue)}}var f=t.state.aggregation;f&&f.box&&(t.lowValue-=f.box/2,t.highValue+=f.box/2),this.runAppend("initializeDisplay",arguments)}function y(e,n,s){var o=!1,l=r.layout&&r.layout.studies&&r.layout.studies[e.name];if(l){for(var h in l.outputMap)a.push(h);l.study&&l.study.renderer&&(a=a.concat(i.createObjectChainNames(h,["Close","Open","High","Low"])));for(var c=0;c<=2;c++)a.push(l.name+"_hist"+(c||""));o=!0}else n&&(a=a.concat(n));if(s){var u=[];for(var p in t.seriesRenderers){var d=t.seriesRenderers[p],m=d.params,g=m.panel;if((m.yAxis||!r.panels[g]||r.panels[g].yAxis)==e){u=d.highLowBars?["Close","Open","High","Low"]:[t.defaultPlotField||"Close"];for(var f=0;f<d.seriesParams.length;f++){var v=d.seriesParams[f];v.symbol?a=a.concat(i.createObjectChainNames(v.symbol,u)):v.field?a.push(v.field):a=a.concat(u)}}}if(e==t.panel.yAxis||o||a.splice(0,u.length),t.includeOverlaysInMinMax)for(var x in r.overlays){var b=r.overlays[x];if(b.panel==s.name)(r.getYAxisByName(b.panel,b.name)||s.yAxis)==e&&y({name:b.name})}}}},i.ChartEngine.prototype.computePosition=function(t,e){return void 0===e&&(e=0),t*this.layout.candleWidth+e+this.micropixels},i.ChartEngine.prototype.computeColor=function(t,e){return t<e?"stx_candle_up":t>e?"stx_candle_down":"stx_candle_shadow"},i.ChartEngine.prototype.computeLength=function(t,e){var i=this.pixelFromPrice(t);return this.pixelFromPrice(e)-i},i.ChartEngine.prototype.setSeriesRenderer=function(t){var e=t.params;return this.chart.seriesRenderers[e.name]?this.chart.seriesRenderers[e.name]:(e.yAxis&&(e.yAxis=this.addYAxis(this.panels[e.panel],e.yAxis)),t.stx=this,this.chart.seriesRenderers[e.name]=t,t)},i.ChartEngine.prototype.setMainSeriesRenderer=function(t){var e=this.layout.chartType,a=this.layout.aggregationType,r=this.chart.customChart,n=this.mainSeriesRenderer;n&&(n.removeAllSeries(t),this.removeSeriesRenderer(n),n=this.mainSeriesRenderer=null);var s={panel:this.chart.panel.name,name:"_main_series",highlightable:!1,useChartLegend:!0};if(r&&r.chartType&&(e=r.chartType),"none"!=e){a&&"ohlc"!=a&&(e=a);var o=i.Renderer.produce(e,s);o&&(this.setSeriesRenderer(o).attachSeries(null,{display:this.chart.symbol}),this.mainSeriesRenderer=o),["highLowBars","standaloneBars","barsHaveWidth"].forEach(function(t){this.chart[t]=this.mainSeriesRenderer&&this.mainSeriesRenderer[t]}.bind(this))}},i.ChartEngine.prototype.setMarket=function(t,e){for(var a in e||(e=this.chart),e.market=new i.Market(t),this.layout.marketSessions)e.market.disableSession(a,this.layout.marketSessions[a])},i.ChartEngine.prototype.setMarketFactory=function(t){this.marketFactory=t},i.ChartEngine.prototype.removeSeriesRenderer=function(t){for(var e in this.chart.seriesRenderers)if(t.params.name===this.chart.seriesRenderers[e].params.name){var i=this.chart.seriesRenderers[t.params.name],a=i.params.yAxis,r=this.panels[i.params.panel];return delete this.chart.seriesRenderers[t.params.name],void this.deleteYAxisIfUnused(r,a)}},i.ChartEngine.prototype.getSeriesRenderer=function(t){return this.chart.seriesRenderers[t]},i.ChartEngine.prototype.startClip=function(t,e){t||(t="chart");var i=this.panels[t],a=i.yAxis;this.chart.context.save(),this.chart.context.beginPath();var r=i.left,n=i.width;e?(r=0,n=this.width):i.yaxisLHS&&i.yaxisLHS.length&&(r++,n--),this.chart.context.rect(r,a.top,n,a.height),this.chart.context.clip()},i.ChartEngine.prototype.endClip=function(){this.chart.context.restore()},i.ChartEngine.prototype.setLineStyle=function(t,e){var a={};t&&"object"==typeof t?a=t:a.color=t,a.color||a.pattern||a.width||(a=null),e||(e=this.chart);var r=1;a&&a.width&&(r=a.width),a&&a.pattern&&(a.pattern=i.borderPatternToArray(r,a.pattern)),e.lineStyle=a},i.ChartEngine.prototype.setGapLines=function(t,e){var a={};t&&"object"==typeof t?a=t:a.color=t,a.color||a.pattern||a.fillMountain||(a=null),e||(e=this.chart),a&&a.pattern&&(a.pattern=i.borderPatternToArray(a.pattern)),a&&a.width<=0&&(a.width=null),e.gaplines=a},i.ChartEngine.prototype.getGapColorFunction=function(t,e,i,a,r){return"object"!=typeof i&&(i={color:i}),function(n,s,o){var l=r?r(n,s,o):i.color;l.color&&(l=l.color);var h=s[t];return h||0===h||(h=s[e]),o||!h&&0!==h?a?("object"!=typeof a&&(a="string"==typeof a?{color:a}:{}),{color:a.color||l,pattern:a.pattern||i.pattern,width:a.width||i.width}):null:{color:l,pattern:i.pattern,width:i.width}}},i.ChartEngine.prototype.drawLineChart=function(t,e,a,r){var n=a,s=this.chart,o=s.context,l=s.lineStyle||{},h=this.canvasStyle(e);r||(r={}),this.startClip(t.name);var c=r.width||l.width||h.width;c&&parseInt(c,10)<=25?o.lineWidth=Math.max(1,i.stripPX(c)):o.lineWidth=1,r.pattern=r.pattern||l.pattern||h.borderTopStyle,r.pattern=i.borderPatternToArray(o.lineWidth,r.pattern),this.canvasColor(e);var u=r.color||l.color;u&&(o.strokeStyle=u),r.skipProjections=!0;var p=r.field||s.defaultPlotField,d=r.subField||s.defaultPlotField||"Close",m=r.gapDisplayStyle;m||!1===m||(m=r.gaps),m||!1===m||(m=s.gaplines),m&&(n=this.getGapColorFunction(p,d,{color:o.strokeStyle,pattern:r.pattern,width:o.lineWidth},m,a)),t.chart.tension&&(r.tension=t.chart.tension);var g=this.plotDataSegmentAsLine(p,t,r,n);return g.colors.length||g.colors.push(o.strokeStyle),o.lineWidth=1,this.endClip(),r.returnObject?g:g.colors},i.ChartEngine.prototype.getPreviousBar=function(t,e,i){return this.getNextBarInternal(t,e,i,-1)},i.ChartEngine.prototype.getNextBar=function(t,e,i){return this.getNextBarInternal(t,e,i,1)},i.ChartEngine.prototype.getNextBarInternal=function(t,e,a,r){var n=t.dataSegment&&t.dataSegment[a];if(n)for(var s=n.tick;s>0&&s<t.dataSet.length;){s+=r;var o=t.dataSet[s];if(o){var l=i.existsInObjectChain(o,e);if(l&&l.obj[l.member])return o}}return null},i.ChartEngine.prototype.getFirstLastDataRecord=function(t,e,i){for(var a=i?t.length-1:0;a>=0&&a<t.length;){if(t[a]&&void 0!==t[a][e])return t[a];i?a--:a++}return null},i.ChartEngine.prototype.updateFloatHRLabel=function(t){var e=t.yaxisLHS.concat(t.yaxisRHS),a=this.crossYActualPos?this.crossYActualPos:this.cy;if(this.floatCanvas.isDirty&&i.clearCanvas(this.floatCanvas,this),!this.controls.crossX||"none"!=this.controls.crossX.style.display){if(this.controls.crossY){var r=t.width;"roundRectArrow"==this.yaxisLabelStyle&&(r-=7),this.controls.crossY.style.left=t.left+"px",this.controls.crossY.style.width=r+"px"}for(var n=0;n<e.length;n++){var s=e[n],o=this.transformedPriceFromPixel(a,t,s);if(!isNaN(o)&&!((s.min||0===s.min)&&o<s.min||(s.max||0===s.max)&&o>s.max)){var l=null;s!==t.chart.yAxis&&(l=this.decimalPlacesFromPriceTick(s.priceTick),(s.decimalPlaces||0===s.decimalPlaces)&&(l=s.decimalPlaces)),o=s.priceFormatter?s.priceFormatter(this,t,o,l):this.formatYAxisPrice(o,t,l,s);var h=this.canvasStyle("stx-float-price");this.createYAxisLabel(t,o,a,h.backgroundColor,h.color,this.floatCanvas.context,s),this.floatCanvas.isDirty=!0}}}},i.ChartEngine.prototype.headsUpHR=function(){if(!this.runPrepend("headsUpHR",arguments)){var t=this.currentPanel;if(t){var e=t.chart;this.updateFloatHRLabel(t);var a=this.controls.floatDate;if(a&&!i.ChartEngine.hideDates()){var r=this.barFromPixel(this.cx),n=e.xaxis[r];n&&n.DT?s(i.displayableDate(this,e,n.DT)):n&&n.index?s(n.index):s("")}this.runAppend("headsUpHR",arguments)}}function s(t){i.efficientDOMUpdate(a,"innerHTML",t)}},i.ChartEngine.prototype.setCrosshairColors=function(){},i.ChartEngine.prototype.magnetize=function(){if(this.magnetizedPrice=null,!this.runPrepend("magnetize",arguments)&&!this.repositioningDrawing){var t=this.currentVectorParameters.vectorType;if(("annotation"!=t&&"callout"!=t||!i.ChartEngine.drawingLine)&&"projection"!=t&&"freeform"!=t){var e=this.currentPanel;if(e.name==e.chart.name){var a=e.chart,r=this.tickFromPixel(i.ChartEngine.crosshairX-this.left,a);if(r>a.dataSet.length)return;var n=a.dataSet[r];if(!n)return;var s=this.valueFromPixel(this.cy,e);if(this.magnetizedPrice=n.Close,this.mainSeriesRenderer&&this.mainSeriesRenderer.highLowBars||this.highLowBars[this.layout.chartType])for(var o=["Open","High","Low","Close"],l=1e9,h=0;h<o.length;h++){var c=n[o[h]];Math.abs(s-c)<l&&(l=Math.abs(s-c),this.magnetizedPrice=c)}var u=this.pixelFromTick(r,a),p=this.pixelFromPrice(this.magnetizedPrice,this.currentPanel),d=this.chart.tempCanvas.context;d.beginPath(),d.lineWidth=1;var m=Math.max(this.layout.candleWidth,12)/3;d.arc(u,p,Math.min(m,8),0,2*Math.PI,!1),d.fillStyle="#FFFFFF",d.strokeStyle="#000000",d.fill(),d.stroke(),d.closePath(),this.chart.tempCanvas.style.display="block"}this.runAppend("magnetize",arguments)}}},i.ChartEngine.prototype.positionCrosshairsAtPointer=function(){var t=this.currentPanel;if(t&&this.manageTouchAndMouse&&!this.runPrepend("positionCrosshairsAtPointer",arguments)){var e=t.chart,a=this.container.getBoundingClientRect();this.top=a.top,this.left=a.left,this.right=this.left+this.width,this.bottom=this.top+this.height,this.cy=this.crossYActualPos=this.backOutY(i.ChartEngine.crosshairY),this.cx=this.backOutX(i.ChartEngine.crosshairX);var r=this.crosshairTick=this.tickFromPixel(this.cx,e),n=this.pixelFromTick(r,e)-1;if(this.controls.crossX&&(this.controls.crossX.style.left=n+"px"),n>=t.right||n<=t.left)this.undisplayCrosshairs();else{var s="chart"==t.name?this.preferences.horizontalCrosshairField:t.horizontalCrosshairField,o=e.dataSet;s&&o&&r<o.length&&r>-1&&(this.crossYActualPos=this.pixelFromPrice(o[r][s],t)),this.controls.crossY&&(this.controls.crossY.style.top=this.crossYActualPos+"px"),this.runAppend("positionCrosshairsAtPointer",arguments)}}},i.ChartEngine.prototype.doDisplayCrosshairs=function(){if(!this.runPrepend("doDisplayCrosshairs",arguments)){if(this.displayInitialized){var t=this.floatCanvas,e=this.currentVectorParameters.vectorType;if(this.layout.crosshair||""!==e&&e)if(i.Drawing&&i.Drawing[e]&&(new i.Drawing[e]).dragToDraw)this.undisplayCrosshairs();else if(this.overXAxis||this.overYAxis||!i.ChartEngine.insideChart&&!this.grabbingScreen)this.undisplayCrosshairs();else if(""!==this.openDialog)this.undisplayCrosshairs();else{var a=this.controls,r=a.crossX,n=a.crossY;r&&""!==r.style.display&&(r.style.display="",n&&(n.style.display=""),this.preferences.magnet&&e?(i.unappendClassName(this.container,"stx-crosshair-on"),this.chart.tempCanvas.style.display="block"):i.appendClassName(this.container,"stx-crosshair-on")),a.floatDate&&!i.ChartEngine.hideDates()&&(a.floatDate.style.visibility="",this.currentPanel&&this.updateFloatHRLabel(this.currentPanel)),t&&(t.style.display="block")}else this.undisplayCrosshairs()}this.runAppend("doDisplayCrosshairs",arguments)}},i.ChartEngine.prototype.undisplayCrosshairs=function(){if(!this.runPrepend("undisplayCrosshairs",arguments)){var t=this.controls,e=t.crossX,a=t.crossY;e&&"none"!=e.style.display&&(e.style.display="none",a&&(a.style.display="none")),this.displayInitialized&&t.floatDate&&(t.floatDate.style.visibility="hidden"),i.unappendClassName(this.container,"stx-crosshair-on");var r=this.floatCanvas;if(r&&r.isDirty&&(i.clearCanvas(r,this),"none"!=r.style.display&&(r.style.display="none")),!this.activeDrawing&&!this.repositioningDrawing&&!this.editingAnnotation){var n=this.chart.tempCanvas;n&&"none"!=n.style.display&&(n.style.display="none")}this.runAppend("undisplayCrosshairs",arguments)}},i.ChartEngine.prototype.modalBegin=function(){this.openDialog="modal",this.undisplayCrosshairs()},i.ChartEngine.prototype.modalEnd=function(){this.cancelTouchSingleClick=!0,this.openDialog="",this.doDisplayCrosshairs()},i.ChartEngine.prototype.updateChartAccessories=function(){var t;if(null!==this.accessoryTimer&&clearTimeout(this.accessoryTimer),!i.ChartEngine.drawingLine&&i.touchDevice&&(new Date).getTime()-this.lastAccessoryUpdate<100)this.accessoryTimer=setTimeout((t=this,function(){t.updateChartAccessories()}),10);else if(this.chart.dataSet&&!this.runPrepend("updateChartAccessories",arguments)){this.positionCrosshairsAtPointer(),this.accessoryTimer=null,this.lastAccessoryUpdate=(new Date).getTime();var e=this.controls.floatDate;if(e){var a=this.currentPanel;if(a||(a=this.chart.panel),a){var r=a.chart,n=!0===this.xAxisAsFooter?0:this.chart.canvasHeight-a.chart.bottom,s=e.offsetWidth/2-.5,o=this.pixelFromTick(this.crosshairTick,r)-s;o<0?o=0:o>this.width-2*s-1&&(o=this.width-2*s-1),i.efficientDOMUpdate(e.style,"left",o+"px"),i.efficientDOMUpdate(e.style,"bottom",n+"px")}}this.headsUpHR(),this.runAppend("updateChartAccessories",arguments)}},i.ChartEngine.prototype.mousemove=function(t){var e=t||event;i.ChartEngine.crosshairX=e.clientX,i.ChartEngine.crosshairY=e.clientY,this.runPrepend("mousemove",arguments)||this.displayInitialized&&""===this.openDialog&&(this.mousemoveinner(e.clientX,e.clientY),this.runAppend("mousemove",arguments))},i.ChartEngine.prototype.setResizeTimer=function(t){var e;this.resizeDetectMS=t,t?(this.resizeTimeout&&window.clearInterval(this.resizeTimeout),this.resizeTimeout=window.setInterval((e=this,function(){e.chart.canvas&&(i.isAndroid||e.chart.canvas.height==Math.floor(e.devicePixelRatio*e.chart.container.clientHeight)&&e.chart.canvas.width==Math.floor(e.devicePixelRatio*e.chart.container.clientWidth)||e.resizeChart())}),t)):(this.resizeTimeout&&window.clearInterval(this.resizeTimeout),this.resizeTimeout=null)},i.ChartEngine.prototype.whichYAxis=function(t,e){if(void 0===e&&(e=this.cx),t)for(var a=t.yaxisLHS.concat(t.yaxisRHS),r=0;r<a.length;r++){var n=a[r];if(n.left<=e&&n.left+n.width>=e)return n}return new i.ChartEngine.YAxis},i.ChartEngine.prototype.findHighlights=function(t,e){var a=this.preferences[t?"highlightsTapRadius":"highlightsRadius"];this.highlightViaTap=t;var r=this.cy,n=this.cx;if(this.anyHighlighted=!1,this.currentPanel){!this.preferences.magnet||this.activeDrawing||this.repositioningDrawing||i.clearCanvas(this.chart.tempCanvas,this),this.activeDrawing&&(e=!0);var s,o,l,h=!1,c=null,u=e?null:["","",!0,null,"drawing"],p=this.currentPanel.chart,d={x0:this.tickFromPixel(n-a,p),x1:this.tickFromPixel(n+a,p),y0:this.valueFromPixel(r-a,this.currentPanel),y1:this.valueFromPixel(r+a,this.currentPanel)};this.repositioningDrawing&&d.x1-d.x0<2?(d.x1++,d.x0--):d.x1==d.x0&&(d.x0-=.5,d.x1+=.5);for(var m=this.drawingObjects.length-1;m>=0;m--){var g=this.drawingObjects[m];if(!g.permanent&&(this.panels[g.panelName]&&(!this.repositioningDrawing||this.repositioningDrawing==g))){var f=g.highlighted,y=g.panelName==this.currentPanel.name;g.repositioner=g.intersected(this.crosshairTick,this.crosshairValue,d),y=y&&g.repositioner,!e&&y?(f?(c=g,this.anyHighlighted&&this.singleDrawingHighlight&&(g.highlighted=!1)):f!=g.highlight(!0)&&(c||(c=g),this.anyHighlighted&&this.singleDrawingHighlight&&(g.highlighted=!1),h=!0),this.anyHighlighted=!0):f!=g.highlight(!1)&&(h=!0)}}for(s in this.overlays)(o=this.overlays[s]).prev=o.highlight,o.highlight=!1;for(s in p.seriesRenderers)for(var v=p.seriesRenderers[s],x=0;x<v.seriesParams.length;x++)(l=v.seriesParams[x]).prev=l.highlight,l.highlight=!1;if(!e){var b=this.barFromPixel(n);if(b>=0&&b<p.dataSegment.length){var C;for(s in this.overlays){if((o=this.overlays[s]).panel==this.currentPanel.name)if(!1!==o.study.isHighlighted)if("function"!=typeof o.study.isHighlighted){if(p.dataSegment[b]){for(var S in o.outputMap)if(o.outputMap[S]&&L.call(this,b,d,S,this.getYAxisByName(o.panel,o.name))){o.highlight=!0,this.anyHighlighted=!0;break}if(o.highlight)break}}else o.study.isHighlighted(this,n,r)&&(o.highlight=!0,this.anyHighlighted=!0)}for(s in p.seriesRenderers){var w=p.seriesRenderers[s],T=w.params.panel;if(w.params.highlightable&&T==this.currentPanel.name)for(var M=0;M<w.seriesParams.length;M++){var D=(l=w.seriesParams[M]).field;l.symbol&&l.subField&&(D+="--\x3e"+l.subField);var E=w.params.yAxis;if(!E&&T&&(E=this.panels[T].yAxis),w.params.step&&b>0){if(!w.caches[l.id])continue;if(!(C=w.caches[l.id][b])&&0!==C)continue;var A=w.caches[l.id][b-1];((A||0===A)&&r+a>=C&&r-a<=A||r-a<=C&&r+a>=A)&&(l.highlight=!0,this.anyHighlighted=!0)}else L.call(this,b,d,D,E,w.caches[l.id])&&(l.highlight=!0,this.anyHighlighted=!0)}}}}for(s in this.overlays){if((o=this.overlays[s]).highlight){this.anyHighlighted=!0;var k=o.inputs.display||o.name;u=[k=this.translateIf(k),null,null,o.permanent,"study"],c=null}o.prev!=o.highlight&&(h=!0)}for(s in p.seriesRenderers){var F=p.seriesRenderers[s];if(F.params.highlightable)for(var _=F.params.yAxis?F.params.yAxis.textStyle:null,P=0;P<F.seriesParams.length;P++)(l=F.seriesParams[P]).highlight&&(this.anyHighlighted=!0,u=[l.display?l.display:l.symbol,l.color||_,!1,l.permanent,"series"],c=null),l.prev!=l.highlight&&(h=!0)}h&&(this.draw(),this.displaySticky.apply(this,this.anyHighlighted?u:null),this.clearMeasure(),c&&c.measure()),this.anyHighlighted||this.setMeasure()}function L(t,e,a,r,n){var s=this.chart,o=this.currentPanel;r||(r=o.yAxis);var l=a.split("--\x3e"),h=l[0],c=l[1];function u(t){if(!t)return null;var e=t[h];return e&&(e[c]||0===e[c])&&(e=e[c]),s.transformFunc&&r==s.yAxis?t.transform&&h in t.transform?((e=t.transform[h])&&(e[c]||0===e[c])&&(e=e[c]),e):s.transformFunc(this,s,e):e}c||(c="Close");var p,d,m,g,f,y=s.dataSegment[b],v=null,x=null,C=null,S=new Array(3);if(y&&n){var w;for(m=n[b],v=y.tick,(m||0===m)&&(S[0]=1),w=b-1;w>=0;w--)if(n[w]||0===n[w]){g=n[w],x=v-(b-w),S[1]=1;break}for(w=b+1;w<s.dataSegment.length;w++)if(n[w]||0===n[w]){f=n[w],C=v-(b-w),S[2]=1;break}}if(null===x&&(p=this.getPreviousBar.call(this,s,a,b))&&(x=p.tick,g=u(p)),null===C&&(d=this.getNextBar.call(this,s,a,b))&&(C=d.tick,f=u(d)),null===x&&null===C)return!1;n||(m=u(y),g=u(p),f=u(d),v=y.tick,p&&(x=p.tick),d&&(C=d.tick)),g||0===g||(g=0,x=0),f||0===f||(m||0===m?(f=m,S[2]=S[0]):(f=g,S[2]=S[1]),C=s.dataSet.length-1),m||0===m||(m=f,v=C,S[0]=S[2],0===g&&0===x&&(g=m,x=v,S[1]=S[0]));var T=this.pixelFromTransformedValue.bind(this),M=this.valueFromPixel.bind(this);return m=M(S[0]?m:T(m,o,r),o),g=M(S[1]?g:T(g,o,r),o),f=M(S[2]?f:T(f,o,r),o),!(!i.boxIntersects(e.x0,e.y0,e.x1,e.y1,x,g,v,m,"segment")&&!i.boxIntersects(e.x0,e.y0,e.x1,e.y1,v,m,C,f,"segment"))}},i.ChartEngine.prototype.positionSticky=function(t){var e=Math.max(this.cy-t.offsetHeight-60,0),i=Math.min(this.chart.canvasWidth-(this.cx-50),this.chart.canvasWidth-t.offsetWidth);t.style.top=e+"px",t.style.right=i+"px"},i.ChartEngine.prototype.displaySticky=function(t,e,a,n,s){var o=this.controls.mSticky;if(o){var l=r("#mStickyInterior",o);if(l){var h=r("#overlayTrashCan",o),c=r(".overlayEdit",o),u=r("#mouseDeleteInstructions",o);a||t?(t||(t=""),a&&!t?(l.style.backgroundColor="",l.style.color="",l.style.display="none"):e?(l.style.backgroundColor=e,l.style.color=i.chooseForegroundColor(e),l.style.display="inline-block"):(l.style.backgroundColor="",l.style.color="",l.style.display="inline-block"),l.innerHTML=t,s&&(r("#mStickyRightClick",o).className="rightclick_"+s),o.style.display="inline-block",this.positionSticky(o),n||!0===this.bypassRightClick||this.bypassRightClick[s]?this.controls.mSticky.style.display="none":this.highlightViaTap||this.touches.length?(h&&(h.style.display="inline-block"),c&&(c.style.display="inline-block"),u&&(u.style.display="none")):u&&(u.style.display="block")):(l.innerHTML="",o.style.display="none",h&&(h.style.display="none"),c&&(c.style.display="none"),u&&(u.style.display="none"))}}},i.ChartEngine.prototype.setMeasure=function(t,e,i,r,n){if(!this.runPrepend("setMeasure",arguments)){var s=a("mMeasure"),o="";if(t){var l=Math.round(Math.abs(t-e)*this.chart.roundit)/this.chart.roundit;l=l.toFixed(this.chart.yAxis.printDecimalPlaces),this.internationalizer?o+=this.internationalizer.numbers.format(l):o+=l;var h=(e-t)/t;h=Math.abs(h)>.1?Math.round(100*h):Math.abs(h)>.01?Math.round(1e3*h)/10:Math.round(1e4*h)/100,this.internationalizer?h=this.internationalizer.percent.format(h/100):h+="%",o+=" ("+h+")";var c=Math.abs(r-i);o+=" "+(c=Math.round(c)+1)+" "+this.translateIf("Bars"),s&&("measureLit"!=s.className&&(s.className="measureLit"),s.innerHTML=o)}else s&&"measureUnlit"!=s.className&&(s.className="measureUnlit"),this.anyHighlighted||""!==this.currentVectorParameters.vectorType||this.clearMeasure();this.activeDrawing||((s=this.controls.mSticky)&&(n?(s.style.display="inline-block",s.children[0].style.display="inline-block",t&&(s.children[0].innerHTML=o),this.positionSticky(s)):(s.style.display="none",s.children[0].innerHTML="")),this.runAppend("setMeasure",arguments))}},i.ChartEngine.prototype.clearMeasure=function(){var t=a("mMeasure");t&&("measureUnlit"!=t.className&&(t.className="measureUnlit"),t.innerHTML="")},i.ChartEngine.prototype.pixelFromBar=function(t,e){e||(e=this.chart);var i=0,a=this.chart.segmentImage;return i=a&&a[t]&&a[t].leftOffset?a[t].leftOffset:(t+.5)*this.layout.candleWidth,i=e.panel.left+Math.floor(i+this.micropixels)-1},i.ChartEngine.prototype.barFromPixel=function(t,e){e||(e=this.chart);var i=this.chart.segmentImage,a=this.micropixels,r=this.layout.candleWidth;if(i){var n,s,o,l=t-e.panel.left-a,h=2,c=i.length,u=Math.round(c/h),p=i[c-1].leftOffset+i[c-1].candleWidth/2;if(l>p)return c+Math.floor((t-p-e.panel.left-a)/r);for(var d=1;d<c&&(h*=2,n=i[u]);d++){var m=(s=n.leftOffset)-(o=n.candleWidth/2);if(0===u||l>=m&&l<s+o)break;l<m?u-=Math.max(1,Math.round(c/h)):u+=Math.max(1,Math.round(c/h)),u=Math.max(0,Math.min(c-1,u))}if(!i[u])for(d=0;d<c;d++)if(n=i[d]){if(l<(s=n.leftOffset)-(o=n.candleWidth/2))return Math.max(0,d-1);if(l<s+o)return d;if(l>=s+o)return d+1}return u}return Math.floor((t-e.panel.left-a)/r)},i.ChartEngine.prototype.tickFromPixel=function(t,e){e||(e=this.chart);var i=e.dataSet.length-e.scroll;return e.segmentImage?i+=this.barFromPixel(t,e):i+=Math.floor((t-e.panel.left-this.micropixels)/this.layout.candleWidth),i},i.ChartEngine.prototype.pixelFromTick=function(t,e){e||(e=this.chart);var i=e.dataSegment,a=e.dataSet,r=e.segmentImage,n=this.micropixels,s=i?i.length:0,o=e.panel,l=e.scroll,h=t-a.length+l,c=s?i[h]:null;if(r&&(c=r[h]),c&&c.leftOffset)return o.left+Math.floor(c.leftOffset+n);var u=0,p=0;return c=s?i[s-1]:null,r&&(c=r[s-1]),c&&c.leftOffset&&s<t-a.length+l&&(u=c.leftOffset-c.candleWidth/2,p=s),u+o.left+Math.floor((t-p-a.length+l+.5)*this.layout.candleWidth+n)},i.ChartEngine.prototype.pixelFromDate=function(t,e,i,a){return this.pixelFromTick(this.tickFromDate(t,e,i,a),e)},i.ChartEngine.prototype.transformedPriceFromPixel=function(t,e,i){e||(e=this.chart.panel);var a=i||e.yAxis;if(t=a.bottom-t,!a.multiplier)return null;var r=a.low+t/a.multiplier;if(a.semiLog){var n=a.logLow+t*a.logShadow/a.height;r=Math.pow(10,n)}return r},i.ChartEngine.prototype.priceFromPixel=function(t,e,i){e||(e=this.chart.panel);var a=this.transformedPriceFromPixel(t,e,i);return this.charts[e.name]&&e.chart.untransformFunc&&(i&&i!=e.yAxis||(a=e.chart.untransformFunc(this,e.chart,a,i))),a},i.ChartEngine.prototype.valueFromPixel=function(t,e,a){return e||(e=this.whichPanel(t)),e||(e=t<=0?this.panels[i.first(this.panels)]:this.panels[i.last(this.panels)]),this.priceFromPixel(t,e,a)},i.ChartEngine.prototype.valueFromPixelUntransform=function(t,e,i){return this.valueFromPixel(t,e,i)},i.ChartEngine.prototype.pixelFromPriceTransform=function(t,e,i){return this.pixelFromPrice(t,e,i)},i.ChartEngine.prototype.pixelFromTransformedValue=function(t,e,i){e||(e=this.chart.panel);var a=i||e.yAxis,r=(a.high-t)*a.multiplier;if(a.semiLog){var n=Math.max(t,0),s=Math.log(n)/Math.LN10,o=a.height;r=o-o*(s-a.logLow)/a.logShadow}return r+=a.top},i.ChartEngine.prototype.pixelFromPrice=function(t,e,i){return e||(e=this.chart.panel),this.charts[e.name]&&e.chart.transformFunc&&(i&&i!=e.yAxis||(t=e.chart.transformFunc(this,e.chart,t,i))),this.pixelFromTransformedValue(t,e,i)},i.ChartEngine.prototype.pixelFromValueAdjusted=function(t,e,i,a){if(this.layout.adj||!this.charts[t.name])return this.pixelFromPrice(i,t,a);var r,n=Math.round(e);return n>0&&n<t.chart.dataSet.length&&(r=t.chart.dataSet[n].ratio)?this.pixelFromPrice(i*r,t,a):this.pixelFromPrice(i,t,a)},i.ChartEngine.prototype.adjustIfNecessary=function(t,e,i){if(this.layout.adj)return i;if(!t||!this.charts[t.name])return i;var a,r=Math.round(e);return r>0&&r<t.chart.dataSet.length&&(a=t.chart.dataSet[r].ratio)?i/a:i},i.ChartEngine.prototype.setTransform=function(t,e,i){t.transformFunc=e,t.untransformFunc=i},i.ChartEngine.prototype.unsetTransform=function(t){delete t.transformFunc,delete t.untransformFunc;for(var e=0;e<t.dataSet.length;e++)t.dataSet[e].transform=null},i.ChartEngine.prototype.undo=function(){this.runPrepend("undo",arguments)||(this.activeDrawing&&(this.activeDrawing.abort(),this.activateDrawing(null),i.clearCanvas(this.chart.tempCanvas,this),this.draw(),i.swapClassName(this.controls.crossX,"stx_crosshair","stx_crosshair_drawing"),i.swapClassName(this.controls.crossY,"stx_crosshair","stx_crosshair_drawing"),i.ChartEngine.drawingLine=!1),this.runAppend("undo",arguments))},i.ChartEngine.prototype.undoStamp=function(t,e){this.undoStamps.push(t),this.dispatch("undoStamp",{before:t,after:e,stx:this})},i.ChartEngine.prototype.undoLast=function(){this.activeDrawing?this.undo():this.undoStamps.length&&(this.drawingObjects=this.undoStamps.pop(),this.changeOccurred("vector"),this.draw())},i.ChartEngine.prototype.addDrawing=function(t){var e=i.shallowClone(this.drawingObjects);this.drawingObjects.push(t),this.undoStamp(e,i.shallowClone(this.drawingObjects))},i.ChartEngine.prototype.connectTheDots=function(t,e,a,r,n,s){if(s||(s={}),"none"!=s.pattern&&(!0===n&&(n=this.chart.panel),null==r&&(r=this.chart.context),!(t.length<4))){var o=0,l=this.chart.canvasHeight,h=this.chart.width;n&&(l=n.yAxis.bottom,o=n.yAxis.top),r.lineWidth=1.1,"object"==typeof e?(r.strokeStyle=e.color,e.opacity?r.globalAlpha=e.opacity:r.globalAlpha=1,r.lineWidth=parseInt(i.stripPX(e.width),10)):!e||"auto"==e||i.isTransparent(e)?r.strokeStyle=this.defaultColor:r.strokeStyle=e,s.opacity&&(r.globalAlpha=s.opacity),s.lineWidth&&(r.lineWidth=s.lineWidth);var c=i.borderPatternToArray(r.lineWidth,s.pattern);r.beginPath();for(var u=0;u<t.length-2;u+=2){var p=t[u],d=t[u+1],m=t[u+2],g=t[u+3];if(isNaN(p)||isNaN(m)||isNaN(d)||isNaN(g))return;for(var f,y,v,x=0,b=1,C=m-p,S=g-d,w=0;w<4;w++){if(0===w&&(f=-C,y=-(0-p)),1==w&&(f=C,y=h-p),2==w&&(f=-S,y=-(o-d)),3==w&&(f=S,y=l-d),v=y/f,(g||0===g)&&0===f&&y<0)return!1;if(f<0){if(v>b)return!1;v>x&&(x=v)}else if(f>0){if(v<x)return!1;v<b&&(b=v)}}var T=p+x*C,M=d+x*S,D=p+b*C,E=d+b*S;try{c&&c.length?r.dashedLineTo(T,M,D,E,c):(r.moveTo(T,M),r.lineTo(D,E))}catch(t){}}r.stroke(),r.closePath(),r.globalAlpha=1,r.lineWidth=1}},i.ChartEngine.prototype.plotSpline=function(t,e,a,r,s,o,l){if(l||(l={}),"none"!=l.pattern){!0===o&&(o=this.chart.panel),null==s&&(s=this.chart.context),s.save(),s.lineWidth=1.1,"object"==typeof a?(s.strokeStyle=a.color,a.opacity?s.globalAlpha=a.opacity:s.globalAlpha=1,s.lineWidth=parseInt(i.stripPX(a.width),10)):!a||"auto"==a||i.isTransparent(a)?s.strokeStyle=this.defaultColor:s.strokeStyle=a,l.opacity&&(s.globalAlpha=l.opacity),l.lineWidth&&(s.lineWidth=l.lineWidth);var h=i.borderPatternToArray(s.lineWidth,l.pattern);l.pattern&&s.setLineDash&&(s.setLineDash(h),s.lineDashOffset=0),s.beginPath(),n.plotSpline(t,e,s),s.stroke(),s.closePath(),s.restore()}},i.ChartEngine.prototype.repositionDrawing=function(t,e){var a=this.panels[t.panelName],r=this.adjustIfNecessary(a,this.crosshairTick,this.valueFromPixel(this.backOutY(i.ChartEngine.crosshairY),a)),n=this.chart.tempCanvas;i.clearCanvas(n,this),e?t.render(n.context):t.reposition(n.context,t.repositioner,this.crosshairTick,r),t.measure&&t.measure()},i.ChartEngine.prototype.activateRepositioning=function(t){this.repositioningDrawing=t;t&&(this.draw(),this.repositionDrawing(t,!0)),this.chart.tempCanvas.style.display=t?"block":"none"},i.ChartEngine.prototype.activateDrawing=function(t,e){if(!t)return this.activeDrawing=null,this.chart.tempCanvas.style.display="none",!1;e||(e=this.chart.panel);var a=i.ChartEngine.drawingTools[t];return a||i.Drawing[t]&&(a=i.Drawing[t],i.ChartEngine.registerDrawingTool(t,a)),a&&(this.activeDrawing=new a,this.activeDrawing.construct(this,e),!this.charts[e.name]&&this.activeDrawing.chartsOnly)?(this.activeDrawing=null,!1):(this.chart.tempCanvas.style.display="block",!0)},i.ChartEngine.prototype.drawingClick=function(t,e,a){if(i.Drawing&&t&&""===this.openDialog&&(this.activeDrawing||this.activateDrawing(this.currentVectorParameters.vectorType,t))){if(this.activeDrawing){if(this.userPointerDown&&!this.activeDrawing.dragToDraw)return void(i.ChartEngine.drawingLine||this.activateDrawing(null));var r=this.tickFromPixel(e,t.chart),n=this.panels[this.activeDrawing.panelName],s=this.adjustIfNecessary(n,r,this.valueFromPixel(a,n));return this.preferences.magnet&&this.magnetizedPrice&&(s=this.adjustIfNecessary(n,r,this.magnetizedPrice)),this.activeDrawing.click(this.chart.tempCanvas.context,r,s)?this.activeDrawing&&(i.ChartEngine.drawingLine=!1,i.clearCanvas(this.chart.tempCanvas,this),this.addDrawing(this.activeDrawing),this.activateDrawing(null),this.adjustDrawings(),this.draw(),this.changeOccurred("vector"),i.swapClassName(this.controls.crossX,"stx_crosshair","stx_crosshair_drawing"),i.swapClassName(this.controls.crossY,"stx_crosshair","stx_crosshair_drawing")):(this.changeOccurred("drawing"),i.ChartEngine.drawingLine=!0,i.swapClassName(this.controls.crossX,"stx_crosshair_drawing","stx_crosshair"),i.swapClassName(this.controls.crossY,"stx_crosshair_drawing","stx_crosshair")),!0}return!1}},i.ChartEngine.prototype.whichPanel=function(t){for(var e in this.panels){var i=this.panels[e];if(!i.hidden&&(t>i.top&&t<i.bottom))return i}return null},i.ChartEngine.prototype.mouseup=function(t){if(!this.runPrepend("mouseup",arguments)){if(this.swipe.end=!0,this.cancelLongHold=!0,this.repositioningDrawing){if(!this.currentVectorParameters.vectorType||Date.now()-this.mouseTimer>250)return this.changeOccurred("vector"),i.clearCanvas(this.chart.tempCanvas,this),this.activateRepositioning(null),this.adjustDrawings(),void this.draw();this.activateRepositioning(null)}if(this.repositioningBaseline){this.repositioningBaseline=null;var e=this.mainSeriesRenderer||{};return e.params&&e.params.baseline&&"mountain"!=e.params.type&&(this.chart.panel.yAxis.scroll=this.pixelFromPrice(this.chart.baseline.userLevel,this.chart.panel)-(this.chart.panel.yAxis.top+this.chart.panel.yAxis.bottom)/2),void this.draw()}var a=this.userPointerDown;if(this.userPointerDown=!1,this.displayInitialized)if(this.grabbingScreen=!1,""===this.openDialog){if(this.grabOverrideClick)return this.overXAxis||this.overYAxis||this.swipeRelease(),i.unappendClassName(this.container,"stx-drag-chart"),this.grabOverrideClick=!1,this.doDisplayCrosshairs(),void this.updateChartAccessories();if(i.ChartEngine.insideChart&&i.unappendClassName(this.container,"stx-drag-chart"),i.ChartEngine.resizingPanel)this.releaseHandle();else{if(t||(t=event),t.which&&t.which>=2||t.button&&t.button>=2||t.ctrlKey)return this.anyHighlighted&&!0!==this.bypassRightClick?(this.rightClickHighlighted(),t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),t.stopPropagation(),!1):(this.dispatch("rightClick",{stx:this,panel:this.currentPanel,x:n,y:r}),!0);if(!(t.clientX<this.left||t.clientX>this.right||t.clientY<this.top||t.clientY>this.bottom)){var r=this.backOutY(t.clientY),n=this.backOutX(t.clientX);!a||this.longHoldTookEffect&&!this.activeDrawing||this.drawingClick(this.currentPanel,n,r),this.activeDrawing||this.longHoldTookEffect||this.dispatch("tap",{stx:this,panel:this.currentPanel,x:n,y:r}),this.runAppend("mouseup",arguments)}}}else i.ChartEngine.insideChart&&i.unappendClassName(this.container,"stx-drag-chart")}},i.ChartEngine.prototype.grabbingHand=function(){this.allowScroll&&this.grabbingScreen&&(i.touchDevice||i.appendClassName(this.container,"stx-drag-chart"))},i.ChartEngine.prototype.mousedown=function(t){if(!this.runPrepend("mousedown",arguments)&&(this.grabOverrideClick=!1,this.displayInitialized&&this.displayCrosshairs&&!this.repositioningDrawing&&!(this.editingAnnotation||(t||(t=event),t.which&&t.which>=2||t.button&&t.button>=2)))){var e=this.container.getBoundingClientRect();if(this.top=e.top,this.left=e.left,this.right=this.left+this.width,this.bottom=this.top+this.height,t.clientX>=this.left&&t.clientX<=this.right&&t.clientY>=this.top&&t.clientY<=this.bottom){if(i.ChartEngine.insideChart=!0,this.currentPanel){this.manageTouchAndMouse&&t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),this.mouseTimer=Date.now(),this.longHoldTookEffect=!1,this.hasDragged=!1,this.userPointerDown=!0;for(var a=this.currentPanel.chart,r=0;r<this.drawingObjects.length;r++){var n=this.drawingObjects[r];if(n.highlighted){if(this.cloneDrawing){var s=new(0,i.ChartEngine.drawingTools[n.name]);return s.reconstruct(this,n.serialize()),this.drawingObjects.push(s),this.activateRepositioning(s),void(s.repositioner=n.repositioner)}var o=this.currentVectorParameters.vectorType;if(!(i.Drawing&&o&&i.Drawing[o]&&(new i.Drawing[o]).dragToDraw))return void this.activateRepositioning(n)}}var l,h=this.mainSeriesRenderer||{};if(h.params&&h.params.baseline&&!1!==a.baseline.userLevel&&this.controls.baselineHandle){var c=this.valueFromPixel(this.cy-5,this.currentPanel),u=this.valueFromPixel(this.cy+5,this.currentPanel),p=this.chart.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,10);if(a.baseline.actualLevel<c&&a.baseline.actualLevel>u&&this.cx>p)return void(this.repositioningBaseline={lastDraw:Date.now()})}if(this.drawingClick(this.currentPanel,this.cx,this.cy),!this.activeDrawing||!this.activeDrawing.dragToDraw)this.grabbingScreen=!0,a.spanLock=!1,this.yToleranceBroken=!1,t||(t=event),this.grabStartX=t.clientX,this.grabStartY=t.clientY,this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=a.scroll,this.grabStartScrollY=this.currentPanel.yAxis.scroll,this.grabStartCandleWidth=this.layout.candleWidth,this.grabStartYAxis=this.whichYAxis(this.currentPanel),this.grabStartZoom=this.grabStartYAxis.zoom,this.grabStartPanel=this.currentPanel,setTimeout((l=this,function(){l.grabbingHand()}),100),this.swipeStart(a),this.longHoldTime&&this.startLongHoldTimer(),this.runAppend("mousedown",arguments)}}else i.ChartEngine.insideChart=!1}},i.ChartEngine.prototype.startLongHoldTimer=function(){var t=this;this.cancelLongHold=!1,this.longHoldTimeout&&clearTimeout(this.longHoldTimeout),this.longHoldTimeout=setTimeout(function(){t.cancelLongHold||(t.dispatch("longhold",{stx:t,panel:t.currentPanel,x:t.cx,y:t.cy}),t.longHoldTookEffect=!0)},this.longHoldTime)},i.ChartEngine.prototype.changeVectorType=function(t){this.currentVectorParameters.vectorType=t,i.Drawing.initializeSettings(this,t),i.ChartEngine.drawingLine&&this.undo(),this.setCrosshairColors(),i.ChartEngine.insideChart&&this.doDisplayCrosshairs()},i.ChartEngine.prototype.changeVectorParameter=function(t,e){"axisLabel"==t?e="true"===e.toString()||Number(e):"lineWidth"==t?e=Number(e):"fontSize"==t&&(e=parseInt(e,10)+"px");var i=this.currentVectorParameters;return void 0!==i[t]?(i[t]=e,!0):"font"==t.substr(0,4)&&("family"==(t=t.substr(4).toLowerCase())&&"default"==e.toLowerCase()&&(e=null),void 0!==(i=i.annotation.font)[t])&&(i[t]=e,!0)},i.ChartEngine.prototype.rightClickOverlay=function(t,e){if(!this.runPrepend("rightClickOverlay",arguments)){var i=this.overlays[t];i.editFunction?i.editFunction(e):this.removeOverlay(t),this.runAppend("rightClickOverlay",arguments)}},i.ChartEngine.prototype.addOverlay=function(t){this.runPrepend("addOverlay",arguments)||(this.overlays[t.name]=t,this.runAppend("addOverlay",arguments))},i.ChartEngine.prototype.removeOverlay=function(t){if(!this.runPrepend("removeOverlay",arguments)){var e=this.overlays[t];for(var a in this.overlays){var r=this.overlays[a],n=["Field"];i.Studies&&(n=i.Studies.getFieldInputs(r));for(var s=0;s<n.length;s++)e.outputMap[r.inputs[n[s]]]&&this.removeOverlay(r.name)}if(i.Studies){var o=this.layout.studies[t];i.deleteRHS(i.Studies.studyPanelMap,o),e&&this.cleanupRemovedStudy(e)}if(e){var l=this.panels[e.panel];delete this.overlays[t],this.deleteYAxisIfUnused(l,this.getYAxisByName(l,t))}this.currentlyImporting||(this.displaySticky(),this.createDataSet(),this.changeOccurred("layout")),this.runAppend("removeOverlay",arguments)}},i.ChartEngine.prototype.addSeries=function(t,e,a){var r=this.runPrepend("addSeries",arguments);if(r)return r;var n=t||null,s=t;t||(t=i.uniqueID());var o={parameters:e?i.clone(e):{},yValueCache:[],display:n,id:t};(e=o.parameters).symbol&&(s=e.symbol),e.yAxis&&(e.yAxis=new i.ChartEngine.YAxis(e.yAxis)),i.ensureDefaults(e,{chartName:this.chart.name,symbolObject:{symbol:s},panel:this.chart.panel.name,action:"add-series"}),"display"in e&&(o.display=e.display),e.isComparison&&(e.shareYAxis=!0);var l=this.charts[e.chartName],h=e.symbolObject;s=e.symbol=h.symbol,o.display||(o.display=s||e.field),o.endPoints={},e.gapDisplayStyle||!1===e.gapDisplayStyle||(e.gapDisplayStyle=e.gaps),e.isComparison&&void 0===e.gapDisplayStyle&&(e.gapDisplayStyle="transparent");var c=this.getSeries({symbolObject:h,chart:l,includeMaster:!0});l.series[t]=o;var u=this;function p(a,r){var n=e.renderer||"Lines",s=e.name||i.uniqueID();if(e.renderer||e.name||e.color||e.chartType){var o=a.getSeriesRenderer(s);if(!o){var l={name:s,overChart:!0,useChartLegend:!0};if(e.chartType?(l=i.extend({panel:e.panel,yAxis:e.yAxis},l),o=i.Renderer.produce(e.chartType,l)):(i.ensureDefaults(e,{name:l.name,overChart:!0,useChartLegend:!0}),o=new i.Renderer[n]({params:e})),!o)return;a.setSeriesRenderer(o)}o.attachSeries(t,e),!1!==e.loadData&&o.ready()}}function d(t){return function(r){if(!r.error){var n=r.quotes;n=u.doCleanupGaps(n,u.chart,{cleanupGaps:e.fillGaps}),i.addMemberToMasterdata({stx:u,label:s,fieldForLabel:e.field,data:n,createObject:!0,noCleanupDates:!0}),p(u)}null===e.action||c.length||u.dispatch(u.currentlyImporting?"symbolImport":"symbolChange",{stx:u,symbol:t.symbol,symbolObject:t.symbolObject,action:e.action}),a&&a.call(u,r.error,o)}}e.isComparison&&this.setComparison(!0,l);var m=l.masterData;m||(m=l.masterData=this.masterData=[]);var g=m.length;if(e.data&&!e.data.useDefaultQuoteFeed)d({symbol:s,symbolObject:h,action:e.action})({quotes:e.data});else if(c.length)o.endPoints=c[0].endPoints,p(this),a&&setTimeout(function(){a.call(u,null,o)},0);else if(this.quoteDriver&&!1!==e.loadData){var f=this.quoteDriver,y=f.makeParams(s,h,l);g&&(y.startDate=m[0].DT,y.endDate=new Date),y.stx.isEquationChart(y.symbol)?i.fetchEquationChart(y,d(y)):i.ChartEngine.Driver.fetchData(i.QuoteFeed.SERIES,f.quoteFeed,y,d(y))}else p(this),a&&a.call(this,null,o);return this.runAppend("addSeries",arguments),o},i.ChartEngine.prototype.getSeries=function(t){var e=t.chart?t.chart:this.chart,a=e.series,r=t.symbolObject;r||(r={symbol:t.symbol});var n=[];for(var s in a){var o=a[s];i.symbolEqual(r,o.parameters.symbolObject)&&n.push(o)}return t.includeMaster&&i.symbolEqual(r,e.symbolObject)&&n.push({}),n},i.ChartEngine.prototype.modifySeries=function(t,e){var a,r,n;if(!this.runPrepend("modifySeries",arguments)&&(e&&("string"==typeof t?(r=t,a=(n=e.chartName?this.charts[e.chartName]:this.chart).series[r]):(r=(a=t).id,n=this.charts[a.parameters.chartName]),a))){for(var s in i.extend(a.parameters,e),n.seriesRenderers)for(var o=n.seriesRenderers[s],l=o.seriesParams,h=0;h<l.length;++h)if(l[h].id===a.id){o.attachSeries(r,a.parameters);break}this.changeOccurred("layout"),this.runAppend("modifySeries",arguments)}},i.ChartEngine.prototype.isEquationChart=function(t){return!(!this.allowEquations||!i.computeEquationChart)&&!(!t||"="!=t[0])},i.ChartEngine.prototype.getDataFields=function(t){t||(t=this.chart);var e=t.defaultPlotField||"Close",i=["Open","High","Low"];for(var a in i.push(e),t.series){var r=t.series[a].parameters;i.push(r.symbol)}return i},i.ChartEngine.prototype.cleanMasterData=function(t,e){var i=t.symbol,a=e.masterData;if(a&&a.length){var r=this.getDataFields(e),n=0;do{var s=a[n];delete s[i],o.call(this,s,r)?a.splice(n,1):n++}while(n<a.length);a=this.doCleanupGaps(a,e,{noCleanupDates:!0}),this.setMasterData(a,e,{noCleanupDates:!0})}function o(t,e){for(var i=0;i<e.length;i++){if(void 0!==t[e[i]])return!1}return!0}},i.ChartEngine.prototype.deleteSeries=function(t,e,i){if(!this.runPrepend("deleteSeries",arguments)){var a,r=(i=i||{}).action?i.action:"remove-series";"object"==typeof t?(a=t.id,e=e||this.charts[t.parameters.chartName]):(a=t,e=e||this.chart);var n=e.series[a];if(n){var s=n.parameters.loadData,o=n.parameters.symbolObject;delete e.series[a];var l=this.getSeries({symbolObject:o,includeMaster:!0});if(!1===s&&l.push(a),l.length||this.cleanMasterData(o,e),"percent"!=this.layout.chartScale){var h=!1;for(var c in e.series)e.series[c].parameters.isComparison&&(h=!0);h||this.setComparison(!1,e)}this.createDataSet(),l.length||this.dispatch(this.currentlyImporting?"symbolImport":"symbolChange",{stx:this,symbol:o.symbol,symbolObject:o,action:r}),this.quoteDriver&&this.quoteDriver.updateSubscriptions(),this.runAppend("deleteSeries",arguments)}}},i.ChartEngine.prototype.removeSeries=function(t,e){if(!this.runPrepend("removeSeries",arguments)){var i,a=!1;for(var r in"object"==typeof t?(i=t.id,e=e||this.charts[t.parameters.chartName]):(i=t,e=e||this.chart),e.seriesRenderers)for(var n=e.seriesRenderers[r],s=n.seriesParams.length-1;s>=0;s--){n.seriesParams[s].id===i&&(n.removeSeries(i),n.seriesParams.length<1&&this.removeSeriesRenderer(n),a=!0)}a||this.deleteSeries(i,e),this.draw(),this.runAppend("removeSeries",arguments)}},i.ChartEngine.prototype.isDailyInterval=function(t){return console.warn("CIQ.ChartEngine.prototype.isDailyInterval has been deprecated. Use use static version insted"),i.ChartEngine.isDailyInterval(t)},i.ChartEngine.prototype.setPeriodicity=function(t,e){if(!this.runPrepend("setPeriodicity",arguments)){var a,r,n=null;t&&"object"==typeof t?(a=t.period,r=t.interval,n=t.timeUnit):(a=t,r=e,e=arguments[arguments.length-1],arguments.length>3&&(n=arguments[2])),"function"!=typeof e&&(e=null);var s=i.cleanPeriodicity(a,r,n);a=s.period,r=s.interval,n=s.timeUnit;var o=this.layout,l=o.candleWidth;o.setSpan={},o.range={},this.chart.inflectionPoint=null;var h=!1;if(this.chart.symbol&&(h=this.needDifferentData({period:a,interval:r,timeUnit:n})),o.periodicity=a,o.interval=r,o.timeUnit=n,h){if(this.changeOccurred("layout"),this.quoteDriver)for(var c in this.charts)this.charts[c].symbol&&(this.displayInitialized?this.quoteDriver.newChart({symbol:this.charts[c].symbol,symbolObject:this.charts[c].symbolObject,chart:this.charts[c]},e):this.newChart(this.charts[c].symbol,null,this.charts[c],e));else this.dataCallback?(this.dataCallback(),e&&e(null)):console.log("cannot change periodicity because neither dataCallback or quoteDriver are set");this.home()}else{var u,p;for(u in this.charts){var d,m=(p=this.charts[u]).dataSegment,g=p.dataSet,f=p.maxTicks,y=p.scroll,v=m?m.length:0,x=g?g.length:0,b=Math.round(p.maxTicks/2);this.setCandleWidth(l,p);var C=!0,S=!1;if(y<=f?C=!1:m&&!m[b]&&(C=!1,S=y-x),C&&v>0&&(f<(Math.round(this.chart.width/l-.499)-1)/2&&(b=v-1),b>=v?(d=m[v-1].DT,b=v-1):d=m[b].DT),this.createDataSet(),C){if(v>0)for(var w=x-1;w>=0;w--){if(g[w].DT.getTime()<d.getTime()){p.scroll=x-1-w+b;break}}}else if(S)p.scroll=g.length+S;else{var T=Math.round(this.preferences.whitespace/l);p.scroll=f-T-1}}if(this.displayInitialized&&this.draw(),this.changeOccurred("layout"),this.quoteDriver)for(u in this.charts)(p=this.charts[u]).symbol&&p.moreAvailable&&this.quoteDriver.checkLoadMore(p);this.home(),e&&e(null),this.runAppend("setPeriodicity",arguments)}}},i.ChartEngine.prototype.setPeriodicityV2=function(t,e,i,a){"function"==typeof i&&(a=i,i=null),this.runPrepend("setPeriodicityV2",arguments)||(this.setPeriodicity(t,e,i,a),this.runAppend("setPeriodicityV2",arguments))},i.ChartEngine.prototype.drawVectors=function(){if(!this.vectorsShowing&&!this.runPrepend("drawVectors",arguments)){if(this.vectorsShowing=!0,!this.chart.hideDrawings){var t,e,i={};for(e=0;e<this.drawingObjects.length;e++){var a=this.drawingObjects[e];this.repositioningDrawing!==a&&(t=a.panelName,this.panels[a.panelName]&&!this.panels[a.panelName].hidden&&(i[t]||(i[t]=[]),i[t].push(a)))}for(t in i){this.startClip(t);var r=i[t];for(e=0;e<r.length;e++)r[e].render(this.chart.context);this.endClip()}}this.runAppend("drawVectors",arguments)}},i.ChartEngine.NONE=0,i.ChartEngine.CLOSEUP=1,i.ChartEngine.CLOSEDOWN=2,i.ChartEngine.CLOSEEVEN=4,i.ChartEngine.CANDLEUP=8,i.ChartEngine.CANDLEDOWN=16,i.ChartEngine.CANDLEEVEN=32,i.ChartEngine.prototype.displayChart=function(t){this.runPrepend("displayChart",arguments)||(this.rendererAction(t,"main"),this.runAppend("displayChart",arguments))},i.ChartEngine.prototype.calculateATR=function(t,e,i){i||(i=t.dataSet);var a=t.state.calculations.atr;a||(a=t.state.calculations.atr={}),e||(e=20);var r,n=[];a.accum&&(n=a.accum);for(var s=0;s<i.length;s++){var o=i[s];if(r=s?i[s-1]:a.q1){var l=Math.max(o.High-o.Low,Math.abs(o.High-r.Close),Math.abs(o.Low-r.Close));if(n.length<e){if(n.push(l)==e){for(var h=0,c=0;c<n.length;c++)h+=n[c];o.atr=h/e}}else o.atr=(r.atr*(e-1)+l)/e;o.trueRange=l}}t.state.calculations.atr={accum:n,q1:r}},i.ChartEngine.prototype.calculateMedianPrice=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["hl/2"]=(i.High+i.Low)/2},i.ChartEngine.prototype.calculateTypicalPrice=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["hlc/3"]=(i.High+i.Low+i.Close)/3},i.ChartEngine.prototype.calculateWeightedClose=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["hlcc/4"]=(i.High+i.Low+2*i.Close)/4},i.ChartEngine.prototype.calculateOHLC4=function(t,e){var i;e||(e=t.dataSet);for(var a=0;a<e.length;++a)(i=e[a])["ohlc/4"]=(i.Open+i.High+i.Low+i.Close)/4},i.ChartEngine.prototype.currentQuote=function(){if(!this.chart.dataSet)return null;for(var t=this.chart.dataSet.length-1;t>=0;t--)if(this.chart.dataSet[t])return this.chart.dataSet[t];return null},i.ChartEngine.prototype.correctIfOffEdge=function(t){if(!this.runPrepend("correctIfOffEdge",arguments)){for(var e in this.charts){var i=this.charts[e],a=i.dataSet,r=i.maxTicks,n=this.layout,s=this.minimumLeftBars;this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[n.chartType]||s--;var o=Math.min(s,r);if(i.allowScrollPast){var l=r-o;o>a.length&&(l=r-a.length),i.scroll-l>=a.length&&(i.scroll=a.length+l-1,this.micropixels=0),i.scroll<=o&&(i.scroll=o,this.micropixels=0)}else i.scroll<o&&(i.scroll=o),i.scroll>a.length&&(i.scroll=a.length);if(!1===i.allowScrollFuture){var h=this.getLabelOffsetInPixels(i,n.chartType),c=r-Math.round(h/n.candleWidth)-1;(this.micropixels<0?i.scroll-1:i.scroll)<c&&(i.scroll=c,this.micropixels=0)}}this.runAppend("correctIfOffEdge",arguments)}},i.ChartEngine.prototype.createDataSegment=function(t){if(!this.runPrepend("createDataSegment",arguments)){var e;for(var a in this.charts){e=this.charts[a],t&&(e=t),e.isComparison&&i.Comparison.createComparisonSegmentInner(this,e);var r=e.dataSet,n=e.baseline,s=e.scroll,o=e.maxTicks,l=this.layout,h=l.candleWidth;n.actualLevel=n.userLevel?n.userLevel:n.defaultLevel;for(var c,u=n.includeInDataSegment&&(!this.mainSeriesRenderer||!this.mainSeriesRenderer.standaloneBars)&&!this.standaloneBars[l.chartType],p=e.dataSegment=[],d=r.length-1-s-1,m=e.defaultPlotField,g=-1;g<s&&g<o;g++)if(d++,-1!=g||u)if(d<r.length&&d>=0){if((c=r[d]).candleWidth=null,p.push(c),null===n.actualLevel&&g>=0)if(m&&"Close"!=m){var f=r[d-1];(f[m]||0===f[m])&&(n.actualLevel=f[m])}else(c.iqPrevClose||0===c.iqPrevClose)&&(n.actualLevel=c.iqPrevClose)}else d<0&&p.push(null);e.segmentImage=null;var y=this.mainSeriesRenderer||{};if(y.params&&y.params.volume){for(var v=0,x=e.width-(o-p.length-1)*l.candleWidth,b=0;b<p.length;b++)(c=p[b])&&(v+=c.Volume);var C=0;e.segmentImage=[];for(var S=0;S<p.length;S++){c=p[S],e.segmentImage[S]={};var w=null;c?(c.Volume?(c.candleWidth=x*c.Volume/v,w=C+c.candleWidth/2,C+=c.candleWidth):(c.candleWidth=h,w=C+h/2,C+=h),e.segmentImage[S]={tick:c.tick,candleWidth:c.candleWidth,leftOffset:w}):C+=h}}if(t)break}e&&e.isComparison&&this.clearPixelCache(),this.positionCrosshairsAtPointer(),this.runAppend("createDataSegment",arguments)}},i.ChartEngine.prototype.getDataSegment=function(t){t||(t=this.chart);var e=t.dataSegment;if(!e||!e.length)return[];var i=0;return right=e.length,this.pixelFromBar(i,t)<t.panel.left&&i++,this.pixelFromBar(right-1,t)>t.panel.right&&right--,e.slice(i,right)},i.ChartEngine.prototype.leftTick=function(){return this.chart.dataSet.length-this.chart.scroll},i.ChartEngine.prototype.getStartDateOffset=function(){for(var t=0;t<this.chart.dataSegment.length;t++)if(this.chart.dataSegment[t])return t;return 0},i.ChartEngine.prototype.setStartDate=function(t){for(var e=0;e<this.chart.dataSet.length;e++){if(this.chart.dataSet[e].DT.getTime()==t.getTime())return this.chart.scroll=this.chart.dataSet.length-e,void this.draw()}},i.ChartEngine.prototype.updateListeners=function(t){for(var e in this.plugins){var i=this.plugins[e];i.display&&i.listener&&i.listener(this,t)}},i.ChartEngine.prototype.clearPixelCache=function(){for(var t in this.panels){var e=this.panels[t];e.cacheHigh=null,e.cacheLow=null,e.cacheLeft=1e6,e.cacheRight=-1}for(var i in this.charts){var a=this.charts[i];if(a.dataSet)for(var r=0;r<a.dataSet.length;r++)a.dataSet[r].cache={}}},i.ChartEngine.prototype.createYAxisLabel=function(t,e,a,r,n,s,o){if(!1!==t.yAxis.drawPriceLabels&&!t.yAxis.noDraw){var l=o||t.yAxis;if(!l.noDraw&&l.width){var h=s||this.chart.context,c=this.getCanvasFontSize("stx_yaxis")+6;this.canvasFont("stx_yaxis",h);l.displayBorder;var u,p=this.drawBorders?3:0;try{u=h.measureText(e).width+p+6}catch(t){u=l.width}var d=l.left-3+3,m=d+3+p,g=3;"left"===(null===l.position?t.chart.yAxis.position:l.position)&&(d=l.left+l.width+3-3,u*=-1,m=d-3-p,g=-3,h.textAlign="right"),a+c/2>l.bottom&&(a=l.bottom-c/2),a-c/2<l.top&&(a=l.top+c/2),void 0===i[this.yaxisLabelStyle]&&(this.yaxisLabelStyle="roundRectArrow");var f=this.yaxisLabelStyle;l.yaxisLabelStyle&&(f=l.yaxisLabelStyle);var y={ctx:h,x:d,y:a,top:a-c/2,width:u,height:c,radius:g,backgroundColor:r,fill:!0,stroke:!1,margin:{left:m-d,top:1},txt:e,color:n};i[f](y)}}},i.ChartEngine.prototype.createXAxisLabel=function(t,e,a,r,n,s){var o,l=this.chart.context,h="stx-float-date",c=this.getCanvasFontSize(h)+4;this.canvasFont(h,l);try{o=l.measureText(e).width+4}catch(t){o=0}var u=t.top+t.height-c;if(!(a+o/2<t.left||a-o/2>t.right)){s||(a+o/2>t.right&&(a=t.right-o/2),a-o/2<t.left&&(a=t.left+o/2)),l.fillStyle=r,i.roundRect({ctx:l,x:a-o/2,top:u,width:o,height:c,radius:3,fill:!0});var p=t.bottom-t.yAxis.bottom-c;l.beginPath(),s?(l.moveTo(a-p,u),l.lineTo(a,u-p-1),l.lineTo(a+p,u),l.closePath(),l.fill()):(l.moveTo(a,u),l.lineTo(a,u-p),l.strokeStyle=r,l.stroke()),l.textBaseline="top",l.fillStyle=n||i.chooseForegroundColor(r),l.fillStyle==r&&("#FFFFFF"==r.toUpperCase()?l.fillStyle="#000000":l.fillStyle="#FFFFFF"),l.fillText(e,a-o/2+2,u+2)}},i.ChartEngine.prototype.drawCurrentHR=function(){if(!this.runPrepend("drawCurrentHR",arguments)){var t,e,i=this.mainSeriesRenderer||{},a=i.highLowBars||this.highLowBars[this.layout.chartType];for(var r in this.charts){var n=this.charts[r],s=n.panel,o=s.yAxis;if(!s.hidden&&(!1!==o.drawCurrentPriceLabel&&!o.noDraw&&i.params)){var l=o.whichSet;l||(l="dataSet");var h=n[l].length,c=this.layout.candleWidth;if("dataSegment"==l)for(;h>(n.width-this.micropixels+c/2+1)/c;)h--;if(h&&n[l][h-1]){var u,p,d,m=n.defaultPlotField;m&&!a||(m="Close");do{if(p=u=n[l][h-1][m],0==--h)break}while(null===p);if("dataSet"==l&&n.currentQuote)p=n.currentQuote[m];else if(n[l].length>=2){var g=n[l][h-2];g&&(u=g[m])}p<u?(t=this.canvasStyle("stx_current_hr_down").backgroundColor,e=this.canvasStyle("stx_current_hr_down").color):(t=this.canvasStyle("stx_current_hr_up").backgroundColor,e=this.canvasStyle("stx_current_hr_up").color),n.transformFunc&&(p=n.transformFunc(this,n,p));var f=Math.max(s.yAxis.printDecimalPlaces,s.chart.decimalPlaces);(o.maxDecimalPlaces||0===o.maxDecimalPlaces)&&(f=Math.min(f,o.maxDecimalPlaces)),d=o.priceFormatter?o.priceFormatter(this,s,p,f):this.formatYAxisPrice(p,s,f);var y=this.pixelFromTransformedValue(p,s);this.createYAxisLabel(s,d,y,t,e),!0===this.preferences.currentPriceLine&&this.isHome()&&(s.chart.context.globalCompositeOperation="destination-over",this.plotLine(s.left,s.right,y,y,t,"line",s.chart.context,s,{pattern:"dashed",lineWidth:1,opacity:.8}),s.chart.context.globalCompositeOperation="source-over")}}}this.runAppend("drawCurrentHR",arguments)}},i.ChartEngine.prototype.getDefaultColor=function(){this.defaultColor="#000000";for(var t=null,e=this.chart.container;!t||i.isTransparent(t);){var a=getComputedStyle(e);if(!a)return;if(t=a.backgroundColor,i.isTransparent(t)&&(t="transparent"),!(e=e.parentNode)||!e.tagName)break}if(t)if("transparent"==t&&(t="#FFFFFF"),this.containerColor=t,i.isTransparent(t))this.defaultColor="#000000";else{var r=i.hsv(t)[2];this.defaultColor=r>.65?"#000000":"#FFFFFF"}else this.containerColor="#FFFFFF"},i.ChartEngine.prototype.startAsyncAction=function(){this.pendingAsyncs||(this.pendingAsyncs=[]),this.pendingAsyncs.push(!0)},i.ChartEngine.prototype.registerChartDrawnCallback=function(t){return this.asyncCallbacks||(this.asyncCallbacks=[]),this.asyncCallbacks.push(t),{fc:t}},i.ChartEngine.prototype.unregisterChartDrawnCallback=function(t){for(var e=0;e<this.asyncCallbacks.length;e++)if(this.asyncCallbacks[e]==t.fc)return void this.asyncCallbacks.splice(e,1)},i.ChartEngine.prototype.makeAsyncCallbacks=function(){if(this.asyncCallbacks&&(!this.pendingAsyncs||!this.pendingAsyncs.length))for(var t=0;t<this.asyncCallbacks.length;t++)this.asyncCallbacks[t]()},i.ChartEngine.prototype.completeAsyncAction=function(){this.pendingAsyncs.pop(),this.makeAsyncCallbacks()},i.ChartEngine.prototype.draw=function(){if(this.debug(),this.chart.canvas&&this.chart.dataSet&&this.chart.canvasHeight&&(this.offset=this.layout.candleWidth*this.candleWidthPercent/2,i.clearCanvas(this.chart.canvas,this),this.masterData&&this.masterData.length&&!this.runPrepend("draw",arguments))){var t,e,a,r;for(a in this.getDefaultColor(),this.vectorsShowing=!1,this.drawPanels(),this.yAxisLabels=[],this.charts){e=this.charts[a],this.correctIfOffEdge(),this.createDataSegment();var n=this.createXAxis(e);for(t in this.initializeDisplay(e),this.drawXAxis(e,n),this.renderYAxis(e),e.tmpWidth=Math.floor(this.layout.candleWidth*this.candleWidthPercent),e.tmpWidth%2==0&&(e.tmpWidth+=1,e.tmpWidth>this.layout.candleWidth&&(e.tmpWidth-=2)),e.tmpWidth<.5&&(e.tmpWidth=.5),this.plugins)(r=this.plugins[t]).display&&r.drawUnder&&r.drawUnder(this,e);this.chart.legend&&(this.chart.legend.colorMap=null),this.controls.baselineHandle&&(this.controls.baselineHandle.style.display="none"),this.rendererAction(e,"underlay"),i.Studies&&i.Studies.displayStudies(this,e,!0),this.displayChart(e),i.Studies&&i.Studies.displayStudies(this,e,!1),this.rendererAction(e,"overlay"),e.legend&&e.legend.colorMap&&e.legendRenderer&&e.legendRenderer(this,{chart:e,legendColorMap:e.legend.colorMap,coordinates:{x:e.legend.x,y:e.legend.y+e.panel.yAxis.top}})}for(a in this.charts)for(t in e=this.charts[a],this.plugins)(r=this.plugins[t]).display&&r.drawOver&&r.drawOver(this,e);for(var s in this.panels)this.panels[s].hidden||this.plotYAxisText(this.panels[s]);for(var o=0;o<this.yAxisLabels.length;o++){var l=this.yAxisLabels[o];"series"==l.src&&l.args[6]&&!1===l.args[6].drawSeriesPriceLabels||this.createYAxisLabel.apply(this,l.args)}for(a in this.createCrosshairs(),this.drawVectors(),this.drawCurrentHR(),this.displayInitialized=!0,this.controls.home&&(this.controls.home.style.display=this.isHome()?"none":"block"),this.positionMarkers(),this.charts)e=this.charts[a],this.quoteDriver&&this.quoteDriver.checkLoadMore(e);this.runAppend("draw",arguments),this.makeAsyncCallbacks()}},i.ChartEngine.prototype.adjustBackingStore=function(t,e){this.devicePixelRatio=window.devicePixelRatio||1,this.devicePixelRatio<1&&(this.devicePixelRatio=1);var a=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,r=this.devicePixelRatio/a;if(this.useBackingStore){if(!i.isAndroid||i.is_chrome){var n=t.width,s=t.height;t.width=n*r,t.height=s*r,t.style.width=n+"px",t.style.height=s+"px",e.scale(r,r),this.adjustedDisplayPixelRatio=r,this.backing={ratio:r,width:t.width,height:t.height,styleWidth:n,styleHeight:s}}}else this.devicePixelRatio=this.adjustedDisplayPixelRatio=1},i.ChartEngine.prototype.reconstituteBackingStore=function(){if(this.useBackingStore){var t=this.chart.canvas;t.width!=this.backing.width&&(t.width=this.backing.width,t.height=this.backing.height,t.context.scale(this.backing.ratio,this.backing.ratio),this.adjustedDisplayPixelRatio=this.backing.ratio,this.draw())}},i.ChartEngine.prototype.disableBackingStore=function(){if(this.useBackingStore){var t=this.chart.canvas;t.width!=this.backing.styleWidth&&(t.width=this.backing.styleWidth,t.height=this.backing.styleHeight,t.context.scale(1,1),this.adjustedDisplayPixelRatio=1,this.draw())}},i.ChartEngine.prototype.resizeCanvas=function(){var t=this.chart.canvas,e=this.chart.context;t&&e&&(this.floatCanvas.height=this.chart.tempCanvas.height=t.height=this.chart.container.clientHeight,this.floatCanvas.width=this.chart.tempCanvas.width=t.width=this.chart.container.clientWidth,this.adjustBackingStore(t,e),this.adjustBackingStore(this.chart.tempCanvas,this.chart.tempCanvas.context),this.adjustBackingStore(this.floatCanvas,this.floatCanvas.context));var i=this.container.getBoundingClientRect();this.top=i.top,this.left=i.left,this.canvasWidth=this.chart.canvasWidth=this.chart.container.clientWidth,this.right=this.left+this.canvasWidth,this.height=this.chart.container.clientHeight,this.width=this.right-this.left,0!==this.width||this.container.dimensionlessCanvas||console.log("warning: zero width chart. Check CSS for chart container."),this.bottom=this.top+this.height,this.calculateYAxisPositions(),this.chart.canvasRight=this.right,this.chart.canvasHeight=this.height;var a=this.layout.candleWidth;for(var r in void 0===a&&(a=8),this.charts){var n=this.charts[r];if(this.setCandleWidth(a,n),n.scroll<n.width/a){n.scroll=Math.floor(n.width/a);var s=Math.round(this.preferences.whitespace/this.layout.candleWidth);n.scroll-=s}var o,l=10;try{o=2*e.measureText("10:00").width}catch(t){o=100}for(;l>1&&!(this.chart.width/o>l);)l/=1.5;n.xAxis.autoComputedTickSizePixels=Math.round(this.chart.width/l),n.xAxis.autoComputedTickSizePixels<1&&(n.xAxis.autoComputedTickSizePixels=1)}},i.ChartEngine.prototype.setCandleWidth=function(t,e){e||(e=this.chart),t<this.minimumCandleWidth&&(t=this.minimumCandleWidth),this.layout.candleWidth=t,e.maxTicks=Math.round(e.width/t)+1},i.ChartEngine.prototype.resizeChart=function(t){if(!this.runPrepend("resizeChart",arguments)){!1!==t&&(t=!0),t&&this.preAdjustScroll();var e=this.chart.canvasHeight;this.resizeCanvas(),t&&this.postAdjustScroll(),this.displayInitialized?(this.adjustPanelPositions(),this.draw()):0!==this.chart.canvasHeight&&0===e&&(this.adjustPanelPositions(),this.draw()),this.doDisplayCrosshairs(),this.updateChartAccessories(),this.runAppend("resizeChart",arguments)}},i.ChartEngine.prototype.newChart=function(t,e,a,r,n){a||(a=this.chart),n||(n={});var s=this.layout,o=n.periodicity;if(o){var l=i.cleanPeriodicity(o.period?o.period:o.periodicity,o.interval,o.timeUnit);s.interval=l.interval,s.periodicity=l.period,s.timeUnit=l.timeUnit}var h=a.symbol,c=i.clone(a.symbolObject),u=a.market,p=a.dataSet,d=a.moreAvailable;if(a.dataSet=[],a.moreAvailable=null,t?"object"==typeof t?(a.symbol=t.symbol,a.symbolObject=t):(a.symbol=t,a.symbolObject.symbol=t):(a.symbol=null,a.symbolObject={symbol:null}),a.inflectionPoint=null,this.marketFactory){var m=this.marketFactory(a.symbolObject);this.setMarket(m,a)}this.setMainSeriesRenderer(!0);var g=n.span,f=n.range;f||g||!s?f&&g&&(g={}):(g=s.range?{}:s.setSpan,f=s.range||{});var y=this;if(!e&&this.quoteDriver){var v=function(t){t&&"orphaned"!=t&&(a.symbol=h,a.symbolObject=c,a.market=u,a.dataSet=p,a.moreAvailable=d),y.dispatch(y.currentlyImporting?"symbolImport":"symbolChange",{stx:y,symbol:y.chart.symbol,symbolObject:y.chart.symbolObject,action:"master"}),r&&r.call(y,t)};f&&Object.keys(f).length?(delete n.span,delete s.setSpan,this.chart.masterData=null,this.displayInitialized=!1,o&&(f.periodicity=o),f.forceLoad=!0,this.setRange(f,v)):g&&g.base?(g.multiplier=g.multiplier||1,this.chart.masterData=null,this.displayInitialized=!1,o&&(g.maintainPeriodicity=!0),g.forceLoad=!0,this.setSpan(g,v)):this.quoteDriver.newChart({symbol:a.symbol,symbolObject:a.symbolObject,chart:a,initializeChart:!0},function(t){t||(y.adjustPanelPositions(),y.quoteDriver.updateSubscriptions(),n.stretchToFillScreen&&y.fillScreen()),v.apply(y,arguments)})}else e||console.log("Warning: No masterData specified and no QuoteFeed configured"),a.symbol||(a.symbol=""),this.setMasterData(e,a),this.createDataSet(),this.initializeChart(),f&&Object.keys(f).length?this.setRange(f):g&&g.multiplier&&g.base?this.setSpan({maintainPeriodicity:!0,multiplier:g.multiplier,base:g.base}):n.stretchToFillScreen?this.fillScreen():e&&e.length?this.draw():this.clear(),this.adjustPanelPositions(),y.dispatch(y.currentlyImporting?"symbolImport":"symbolChange",{stx:y,symbol:y.chart.symbol,symbolObject:y.chart.symbolObject,action:"master"}),r&&r.call(y)},i.ChartEngine.prototype.clear=function(){for(var t in this.displayInitialized=!1,this.layout.studies){var e=this.layout.studies[t];i.Studies.removeStudy(this,e)}this.controls.chartControls&&(this.controls.chartControls.style.display="none"),this.chart.panel.title.innerHTML="",this.chart.panel.title.appendChild(document.createTextNode(this.chart.panel.display))},i.ChartEngine.prototype.fillScreen=function(){var t=this.chart,e=this.layout.candleWidth,i=t.width-this.preferences.whitespace,a=t.dataSet.length;if(a*e>=i)this.draw();else{this.mainSeriesRenderer&&this.mainSeriesRenderer.standaloneBars||this.standaloneBars[this.layout.chartType]||a--;var r=i/a;this.setCandleWidth(r,t),this.home({maintainWhitespace:!0})}},i.ChartEngine.prototype.setMasterData=function(t,e,a){if(e||(e=this.chart),this.marketFactory){var r=this.marketFactory(e.symbolObject);this.setMarket(r,e)}var n;for(a||(a={}),a.noCleanupDates||this.doCleanupDates(t,this.layout.interval),e.masterData=t,"chart"==e.name&&(this.masterData=t),n=0;t&&n<t.length;n++){var s=t[n];s.DT?("[object Date]"!=Object.prototype.toString.call(s.DT)&&(s.DT=new Date(s.DT)),s.Date&&17==s.Date.length||(s.Date=i.yyyymmddhhmmssmmm(s.DT))):s.Date?s.DT=i.strToDateTime(s.Date):console.log("setMasterData : Missing DT and Date on masterData object"),s.Volume&&"number"!=typeof s.Volume&&(s.Volume=parseInt(s.Volume,10))}for(n in e.decimalPlaces=this.callbacks.calculateTradingDecimalPlaces({stx:this,chart:e,symbol:e.symbolObject.symbol,symbolObject:e.symbolObject}),this.setDisplayDates(t),e.roundit=Math.pow(10,e.decimalPlaces),this.plugins){var o=this.plugins[n];o.display&&o.setMasterData&&o.setMasterData(this,e)}},i.ChartEngine.prototype.setMasterDataRender=function(t,e,i){i||(i=this.chart),i.symbol||(i.symbol=""),this.setMasterData(e,i),e&&e.length&&(i.symbol=t),this.createDataSet(),this.initializeChart(),this.draw(),e&&e.length||(i.symbol=null,this.clear()),this.adjustPanelPositions()},i.ChartEngine.prototype.getSymbols=function(t){t||(t={});var e,a,r,n=[],s=this.layout;function o(t,e,i){return{symbol:t,symbolObject:e,periodicity:i.periodicity,interval:i.interval,timeUnit:i.timeUnit,setSpan:i.setSpan}}for(var l in this.charts){var h=this.charts[l];for(var c in h.symbolObject&&h.symbolObject.symbol&&n.push(o(h.symbol,h.symbolObject,s)),h.series){var u=h.series[c].parameters;u.data&&!u.data.useDefaultQuoteFeed||(r=u.symbolObject,(e=o(a=u.symbol,r,s)).id=c,t["include-parameters"]&&(e.parameters=u),t["exclude-studies"]&&"study"==u.bucket||n.push(e))}}for(var p=n.length-1;p>=0;p--)if(a=n[p].symbol,this.isEquationChart(a)){var d=i.formatEquation(a);if(d){for(var m=0;m<d.symbols.length;m++)e=o(d.symbols[m],n[p].symbolObject,n[p]),n.push(e);n.splice(p,1)}}return n},i.ChartEngine.prototype.setDisplayDate=function(t){if(!i.ChartEngine.isDailyInterval(this.layout.interval)){var e,a=t.DT,r=1e3*a.getSeconds()+a.getMilliseconds();this.displayZone&&(e=new s.Date(a.getTime(),this.displayZone),a=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()),a=new Date(a.getTime()+r)),t.displayDate=a}},i.ChartEngine.prototype.setDisplayDates=function(t){if(t&&!i.ChartEngine.isDailyInterval(this.layout.interval))for(var e=0;e<t.length;e++){var a=t[e];a.DT&&this.setDisplayDate(a)}},i.ChartEngine.prototype.streamTrade=function(t,e,i,a){var r=this.chart;a||(a={}),a.chart&&(r=a.chart),a.fillGaps=this.streamParameters.fillGaps;var n="object"==typeof t,s=n?t.last:arguments[0],o=n?t.volume:arguments[1],l=n?t.bid:null,h=n?t.ask:null;n||(e=arguments[2],i=arguments[3]),i&&(a.secondarySeries=i);var c={DT:e,Last:s,Volume:o,Bid:l,Ask:h};this.updateChartData(c,r,a)},i.ChartEngine.prototype.appendMasterData=function(t,e,i){this.updateChartData(t,e,i)},i.ChartEngine.prototype.updateChartData=function(t,e,a){a||(a={}),e||(e=this.chart);var r=!1,n=!1,s=e.masterData,o=this.layout,l=this.dataZone;if(a.noCleanupDates||this.doCleanupDates(t,o.interval),a.useAsLastSale||t.constructor==Object&&void 0!==t.Last&&null!==t.Last){if(r=!0,a.useAsLastSale&&a.useAsLastSale.aggregatedVolume&&(n=!0),t.constructor===Array){var h=t[t.length-1];t={},h.DT?t.DT=h.DT:t.DT=i.strToDateTime(h.Date),t.Close=h.Close,t.Volume=h.Volume}else t.Last&&(t.Close=t.Last,delete t.Last);if(t.DT&&(t.DT=new Date(+t.DT)),t.DT&&"Invalid Date"!=t.DT||(t.DT=new Date),"tick"!=o.interval){var c,u,p=new i.Market({}),d={begin:s&&s.length?s[s.length-1].DT:t.DT,interval:o.interval,periodicity:1,timeUnit:o.timeUnit,inZone:l},m=p.newIterator(d),g=m.next();if(s){if(t.DT<g){c=0;var f=m.previous();for(u=t.DT,a.appending=!0;u<f&&c<1e3;)a.appending=!1,f=m.previous(),c++;t.DT=f,a.updating=!a.appending}else if(t.DT>=g){for(c=0,u=t.DT;u>g&&c<1e3;)t.DT=g,g=m.next(),c++;a.appending=!0}}else t.DT=new Date(+m.previous())}t.Open=t.Close,t.High=t.Close,t.Low=t.Close}if(a.secondarySeries)a.fillGaps&&(t=this.doCleanupGaps(t,e,{cleanupGaps:a.fillGaps,noCleanupDates:!0})),i.addMemberToMasterdata({stx:this,label:a.secondarySeries,data:t,createObject:!!a.overwrite||"aggregate",noCleanupDates:!0});else{if(t&&t.constructor==Object&&(t=[t]),!t||!t.length)return;if(this.runPrepend("appendMasterData",[t,e,a]))return;if(this.runPrepend("updateChartData",[t,e,a]))return;if(s&&s.length)for(var y=!1,v=s.length-1,x=!1,b=0;b<t.length;b++){var C=t[b],S=C.DT,w=C.Date;for(S&&"[object Date]"!=Object.prototype.toString.call(S)&&(C.DT=S=new Date(S)),S&&(w&&17==w.length||(C.Date=i.yyyymmddhhmmssmmm(C.DT))),S||(S=C.DT=i.strToDateTime(w));v>=0&&v<s.length;){var T=s[v].DT;if(T||(T=i.strToDateTime(s[v].Date)),T.getTime()<=S.getTime()){x=!0;var M=0;if(T.getTime()<S.getTime()){if(v<s.length-1)if((s[v+1].DT||i.strToDateTime(s[v+1].Date)).getTime()<=S.getTime()){v++;continue}if(M=1,a.fillGaps&&!y&&v==s.length-1){var D=t.slice(b);D.unshift(s[v]),(D=this.doCleanupGaps(D,e,{noCleanupDates:!0})).shift(),C=(t=t.slice(0,b).concat(D))[b],y=!0}}if(a.deleteItems)M||s.splice(v,1);else{if(!M){var E=s.length>v+b?s[v+b]:null;if(E)for(var A in null===C.Close?(void 0!==C.Open&&(C.Open=null),void 0!==C.High&&(C.High=null),void 0!==C.Low&&(C.Low=null),void 0!==C.Volume&&(C.Volume=null)):(r?(C.Volume&&(C.Volume=parseInt(C.Volume,10)),n||(C.Volume+=E.Volume)):"number"!=typeof C.Volume&&E.Volume&&(C.Volume=E.Volume),a.allowReplaceOHL||("number"==typeof E.Open&&(C.Open=E.Open),"number"==typeof E.High&&"number"==typeof C.High&&E.High>C.High&&(C.High=E.High),"number"==typeof E.Low&&"number"==typeof C.Low&&E.Low<C.Low&&(C.Low=E.Low)),"number"!=typeof C.Close&&(C.Close=E.Close),"number"!=typeof C.High&&(C.High=E.High),"number"!=typeof C.Low&&(C.Low=E.Low),"number"!=typeof C.Bid&&(C.Bid=E.Bid),"number"!=typeof C.Ask&&(C.Ask=E.Ask)),e.series){var k=e.series[A].parameters.symbolObject.symbol;void 0===C[k]&&void 0!==E[k]&&(C[k]=E[k])}}if("number"==typeof C.Close){"number"!=typeof C.Open&&(C.Open=C.Close);var F=Math.max(C.Open,C.Close),_=Math.min(C.Open,C.Close);("number"!=typeof C.High||C.High<F)&&(C.High=F),("number"!=typeof C.Low||C.Low>_)&&(C.Low=_)}C.Volume&&"number"!=typeof C.Volume&&(C.Volume=parseInt(C.Volume,10)),this.setDisplayDate(C),v+=M,s.splice(v,M?0:1,C)}break}v+=x?1:-1}v<0&&(s.splice(0,0,C),x=!0,v=0)}else s=i.clone(t),this.setMasterData(s,e,{noCleanupDates:!0});for(var P in this.maxMasterDataSize&&(s=e.masterData=this.masterData=s.slice(-this.maxMasterDataSize)),(!e.endPoints.begin||e.endPoints.begin>t[0].DT)&&(e.endPoints.begin=t[0].DT),(!e.endPoints.end||e.endPoints.end<t[t.length-1].DT)&&(e.endPoints.end=t[t.length-1].DT),this.plugins){var L=this.plugins[P];L.display&&L.appendMasterData&&L.appendMasterData(this,t,e)}this.masterData&&this.masterData.length||(this.masterData=s)}if(!a.noCreateDataSet){var O=this.streamParameters;if(++O.count>O.maxTicks||a.bypassGovernor)clearTimeout(O.timeout),this.createDataSet(null,null,a),this.draw(),this.updateChartAccessories(),O.count=0,O.timeout=-1;else{var N=this;-1==O.timeout&&(O.timeout=setTimeout(function(){N.createDataSet(null,null,a),N.draw(),N.updateChartAccessories(),N.streamParameters.count=0,N.streamParameters.timeout=-1},O.maxWait))}}this.runAppend("appendMasterData",arguments),this.runAppend("updateChartData",arguments)},i.ChartEngine.prototype.setMaxTicks=function(t,e){e||(e={}),(t=Math.round(t))<2&&(t=2);var i=e.padding?e.padding:0;this.layout.candleWidth=(this.chart.width-i)/t,this.layout.candleWidth||(this.layout.candleWidth=8),this.chart.maxTicks=Math.round(this.chart.width/this.layout.candleWidth-.499),(e.padding||0===e.padding)&&(this.chart.scroll=t+1)},i.ChartEngine.prototype.construct=function(){this.stackPanel("chart","chart",1),this.adjustPanelPositions(),this.chart.panel=this.panels[this.chart.name],this.cx=0,this.cy=0,this.micropixels=0,this.controls.home&&this.chart.panel.subholder.appendChild(this.controls.home),this.callbackListeners={doubleTap:[],drawing:[],layout:[],longhold:[],move:[],newChart:[],preferences:[],rightClick:[],studyOverlayEdit:[],studyPanelEdit:[],symbolChange:[],symbolImport:[],tap:[],theme:[],undoStamp:[]},this.longHoldTime=1e3},i.ChartEngine.prototype.addDomEventListener=function(t,e,i,a){t.addEventListener(e,i,a),this.eventListeners.push({element:t,event:e,function:i,options:a})},i.ChartEngine.prototype.addEventListener=function(t,e){if("*"===t)for(var i in this.callbackListeners)this.callbackListeners[i].push(e);else if(t instanceof Array)for(var a=0;a<t.length;a++)this.callbackListeners[t[a]].push(e);else{var r=this.callbackListeners[t];if(!r)throw new Error("Attempted to add an invalid listener.");r.push(e)}return{type:t,cb:e}},i.ChartEngine.prototype.removeEventListener=function(t,e){t&&"object"==typeof t||(t={type:t,cb:e});var i=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return void t.splice(i,1)},a=this.callbackListeners;if("*"!==t.type){if(!a[t.type])throw new Error("Attempted to remove an invalid listener.");i(a[t.type],t.cb)}else for(var r in a)i(a[r],t.cb)},i.ChartEngine.prototype.dispatch=function(t,e){this.callbacks[t]&&this.callbacks[t].call(this,e);var i,a=this.callbackListeners[t];if(a){for(var r=0;r<a.length;r++)i=a[r].call(this,e);if(i)return i}if(a=this.callbackListeners["*"]){for(var n=0;n<a.length;n++)i=a[n].call(this,e);if(i)return i}return!1},i.ChartEngine.prototype.getYAxisByName=function(t,e){if(t){if("string"==typeof t&&(t=this.panels[t]),e===t.yAxis.name)return t.yAxis;var i;for(i=0;t.yaxisLHS&&i<t.yaxisLHS.length;i++)if(t.yaxisLHS[i].name===e)return t.yaxisLHS[i];for(i=0;t.yaxisRHS&&i<t.yaxisRHS.length;i++)if(t.yaxisRHS[i].name===e)return t.yaxisRHS[i]}},i.ChartEngine.prototype.deleteYAxisIfUnused=function(t,e){if(e&&e.name!==t.yAxis.name){for(var i in this.chart.seriesRenderers){var a=this.chart.seriesRenderers[i];if(a.params.yAxis&&a.params.yAxis.name===e.name&&0!==a.seriesParams.length)return}var r;for(r=0;r<t.yaxisLHS.length;r++)t.yaxisLHS[r]===e&&t.yaxisLHS.splice(r,1);for(r=0;r<t.yaxisRHS.length;r++)t.yaxisRHS[r]===e&&t.yaxisRHS.splice(r,1);this.preAdjustScroll(),this.resizeCanvas(),this.adjustPanelPositions(),this.postAdjustScroll()}},i.ChartEngine.prototype.addYAxis=function(t,e){if(e){t.yaxisLHS||(t.yaxisLHS=[],t.yaxisRHS=[],"left"==t.yAxis.position?t.yaxisLHS.push(t.yAxis):t.yaxisRHS.push(t.yAxis));var i,a=t.yaxisLHS;for(i=a.length-1;i>=0;i--)if(a[i].name===e.name){if("left"==e.position)return a[i];a.splice(i,1)}for(i=(a=t.yaxisRHS).length-1;i>=0;i--)if(a[i].name===e.name){if("left"!=e.position)return a[i];a.splice(i,1)}return"left"===e.position?t.yaxisLHS.unshift(e):(e.position||(e.position="right"),t.yaxisRHS.push(e)),e.height=t.yAxis.height,this.preAdjustScroll(),this.resizeCanvas(),this.adjustPanelPositions(),this.calculateYAxisMargins(e),this.postAdjustScroll(),e}},i.ChartEngine.prototype.calculateYAxisPositions=function(){var t=[],e=this.chart;for(var i in this.charts)this.charts[i].hidden||t.push(i);for(var a in this.panels){var r=this.panels[a];r.name===r.chart.name||r.hidden||t.push(a)}var n,s,o,l,h=this.drawBorders?3:0,c=0,u=0;for(s=0;s<t.length;s++)if(o=this.panels[t[s]]){o.yaxisLHS||(o.yaxisLHS=[],o.yaxisRHS=[]);var p=o.yAxis.position;for(p||(p=o.chart.panel.yAxis.position),n=0;n<o.yaxisLHS.length;n++)if(o.yaxisLHS[n].name==o.yAxis.name){o.yaxisLHS.splice(n,1);break}for(n=0;n<o.yaxisRHS.length;n++)if(o.yaxisRHS[n].name==o.yAxis.name){o.yaxisRHS.splice(n,1);break}"left"==o.yAxis.position?o.yaxisLHS.push(o.yAxis):o.yaxisRHS.unshift(o.yAxis),o.yAxis.width||0===o.yAxis.width||(o.yAxis.width=this.yaxisWidth),o.yaxisTotalWidthRight=0,o.yaxisTotalWidthLeft=0;var d=o.yaxisLHS.concat(o.yaxisRHS);for(n=0;n<d.length;n++)if(!(l=d[n]).noDraw&&l.width)if(e.quoteTextLength&&e.quoteTextLength>l.width&&(l.width=e.quoteTextLength+h+16),"left"==l.position){o.yaxisTotalWidthLeft+=l.width;var m=!l.justifyRight&&!1!==l.justifyRight;l.justifyRight=m?o.chart.yAxis.justifyRight:l.justifyRight,m&&(l.justifyRight=!0)}else o.yaxisTotalWidthRight+=l.width;o.yaxisTotalWidthLeft>c&&(c=o.yaxisTotalWidthLeft),o.yaxisTotalWidthRight>u&&(u=o.yaxisTotalWidthRight)}for(s=0;s<t.length;s++)if(o=this.panels[t[s]]){var g=o.name===o.chart.name,f=c;for(n=o.yaxisLHS.length-1;n>=0;n--)(l=o.yaxisLHS[n]).noDraw||(f-=l.width,l.left=f);for(f=this.width-u,n=0;n<o.yaxisRHS.length;n++)(l=o.yaxisRHS[n]).noDraw||(l.left=f,f+=l.width);void 0!==this.yaxisLeft&&(o.chart.yaxisPaddingRight=this.yaxisLeft),o.yaxisCalculatedPaddingRight=u,(o.chart.yaxisPaddingRight||0===o.chart.yaxisPaddingRight)&&(o.yaxisCalculatedPaddingRight=o.chart.yaxisPaddingRight),o.yaxisCalculatedPaddingLeft=c,(o.chart.yaxisPaddingLeft||0===o.chart.yaxisPaddingLeft)&&(o.yaxisCalculatedPaddingLeft=o.chart.yaxisPaddingLeft),g?(o.left=o.yaxisCalculatedPaddingLeft,o.right=this.width-o.yaxisCalculatedPaddingRight):(o.left=o.chart.panel.left,o.right=o.chart.panel.right),o.width=o.right-o.left,o.handle&&(o.handle.style.left=o.left+"px",o.handle.style.width=o.width+"px"),g&&(o.chart.left=o.left,o.chart.right=o.right,o.chart.width=Math.max(o.right-o.left,0))}this.setCandleWidth(this.layout.candleWidth)},i.ChartEngine.prototype.initializeChart=function(t){if(!this.runPrepend("initializeChart",arguments)){this.chart.symbolObject.symbol||(this.chart.symbolObject.symbol=this.chart.symbol),this.locale&&this.setLocale(this.locale),!this.displayZone&&i.ChartEngine.defaultDisplayTimeZone&&this.setTimeZone(null,i.ChartEngine.defaultDisplayTimeZone),this.calculateYAxisPositions(),this.micropixels=0,t?this.chart.container=t:t=this.chart.container,t.stx=this,t.CIQRegistered||(t.CIQRegistered=!0,i.ChartEngine.registeredContainers.push(t)),i.isSurface&&(this.gesture||(this.gesture=new MSGesture,this.manageTouchAndMouse?this.gesture.target=t:this.gesture.target=document.body,this.gesturePointerId=null)),this.registerHTMLElements();var e=this.chart.canvas,a=this.chart.tempCanvas,n=this.floatCanvas;e&&document.createElement("canvas").getContext?(e.id||(t.removeChild(e),this.chart.canvas=null),a&&!a.id&&(t.removeChild(a),this.chart.tempCanvas=null),n&&!n.id&&(t.removeChild(n),this.floatCanvas=null)):(this.layout.candleWidth<this.minimumCandleWidth&&(this.layout.candleWidth=this.minimumCandleWidth),this.layout.candleWidth>200&&(this.layout.candleWidth=8)),this.chart.canvas||(e=this.chart.canvas=document.createElement("canvas")),this.chart.canvas.getContext?t.appendChild(e):((e=this.chart.canvas=t.querySelectorAll("#ie8canvas")[0]).getContext||window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(e),e.style.display="block"),e.style.position="absolute",e.style.left="0px",(e.context=this.chart.context=e.getContext("2d")).lineWidth=1,this.chart.tempCanvas||(a=this.chart.tempCanvas=document.createElement("canvas")),this.chart.tempCanvas.getContext?t.appendChild(a):(a=this.chart.tempCanvas=t.querySelectorAll("#ie8canvasTemp")[0]).getContext||window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(a),a.style.position="absolute",a.style.left="0px",a.context=this.chart.tempCanvas.getContext("2d"),a.context.lineWidth=1,a.style.display="none",this.floatCanvas||(n=this.floatCanvas=document.createElement("canvas")),this.floatCanvas.getContext?t.appendChild(n):(n=this.floatCanvas=t.querySelectorAll("#ie8canvasFloat")[0]).getContext||window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(n),n.style.position="absolute",n.style.left="0px",n.context=n.getContext("2d"),n.context.lineWidth=1,n.style.display="none",this.resizeCanvas(),i.isAndroid&&(this.chart.tempCanvas.ontouchstart=function(t){t.preventDefault&&t.preventDefault()},this.floatCanvas.ontouchstart=function(t){t.preventDefault&&t.preventDefault()});var s,o,l,h,c,u=this.chart,p=this.panels;for(var d in u.panel.display=u.symbol,u.symbolDisplay&&(u.panel.display=u.symbolDisplay),this.adjustPanelPositions(),this.chart.panel=p[u.name],p)for(var m=p[d].yaxisLHS.concat(p[d].yaxisRHS),g=0;g<m.length;g++)m[g].height=p[d].yAxis.height,this.calculateYAxisMargins(m[g]);if(this.initialWhitespace=this.preferences.whitespace,u.dataSet&&u.dataSet.length>0){u.scroll=Math.floor(u.width/this.layout.candleWidth);var f=Math.round(this.preferences.whitespace/this.layout.candleWidth);u.scroll-=f}if(i.touchDevice){var y=r(".overlayEdit",t),v=r("#overlayTrashCan",t),x=r("#vectorTrashCan",t);y?(i.safeClickTouch(y,(h=this,function(t){h.deleteHighlighted(!0,!0)})),v&&i.safeClickTouch(v,(l=this,function(t){l.deleteHighlighted(!1)}))):v&&i.safeClickTouch(v,(o=this,function(t){o.deleteHighlighted(!0)})),x&&i.safeClickTouch(x,(s=this,function(t){s.deleteHighlighted(!0)}))}for(var b in this.manageTouchAndMouse&&(this.registerTouchAndMouseEvents(),this.controls.chartControls&&(this.controls.chartControls.style.display="block")),t.onmouseout=(c=this,function(t){c.handleMouseOut(t)}),this.abortDrawings(),this.undoStamps=[],p){var C=p[b];C.markerHolder&&(t.removeChild(C.markerHolder),C.markerHolder=null)}for(var S in this.plugins){var w=this.plugins[S];w.display&&w.initializeChart&&w.initializeChart(this)}if(!this.resizeListenerInitialized){var T=this;this.resizeListenerInitialized=!0;this.addDomEventListener(window,"resize",function(t){T.resizeChart()},!0)}u.baseline.userLevel&&(u.baseline.userLevel=null),this.setResizeTimer(this.resizeDetectMS),this.runAppend("initializeChart",arguments)}},i.ChartEngine.prototype.destroy=function(){this.setResizeTimer(0),this.quoteDriver&&this.quoteDriver.die(),this.styles={};for(var t=0;t<this.eventListeners.length;t++){var e=this.eventListeners[t];e.element.removeEventListener(e.event,e.function,e.options)}this.streamParameters.timeout&&clearTimeout(this.streamParameters.timeout);var a=i.ChartEngine.registeredContainers,r=a.indexOf(this.chart.container);if(r>-1&&a.splice(r,1),this.slider){var n=a.indexOf(this.slider.slider.chart.container);n>-1&&a.splice(n,1)}},i.ChartEngine.prototype.handleMouseOut=function(t){if(t=t||window.event,!i.withinElement(this.chart.container,t.pageX,t.pageY)){if(this.runPrepend("handleMouseOut",arguments))return;if(this.undisplayCrosshairs(),this.grabbingScreen=!1,this.touches=[],this.touching=!1,this.activeDrawing&&this.userPointerDown){this.userPointerDown=!1,this.drawingLine=!1;var e=this.backOutY(t.pageY),a=this.backOutX(t.pageX);this.drawingClick(this.currentPanel,a,e)}i.ChartEngine.insideChart=!1,this.displaySticky(),this.findHighlights(!1,!0),this.runAppend("handleMouseOut",arguments)}},i.ChartEngine.prototype.registerTouchAndMouseEvents=function(){if(!this.touchAndMouseEventsRegistered){this.touchAndMouseEventsRegistered=!0;var t=r("#zoomIn",this.controls.chartControls),e=r("#zoomOut",this.controls.chartControls),a=this.chart.container,n=this,s=function(t,e){n.addDomEventListener(a,t,e)};i.touchDevice?i.isSurface?(s("mousemove",function(t){n.msMouseMoveProxy(t)}),s("mousedown",function(t){n.msMouseDownProxy(t)}),s("mouseup",function(t){n.msMouseUpProxy(t)}),window.navigator.msPointerEnabled?(s("MSPointerDown",function(t){return n.startProxy(t)}),s("MSGestureStart",function(t){n.gestureInEffect=!0}),s("MSGestureChange",function(t){return n.touchmove(t)}),s("MSGestureEnd",function(t){return n.gestureInEffect=!1,n.touchend(t)}),s("MSPointerMove",function(t){n.moveProxy(t)}),s("MSPointerUp",function(t){return n.endProxy(t)})):(s("pointerdown",function(t){return n.startProxy(t)}),s("MSGestureStart",function(t){n.gestureInEffect=!0}),s("MSGestureChange",function(t){return n.touchmove(t)}),s("MSGestureEnd",function(t){return n.gestureInEffect=!1,n.touchend(t)}),s("pointermove",function(t){n.moveProxy(t)}),s("pointerup",function(t){return n.endProxy(t)}))):(i.isAndroid||i.ipad||i.iphone||(s("mousemove",function(t){n.iosMouseMoveProxy(t)}),s("mousedown",function(t){n.iosMouseDownProxy(t)}),s("mouseup",function(t){n.iosMouseUpProxy(t)})),s("touchstart",function(t){n.touchstart(t)}),s("touchmove",function(t){n.touchmove(t)}),s("touchend",function(t){n.touchend(t)}),t&&(t.removeAttribute("onMouseOver"),t.removeAttribute("onMouseOut")),e&&(e.removeAttribute("onMouseOver"),e.removeAttribute("onMouseOut"))):(s("mousemove",function(t){n.mousemove(t)}),s("mousedown",function(t){n.mousedown(t)}),s("mouseup",function(t){n.mouseup(t)}));var o=i.wheelEvent;this.captureMouseWheelEvents&&this.addDomEventListener(a,o,function(t){n.mouseWheel(t)})}},i.ChartEngine.prototype.rightClickHighlighted=function(){this.runPrepend("rightClickHighlighted",arguments)||(this.deleteHighlighted(!0),this.runAppend("rightClickHighlighted",arguments))},i.ChartEngine.prototype.deleteHighlighted=function(t,e){if(!this.runPrepend("deleteHighlighted",arguments)){this.cancelTouchSingleClick=!0,i.clearCanvas(this.chart.tempCanvas,this);var a=!1===this.bypassRightClick;if(a||!this.bypassRightClick.drawing)for(var r=this.drawingObjects.length-1;r>=0;r--){var n=this.drawingObjects[r];if(n.highlighted&&!n.permanent){if(!n.abort()){var s=i.shallowClone(this.drawingObjects);this.drawingObjects.splice(r,1),this.undoStamp(s,i.shallowClone(this.drawingObjects))}this.changeOccurred("vector")}}if(a||!this.bypassRightClick.study)for(var o in this.overlays){var l=this.overlays[o];l.highlight&&!l.permanent&&(t||e?this.rightClickOverlay(o,e):this.removeOverlay(o))}var h=this.currentPanel.chart;if(a||!this.bypassRightClick.series)for(var c in h.seriesRenderers)for(var u=h.seriesRenderers[c],p=u.seriesParams.length-1;p>=0;p--){var d=u.seriesParams[p];d.highlight&&!d.permanent&&(u.removeSeries(d.id),u.seriesParams.length<1&&this.removeSeriesRenderer(u))}this.draw(),this.clearMeasure();var m=this.controls.mSticky;m&&(m.style.display="none",m.children[0].innerHTML=""),this.runAppend("deleteHighlighted",arguments)}},i.ChartEngine.prototype.panelExists=function(t){for(var e in this.panels){if(this.panels[e].name==t)return!0}return!1},i.ChartEngine.prototype.hideCrosshairs=function(){this.displayCrosshairs=!1},i.ChartEngine.prototype.showCrosshairs=function(){this.displayCrosshairs=!0},i.ChartEngine.prototype.grabHandle=function(t){this.runPrepend("grabHandle",arguments)||t&&(i.ChartEngine.crosshairY=t.top+this.top,i.ChartEngine.resizingPanel=t,i.appendClassName(t.handle,"stx-grab"),this.runAppend("grabHandle",arguments))},i.ChartEngine.prototype.releaseHandle=function(){if(this.runPrepend("releaseHandle",arguments))return!0;i.clearCanvas(this.chart.tempCanvas,this),this.resizePanels(),i.ChartEngine.resizingPanel&&i.unappendClassName(i.ChartEngine.resizingPanel.handle,"stx-grab"),i.ChartEngine.resizingPanel=null,this.runAppend("releaseHandle",arguments)},i.ChartEngine.prototype.storePanels=function(){this.layout||(this.layout={});var t=this.layout;for(var e in t.panels={},this.panels){var i=this.panels[e];t.panels[i.name]={percent:i.percent,display:i.display,yAxis:i.yAxis}}},i.ChartEngine.prototype.savePanels=function(t){this.storePanels(),!1!==t&&this.changeOccurred("layout")},i.ChartEngine.prototype.resolveY=function(t){return this.top+t},i.ChartEngine.prototype.resolveX=function(t){return this.left+t},i.ChartEngine.prototype.backOutY=function(t){return t-this.top},i.ChartEngine.prototype.backOutX=function(t){return t-this.left},i.ChartEngine.prototype.cleanupRemovedStudy=function(t){for(var e in t.study.removeFN&&t.study.removeFN(this,t),t.study.feed&&this.detachTagAlongQuoteFeed(t.study.feed),this.plugins)e.indexOf("{"+t.id+"}")>-1&&delete this.plugins[e];this.layout.studies&&delete this.layout.studies[t.name],delete this.overlays[t.name],i.Studies.removeStudySymbols(t,this),this.quoteDriver&&this.quoteDriver.updateSubscriptions()},i.ChartEngine.prototype.privateDeletePanel=function(t){if(this.layout.studies){var e=this.layout.studies[t.name];e&&this.cleanupRemovedStudy(e)}if(delete this.panels[t.name],i.Studies)for(var a in i.Studies.studyPanelMap)i.Studies.studyPanelMap[a].panel==t.name&&delete i.Studies.studyPanelMap[a];for(var r in this.overlays)this.overlays[r].panel==t.name&&(this.cleanupRemovedStudy(this.layout.studies[r]),delete this.overlays[r]);if(t.holder&&(this.chart.container.removeChild(t.holder),this.getMarkerArray))for(var n=this.getMarkerArray("panelName",t.name),s=0;s<n.length;s++)this.removeFromHolder(n[s]);t.handle&&t.handle.parentNode.removeChild(t.handle),this.currentPanel=null},i.ChartEngine.prototype.panelClose=function(t){if(t&&!this.runPrepend("panelClose",arguments)){if(this.cancelTouchSingleClick=!0,i.ChartEngine.drawingLine=!1,t.soloing&&this.panelSolo(t),this.charts[t.name]){for(var e in this.panels){var a=this.panels[e];a.chart.name==t.name&&this.privateDeletePanel(a)}delete this.charts[t.name]}else this.privateDeletePanel(t);this.currentlyImporting||(this.showCrosshairs(),this.createDataSet(),this.calculateYAxisPositions(),this.adjustPanelPositions(),this.draw(),this.savePanels()),this.openDialog&&(this.openDialog=""),this.runAppend("panelClose",arguments)}},i.ChartEngine.prototype.deleteAllPanels=function(){for(var t in this.panels){var e=this.panels[t];this.privateDeletePanel(e)}this.layout.panels={},this.panels={}},i.ChartEngine.prototype.panelUp=function(t){this.cancelTouchSingleClick=!0,i.ChartEngine.drawingLine=!1,this.showCrosshairs();var e,a={},r=0;for(e in this.panels){if(e==t.name)break;r++}if(r){var n=0;for(e in this.panels)n==r-1&&(a[t.name]=t),e!=t.name&&(a[e]=this.panels[e],n++);this.panels=a,this.adjustPanelPositions(),this.draw(),this.savePanels()}},i.ChartEngine.prototype.panelDown=function(t){this.cancelTouchSingleClick=!0,i.ChartEngine.drawingLine=!1,this.showCrosshairs();var e,a={},r=0;for(e in this.panels){if(e==t.name)break;r++}var n=0;for(e in this.panels)n++;if(r!=n-1){var s=0;for(e in this.panels)e!=t.name?(a[e]=this.panels[e],s==r+1&&(a[t.name]=t),s++):s++;this.panels=a,this.adjustPanelPositions(),this.draw(),this.savePanels()}},i.ChartEngine.prototype.panelSolo=function(t){this.cancelTouchSingleClick=!0,i.ChartEngine.drawingLine=!1,this.showCrosshairs();var e=!0;for(var a in t.soloing?(e=!1,t.soloing=!1,i.unappendClassName(t.solo,"stx_solo_lit"),t.percent=t.oldPercent,"chart"==t.name||this.soloPanelToFullScreen||(this.chart.panel.percent=this.chart.panel.oldPercent),this.soloPanelToFullScreen&&(this.xAxisAsFooter=this.chart.panel.oldXAxisAsFooter,this.controls.home&&this.chart.panel.subholder.appendChild(this.controls.home))):(t.soloing=!0,i.appendClassName(t.solo,"stx_solo_lit"),t.oldPercent=t.percent,"chart"!=t.name&&(this.soloPanelToFullScreen?(this.chart.panel.oldXAxisAsFooter=this.xAxisAsFooter,this.xAxisAsFooter=!0,this.controls.home&&t.subholder.appendChild(this.controls.home)):(this.chart.panel.oldPercent=this.chart.panel.percent,t.percent=1-this.chart.panel.percent))),this.panels)this.panels[a].hidden=e;this.soloPanelToFullScreen||(this.chart.panel.hidden=!1),t.hidden=!1,this.adjustPanelPositions(),this.calculateYAxisPositions(),this.draw(),this.savePanels()},i.ChartEngine.prototype.calculatePanelPercent=function(t){var e=t.bottom-t.top;t.percent=e/this.chart.canvasHeight},i.ChartEngine.prototype.resizePanels=function(){if(i.ChartEngine.resizingPanel){var t,e,a,r=!0;if(i.ChartEngine.crosshairY>this.resolveY(i.ChartEngine.resizingPanel.top)&&(r=!1),r){for(t in a=null,this.panels){if(this.panels[t]==i.ChartEngine.resizingPanel)break;this.panels[t].hidden||(a=this.panels[t])}(e=this.backOutY(i.ChartEngine.crosshairY))<a.top+30&&(e=a.top+30,i.ChartEngine.crosshairY=this.resolveY(e)),a.bottom=e,i.ChartEngine.resizingPanel.top=e,this.calculatePanelPercent(a),this.calculatePanelPercent(i.ChartEngine.resizingPanel)}else{for(t in a=null,this.panels){if(this.panels[t]==i.ChartEngine.resizingPanel)break;this.panels[t].hidden||(a=this.panels[t])}(e=this.backOutY(i.ChartEngine.crosshairY))>i.ChartEngine.resizingPanel.bottom-30&&(e=i.ChartEngine.resizingPanel.bottom-30,i.ChartEngine.crosshairY=this.resolveY(e)),a.bottom=e,i.ChartEngine.resizingPanel.top=e,this.calculatePanelPercent(a),this.calculatePanelPercent(i.ChartEngine.resizingPanel)}this.adjustPanelPositions(),this.draw(),this.savePanels()}},i.ChartEngine.prototype.adjustPanelPositions=function(){if(this.chart.tempCanvas&&i.clearCanvas(this.chart.tempCanvas,this),this.chart.symbol&&!this.runPrepend("adjustPanelPositions",arguments)){var t,e,a,r=0,n=this.chart.canvasHeight,s=!1,o=0,l=0,h=!1;for(t in this.panels)e=this.panels[t],(isNaN(e.percent)||e.percent<=0)&&(e.percent=.05),e.hidden||(o+=e.percent,l++,e.soloing&&(h=!0));for(t in this.panels){var c=0;if((e=this.panels[t]).hidden)e.markerHolder&&(e.markerHolder.style.display="none");else{this.manageTouchAndMouse&&(e.up&&(s?this.displayIconsUpDown&&(e.up.style.display=""):(s=!0,e.up.style.display="none")),e.solo&&(h?e.soloing?this.displayIconsSolo&&(e.solo.style.display=""):e.solo.style.display="none":1==l?e.solo.style.display="none":2!=l||this.soloPanelToFullScreen?this.displayIconsSolo&&(e.solo.style.display=""):e.solo.style.display="none"),e.down&&(1==l?e.down.style.display="none":this.displayIconsUpDown&&(e.down.style.display="")),e.edit&&(e.editFunction?e.edit.style.display="":e.edit.style.display="none")),e.percent=e.percent/o,e.top=r,e.bottom=e.top+n*e.percent,e.height=e.bottom-e.top,e.chart.name==e.name&&(e.chart.top=e.top,e.chart.bottom=e.bottom,e.chart.height=e.height),r=e.bottom;for(var u=e.yaxisLHS.concat(e.yaxisRHS),p=0;p<u.length;p++){var d=u[p];d.zoom&&d.height>0&&(c=d.zoom/d.height),this.adjustYAxisHeightOffset(e,d),d.height=d.bottom-d.top,c&&(d.zoom=c*d.height,d.zoom>d.height&&(d.zoom=0,d.scroll=0)),d.high||0===d.high||(d.high=100,d.low=0,d.shadow=100),d.multiplier=d.height/d.shadow}e.holder&&(e.holder.style.right="0px",e.holder.style.top=e.top+"px",e.holder.style.left="0px",e.holder.style.height=e.height+"px",e.subholder.style.left=e.left+"px",e.subholder.style.width=e.width+"px",e.subholder.style.top="0px",e.yAxis.height>=0&&(e.subholder.style.height=e.yAxis.height+"px"))}}if(t&&this.panels[t].down&&(this.panels[t].down.style.display="none"),this.manageTouchAndMouse&&2==l&&!h&&this.chart.panel.solo&&(this.chart.panel.solo.style.display=""),this.controls.chartControls&&this.chart.panel)a=h&&this.soloPanelToFullScreen?this.chart.canvasHeight-e.yAxis.bottom+12:this.chart.canvasHeight-this.chart.panel.yAxis.bottom+12,this.controls.chartControls.style.bottom=a+"px";this.clearPixelCache(),this.adjustDrawings(),this.runAppend("adjustPanelPositions",arguments)}},i.ChartEngine.prototype.addChart=function(t,e){e.name=t,this.charts[t]=e},i.ChartEngine.prototype.createPanel=function(t,e,i,a,r){if(!this.runPrepend("createPanel",arguments)){a||(a="chart");var n=this.chart.canvasHeight;i||(i=.2*n);var s=i/n,o=1-s;for(var l in this.panels){this.panels[l].percent*=o}this.stackPanel(t,e,s,a,r),this.adjustPanelPositions(),this.savePanels(!1),this.runAppend("createPanel",arguments)}},i.ChartEngine.prototype.configurePanelControls=function(t){if(t.icons){var e,a,n,s,o,l,h,c,u,p,d,m,g,f,y=t.name==t.chart.name;i.appendClassName(t.icons,"stx-show"),t.title=r(".stx-panel-title",t.icons),t.up=r(".stx-ico-up",t.icons),t.up&&(t.up=t.up.parentNode),t.solo=r(".stx-ico-focus",t.icons),t.solo&&(t.solo=t.solo.parentNode),t.down=r(".stx-ico-down",t.icons),t.down&&(t.down=t.down.parentNode),t.edit=r(".stx-ico-edit",t.icons),t.edit&&(t.edit=t.edit.parentNode),t.close=r(".stx-ico-close",t.icons),t.close&&(t.close=t.close.parentNode),t.title&&(t.title.innerHTML="",t.display&&t.title.appendChild(document.createTextNode(t.display)),y&&(i.appendClassName(t.title,"chart-title"),i.appendClassName(t.icons,"stx-chart-panel"))),i.touchDevice&&!i.isSurface||this.makeModal(t.icons),t.handle&&(i.touchDevice&&!i.isSurface||(t.handle.onmouseover=(l=this,function(){l.hideCrosshairs()})),i.touchDevice&&!i.isSurface||(t.handle.onmouseout=(o=this,function(){o.showCrosshairs()})),i.touchDevice&&(t.handle.ontouchstart=(n=this,s=t,function(t){n.resizingPanel||(t.preventDefault(),n.grabHandle(s))}),t.handle.ontouchend=function(t){t.preventDefault()}),t.handle.onmousedown=(e=this,a=t,function(t){t||(t=event),e.grabHandle(a)}),t.handle.onmouseup=function(t){t||(t=event)}),t.close&&(i.safeClickTouch(t.close,(h=this,c=t,function(){h.panelClose(c)})),"chart"==t.name&&(t.close.style.display="none")),t.up&&i.safeClickTouch(t.up,(u=this,p=t,function(){u.panelUp(p)})),t.down&&i.safeClickTouch(t.down,(d=this,m=t,function(){d.panelDown(m)})),t.solo&&i.safeClickTouch(t.solo,(g=this,f=t,function(){g.panelSolo(f)}))}},i.ChartEngine.prototype.stackPanel=function(t,e,a,r,n){if(!this.runPrepend("stackPanel",arguments)){r||(r="chart");var s=this.charts[r],o=e==r;o&&(t=s.symbol,s.symbolDisplay&&(t=s.symbolDisplay),n||(n=s.yAxis));var l=this.panels[e]=new i.ChartEngine.Panel(e,n);!o&&s.yAxis&&l.yAxis.position==s.yAxis.position&&(l.yAxis.width=s.yAxis.width),o&&!s.panel&&(s.panel=l),l.percent=a,l.chart=s,l.display=t,l.holder=i.newChild(this.container,"div","stx-holder"),l.subholder=i.newChild(l.holder,"div","stx-subholder"),l.subholder.style.zIndex=1,l.holder.setAttribute("cq-panel-name",e),l.subholder.setAttribute("cq-panel-name",e);var h=o?"stx-panel-chart":"stx-panel-study";i.appendClassName(l.holder,h),this.controls.handleTemplate&&this.manageTouchAndMouse&&(l.handle=this.controls.handleTemplate.cloneNode(!0),this.container.appendChild(l.handle),l.handle.id=null,l.handle.panel=l),this.controls.iconsTemplate&&(l.icons=this.controls.iconsTemplate.cloneNode(!0),l.subholder.appendChild(l.icons),this.configurePanelControls(l)),this.resizeCanvas(),this.runAppend("stackPanel",arguments)}},i.ChartEngine.prototype.setPanelEdit=function(t,e){t.editFunction=e,t.edit&&i.safeClickTouch(t.edit,e),this.adjustPanelPositions()},i.ChartEngine.prototype.drawPanels=function(){if(!this.runPrepend("drawPanels",arguments)){var t=!1;for(var e in this.panels){var a=this.panels[e];a.state={};var r=this.translateIf(a.display);if(a.title&&a.title.textContent!=r&&(a.title.innerHTML="",a.title.appendChild(document.createTextNode(r))),i.appendClassName(a.icons,"stx-show"),a.hidden)i.unappendClassName(a.icons,"stx-show"),a.handle&&(a.handle.style.display="none"),a.holder.style.display="none";else{var n=this.manageTouchAndMouse;if(this.displayIconsUpDown&&n||!a.up||(a.up.style.display="none"),this.displayIconsUpDown&&n||!a.down||(a.down.style.display="none"),this.displayIconsSolo&&n||!a.solo||(a.solo.style.display="none"),this.displayIconsClose&&n||!a.close||(a.close.style.display="none"),a.editFunction&&n||!a.edit||(a.edit.style.display="none"),a.holder.style.display="block",t){var s=a.top;s=Math.round(s)+.5,this.plotLine(a.left,a.right,s,s,this.canvasStyle("stx_panel_border"),"segment",this.chart.context,!1,{}),a.handle&&(this.displayPanelResize?a.handle.style.display="":a.handle.style.display="none",a.handle.style.top=s-a.handle.offsetHeight/2+"px")}else a.handle&&(a.handle.style.display="none"),t=!0}}this.runAppend("drawPanels",arguments)}},i.ChartEngine.prototype.touchSingleClick=function(t,e,a){var r=this,n=arguments;return function(){(function(){if(!this.cancelTouchSingleClick){if(this.runPrepend("touchSingleClick",n))return;if(this.editingAnnotation)return;if(this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},!this.displayCrosshairs)return;if(!this.displayInitialized)return;if(""!==this.openDialog)return;if(e<this.left||e>this.right||a<this.top||a>this.bottom)return;var t=this.backOutY(i.ChartEngine.crosshairY),s=this.backOutX(i.ChartEngine.crosshairX);this.currentPanel=this.whichPanel(t);var o=this.currentVectorParameters.vectorType;if(!(i.Drawing&&o&&i.Drawing[o]&&(new i.Drawing[o]).dragToDraw)){if(!this.drawingClick(this.currentPanel,s,t)&&!this.layout.crosshair){i.ChartEngine.crosshairY=0,i.ChartEngine.crosshairX=0,this.cx=this.backOutX(i.ChartEngine.crosshairX),this.cy=this.backOutY(i.ChartEngine.crosshairY),this.findHighlights(),i.ChartEngine.crosshairY=a,i.ChartEngine.crosshairX=e;var l=this.container.getBoundingClientRect();this.top=l.top,this.left=l.left,this.right=this.left+this.width,this.bottom=this.top+this.height,this.cx=this.backOutX(i.ChartEngine.crosshairX),this.cy=this.backOutY(i.ChartEngine.crosshairY),this.currentPanel&&this.currentPanel.chart.dataSet&&(this.crosshairTick=this.tickFromPixel(this.cx,this.currentPanel.chart),this.crosshairValue=this.adjustIfNecessary(this.currentPanel,this.crosshairTick,this.valueFromPixel(this.cy,this.currentPanel))),this.headsUpHR(),this.findHighlights(!0)}this.currentVectorParameters.vectorType||this.dispatch("tap",{stx:this,panel:this.currentPanel,x:s,y:t})}}r.cancelTouchSingleClick=!1,this.runAppend("touchSingleClick",n)}).apply(r,n)}},i.ChartEngine.prototype.touchDoubleClick=function(t,e,a){if(!this.runPrepend("touchDoubleClick",arguments)&&!this.dispatch("doubleTap",{stx:this,finger:t,x:e,y:a})&&!(e<this.left||e>this.right||a<this.chart.panel.top||a>this.chart.panel.bottom||this.editingAnnotation)){if(i.ChartEngine.drawingLine)this.undo();else if(this.anyHighlighted)this.deleteHighlighted();else{var r=this.currentPanel.yAxis;r.scroll==(r.initialMarginTop-r.initialMarginBottom)/2&&r.zoom==r.initialMarginTop+r.initialMarginBottom?this.home():this.calculateYAxisMargins(this.currentPanel.yAxis),this.draw()}this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},this.runAppend("touchDoubleClick",arguments)}},i.ChartEngine.prototype.startProxy=function(t){if(4==t.pointerType||"mouse"==t.pointerType?this.mouseMode=!0:this.mouseMode=!1,!this.mouseMode)if(this.touches[this.touches.length]={pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY},this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY}],this.gestureInEffect||1!=this.touches.length)this.gesture.stop(),this.touchstart(t);else{if(this.gesturePointerId=t.pointerId,this.overrideGesture=!1,!this.gesture)return;this.gesture.addPointer(t.pointerId),this.touchstart(t)}},i.ChartEngine.prototype.moveProxy=function(t){4==t.pointerType||"mouse"==t.pointerType?this.mouseMode=!0:this.mouseMode=!1,this.mouseMode||this.gestureInEffect||this.touchmove(t)},i.ChartEngine.prototype.endProxy=function(t){if(!this.mouseMode){for(var e=this.touches.length,i=0;i<this.touches.length;i++)if(this.touches[i].pointerId==t.pointerId){this.touches.splice(i,1);break}if(i==e)return this.touches=[],this.grabbingScreen=!1,void(this.touching=!1);this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY}],this.gestureInEffect||this.touchend(t)}},i.ChartEngine.prototype.msMouseMoveProxy=function(t){!this.touches.length&&this.mouseMode&&this.mousemove(t)},i.ChartEngine.prototype.msMouseDownProxy=function(t){this.mouseMode&&this.mousedown(t)},i.ChartEngine.prototype.msMouseUpProxy=function(t){this.mouseMode&&this.mouseup(t)},i.ChartEngine.prototype.iosMouseMoveProxy=function(t){this.touching||this.mousemove(t)},i.ChartEngine.prototype.iosMouseDownProxy=function(t){this.touching?this.mouseMode=!1:(this.mouseMode=!0,this.mousedown(t))},i.ChartEngine.prototype.iosMouseUpProxy=function(t){this.touching||this.mouseup(t)},i.ChartEngine.prototype.rawWatermark=function(t,e,i,a){this.canvasFont("stx_watermark",t),t.fillStyle=this.defaultColor,t.globalAlpha=.5,this.chart.context.textBaseline="alphabetic",t.fillText(a,e,i),t.globalAlpha=1},i.ChartEngine.prototype.watermark=function(t,e){if(e&&"object"!=typeof e&&(e={h:arguments[1],v:arguments[2],text:arguments[3]}),e={h:e.h||"left",v:e.v||"bottom",text:e.text||"",hOffset:e.hOffset||10,vOffset:e.vOffset||20},this.chart.context){var i=this.panels[t];if(i&&!i.hidden){var a=i.yAxis.bottom-e.vOffset;"top"==e.v?a=i.top+e.vOffset:"middle"==e.v&&(a=(i.top+i.yAxis.bottom)/2),this.chart.context.save(),this.canvasFont("stx_watermark"),this.canvasColor("stx_watermark"),this.chart.context.textBaseline="alphabetic";var r=i.left+e.hOffset;"right"==e.h?r=i.right-e.hOffset:"center"==e.h&&(r=(i.right+i.left-this.chart.context.measureText(e.text).width)/2),this.chart.context.globalAlpha=.5,this.chart.context.fillText(e.text,r,a),this.chart.context.globalAlpha=1,this.chart.context.restore()}}},i.ChartEngine.prototype.preAdjustScroll=function(t){t||(t=this.chart),this.previousAdjust={chart:t,scroll:t.scroll,maxTicks:t.maxTicks}},i.ChartEngine.prototype.postAdjustScroll=function(){if(this.previousAdjust){var t=this.previousAdjust.chart;t.scroll=this.previousAdjust.scroll+(t.maxTicks-this.previousAdjust.maxTicks),this.displayInitialized&&this.draw()}},i.ChartEngine.prototype.adjustDrawings=function(){for(var t=0;t<this.drawingObjects.length;t++){var e=this.drawingObjects[t];this.panels[e.panelName]&&e.adjust()}},i.ChartEngine.prototype.getNextInterval=function(t,e,i){e||(e=1),!1!==i&&(i=!0);var a=this.standardMarketIterator(t,i?this.dataZone:this.displayZone);return e<1?a.previous(-1*e):a.next(e)},i.ChartEngine.prototype.standardMarketIterator=function(t,e,i){var a=i||this.chart,r={begin:t,interval:"tick"==this.layout.interval?1:this.layout.interval,periodicity:"tick"==this.layout.interval?this.chart.xAxis.futureTicksInterval:this.layout.periodicity,timeUnit:this.layout.timeUnit,outZone:e};return a.market.newIterator(r)},i.ChartEngine.prototype.zoomSet=function(t,e){var i=this.mainSeriesRenderer||{};if(!i.params||!i.params.volume){var a;a=this.preferences.zoomAtCurrentMousePosition&&this.zoomInitiatedByMouseWheel&&this.crosshairTick<e.dataSet.length?this.crosshairTick||this.tickFromPixel(this.cx,e):this.isHome()?e.dataSet.length-1:this.chart.scroll>this.chart.dataSet.length?0:"zoom-x"==this.grabMode?this.tickFromPixel(this.chart.width,e):this.tickFromPixel(this.chart.width/2,e),this.animations.zoom.hasCompleted&&(this.zoomInitiatedByMouseWheel=!1);var r=e.dataSet.length-1-a,n=e.scroll;e.scroll=Math.floor((this.pixelFromTick(a,e)-e.left)/t)+1+r,this.micropixels+=(n-r)*this.layout.candleWidth-(e.scroll-r)*t}this.setCandleWidth(t),e.spanLock=!1,this.draw(),this.doDisplayCrosshairs(),this.updateChartAccessories()},i.ChartEngine.prototype.zoomOut=function(t,e){if(!this.runPrepend("zoomOut",arguments)){this.preferences.zoomOutSpeed?e=this.preferences.zoomOutSpeed:e||(e=1.3),t&&t.preventDefault&&t.preventDefault(),this.cancelTouchSingleClick=!0;var a=this;for(var r in this.charts){var n=this.charts[r];if(i.ipad&&n.maxTicks>i.ChartEngine.ipadMaxTicks)return;var s=Math.floor(n.maxTicks*e);!1===n.allowScrollFuture&&!1===n.allowScrollPast&&s>n.dataSet.length&&(s=n.dataSet.length);var o=this.chart.width/s;o<this.minimumCandleWidth&&(o=this.minimumCandleWidth),this.layout.setSpan=null,this.layout.range=null,this.animations.zoom.run(l(n),this.layout.candleWidth,o)}}function l(t){return function(e){if(a.zoomSet(e,t),a.animations.zoom.hasCompleted){if(a.runAppend("zoomOut",arguments))return;a.changeOccurred("layout")}}}},i.ChartEngine.prototype.mouseWheel=function(t){if(!this.runPrepend("mouseWheel",arguments)){t||(t=event),t.preventDefault&&t.preventDefault();var e=t.deltaX,a=t.deltaY;if(Math.abs(a)>Math.abs(e)?e=0:a=0,this.lastMouseWheelEvent=Date.now(),0!==Math.abs(e)||0!==Math.abs(a)){if(this.allowSideswipe&&0!==e){this.lastMove="horizontal";var r=e;return r>50&&(r=50),r<-50&&(r=-50),this.grabbingScreen=!0,this.currentPanel||(this.currentPanel=this.chart.panel),this.grabStartX=i.ChartEngine.crosshairX,this.grabStartY=i.ChartEngine.crosshairY,this.grabStartScrollX=this.chart.scroll,this.grabStartScrollY=this.currentPanel.yAxis.scroll,this.grabStartMicropixels=this.micropixels,this.grabStartPanel=this.currentPanel,this.mousemoveinner(i.ChartEngine.crosshairX-r,i.ChartEngine.crosshairY),this.updateChartAccessories(),void(this.grabbingScreen=!1)}if(this.lastMove="vertical",this.allowZoom&&this.displayInitialized){a||("onmousewheel"==i.wheelEvent?(a=-.025*t.wheelDelta,t.wheelDeltaX&&(e=-.025*t.wheelDeltaX)):a=t.detail),void 0===t.deltaMode&&(t.deltaMode="MozMousePixelScroll"==t.type?0:1);var n=-a;1==t.deltaMode&&(n*=33);var s=null,o=null;if(this.mouseWheelAcceleration){var l=Math.max(Math.pow(Math.abs(n),.3),1);s=1-.1*l,o=1+.2*l}if(this.zoomInitiatedByMouseWheel=!0,n>0?this.reverseMouseWheel?this.zoomOut(null,o):this.zoomIn(null,s):n<0&&(this.reverseMouseWheel?this.zoomIn(null,s):this.zoomOut(null,o)),!this.runAppend("mouseWheel",arguments))return!1}}}},i.ChartEngine.prototype.zoomIn=function(t,e){if(!this.runPrepend("zoomIn",arguments)){this.preferences.zoomInSpeed?e=this.preferences.zoomInSpeed:e||(e=.7),t&&t.preventDefault&&t.preventDefault(),this.cancelTouchSingleClick=!0;var i=this;for(var a in this.charts){var r=this.charts[a],n=Math.floor(r.maxTicks*e);r.maxTicks-n<1&&(n=r.maxTicks-1),n<this.minimumZoomTicks&&(n=this.minimumZoomTicks);var s=this.chart.width/n;this.layout.setSpan=null,this.layout.range=null,this.animations.zoom.run(o(r),this.layout.candleWidth,s)}}function o(t){return function(e){if(i.zoomSet(e,t),i.animations.zoom.hasCompleted){if(i.runAppend("zoomIn",arguments))return;i.changeOccurred("layout")}}}},i.ChartEngine.prototype.translateIf=function(t){return this.translationCallback?this.translationCallback(t):t},i.ChartEngine.prototype.setTimeZone=function(t,e){if(void 0!==s){var i=new Date,a=i.getTimezoneOffset(),r=a,n=a;for(var o in t&&(this.dataZone=t),this.dataZone&&(r=new s.Date(i,this.dataZone).getTimezoneOffset()),e&&(this.displayZone=e),this.displayZone&&(n=new s.Date(i,this.displayZone).getTimezoneOffset()),this.timeZoneOffset=r-a-(n-a),this.charts){var l=this.charts[o];this.setDisplayDates(l.masterData)}this.preferences.timeZone=e,this.changeOccurred("preferences"),this.createDataSet()}else this.timeZoneOffset=0},i.ChartEngine.prototype.setLocale=function(t,e){if("undefined"!=typeof Intl&&this.locale!=t){this.locale=t;var a,r=this.internationalizer={};for(r.hourMinute=new Intl.DateTimeFormat(this.locale,{hour:"numeric",minute:"numeric",hour12:!1}),r.hourMinuteSecond=new Intl.DateTimeFormat(this.locale,{hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}),r.mdhm=new Intl.DateTimeFormat(this.locale,{year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),r.monthDay=new Intl.DateTimeFormat(this.locale,{month:"numeric",day:"numeric"}),r.yearMonthDay=new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"numeric",day:"numeric"}),r.yearMonth=new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"numeric"}),r.month=new Intl.DateTimeFormat(this.locale,{month:"short"}),r.numbers=new Intl.NumberFormat(this.locale),r.priceFormatters=[],e||(e=8),a=0;a<e+1;a++)r.priceFormatters.push(new Intl.NumberFormat(this.locale,{maximumFractionDigits:a,minimumFractionDigits:a}));for(a=0;a<5;a++){var n=a,s=a;a||(n="",s=2),r["percent"+n]=new Intl.NumberFormat(this.locale,{style:"percent",minimumFractionDigits:s,maximumFractionDigits:s})}i.I18N.createMonthArrays&&i.I18N.createMonthArrays(this,r.month,this.locale)}},i.ChartEngine.prototype.importLayout=function(t,e){if(t){"object"!=typeof e&&(e={managePeriodicity:arguments[1],preserveTicksAndCandleWidth:arguments[2]});var a=this.layout,r=i.shallowClone(a),n=e.managePeriodicity,s=e.cb,o=e.seriesCB,l=e.noDataLoad,h=this.minimumCandleWidth,c=e.preserveTicksAndCandleWidth;c||!1===c||(c=!0);var u=this.exportDrawings();if(this.abortDrawings(),this.currentlyImporting=!0,i.Studies)for(var p in a.studies){var d=a.studies[p];i.Studies.removeStudy(this,d)}this.overlays={};var m=i.shallowClone(this.panels);this.panels={};var g=i.clone(t);i.dataBindSafeAssignment(a,i.clone(g)),a.periodicity=r.periodicity,a.interval=r.interval,a.timeUnit=r.timeUnit,a.setSpan=r.setSpan,a.range=r.range,c?a.candleWidth=r.candleWidth:a.candleWidth||(a.candleWidth=8),a.candleWidth<h&&(a.candleWidth=h),this.setCandleWidth(a.candleWidth),"percent"==a.chartScale&&this.setComparison(!0);var f,y,v,x=g.panels,b=[];for(y in x){if(!("top"in x[y]))break;for((v=x[y]).name=y,f=b.length-1;f>=0&&b[f].top>v.top;--f);b.splice(f+1,0,v)}if(a.panels={},b.length>0)for(var C=0;C<b.length;++C)v=b[C],this.stackPanel(v.display,v.name,v.percent,v.chartName);else for(y in x)v=x[y],yAxis=v.yAxis?new i.ChartEngine.YAxis(v.yAxis):null,this.stackPanel(v.display,y,v.percent,v.chartName,yAxis);for(var S in i.isEmpty(x)&&this.stackPanel("chart","chart",1,"chart"),m){var w=m[S],T=this.panels[S];if(T){this.container.removeChild(T.holder),w.handle&&this.container.removeChild(w.handle);for(var M in{holder:!0,subholder:!0,display:!0})T[M]=w[M];this.configurePanelControls(T),w.chart.panel==w&&(w.chart.panel=T)}else this.privateDeletePanel(w)}if(this.adjustPanelPositions(),this.storePanels(),i.Studies){var D=i.clone(a.studies);for(var E in delete a.studies,D){var A=D[E];i.Studies.addStudy(this,A.type,A.inputs,A.outputs,A.parameters,A.panel)}}this.extendedHours&&this.extendedHours.prepare(a.extended,a.marketSessions),void 0===a.chartType&&(a.chartType="line"),this.setMainSeriesRenderer(),this.adjustPanelPositions();var k=this;if(!l){if(g.symbols&&g.symbols.length){var F={};n?c?g.interval&&(F.periodicity={interval:g.interval,period:g.periodicity,timeUnit:g.timeUnit}):g.range?F.range=g.range:g.setSpan&&(F.span=g.setSpan):F.periodicity={interval:r.interval,period:r.periodicity,timeUnit:r.timeUnit};var _=g.symbols[0].symbolObject||g.symbols[0].symbol;return void this.newChart(_,null,this.chart,function(t){if(!t)for(var e,a=1;a<g.symbols.length;++a){(e=g.symbols[a]).parameters||(e.parameters={});var r=i.clone(e.parameters);r.action=null,k.addSeries(e.id,r,o)}I(),s&&s.apply(null,arguments)},F)}if(n){if(!c){var P=g.range;if(P&&Object.keys(P).length&&this.chart.symbol)return void this.setRange(P,function(){I(),s&&s()});if(g.setSpan&&"{}"!=JSON.stringify(g.setSpan)&&this.chart.symbol)return void this.setSpan(g.setSpan,function(){I(),s&&s()})}var L=g.interval,O=g.periodicity,N=g.timeUnit;return isNaN(O)&&(O=1),L||(L="day"),void this.setPeriodicity({period:O,interval:L,timeUnit:N},function(){I(),s&&s()})}}n&&(a.periodicity=g.periodicity,a.interval=g.interval,a.timeUnit=g.timeUnit,a.setSpan=g.setSpan),this.createDataSet(),c||this.home(),I(),s&&s()}else e.cb&&e.cb();function I(){k.importDrawings(u),k.draw(),k.currentlyImporting=!1,k.updateListeners("layout")}},i.ChartEngine.prototype.exportLayout=function(t){var e={};for(var a in this.layout)"studies"!=a&&"panels"!=a?e[a]=i.clone(this.layout[a]):"studies"==a?e.studies={}:"panels"==a&&(e.panels={});for(var r in this.panels){var n=e.panels[r]={},s=this.panels[r];n.percent=s.percent,n.display=s.display,n.chartName=s.chart.name,n.top=s.top,s.yAxis.position&&(n.yAxis={position:s.yAxis.position})}for(var o in this.layout.studies){var l=e.studies[o]={},h=this.layout.studies[o];l.type=h.type,l.inputs=i.clone(h.inputs),l.outputs=i.clone(h.outputs),l.panel=h.panel,l.parameters=i.clone(h.parameters)}return t?e.symbols=this.getSymbols({"include-parameters":!0,"exclude-studies":!0}):delete e.symbols,e},i.ChartEngine.prototype.doCleanupDates=function(t,e){if(t&&t.length)for(var a=0;a<t.length;a++){var r=t[a],n=r.DT;if(n||r.Date){if(r.DT&&"[object String]"==Object.prototype.toString.call(n)&&n.length<=10)(n=new Date(n)).setMinutes(n.getMinutes()+n.getTimezoneOffset());else{var o=!0;if(r.DT||(n=i.strToDateTime(r.Date),r.Date.length<=10&&(o=!1)),"[object Date]"!=Object.prototype.toString.call(n)&&(n=new Date(n)),this.dataZone&&o){var l=new s.Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),this.dataZone),h=1e3*n.getSeconds()+n.getMilliseconds();n=new Date(l.getTime()+h)}i.ChartEngine.isDailyInterval(e)&&n.setHours(0,0,0,0)}r.DT||(r.Date=i.yyyymmddhhmmssmmm(n)),r.DT=n}}},i.ChartEngine.prototype.doCleanupGaps=function(t,e,a){if(!t||!t.length)return t;var r=this.layout.interval;a=a||{},e||(e=this.chart),a.noCleanupDates||this.doCleanupDates(t,r);var n=a.cleanupGaps?a.cleanupGaps:this.cleanupGaps,s="gap"==n;if(!n)return t;if("tick"==r)return t;if("month"==r||"week"==r){if(this.dontRoll)return t;r="day"}var o=function(t){return t.DT?"[object Date]"!=Object.prototype.toString.call(t.DT)?new Date(t.DT):new Date(+t.DT):i.strToDateTime(t.Date)},l=[],h=t[0];l.push(h);var c,u={begin:o(h),interval:r,periodicity:1,timeUnit:this.layout.timeUnit},p=e.market.newIterator(u),d=e.defaultPlotField;function m(t,e){for(;+t<+e;){var i=s?null:h[d],a=s?null:h.Adj_Close;l.push({DT:t,Open:i,High:i,Low:i,Close:i,Volume:0,Adj_Close:a}),t=p.next()}}function g(t,e){var a=t[d],r=e[d];void 0!==a&&void 0===r&&i.ensureDefaults(e,{Close:a,Open:a,High:a,Low:a,Volume:0,Adj_Close:t.Adj_Close})}for(var f=1;f<t.length;f++){var y=t[f];c=p.next();var v=o(y);for(m(c,v);v<c;){if(++f==t.length)return l;s||g(h,y),l.push(y),h=y,v=o(y=t[f])}c<v?(f--,c=p.previous()):(s||g(h,y),l.push(y),h=y)}return l},i.Comparison=function(){},i.Comparison.initialPrice=100,i.Comparison.getInitialPrice=function(t){if(t.initialComparisonPrice)return t.initialComparisonPrice;t.initialComparisonPrice=100;var e=i.Comparison.initialPrice;if("number"==typeof e&&(t.initialComparisonPrice=e),"string"==typeof e&&(t.series[e]||""===e)){var a="Close";t.defaultPlotField&&(t.highLowBars||(a=t.defaultPlotField));for(var r=t.dataSet.length-t.scroll;r<t.dataSet.length;r++){var n=t.dataSet[r];if(n){if(n[e]&&n[e][a]){t.initialComparisonPrice=n[e][a];break}if(""===e&&n[a]){t.initialComparisonPrice=n[a];break}}}}return t.initialComparisonPrice},i.Comparison.priceToPercent=function(t,e,a){var r=i.Comparison.baseline||a;return Math.round((a-r)/r*100*1e4)/1e4},i.Comparison.percentToPrice=function(t,e,a){return(i.Comparison.baseline||1)*(1+a/100)},i.Comparison.priceToRelative=function(t,e,a){var r=i.Comparison.baseline||a;return i.Comparison.getInitialPrice(e)*a/r},i.Comparison.relativeToPrice=function(t,e,a){return(i.Comparison.baseline||1)*a/i.Comparison.getInitialPrice(e)},i.Comparison.createComparisonSegmentInner=function(t,e){var a,r,n,s=[];for(a in e.series){var o=e.series[a].parameters;o.isComparison&&s.push(o.symbol)}var l=["Close","Open","High","Low","iqPrevClose"],h=t.chart.highLowBars||t.highLowBars[t.layout.chartType];e.defaultPlotField&&!h&&l.unshift(e.defaultPlotField);var c=l[0],u=t.layout.studies;if(u)for(var p in u){var d=u[p];if(r=t.panels[d.panel],n=t.getYAxisByName(r,d.name)||r.yAxis,r&&r.yAxis==n){for(a in d.outputMap)l.push(a);for(var m=0;m<=2;m++)l.push(d.name+"_hist"+(m||""));d.referenceOutput&&l.push(d.referenceOutput+" "+d.name)}}for(var g in t.plugins){var f=t.plugins[g];if(f.transformOutputs)for(a in f.transformOutputs)l.push(a)}e.initialComparisonPrice=null,e.dataSegment=[];var y=null,v=e.dataSet.length-e.scroll;t.micropixels+t.layout.candleWidth/2<0&&v++;for(var x=e.maxTicks+3,b=0;b<=x;b++){b==x&&(b=-1);var C=v+b;if(C<e.dataSet.length&&C>=0){var S,w=e.dataSet[C],T=w[c];if(!y){if(0===T||null===T){if(b<0)break;continue}y=i.clone(w)}for(w.transform||(w.transform={cache:{},DT:w.DT,Date:w.Date}),!i.Comparison.baseline&&T&&(y=i.clone(w)),i.Comparison.baseline=y[c],S=0;S<l.length;S++)(w[a=l[S]]||0===w[a])&&(w.transform[a]=e.transformFunc(t,e,w[a]));for(S=0;S<s.length;S++){a=s[S];var M=e.series[a];if(-1==b&&M&&M.parameters.isComparison)delete w.transform[a];else for(var D=w[a],E=0;D&&E<l.length;E++){var A=D[l[E]];if(A||0===A){var k=y[a]&&y[a][l[0]];if(k||0===k||(y[a]||(y[a]={}),y[a][l[E]]=k=A*i.Comparison.baseline/w[c]),0!==k){var F=A*((i.Comparison.baseline||1)/k);w.transform[a]||(w.transform[a]={}),w.transform[a][l[E]]=e.transformFunc(t,e,F)}}}}e.dataSegment.push(w)}else C<0&&e.dataSegment.push(null);if(b<0)break}},i.Comparison.priceFormat=function(t,e,i){if(null==i||isNaN(i))return"";var a=e.yAxis.priceTick,r=t.internationalizer;return i=r?a>=5?r.percent.format(i/100):a>=.5?r.percent1.format(i/100):a>=.05?r.percent2.format(i/100):a>=.005?r.percent3.format(i/100):r.percent4.format(i/100):a>=5?i.toFixed(0)+"%":a>=.5?i.toFixed(1)+"%":a>=.05?i.toFixed(2)+"%":a>=.005?i.toFixed(3)+"%":i.toFixed(4)+"%",0===parseFloat(i)&&"-"==i.charAt(0)&&(i=i.substring(1)),i},i.ChartEngine.prototype.setComparison=function(t,e,a){if(e||(e=this.chart),"string"==typeof e&&(e=this.charts[e]),(a||""===a)&&(i.Comparison.initialPrice=a),!0===t){if(e.isComparison)return;t="percent"}var r=e.panel.yAxis,n=r.priceFormatter==i.Comparison.priceFormat;switch(t){case"relative":this.setTransform(e,i.Comparison.priceToRelative,i.Comparison.relativeToPrice),n&&(r.priceFormatter=r.originalPriceFormatter?r.originalPriceFormatter.func:null,r.originalPriceFormatter=null),r.whichSet="dataSegment",e.isComparison=!0;break;case"percent":this.setTransform(e,i.Comparison.priceToPercent,i.Comparison.percentToPrice),n||(r.originalPriceFormatter={func:r.priceFormatter},r.priceFormatter=i.Comparison.priceFormat),r.whichSet="dataSegment",e.isComparison=!0;break;default:this.unsetTransform(e),n&&(r.priceFormatter=r.originalPriceFormatter?r.originalPriceFormatter.func:null,r.originalPriceFormatter=null),r.whichSet="dataSet",e.isComparison=!1}},i.ChartEngine.prototype.importPreferences=function(t){this.preferences=t,t.timeZone&&this.setTimeZone(this.dataZone,t.timeZone),t.language&&i.I18N&&(i.I18N.setLanguage(this,t.language),i.I18N.translateUI(t.language))},i.ChartEngine.prototype.exportPreferences=function(){return this.preferences},"undefined"!=typeof document&&document.addEventListener("contextmenu",i.ChartEngine.handleContextMenu),t},__market_=function(t){t||(t={});var e=t.CIQ,i=t.timezoneJS;e||(e=function(){},t.CIQ=e);var a=864e5;e.Market=function(t){this.market_def=!1,this.rules=!1,this.normalHours=[],this.extraHours=[],this.class_name="Market",this.tz_lib=void 0===i?Date:i.Date,this.market_tz="",this.hour_aligned=!1,this.convertOnDaily=!1,this.enabled_by_default=!1,void 0!==t&&t&&t!={}&&(t.market_definition&&(t=t.market_definition),t.rules&&(this.rules=t.rules),t.market_tz&&(this.market_tz=t.market_tz),t.convertOnDaily&&(this.convertOnDaily=t.convertOnDaily),t.hour_aligned,this.hour_aligned=t.hour_aligned,void 0!==t.enabled_by_default&&t.enabled_by_default instanceof Array&&(this.enabled_by_default=t.enabled_by_default),this.market_def=t,void 0===this.market_def.name&&(this.market_def.name="no market name specified"),e.Market._createTimeSegments(this))},e.Market.GLOBEX={name:"GLOBEX",market_tz:"America/Chicago",hour_aligned:!0,rules:[{dayofweek:0,open:"15:00",close:"24:00"},{dayofweek:1,open:"00:00",close:"24:00"},{dayofweek:2,open:"00:00",close:"24:00"},{dayofweek:3,open:"00:00",close:"24:00"},{dayofweek:4,open:"00:00",close:"24:00"},{dayofweek:5,open:"00:00",close:"18:00"}]},e.Market.FOREX={name:"FOREX",market_tz:"America/New_York",hour_aligned:!0,rules:[{dayofweek:0,open:"15:00",close:"24:00"},{dayofweek:1,open:"00:00",close:"17:00"},{dayofweek:1,open:"17:00",close:"24:00"},{dayofweek:2,open:"00:00",close:"17:00"},{dayofweek:2,open:"17:00",close:"24:00"},{dayofweek:3,open:"00:00",close:"17:00"},{dayofweek:3,open:"17:00",close:"24:00"},{dayofweek:4,open:"00:00",close:"17:00"},{dayofweek:4,open:"17:00",close:"24:00"},{dayofweek:5,open:"00:00",close:"17:00"}]},e.Market.METALS={name:"METALS",market_tz:"America/New_York",hour_aligned:!0,rules:[{dayofweek:0,open:"18:00",close:"24:00"},{dayofweek:1,open:"00:00",close:"17:15"},{dayofweek:1,open:"18:00",close:"24:00"},{dayofweek:2,open:"00:00",close:"17:15"},{dayofweek:2,open:"18:00",close:"24:00"},{dayofweek:3,open:"00:00",close:"17:15"},{dayofweek:3,open:"18:00",close:"24:00"},{dayofweek:4,open:"00:00",close:"17:15"},{dayofweek:4,open:"18:00",close:"24:00"},{dayofweek:5,open:"00:00",close:"17:15"}]},e.Market.NYSE={name:"NYSE",market_tz:"America/New_York",hour_aligned:!1,rules:[{dayofweek:1,open:"09:30",close:"16:00"},{dayofweek:2,open:"09:30",close:"16:00"},{dayofweek:3,open:"09:30",close:"16:00"},{dayofweek:4,open:"09:30",close:"16:00"},{dayofweek:5,open:"09:30",close:"16:00"},{dayofweek:1,open:"04:00",close:"09:30",name:"pre"},{dayofweek:2,open:"04:00",close:"09:30",name:"pre"},{dayofweek:3,open:"04:00",close:"09:30",name:"pre"},{dayofweek:4,open:"04:00",close:"09:30",name:"pre"},{dayofweek:5,open:"04:00",close:"09:30",name:"pre"},{dayofweek:1,open:"16:00",close:"20:00",name:"post"},{dayofweek:2,open:"16:00",close:"20:00",name:"post"},{dayofweek:3,open:"16:00",close:"20:00",name:"post"},{dayofweek:4,open:"16:00",close:"20:00",name:"post"},{dayofweek:5,open:"16:00",close:"20:00",name:"post"},{date:"*-12-25",open:"00:00",close:"00:00"},{date:"*-07-04",open:"00:00",close:"00:00"},{date:"*-01-01",open:"00:00",close:"00:00"},{date:"2012-01-02",open:"00:00",close:"00:00"},{date:"2018-01-15"},{date:"2018-02-19"},{date:"2018-03-30"},{date:"2018-05-28"},{date:"2018-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2018-07-03",open:"9:30",close:"13:00"},{date:"2018-09-03"},{date:"2018-11-22"},{date:"2018-11-23",open:"4:00",close:"9:30",name:"pre"},{date:"2018-11-23",open:"9:30",close:"13:00"},{date:"2018-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2018-12-24",open:"9:30",close:"13:00"},{date:"2017-01-02"},{date:"2017-01-16"},{date:"2017-02-20"},{date:"2017-04-14"},{date:"2017-05-29"},{date:"2017-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2017-07-03",open:"9:30",close:"13:00"},{date:"2017-09-04"},{date:"2017-11-23"},{date:"2017-11-24",open:"4:00",close:"9:30",name:"pre"},{date:"2017-11-24",open:"9:30",close:"13:00"},{date:"2016-01-18"},{date:"2016-02-15"},{date:"2016-03-25"},{date:"2016-05-30"},{date:"2016-09-05"},{date:"2016-11-24"},{date:"2016-11-25",open:"4:00",close:"9:30",name:"pre"},{date:"2016-11-25",open:"9:30",close:"13:00"},{date:"2016-12-26"},{date:"2015-01-19"},{date:"2015-02-16"},{date:"2015-04-03"},{date:"2015-05-25"},{date:"2015-07-03"},{date:"2015-09-07"},{date:"2015-11-26"},{date:"2015-11-27",open:"4:00",close:"9:30",name:"pre"},{date:"2015-11-27",open:"9:30",close:"13:00"},{date:"2015-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2015-12-24",open:"9:30",close:"13:00"},{date:"2014-01-20"},{date:"2014-02-17"},{date:"2014-04-18"},{date:"2014-05-26"},{date:"2014-09-01"},{date:"2014-11-27"},{date:"2014-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2014-07-03",open:"9:30",close:"13:00"},{date:"2014-11-28",open:"4:00",close:"9:30",name:"pre"},{date:"2014-11-28",open:"9:30",close:"13:00"},{date:"2014-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2014-12-24",open:"9:30",close:"13:00"},{date:"2013-01-21"},{date:"2013-02-18"},{date:"2013-03-29"},{date:"2013-05-27"},{date:"2013-09-02"},{date:"2013-11-28"},{date:"2013-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2013-07-03",open:"9:30",close:"13:00"},{date:"2013-11-29",open:"4:00",close:"9:30",name:"pre"},{date:"2013-11-29",open:"9:30",close:"13:00"},{date:"2013-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2013-12-24",open:"9:30",close:"13:00"},{date:"2012-01-16"},{date:"2012-02-20"},{date:"2012-04-06"},{date:"2012-05-28"},{date:"2012-09-03"},{date:"2012-10-29"},{date:"2012-10-30"},{date:"2012-11-22"},{date:"2012-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2012-07-03",open:"9:30",close:"13:00"},{date:"2012-11-23",open:"4:00",close:"9:30",name:"pre"},{date:"2012-11-23",open:"9:30",close:"13:00"},{date:"2012-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2012-12-24",open:"9:30",close:"13:00"}]},e.Market.Symbology=function(){},e.Market.Symbology.isForeignSymbol=function(t){return!!t&&-1!=t.indexOf(".")},e.Market.Symbology.isFuturesSymbol=function(t){return!!t&&(0===t.indexOf("/")&&"/"!=t)},e.Market.Symbology.isForexSymbol=function(t){return!!t&&(!e.Market.Symbology.isForeignSymbol(t)&&(!e.Market.Symbology.isFuturesSymbol(t)&&(!(t.length<6||t.length>7)&&((6!=t.length||"X"!=t[5])&&!!/\^?[A-Za-z]{6}/.test(t)))))},e.Market.Symbology.isForexMetal=function(t,i){return!!t&&(!!e.Market.Symbology.isForexSymbol(t)&&("^"!=t.charAt(0)&&(t="^"+t),-1!=",XAU,XPD,XPT,XAG,".indexOf(","+t.substr(4,3)+",")||!i&&-1!=",XAU,XPD,XPT,XAG,".indexOf(","+t.substr(1,3)+",")))},e.Market.Symbology.isForexFuturesSymbol=function(t){return!!e.Market.Symbology.isForexSymbol(t)||!!e.Market.Symbology.isFuturesSymbol(t)},e.Market.Symbology.factory=function(t){var i=t.symbol;return e.Market.Symbology.isForeignSymbol(i)?null:e.Market.Symbology.isFuturesSymbol(i)?e.Market.GLOBEX:e.Market.Symbology.isForexMetal(i)?e.Market.METALS:e.Market.Symbology.isForexSymbol(i)?e.Market.FOREX:e.Market.NYSE},e.Market.prototype._find_next_segment=function(t,e){if(!this.market_def)return null;if(!this.rules)return null;var i=new Date(+t),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz});if(this._wasOpenIntraDay(i)){var r=this.zseg_match.close_parts.hours,n=this.zseg_match.close_parts.minutes;i.setHours(r),i.setMinutes(n),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz})}return a.next()},e.Market.prototype._find_prev_segment=function(t,e){if(!this.market_def)return null;if(!this.rules)return null;var i=new Date(+t),a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz}),r=this._wasOpenIntraDay(i);if(null===r?(i=new Date(i-6e4),r=this._wasOpenIntraDay(i)):(e&&i.getHours()===this.zseg_match.open_parts.hours&&i.getMinutes()===this.zseg_match.open_parts.minutes||!e&&i.getHours()===this.zseg_match.close_parts.hours&&i.getMinutes()===this.zseg_match.close_parts.minutes)&&(i=a.previous()),r){var n=this.zseg_match.open_parts.hours,s=this.zseg_match.open_parts.minutes;return i.setHours(n),i.setMinutes(s),i=(a=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz})).previous(),this.zseg_match.close_parts.hours===n&&this.zseg_match.close_parts.minutes===s?e?a.next():i:this.zseg_match.adjacent_child?i:e?a.next():i}return a.previous()},e.Market.prototype.disableSession=function(t,e){var i=!1;if(void 0!==e&&e&&(i=!0),t){for(var a=0;a<this.normalHours.length;a++)this.normalHours[a].name===t&&(this.normalHours[a].enabled=i);for(a=0;a<this.extraHours.length;a++)this.extraHours[a].name===t&&(this.extraHours[a].enabled=i)}},e.Market.prototype.enableSession=function(t){this.disableSession(t,"enable_instead")},e.Market.prototype.getClose=function(t,e,i,a){if(!this.market_def)return null;if(!this.rules)return null;var r=t;if(t||(r=new Date,i=null),r=this._convertToMarketTZ(r,i),void 0!==e){if(this._wasOpenIntraDay(r)&&this.zseg_match.name===e)return r.setHours(this.zseg_match.close_parts.hours,this.zseg_match.close_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}else if(this._wasOpenDaily(r)){for(var n=this.zseg_match;n.child_;)n=n.child_;for(;!n.enabled;)n=n.parent_;return r.setHours(n.close_parts.hours,n.close_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}return null},e.Market.prototype.getNextClose=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;(t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),this._wasOpenIntraDay(a))||(a=this.newIterator({begin:a,interval:1,inZone:this.market_tz,outZone:this.market_tz}).next());for(var r=a.getDate(),n=this.zseg_match;n.adjacent_child;)n=n.adjacent_child,r+=1;return a.setDate(r),a.setHours(n.close_parts.hours,n.close_parts.minutes,0,0),a=this._convertFromMarketTZ(a,i)},e.Market.prototype.getNextOpen=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_next_segment(a),this.zseg_match.adjacent_parent?(a=this.getNextOpen(a,this.market_tz,this.market_tz),a=this._convertFromMarketTZ(a,i)):(a.setHours(this.zseg_match.open_parts.hours),a.setMinutes(this.zseg_match.open_parts.minutes),a=this._convertFromMarketTZ(a,i))},e.Market.prototype.getOpen=function(t,e,i,a){if(!this.market_def)return null;if(!this.rules)return null;var r=t;if(t||(r=new Date,i=null),r=this._convertToMarketTZ(r,i),void 0!==e){if(this._wasOpenIntraDay(r)&&this.zseg_match.name==e)return r.setHours(this.zseg_match.open_parts.hours,this.zseg_match.open_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}else if(this._wasOpenDaily(r)){for(var n=this.zseg_match;n.parent_;)n=n.parent_;for(;!n.enabled;)n=n.child_;return r.setHours(n.open_parts.hours,n.open_parts.minutes,0,0),r=this._convertFromMarketTZ(r,a)}return null},e.Market.prototype.getPreviousClose=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_prev_segment(a,!1),this.zseg_match.adjacent_child?this.getPreviousClose(a,this.market_tz,this.market_tz):(a.setHours(this.zseg_match.close_parts.hours),a.setMinutes(this.zseg_match.close_parts.minutes),a=this._convertFromMarketTZ(a,i))},e.Market.prototype.getPreviousOpen=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var a=t;return t||(a=new Date,e=null),a=this._convertToMarketTZ(a,e),a=this._find_prev_segment(a,!0),this.zseg_match.adjacent_parent?this.getPreviousOpen(this.market_tz,this.market_tz):(a.setHours(this.zseg_match.open_parts.hours),a.setMinutes(this.zseg_match.open_parts.minutes),a=this._convertFromMarketTZ(a,i))},e.Market.prototype.getSession=function(t,e){return t=this._convertToMarketTZ(t,e),this._wasOpenIntraDay(t)&&this.zseg_match?this.zseg_match.name:null},e.Market.prototype.marketZoneNow=function(){return this._convertToMarketTZ(new Date)},e.Market.prototype.isHourAligned=function(){return this.hour_aligned},e.Market.prototype.isOpen=function(){var t=new Date;return this.market_tz&&(t=new this.tz_lib(t.getTime(),this.market_tz)),this._wasOpenIntraDay(t)},e.Market.prototype.isMarketDay=function(){var t=new Date;return this.market_tz&&(t=new this.tz_lib(t.getTime(),this.market_tz)),this._wasOpenDaily(t)},e.Market.prototype.isMarketDate=function(t){return this._wasOpenDaily(t)},e.Market.prototype.newIterator=function(t){var i=!1;t.periodicity?i=t.periodicity:t.multiple&&(i=t.multiple);var a=t.interval;return a||(a="minute"),"hour"==a&&(a=60),i||(i=1),t.begin||(t.begin=new Date,t.inZone=null),a==parseInt(a,10)&&(a=parseInt(a,10),t.periodicity<1/60?(i=i*a*6e4,a="millisecond"):t.periodicity<1?(i=i*a*60,a="second"):(i*=a,a="minute")),t.timeUnit&&("millisecond"===t.timeUnit?a=t.timeUnit:"second"===t.timeUnit&&(a=t.timeUnit)),t.interval=a,t.multiple=i,t.market=this,new e.Market.Iterator(t)},e.Market.prototype._wasOpenDaily=function(t){return this._was_open(t,!1)},e.Market.prototype._wasOpenIntraDay=function(t){return this._was_open(t,!0)},e.Market.prototype._was_open=function(t,e){if(this.zopen_hour=0,this.zopen_minute=0,this.zclose_hour=0,this.zclose_minute=0,this.zmatch_open=!1,this.zseg_match=null,!this.market_def||!this.rules)return this.zclose_hour=24,!0;var i,a,r=!1,n=!1,s=t.getFullYear(),o=t.getMonth()+1,l=t.getDay(),h=t.getDate(),c=60*t.getHours()*60+60*t.getMinutes()+t.getSeconds();for(void 0===e&&(e=!0),a=0;a<this.normalHours.length;a++)if((i=this.normalHours[a]).enabled&&((r=i.dayofweek===l)&&e&&(r=c>=i.open&&c<i.close),r)){if(!e&&this.zseg_match&&(i.open_parts.hours>this.zopen_hour||i.open_parts.hours==this.zopen_hour&&i.open_parts.minutes>this.zopen_minute))continue;if(this.zopen_hour=i.open_parts.hours,this.zopen_minute=i.open_parts.minutes,this.zclose_hour=i.close_parts.hours,this.zclose_minute=i.close_parts.minutes,this.zmatch_open=c===i.open,this.zseg_match=i,e)break}for(a=0;a<this.extraHours.length;a++)if((i=this.extraHours[a]).enabled&&("*"===i.year||s===i.year)&&o===i.month&&h===i.day&&(!(n=!e&&i.open||c>=i.open&&c<i.close)&&this.zseg_match&&(r=!1,this.zopen_hour=0,this.zopen_minute=0,this.zclose_hour=0,this.zclose_minute=0,this.zmatch_open=!1,this.zseg_match=null),n)){if(!e&&this.zseg_match&&(i.open_parts.hours>this.zopen_hour||i.open_parts.hours==this.zopen_hour&&i.open_parts.minutes>this.zopen_minute))continue;if(this.zopen_hour=i.open_parts.hours,this.zopen_minute=i.open_parts.minutes,this.zclose_hour=i.close_parts.hours,this.zclose_minute=i.close_parts.minutes,this.zmatch_open=c===i.open,this.zseg_match=i,e)break}return this.zseg_match},e.Market.prototype._wasClosed=function(t){return!this._was_open(t,!0)},e.Market.prototype._wasOpen=function(t){return this._was_open(t,!0)},e.Market.prototype._tzDifferenceMillis=function(t,e,i){var a=t;return 60*(t.getTimezoneOffset()-a.getTimezoneOffset())*1e3},e.Market._createTimeSegments=function(t){for(var e,i=function(t,i){if(24===t.close_parts.hours&&0===i.open_parts.hours&&0===i.open_parts.minutes){if(e.dayofweek===s.dayofweek-1)return!0;if(6===e.dayofweek&&0===s.dayofweek)return!0}return!1},a=0;a<t.rules.length;a++){var n=JSON.parse(JSON.stringify(t.rules[a]));void 0===n.open&&void 0===n.close&&(n.open="00:00",n.close="00:00"),n.hasOwnProperty("name")||(n.name="");try{var s;if(void 0!==n.dayofweek?(n.year="*",s=r._createDayOfWeekSegment(t,n),e&&(e.dayofweek===s.dayofweek?(e.child_=s,s.parent_=e):i(e,s)&&(e.adjacent_child=s,s.adjacent_parent=e)),e=s):void 0!==n.date?(n.isDayOfWeek=!1,n.dayofweek=-1,s=r._createDateTimeSegment(t,n)):console.log("Error, unknown rule type "+n),t.enabled_by_default)for(var o=0;o<t.enabled_by_default.length;o++){var l=t.enabled_by_default[o];if(s.name===l){s.enabled=!0;break}}}catch(t){console.log("Error, creating market rules "+t)}}},e.Market._timeSegment={};var r=e.Market._timeSegment;r.re_wild_card_iso=/^(\*)-(\d\d)-(\d\d)$/,r.re_regular_iso=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,r.re_split_hours_minutes=/^(\d\d):(\d\d)$/,r.re_split_hour_minutes=/^(\d):(\d\d)$/,r._hashCode=function(t){var e,i,a=0;if(0===t.length)return a;for(e=0,i=t.length;e<i;e++)a=(a<<5)-a+t.charCodeAt(e),a|=0;return a},r._splitHoursMinutes=function(t){var e=r.re_split_hour_minutes.exec(t),i={hours:NaN,minutes:NaN};return null===e&&null===(e=r.re_split_hours_minutes.exec(t))?i:(i.hours=parseInt(e[1],10),i.minutes=parseInt(e[2],10),i)},r._createDayOfWeekSegment=function(t,e){var i={name:e.name,isDayOfWeek:!0,dayofweek:e.dayofweek,date_str:"*",open_parts:r._splitHoursMinutes(e.open),close_parts:r._splitHoursMinutes(e.close),open:r._secSinceMidnight(t,e.open,!0),close:r._secSinceMidnight(t,e.close,!1),child_:!1,parent_:!1,adjacent_child:!1,adjacent_parent:!1,enabled:!1};return""===i.name&&(i.enabled=!0),i.hash_code=this._hashCode((i.open+i.close).toString()),t.normalHours.push(i),i},r._createDateTimeSegment=function(t,e){var i,a=this.re_regular_iso.exec(e.date);if(null===a){if(null===(a=this.re_wild_card_iso.exec(e.date)))return void console.log("Warning: invalid date format on rule -> "+e.date);i="*"}else i=parseInt(a[1],10);var n={name:e.name,isDayOfWeek:!1,dayofweek:-1,year:i,month:parseInt(a[2],10),day:parseInt(a[3],10),date_str:e.date,open_parts:r._splitHoursMinutes(e.open),close_parts:r._splitHoursMinutes(e.close),open:r._secSinceMidnight(t,e.open,!0),close:r._secSinceMidnight(t,e.close,!1),enabled:!1};return""===n.name&&(n.enabled=!0),n.hash_key=this._hashCode(n.date_str+n.open+n.close),t.extraHours.push(n),n},r._secSinceMidnight=function(t,e,i){var a=e.split(":"),r=parseInt(a[0],10),n=60*r*60+60*parseInt(a[1],10);return i||24===r&&(n=60*r*60+1),n},e.Market.prototype._convertToMarketTZ=function(t,e){return this.market_tz?((i=e?new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),e):new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())).setTimezone&&i.setTimezone(this.market_tz),new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())):t;var i},e.Market.prototype._convertFromMarketTZ=function(t,e){if(!this.market_tz)return t;var i=new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),this.market_tz);return e?(i.setTimezone&&i.setTimezone(e),new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())):new Date(i.getTime())},e.Market.Iterator=function(t){this.market=t.market,this.begin=t.begin,this.interval=t.interval,this.multiple=t.multiple,this.inZone=t.inZone,this.outZone=t.outZone,this.clock=new e.Market.Iterator._Clock(t.market,t.interval,t.multiple),this.intraDay=this.clock.intra_day,this.intraDay&&(this.begin=this.market._convertToMarketTZ(this.begin,t.inZone)),this.clock._setStart(this.begin),this.clock.minutes_aligned=!1},e.Market.Iterator.prototype.date=function(){return this.clock._date()},e.Market.Iterator.prototype.futureTick=function(t){this.clock.skip=1;var e,i=0;e=this.intraDay?this.market._convertToMarketTZ(t.end,this.inZone).getTime():t.end.getTime();var a=this.clock.ctime;if(e===a)return i;var r=2,n=0;t.sample_size&&(r=t.sample_size);var s,o=(new Date).getTime();if(e>a){for(this.clock.forward=!0;this.clock.ctime<e;)if(i+=1,n+=1,this.clock._findNext(),1e3===n&&(n=0,(new Date).getTime()-o>=r)){s=(this.clock.ctime-a)/i,i=Math.floor((e-a)/s);break}this.clock.ctime>e&&i--}else for(this.clock.forward=!1;this.clock.ctime>e;)if(i+=1,n+=1,this.clock._findPrevious(),1e3===n&&(n=0,(new Date).getTime()-o>=r)){s=(a-this.clock.ctime)/i,i=Math.floor((a-e)/s);break}return i},e.Market.Iterator.prototype.isHourAligned=function(){return!this.intraDay||this.market.isHourAligned()},e.Market.Iterator.prototype.isOpen=function(){return this.market.isOpen()},e.Market.Iterator.prototype.next=function(t){this.clock.skip=1,t&&(this.clock.skip=t),this.clock.forward=!0;for(var e=0;e<this.clock.skip;e++)this.begin=this.clock._findNext();return this.intraDay||this.market.convertOnDaily?this.market._convertFromMarketTZ(this.clock.display_date,this.outZone):this.clock.display_date},e.Market.Iterator.prototype.peek=function(){return this.clock._peek()},e.Market.Iterator.prototype.previous=function(t){this.clock.skip=1,t&&(this.clock.skip=t),this.clock.forward=!1;for(var e=0;e<this.clock.skip;e++)this.begin=this.clock._findPrevious();return this.intraDay||this.market.convertOnDaily?this.market._convertFromMarketTZ(this.clock.display_date,this.outZone):this.clock.display_date},e.Market.Iterator._Clock=function(t,e,i){i%60==0&&"second"===e&&(e="minute",i/=60),this.market=t,this.interval=e,this.multiple=i,this.intra_day=!1,this.intervals=[],this.max_iters=10080;var r=a,n=this._dayImpl;"millisecond"===e?(n=this._millisImpl,r=1):"second"===e?(n=this._secondImpl,r=1e3):"minute"===e?(n=this._minuteImpl,r=6e4):"hour"===e?(n=this._hourImpl,r=36e5):"day"===e?(n=this._dayImpl,r=a):"week"===e?(n=this._weekImpl,r=7*a):"month"===e?(n=this._monthImpl,r=2592e6):console.log('Periodicity ERROR: "'+e+'" is not a valid interval. Please see setPeriodicity() for details.'),this.tick_time=r*i,this.intra_day=this.tick_time<a,this._findPrevious=this._findNext=n};var n=e.Market.Iterator._Clock.prototype;return n._total_minutes=function(t,e,i,a){return 60*(i-t)-e+a},n._alignMinutes=function(){if(void 0===this.market.zopen_minute)return[];var t=this.market.zopen_minute;this.market.isHourAligned()&&this.multiple%60==0&&(t=0);for(var e=this._total_minutes(this.market.zopen_hour,t,this.market.zclose_hour,this.market.zclose_minute),i=[],a=0;a<e;)i.push(t+a),a+=this.multiple;return i},n._alignBaseZero=function(t){for(var e=0,i=[e];!((e+=this.multiple)>=t);)i.push(e);return i},n._date=function(){var t=Math.round(this.ctime),e=new Date(t);return this.intra_day?this.display_date=new Date(t+this.shift_millis):this.display_date=e,e},n._alignToBoundary=function(t,e){for(var i=0,a=0,r=e,n=0;n<t.length-1&&(i=t[n],a=t[n+1],e!==i&&e!==a);n++){if(e>i&&e<a){r=i;break}n+1===t.length-1&&(r=a)}return r},n._peek=function(){return this._date().toString()},n._seekHr=function(){this.forward?this.ctime-=36e5:this.ctime+=36e5},n._setStart=function(t){var e=this.market._tzDifferenceMillis(t),i=new Date(t.getTime()+e);this.shift_millis=e,this.ctime=i.getTime(),this.shift_millis=0,this.ctime=t.getTime()},n._tickTock=function(){this.forward?this.ctime+=this.tick_time:this.ctime-=this.tick_time},n._tockTick=function(){this.forward?this.ctime-=this.tick_time:this.ctime+=this.tick_time},n._tickTock24=function(){this.ctime+=a},n._tockTick24=function(){this.ctime-=a},n._windMaybe=function(t,e){for(var i=0,a=new Date(this.ctime),r=!1;!t.call(this.market,a);)if(e.call(this),r=!0,a=new Date(this.ctime),(i+=1)>this.max_iters){var n="Warning! max iterations ("+this.max_iters;n+=") reached with no rule match.",console.log(n);break}return r},n._millisImpl=function(){var t=!1;if(!this.mperiods_aligned){var e=this._alignBaseZero(1e3),i=new Date(this.ctime),a=i.getMilliseconds();a=this._alignToBoundary(e,a),i.setMilliseconds(0),this.ctime=i.getTime()+a,this.mperiods_aligned=!0,t=!0}var r=this._date().getMinutes();this._tickTock();var n=this._date().getMinutes();if((t||r!=n)&&!this.market._wasOpenIntraDay(this._date())){var s=this.tick_time;this.tick_time=6e4;var o=this.multiple;this.multiple=1,this._minuteImpl(),this.tick_time=s,this.multiple=o}return this._date()},n._secondImpl=function(){var t=!1;if(!this.speriod_aligned){var e=this._alignBaseZero(60),i=new Date(this.ctime),a=i.getSeconds();a=this._alignToBoundary(e,a),i.setSeconds(a),i.setMilliseconds(0),this.ctime=i.getTime(),this.speriod_aligned=!0,t=!0}var r=this._date().getMinutes();this._tickTock();var n=this._date().getMinutes();if((t||r!=n)&&!this.market._wasOpenIntraDay(this._date())){var s=this.tick_time;this.tick_time=6e4;var o=this.multiple;this.multiple=1,this._minuteImpl(),this.tick_time=s,this.multiple=o}return this._date()},n._minuteImpl=function(){var t=this._windMaybe(this.market._wasOpenIntraDay,this._tockTick),e=new Date(this.ctime),i=e.getTimezoneOffset(),a=e.getMinutes(),r=e.getHours(),n=this._alignMinutes(),s=this._total_minutes(this.market.zopen_hour,this.market.zopen_minute,r,a)+this.market.zopen_minute;s=t?this.forward?n[n.length-1]:n[0]:this._alignToBoundary(n,s),r=Math.floor(s/60)+this.market.zopen_hour,e.setHours(r,s%60,0,0);var o=e.getTimezoneOffset()-i;(this.forward&&o<0||!this.forward&&o>0)&&e.setTime(e.getTime()-6e4*o),this.ctime=e.getTime(),this._tickTock();var l=this.market.zseg_match,h=this.market.hour_aligned&&this.multiple%60==0;if(this._windMaybe(this.market._wasOpenIntraDay,this._tickTock)||!h&&l!=this.market.zseg_match){if(e=new Date(this.ctime),this.forward)e.setMinutes(this.market.zopen_minute),e.setHours(this.market.zopen_hour);else{var c=(n=this._alignMinutes())[n.length-1];e.setMinutes(c%60),e.setHours(Math.floor(c/60)+this.market.zopen_hour)}this.ctime=e.getTime()}return this._date()},n._hourImpl=function(){this._windMaybe(this.market._wasOpenIntraDay,this._tockTick);var t=new Date(this.ctime);this.market.isHourAligned()?t.setMinutes(0):t.setMinutes(this.market.zopen_minute),t.setSeconds(0),t.setMilliseconds(0),this.ctime=t.getTime(),this._tickTock();var e=this.market.zseg_match;if(this._windMaybe(this.market._wasOpenIntraDay,this._tickTock)||!this.market.hour_aligned&&e!=this.market.zseg_match){if(current_date=new Date(this.ctime),this.forward)current_date.setMinutes(this.market.zopen_minute),current_date.setHours(this.market.zopen_hour);else{periods=this._alignMinutes();var i=periods[periods.length-1];current_date.setMinutes(i%60),current_date.setHours(Math.floor(i/60)+this.market.zopen_hour)}this.ctime=current_date.getTime()}return this._date()},n._dayImpl=function(){this._windMaybe(this.market._wasOpenDaily,this._seekHr);var t=new Date(this.ctime);t.setHours(12,0,0,0),this.ctime=t.getTime();for(var e=0;e<this.multiple;)this.forward?this._tickTock24():this._tockTick24(),this.market._wasOpenDaily(this._date())&&(e+=1);return(t=new Date(this.ctime)).setHours(0),this.ctime=t.getTime(),this._date()},n._weekImpl=function(){var t=new Date(this.ctime);for(t.setHours(12),this.ctime=t.getTime(),this._tickTock(),t=new Date(this.ctime);0!==t.getDay();)this._tockTick24(),t=new Date(this.ctime);return this._windMaybe(this.market._wasOpenDaily,this._tickTock24),(t=new Date(this.ctime)).setHours(0,0,0,0),this.ctime=t.getTime(),this._date()},n._monthImpl=function(){var t=new Date(this.ctime);return t.setDate(15),this.ctime=t.getTime(),this._tickTock(),(t=new Date(this.ctime)).setDate(1),t.setHours(12),this.ctime=t.getTime(),this._windMaybe(this.market._wasOpenDaily,this._tickTock24),(t=new Date(this.ctime)).setHours(0,0,0,0),this.ctime=t.getTime(),this._date()},n._findNext=null,n._findPrevious=null,t},__polyfills_=function(){},__timezone_=function(_exports){var CIQ=_exports.CIQ;return CIQ.timeZoneMap={"(UTC-11:00) American Samoa, Midway Island":"Pacific/Pago_Pago","(UTC-10:00) Hawaii":"Pacific/Honolulu","(UTC-09:00) Alaska":"America/Juneau","(UTC-08:00) Pacific Time (US and Canada)":"America/Los_Angeles","(UTC-08:00) Tijuana":"America/Tijuana","(UTC-07:00) Arizona":"America/Phoenix","(UTC-07:00) Chihuahua, Mazatlan":"America/Chihuahua","(UTC-07:00) Mountain Time (US and Canada)":"America/Denver","(UTC-06:00) Central America":"America/Costa_Rica","(UTC-06:00) Central Time (US and Canada)":"America/Chicago","(UTC-06:00) Guadalajara, Mexico City, Monterrey":"America/Mexico_City","(UTC-06:00) Saskatchewan":"America/Regina","(UTC-05:00) Bogota, Lima, Quito, Rio Branco":"America/Bogota","(UTC-05:00) Eastern Time (US and Canada)":"America/New_York","(UTC-05:00) Indiana (East)":"America/Indiana/Indianapolis","(UTC-04:00) Asuncion":"America/Asuncion","(UTC-04:00) Santiago":"America/Santiago","(UTC-04:00) Caracas":"America/Caracas","(UTC-04:00) Atlantic Time (Canada)":"America/Halifax","(UTC-04:00) Georgetown, La Paz, Manaus, San Juan":"America/Puerto_Rico","(UTC-03:30) Newfoundland and Labrador":"America/St_Johns","(UTC-03:00) Buenos Aires":"America/Argentina/Buenos_Aires","(UTC-03:00) Punta Arenas":"America/Punta_Arenas","(UTC-03:00) Montevideo":"America/Montevideo","(UTC-03:00) Sao Paulo":"America/Sao_Paulo","(UTC-02:00) Mid-Atlantic":"Atlantic/South_Georgia","(UTC-01:00) Azores":"Atlantic/Azores","(UTC-01:00) Cape Verde Islands":"Atlantic/Cape_Verde","(UTC) Greenwich Mean Time, Reykjavik":"UTC","(UTC) Casablanca":"Africa/Casablanca","(UTC) Dublin, Lisbon, London":"Europe/London","(UTC+01:00) Algiers, Tunis":"Africa/Tunis","(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna":"Europe/Amsterdam","(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague":"Europe/Belgrade","(UTC+01:00) Brussels, Copenhagen, Madrid, Paris":"Europe/Brussels","(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb":"Europe/Sarajevo","(UTC+02:00) Kaliningrad":"Europe/Kaliningrad","(UTC+02:00) Athens, Bucharest":"Europe/Bucharest","(UTC+02:00) Cairo":"Africa/Cairo","(UTC+02:00) Harare, Johannesburg":"Africa/Johannesburg","(UTC+02:00) Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius":"Europe/Helsinki","(UTC+02:00) Cyprus":"Asia/Nicosia","(UTC+02:00) Jerusalem":"Asia/Jerusalem","(UTC+03:00) Istanbul":"Europe/Istanbul","(UTC+03:00) Baghdad, Kuwait, Qatar, Riyadh":"Asia/Riyadh","(UTC+03:00) Minsk, Moscow, Kirov, Volgograd":"Europe/Moscow","(UTC+03:00) Simferopol":"Europe/Simferopol","(UTC+03:00) Nairobi":"Africa/Nairobi","(UTC+03:30) Tehran":"Asia/Tehran","(UTC+04:00) Baku":"Asia/Baku","(UTC+04:00) Dubai, Muscat":"Asia/Dubai","(UTC+04:00) Astrakhan, Samara, Saratov, Ulyanovsk":"Europe/Samara","(UTC+04:30) Kabul":"Asia/Kabul","(UTC+05:00) Karachi, Tashkent":"Asia/Karachi","(UTC+05:00) Yekaterinburg":"Asia/Yekaterinburg","(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi":"Asia/Kolkata","(UTC+05:45) Kathmandu":"Asia/Kathmandu","(UTC+06:00) Almaty":"Asia/Almaty","(UTC+06:00) Omsk":"Asia/Omsk","(UTC+06:00) Astana, Dhaka":"Asia/Dhaka","(UTC+06:30) Yangon":"Asia/Yangon","(UTC+07:00) Bangkok, Jakarta, Vietnam":"Asia/Bangkok","(UTC+07:00) Hovd":"Asia/Hovd","(UTC+07:00) Krasnoyarsk":"Asia/Krasnoyarsk","(UTC+07:00) Novokuznetsk":"Asia/Novokuznetsk","(UTC+07:00) Barnaul, Novosibirsk, Tomsk":"Asia/Novosibirsk","(UTC+08:00) Beijing, Chongqing, Hong Kong SAR":"Asia/Hong_Kong","(UTC+08:00) Brunei, Kuala Lumpur, Singapore":"Asia/Kuala_Lumpur","(UTC+08:00) Irkutsk":"Asia/Irkutsk","(UTC+08:00) Choibalsan, Ulaanbaatar":"Asia/Ulaanbaatar","(UTC+08:00) Manila, Taipei":"Asia/Taipei","(UTC+08:00) Perth":"Australia/Perth","(UTC+08:30) Pyongyang":"Asia/Pyongyang","(UTC+08:45) Eucla":"Australia/Eucla","(UTC+09:00) Osaka, Sapporo, Tokyo":"Asia/Tokyo","(UTC+09:00) Seoul":"Asia/Seoul","(UTC+09:00) Chita, Khandyga, Yakutsk":"Asia/Yakutsk","(UTC+09:30) Adelaide":"Australia/Adelaide","(UTC+09:30) Darwin":"Australia/Darwin","(UTC+10:00) Brisbane":"Australia/Brisbane","(UTC+10:00) Canberra, Melbourne, Sydney":"Australia/Sydney","(UTC+10:00) Guam, Port Moresby":"Pacific/Guam","(UTC+10:00) Ust-Nera, Vladivostok":"Asia/Vladivostok","(UTC+11:00) Noumea, Solomon Islands":"Pacific/Noumea","(UTC+11:00) Magadan":"Asia/Magadan","(UTC+11:00) Sakhalin, Srednekolymsk":"Asia/Srednekolymsk","(UTC+12:00) Anadyr, Kamchatka":"Asia/Kamchatka","(UTC+12:00) Auckland, Wellington":"Pacific/Auckland","(UTC+12:45) Chatham":"Pacific/Chatham","(UTC+13:00) Tonga":"Pacific/Tongatapu","(UTC+13:00) Samoa":"Pacific/Apia","(UTC+14:00) Kiritimati":"Pacific/Kiritimati"},function(){"use strict";var root=this,timezoneJS={};_exports.timezoneJS=timezoneJS,timezoneJS.VERSION="0.4.11";for(var ajax_lib=root.$||root.jQuery||root.Zepto,fleegix=root.fleegix,DAYS=timezoneJS.Days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],MONTHS=timezoneJS.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],SHORT_MONTHS={},SHORT_DAYS={},EXACT_DATE_TIME={},i=0;i<MONTHS.length;i++)SHORT_MONTHS[MONTHS[i].substr(0,3)]=i;for(i=0;i<DAYS.length;i++)SHORT_DAYS[DAYS[i].substr(0,3)]=i;var _arrIndexOf=Array.prototype.indexOf||function(t){if(null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var a=0;if(arguments.length>1&&((a=Number(arguments[1]))!=a?a=0:0!==a&&a!==1/0&&a!==-1/0&&(a=(a>0||-1)*Math.floor(Math.abs(a)))),a>=i)return-1;for(var r=a>=0?a:Math.max(i-Math.abs(a),0);r<i;r++)if(r in e&&e[r]===t)return r;return-1},_fixWidth=function(t,e){if("number"!=typeof t)throw"not a number: "+t;var i=t>1e3,a=t.toString(),r=a.length;if(i&&r>e)return a.substr(r-e,r);for(a=[a];r<e;)a.unshift("0"),r++;return a.join("")},_transport=function(t){if(t){if(!t.url)throw new Error("URL must be specified");if("async"in t||(t.async=!0),!(fleegix&&void 0!==fleegix.xhr||ajax_lib&&void 0!==ajax_lib.ajax))throw new Error("Please use the Fleegix.js XHR module, jQuery ajax, Zepto ajax, or define your own transport mechanism for downloading zone files.");return t.async?fleegix&&fleegix.xhr?fleegix.xhr.send({url:t.url,method:"get",handleSuccess:t.success,handleErr:t.error}):ajax_lib.ajax({url:t.url,dataType:"text",method:"GET",error:t.error,success:t.success}):fleegix&&fleegix.xhr?fleegix.xhr.doReq({url:t.url,async:!1}):ajax_lib.ajax({url:t.url,async:!1,dataType:"text"}).responseText}};timezoneJS.ruleCache={},timezoneJS.Date=function(){if(this===timezoneJS)throw"timezoneJS.Date object must be constructed with 'new'";var t=Array.prototype.slice.apply(arguments),e=null,i=null,a=[],r=!1;"[object Array]"===Object.prototype.toString.call(t[0])&&(t=t[0]),"string"==typeof t[t.length-1]&&(r=Date.parse(t[t.length-1].replace(/GMT[+-]\d+/,"")),(isNaN(r)||null===r)&&(i=t.pop()));var n=!1;switch(t.length){case 0:e=new Date;break;case 1:e=new Date(t[0]),"string"==typeof t[0]&&-1==t[0].search(/[+-][0-9]{4}/)&&-1==t[0].search(/Z/)&&-1==t[0].search(/T/)&&(n=!0);break;case 2:e=new Date(t[0],t[1]),n=!0;break;default:for(var s=0;s<7;s++)a[s]=t[s]||0;e=new Date(a[0],a[1],a[2],a[3],a[4],a[5],a[6]),n=!0}if(isNaN(e.getTime()))throw new Error("Invalid date");this._useCache=!1,this._tzInfo={},this._day=0,this.year=0,this.month=0,this.date=0,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0,this.timezone=i||null,n?this.setFromDateObjProxy(e):this.setFromTimeProxy(e.getTime(),i)},CIQ.extend(timezoneJS.Date.prototype,{getDate:function(){return this.date},getDay:function(){return this._day},getFullYear:function(){return this.year},getMonth:function(){return this.month},getYear:function(){return this.year-1900},getHours:function(){return this.hours},getMilliseconds:function(){return this.milliseconds},getMinutes:function(){return this.minutes},getSeconds:function(){return this.seconds},getUTCDate:function(){return this.getUTCDateProxy().getUTCDate()},getUTCDay:function(){return this.getUTCDateProxy().getUTCDay()},getUTCFullYear:function(){return this.getUTCDateProxy().getUTCFullYear()},getUTCHours:function(){return this.getUTCDateProxy().getUTCHours()},getUTCMilliseconds:function(){return this.getUTCDateProxy().getUTCMilliseconds()},getUTCMinutes:function(){return this.getUTCDateProxy().getUTCMinutes()},getUTCMonth:function(){return this.getUTCDateProxy().getUTCMonth()},getUTCSeconds:function(){return this.getUTCDateProxy().getUTCSeconds()},getTime:function(){return this._timeProxy+60*this.getTimezoneOffset()*1e3},getTimezone:function(){return this.timezone},getTimezoneOffset:function(){return this.getTimezoneInfo().tzOffset},getTimezoneAbbreviation:function(){return this.getTimezoneInfo().tzAbbr},getTimezoneInfo:function(){return this._useCache?this._tzInfo:(t=this.timezone?"Etc/UTC"===this.timezone||"Etc/GMT"===this.timezone?{tzOffset:0,tzAbbr:"UTC"}:timezoneJS.timezone.getTzInfo(this._timeProxy,this.timezone):{tzOffset:this.getLocalOffset(),tzAbbr:null},this._tzInfo=t,this._useCache=!0,t);var t},getUTCDateProxy:function(){var t=new Date(this._timeProxy);return t.setUTCMinutes(t.getUTCMinutes()+this.getTimezoneOffset()),t},setDate:function(t){return this.setAttribute("date",t),this.getTime()},setFullYear:function(t,e,i){return void 0!==i&&this.setAttribute("date",1),this.setAttribute("year",t),void 0!==e&&this.setAttribute("month",e),void 0!==i&&this.setAttribute("date",i),this.getTime()},setMonth:function(t,e){return this.setAttribute("month",t),void 0!==e&&this.setAttribute("date",e),this.getTime()},setYear:function(t){return 0<=(t=Number(t))&&t<=99&&(t+=1900),this.setUTCAttribute("year",t),this.getTime()},setHours:function(t,e,i,a){return this.setAttribute("hours",t),void 0!==e&&this.setAttribute("minutes",e),void 0!==i&&this.setAttribute("seconds",i),void 0!==a&&this.setAttribute("milliseconds",a),this.getTime()},setMinutes:function(t,e,i){return this.setAttribute("minutes",t),void 0!==e&&this.setAttribute("seconds",e),void 0!==i&&this.setAttribute("milliseconds",i),this.getTime()},setSeconds:function(t,e){return this.setAttribute("seconds",t),void 0!==e&&this.setAttribute("milliseconds",e),this.getTime()},setMilliseconds:function(t){return this.setAttribute("milliseconds",t),this.getTime()},setTime:function(t){if(isNaN(t))throw new Error("Units must be a number.");return this.setFromTimeProxy(t,this.timezone),this.getTime()},setUTCFullYear:function(t,e,i){return void 0!==i&&this.setUTCAttribute("date",1),this.setUTCAttribute("year",t),void 0!==e&&this.setUTCAttribute("month",e),void 0!==i&&this.setUTCAttribute("date",i),this.getTime()},setUTCMonth:function(t,e){return this.setUTCAttribute("month",t),void 0!==e&&this.setUTCAttribute("date",e),this.getTime()},setUTCDate:function(t){return this.setUTCAttribute("date",t),this.getTime()},setUTCHours:function(t,e,i,a){return this.setUTCAttribute("hours",t),void 0!==e&&this.setUTCAttribute("minutes",e),void 0!==i&&this.setUTCAttribute("seconds",i),void 0!==a&&this.setUTCAttribute("milliseconds",a),this.getTime()},setUTCMinutes:function(t,e,i){return this.setUTCAttribute("minutes",t),void 0!==e&&this.setUTCAttribute("seconds",e),void 0!==i&&this.setUTCAttribute("milliseconds",i),this.getTime()},setUTCSeconds:function(t,e){return this.setUTCAttribute("seconds",t),void 0!==e&&this.setUTCAttribute("milliseconds",e),this.getTime()},setUTCMilliseconds:function(t){return this.setUTCAttribute("milliseconds",t),this.getTime()},setFromDateObjProxy:function(t){this.year=t.getFullYear(),this.month=t.getMonth(),this.date=t.getDate(),this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds(),this.milliseconds=t.getMilliseconds(),this._day=t.getDay(),this._dateProxy=t,this._timeProxy=Date.UTC(this.year,this.month,this.date,this.hours,this.minutes,this.seconds,this.milliseconds),this._useCache=!1},setFromTimeProxy:function(t,e){var i=new Date(t),a=e?timezoneJS.timezone.getTzInfo(t,e,!0).tzOffset:i.getTimezoneOffset();i.setTime(t+6e4*(i.getTimezoneOffset()-a)),this.setFromDateObjProxy(i)},setAttribute:function(t,e){if(isNaN(e))throw new Error("Units must be a number.");var i=this._dateProxy;i["set"+("year"===t?"FullYear":t.substr(0,1).toUpperCase()+t.substr(1))](e),this.setFromDateObjProxy(i)},setUTCAttribute:function(t,e){if(isNaN(e))throw new Error("Units must be a number.");var i="year"===t?"FullYear":t.substr(0,1).toUpperCase()+t.substr(1),a=this.getUTCDateProxy();a["setUTC"+i](e),a.setUTCMinutes(a.getUTCMinutes()-this.getTimezoneOffset()),this.setFromTimeProxy(a.getTime()+6e4*this.getTimezoneOffset(),this.timezone)},setTimezone:function(t){var e=this.getTimezoneInfo().tzOffset;this.timezone=t,this._useCache=!1,this.setUTCMinutes(this.getUTCMinutes()-this.getTimezoneInfo().tzOffset+e)},removeTimezone:function(){this.timezone=null,this._useCache=!1},valueOf:function(){return this.getTime()},clone:function(){return this.timezone?new timezoneJS.Date(this.getTime(),this.timezone):new timezoneJS.Date(this.getTime())},toGMTString:function(){return this.toString("EEE, dd MMM yyyy HH:mm:ss Z","Etc/GMT")},toLocaleStringIntl:function(){},toLocaleDateString:function(){},toLocaleTimeString:function(){},toSource:function(){},toISOString:function(){return this.toString("yyyy-MM-ddTHH:mm:ss.SSS","Etc/UTC")+"Z"},toJSON:function(){return this.toISOString()},toDateString:function(){return this.toString("EEE MMM dd yyyy")},toTimeString:function(){return this.toString("H:mm k")},toString:function(t,e){t||(t="yyyy-MM-ddTHH:mm:ss.SSS");var i=t,a=e?timezoneJS.timezone.getTzInfo(this.getTime(),e):this.getTimezoneInfo(),r=this;e&&(r=this.clone()).setTimezone(e);var n=r.getHours();return i.replace(/a+/g,function(){return"k"}).replace(/y+/g,function(t){return _fixWidth(r.getFullYear(),t.length)}).replace(/d+/g,function(t){return _fixWidth(r.getDate(),t.length)}).replace(/m+/g,function(t){return _fixWidth(r.getMinutes(),t.length)}).replace(/s+/g,function(t){return _fixWidth(r.getSeconds(),t.length)}).replace(/S+/g,function(t){return _fixWidth(r.getMilliseconds(),t.length)}).replace(/h+/g,function(t){return _fixWidth(n%12==0?12:n%12,t.length)}).replace(/M+/g,function(t){var e=r.getMonth(),i=t.length;return i>3?timezoneJS.Months[e]:i>2?timezoneJS.Months[e].substring(0,i):_fixWidth(e+1,i)}).replace(/k+/g,function(){return n>=12?(n>12&&(n-=12),"PM"):"AM"}).replace(/H+/g,function(t){return _fixWidth(n,t.length)}).replace(/E+/g,function(t){return DAYS[r.getDay()].substring(0,t.length)}).replace(/Z+/gi,function(){return a.tzAbbr})},toUTCString:function(){return this.toGMTString()},civilToJulianDayNumber:function(t,e,i){var a;++e>12&&(a=parseInt(e/12,10),e%=12,t+=a),e<=2&&(t-=1,e+=12);var r=2-(a=Math.floor(t/100))+Math.floor(a/4);return Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))+i+r-1524},getLocalOffset:function(){return this._dateProxy.getTimezoneOffset()}},!0),timezoneJS.timezone=new function(){var _this=this,regionMap={Etc:"etcetera",EST:"northamerica",MST:"northamerica",HST:"northamerica",EST5EDT:"northamerica",CST6CDT:"northamerica",MST7MDT:"northamerica",PST8PDT:"northamerica",America:["northamerica","southamerica"],Pacific:"australasia",Atlantic:"europe",Africa:"africa",Indian:"africa",Antarctica:"antarctica",Asia:"asia",Australia:"australasia",Europe:"europe",WET:"europe",CET:"europe",MET:"europe",EET:"europe"},regionExceptions={"Pacific/Honolulu":"northamerica","Atlantic/Bermuda":"northamerica","Atlantic/Cape_Verde":"africa","Atlantic/St_Helena":"africa","Indian/Kerguelen":"antarctica","Indian/Chagos":"asia","Indian/Maldives":"asia","Indian/Christmas":"australasia","Indian/Cocos":"australasia","America/Danmarkshavn":"europe","America/Scoresbysund":"europe","America/Godthab":"europe","America/Thule":"europe","Asia/Istanbul":"europe","Asia/Yekaterinburg":"europe","Asia/Omsk":"europe","Asia/Novosibirsk":"europe","Asia/Krasnoyarsk":"europe","Asia/Irkutsk":"europe","Asia/Yakutsk":"europe","Asia/Vladivostok":"europe","Asia/Sakhalin":"europe","Asia/Magadan":"europe","Asia/Kamchatka":"europe","Asia/Anadyr":"europe","Africa/Ceuta":"europe",GMT:"etcetera","Europe/Nicosia":"asia"};function invalidTZError(t){throw new Error("Timezone '"+t+"' is either incorrect, or not loaded in the timezone registry.")}function builtInLoadZoneFile(t,e){var i=_this.zoneFileBasePath+"/"+t;return e&&e.async?_this.transport({async:!0,url:i,success:function(t){return _this.parseZones(t)&&"function"==typeof e.callback&&e.callback()},error:function(){throw new Error("Error retrieving '"+i+"' zoneinfo files")}}):_this.parseZones(_this.transport({url:i,async:!1}))}function getRegionForTimezone(t){var e,i,a=regionExceptions[t];if(a)return a;if(e=t.split("/")[0],i=regionMap[e])return i;var r=_this.zones[t];return"string"==typeof r?getRegionForTimezone(r):_this.loadedZones.backward?void invalidTZError(t):(_this.loadZoneFile("backward"),getRegionForTimezone(t))}function parseTimeString(t){var e=t.match(/(\d+)(?::0*(\d*))?(?::0*(\d*))?([wsugz])?$/);return e[1]=parseInt(e[1],10),e[2]=e[2]?parseInt(e[2],10):0,e[3]=e[3]?parseInt(e[3],10):0,e.slice(1,5)}function processZone(t){if(t[3]){var e=parseInt(t[3],10),i=11,a=31;t[4]&&(i=SHORT_MONTHS[t[4].substr(0,3)],a=parseInt(t[5],10)||1);var r=t[6]?parseTimeString(t[6]):[0,0,0];return[e,i,a,r[0],r[1],r[2]]}}function getZone(t,e){for(var i="number"==typeof t?t:new Date(+t).getTime(),a=e,r=_this.zones[a];"string"==typeof r;)a=r,r=_this.zones[a];if(!r){if(!_this.loadedZones.backward)return _this.loadZoneFile("backward"),getZone(t,e);if(a&&a!==e)return _this.lazyLoadZoneFiles(a),getZone(t,a);invalidTZError(a)}if(0===r.length)throw new Error("No Zone found for '"+e+"' on "+t);for(var n=r.length-1;n>=0;n--){var s=r[n];if(s[3]&&i>s[3])break}return r[n+1]}function getBasicOffset(t){var e=parseTimeString(t);return(e=("-"===t.charAt(0)?-1:1)*(1e3*(60*(60*e[0]+e[1])+e[2])))/60/1e3}function getAdjustedOffset(t,e){return-Math.ceil(e-t)}function getRule(t,e,i,a){var r="number"==typeof t?new Date(t):t,n=e[1],s=e[0],o=n.match(/^([0-9]):([0-9][0-9])$/);if(o)return[-1e6,"max","-","Jan",1,[0,0,0],60*parseInt(o[1],10)+parseInt(o[2],10),"-"];var l,h,c=function(t,e,i){var a=0;if("u"===e||"g"===e||"z"===e)a=0;else if("s"===e)a=s;else{if("w"!==e&&e)throw new Error("unknown type "+e);a=getAdjustedOffset(s,i[6])}return a*=6e4,new Date(t.getTime()+a)},u=function(t,e){var i,a=t[0],r=t[1],n=r[5];if(EXACT_DATE_TIME[a]||(EXACT_DATE_TIME[a]={}),EXACT_DATE_TIME[a][r])i=EXACT_DATE_TIME[a][r];else{if(isNaN(r[4])){var s,o;"last"===r[4].substr(0,4)?(i=new Date(Date.UTC(a,SHORT_MONTHS[r[3]]+1,1,n[0]-24,n[1],n[2],0)),s=SHORT_DAYS[r[4].substr(4,3)],o="<="):(i=new Date(Date.UTC(a,SHORT_MONTHS[r[3]],r[4].substr(5),n[0],n[1],n[2],0)),s=SHORT_DAYS[r[4].substr(0,3)],o=r[4].substr(3,2));var l=i.getUTCDay();">="===o?i.setUTCDate(i.getUTCDate()+(s-l+(s<l?7:0))):i.setUTCDate(i.getUTCDate()+(s-l-(s>l?7:0)))}else i=new Date(Date.UTC(a,SHORT_MONTHS[r[3]],r[4],n[0],n[1],n[2],0));EXACT_DATE_TIME[a][r]=i}return e&&(i=c(i,n[3],e)),i},p=function(t,e){for(var i=[],a=0;e&&a<e.length;a++)e[a][0]<=t&&(e[a][1]>=t||e[a][0]===t&&"only"===e[a][1]||"max"===e[a][1])&&i.push([t,e[a]]);return i},d=function(t,e,a){var r,n;return t instanceof Date?a&&(t=c(t,i?"u":"w",a)):(r=t[0],n=t[1],t=!a&&EXACT_DATE_TIME[r]&&EXACT_DATE_TIME[r][n]?EXACT_DATE_TIME[r][n]:u(t,a)),e instanceof Date?a&&(e=c(e,i?"u":"w",a)):(r=e[0],n=e[1],e=!a&&EXACT_DATE_TIME[r]&&EXACT_DATE_TIME[r][n]?EXACT_DATE_TIME[r][n]:u(e,a)),(t=Number(t))-(e=Number(e))},m=r.getUTCFullYear(),g=timezoneJS.ruleCache[a];if(g||(g=timezoneJS.ruleCache[a]={}),(l=g[m])||((l=(l=p(m-1,_this.rules[n])).concat(p(m,_this.rules[n]))).sort(d),g[m]=l),!l||!l.length)return null;for(var f=l.length-1;f>=0;f--){h=f>0?l[f-1][1]:null;var y=l[f];if(y[2]||(y[2]=u(y,h)),d(r,y,h)>=0)return y[1]}return null}function getAbbreviation(t,e){var i,a=t[2];return a.indexOf("%s")>-1?(i=e?"-"===e[7]?"":e[7]:"S",a.replace("%s",i)):a.indexOf("/")>-1?a.split("/",2)[e&&e[6]?1:0]:a}this.zoneFileBasePath=null,this.zoneFiles=["africa","antarctica","asia","australasia","backward","etcetera","europe","northamerica","pacificnew","southamerica"],this.loadingSchemes={PRELOAD_ALL:"preloadAll",LAZY_LOAD:"lazyLoad",MANUAL_LOAD:"manualLoad"},this.getRegionForTimezone=getRegionForTimezone,this.loadingScheme=this.loadingSchemes.LAZY_LOAD,this.loadedZones={},this.zones={},this.rules={},this.init=function(t){var e={async:!0},i=this.loadingScheme===this.loadingSchemes.PRELOAD_ALL?this.zoneFiles:this.defaultZoneFile||"northamerica";for(var a in t)e[a]=t[a];return this.loadZoneFiles(i,e)},this.loadZoneFiles=function(t,e){var i,a=0;if("string"==typeof t)return this.loadZoneFile(t,e);i=(e=e||{}).callback,e.callback=function(){++a===t.length&&"function"==typeof i&&i()};for(var r=0;r<t.length;r++)this.loadZoneFile(t[r],e)},this.loadZoneFile=function(t,e){if(void 0===this.zoneFileBasePath)throw new Error("Please define a base path to your zone file directory -- timezoneJS.timezone.zoneFileBasePath.");if(!this.loadedZones[t])return this.loadedZones[t]=!0,builtInLoadZoneFile(t,e)},this.loadZoneJSONData=function(url,sync){var processData=function(data){for(var z in data=eval("("+data+")"),data.zones)_this.zones[z]=data.zones[z];for(var r in data.rules)_this.rules[r]=data.rules[r]};return sync?processData(_this.transport({url:url,async:!1})):_this.transport({url:url,success:processData})},this.loadZoneDataFromObject=function(t){if(t){for(var e in t.zones)_this.zones[e]=t.zones[e];for(var i in t.rules)_this.rules[i]=t.rules[i]}},this.getAllZones=function(){var t=[];for(var e in this.zones)t.push(e);return t.sort()},this.parseZones=function(t){if(!t)return!1;for(var e,i=t.split("\n"),a=[],r=null,n=null,s=0;s<i.length;s++)if((e=i[s]).match(/^\s/)&&(e="Zone "+r+e),(e=e.split("#")[0]).length>3)switch((a=e.split(/\s+/)).shift()){case"Zone":if(r=a.shift(),_this.zones[r]||(_this.zones[r]=[]),a.length<3)break;a.splice(3,a.length,processZone(a)),a[3]&&(a[3]=Date.UTC.apply(null,a[3])),a[0]=-getBasicOffset(a[0]),_this.zones[r].push(a);break;case"Rule":n=a.shift(),_this.rules[n]||(_this.rules[n]=[]),a[0]=parseInt(a[0],10),a[1]=parseInt(a[1],10)||a[1],a[5]=parseTimeString(a[5]),a[6]=getBasicOffset(a[6]),_this.rules[n].push(a);break;case"Link":if(_this.zones[a[1]])throw new Error("Error with Link "+a[1]+". Cannot create link of a preexisted zone.");isNaN(a[0])?_this.zones[a[1]]=a[0]:_this.zones[a[1]]=parseInt(a[0],10)}return!0},this.transport=_transport,this.getTzInfo=function(t,e,i){this.lazyLoadZoneFiles(e);var a=getZone(t,e),r=+a[0],n=getRule(t,a,i,e);return n&&(r=getAdjustedOffset(r,n[6])),{tzOffset:r,tzAbbr:getAbbreviation(a,n)}},this.lazyLoadZoneFiles=function(t){if(this.loadingScheme===this.loadingSchemes.LAZY_LOAD){var e=getRegionForTimezone(t);if(!e)throw new Error("Not a valid timezone ID.");this.loadZoneFiles(e)}}}}.call("undefined"!=typeof window?window:this),_exports.timezoneJS.timezone.loadingScheme=_exports.timezoneJS.timezone.loadingSchemes.MANUAL_LOAD,_exports.timezoneJS.timezone.loadZoneDataFromObject({zones:{"Atlantic/Cape_Verde":[[60,"-","-01",null]],"Africa/Cairo":[[-120,"Egypt","EE%sT",null]],"Africa/Nairobi":[[-180,"-","EAT",null]],"Africa/Casablanca":[[0,"Morocco","WE%sT",null]],"Africa/Johannesburg":[[-120,"SA","SAST",null]],"Africa/Tunis":[[-60,"Tunisia","CE%sT",null]],"Asia/Kabul":[[-270,"-","+0430",null]],"Asia/Baku":[[-240,"Azer","+04/+05",null]],"Asia/Dhaka":[[-360,"Dhaka","+06/+07",null]],"Asia/Yangon":[[-390,"-","+0630",null]],"Asia/Shanghai":[[-480,"PRC","C%sT",null]],"Asia/Hong_Kong":[[-480,"HK","HK%sT",null]],"Asia/Taipei":[[-480,"Taiwan","C%sT",null]],"Asia/Nicosia":[[-120,"EUAsia","EE%sT",null]],"Asia/Kolkata":[[-330,"-","IST",null]],"Asia/Tehran":[[-210,"Iran","+0330/+0430",null]],"Asia/Jerusalem":[[-120,"Zion","I%sT",null]],"Asia/Tokyo":[[-540,"Japan","J%sT",null]],"Asia/Almaty":[[-360,"-","ALMT",null]],"Asia/Seoul":[[-540,"ROK","K%sT",null]],"Asia/Pyongyang":[[-540,"-","KST",14395968e5],[-510,"-","KST",null]],"Asia/Kuala_Lumpur":[[-480,"-","+08",null]],"Asia/Hovd":[[-420,"Mongol","+07/+08",null]],"Asia/Ulaanbaatar":[[-480,"Mongol","+08/+09",null]],"Asia/Kathmandu":[[-345,"-","+0545",null]],"Asia/Karachi":[[-300,"Pakistan","PK%sT",null]],"Asia/Riyadh":[[-180,"-","+03",null]],"Asia/Bangkok":[[-420,"-","+07",null]],"Asia/Dubai":[[-240,"-","+04",null]],"Australia/Darwin":[[-570,"Aus","CST",null]],"Australia/Perth":[[-480,"AW","WST",null]],"Australia/Eucla":[[-525,"AW","+0845/+0945",null]],"Australia/Brisbane":[[-600,"AQ","EST",null]],"Australia/Adelaide":[[-570,"AS","CST",null]],"Australia/Sydney":[[-600,"AN","EST",null]],"Pacific/Guam":[[-600,"-","ChST",null]],"Pacific/Kiritimati":[[-840,"-","+14",null]],"Pacific/Noumea":[[-660,"NC","+11/+12",null]],"Pacific/Auckland":[[-720,"NZ","NZ%sT",null]],"Pacific/Chatham":[[-765,"Chatham","+1245/+1345",null]],"Pacific/Pago_Pago":[[660,"-","SST",null]],"Pacific/Apia":[[-780,"WS","+13/+14",null]],"Pacific/Tongatapu":[[-780,"Tonga","+13/+14",null]],"Etc/UTC":[[0,"-","UTC",null]],UTC:"Etc/UTC","Europe/London":[[0,"EU","GMT/BST",null]],WET:[[0,"EU","WE%sT",null]],CET:[[-60,"C-Eur","CE%sT",null]],MET:[[-60,"C-Eur","ME%sT",null]],EET:[[-120,"EU","EE%sT",null]],"Europe/Brussels":[[-60,"EU","CE%sT",null]],"Europe/Helsinki":[[-120,"EU","EE%sT",null]],"Europe/Paris":[[-60,"EU","CE%sT",null]],"Europe/Berlin":[[-60,"EU","CE%sT",null]],"Europe/Amsterdam":[[-60,"EU","CE%sT",null]],"Atlantic/Azores":[[60,"EU","AZO%sT",null]],"Europe/Bucharest":[[-120,"EU","EE%sT",null]],"Europe/Kaliningrad":[[-180,"-","+03",14142888e5],[-120,"-","EET",null]],"Europe/Moscow":[[-240,"-","MSK",14142888e5],[-180,"-","MSK",null]],"Europe/Simferopol":[[-120,"EU","EE%sT",13961448e5],[-240,"-","MSK",14142888e5],[-180,"-","MSK",null]],"Europe/Samara":[[-240,"-","+04",null]],"Asia/Yekaterinburg":[[-360,"-","+06",14142888e5],[-300,"-","+05",null]],"Asia/Omsk":[[-420,"-","+07",14142888e5],[-360,"-","+06",null]],"Asia/Novosibirsk":[[-420,"-","+07",14142888e5],[-360,"-","+06",14693256e5],[-420,"-","+07",null]],"Asia/Novokuznetsk":[[-420,"-","+07",null]],"Asia/Krasnoyarsk":[[-480,"-","+08",14142888e5],[-420,"-","+07",null]],"Asia/Irkutsk":[[-540,"-","+09",14142888e5],[-480,"-","+08",null]],"Asia/Yakutsk":[[-600,"-","+10",14142888e5],[-540,"-","+09",null]],"Asia/Vladivostok":[[-660,"-","+11",14142888e5],[-600,"-","+10",null]],"Asia/Magadan":[[-720,"-","+12",14142888e5],[-600,"-","+10",14614632e5],[-660,"-","+11",null]],"Asia/Srednekolymsk":[[-720,"-","+12",14142888e5],[-660,"-","+11",null]],"Asia/Kamchatka":[[-720,"-","+12",null]],"Europe/Belgrade":[[-60,"EU","CE%sT",null]],"Europe/Sarajevo":"Europe/Belgrade","Europe/Istanbul":[[-120,"EU","EE%sT",13961412e5],[-120,"-","EET",13962276e5],[-120,"EU","EE%sT",14457348e5],[-120,"1:00","EEST",14469444e5],[-120,"EU","EE%sT",14732064e5],[-180,"-","+03",null]],"America/New_York":[[300,"US","E%sT",null]],"America/Chicago":[[360,"US","C%sT",null]],"America/Denver":[[420,"US","M%sT",null]],"America/Los_Angeles":[[480,"US","P%sT",null]],"America/Juneau":[[540,"US","AK%sT",null]],"Pacific/Honolulu":[[600,"-","HST",null]],"America/Phoenix":[[420,"-","MST",null]],"America/Indiana/Indianapolis":[[300,"US","E%sT",null]],"America/St_Johns":[[210,"Canada","N%sT",null]],"America/Halifax":[[240,"Canada","A%sT",null]],"America/Regina":[[360,"-","CST",null]],"America/Mexico_City":[[360,"Mexico","C%sT",null]],"America/Chihuahua":[[420,"Mexico","M%sT",null]],"America/Tijuana":[[480,"US","P%sT",null]],"America/Costa_Rica":[[360,"CR","C%sT",null]],"America/Puerto_Rico":[[240,"-","AST",null]],"America/Argentina/Buenos_Aires":[[180,"Arg","-03/-02",null]],"America/Sao_Paulo":[[180,"Brazil","-03/-02",null]],"America/Santiago":[[240,"Chile","-04/-03",null]],"America/Punta_Arenas":[[240,"Chile","-04/-03",14808096e5],[180,"-","-03",null]],"America/Bogota":[[300,"CO","-05/-04",null]],"America/Asuncion":[[240,"Para","-04/-03",null]],"Atlantic/South_Georgia":[[120,"-","-02",null]],"America/Montevideo":[[180,"Uruguay","-03/-02",null]],"America/Caracas":[[270,"-","-0430",14620698e5],[240,"-","-04",null]],"Europe/Athens":"Europe/Bucharest","Asia/Rangoon":"Asia/Yangon","Atlantic/Reykjavik":"UTC","Asia/Kuwait":"Asia/Riyadh","Asia/Muscat":"Asia/Riyadh","Asia/Istanbul":"Europe/Istanbul","Pacific/Midway":"Pacific/Pago_Pago"},rules:{Egypt:[[2014,"only","-","May","16",[0,0,0,null],60,"S"],[2014,"only","-","Jun","27",[0,0,0,null],0,"-"],[2014,"only","-","Aug","1",[0,0,0,null],60,"S"],[2014,"only","-","Sep","lastThu",[23,0,0,"s"],0,"-"]],Morocco:[[2012,2013,"-","Apr","lastSun",[2,0,0,null],60,"S"],[2013,"only","-","Jul","7",[3,0,0,null],0,"-"],[2013,"only","-","Aug","10",[2,0,0,null],60,"S"],[2013,"max","-","Oct","lastSun",[3,0,0,null],0,"-"],[2014,2021,"-","Mar","lastSun",[2,0,0,null],60,"S"],[2014,"only","-","Jun","28",[3,0,0,null],0,"-"],[2014,"only","-","Aug","2",[2,0,0,null],60,"S"],[2015,"only","-","Jun","14",[3,0,0,null],0,"-"],[2015,"only","-","Jul","19",[2,0,0,null],60,"S"],[2016,"only","-","Jun","5",[3,0,0,null],0,"-"],[2016,"only","-","Jul","10",[2,0,0,null],60,"S"],[2017,"only","-","May","21",[3,0,0,null],0,"-"],[2017,"only","-","Jul","2",[2,0,0,null],60,"S"],[2018,"only","-","May","13",[3,0,0,null],0,"-"],[2018,"only","-","Jun","17",[2,0,0,null],60,"S"],[2019,"only","-","May","5",[3,0,0,null],0,"-"],[2019,"only","-","Jun","9",[2,0,0,null],60,"S"],[2020,"only","-","Apr","19",[3,0,0,null],0,"-"],[2020,"only","-","May","24",[2,0,0,null],60,"S"],[2021,"only","-","Apr","11",[3,0,0,null],0,"-"],[2021,"only","-","May","16",[2,0,0,null],60,"S"],[2022,"only","-","May","8",[2,0,0,null],60,"S"],[2023,"only","-","Apr","23",[2,0,0,null],60,"S"]],SA:[],Tunisia:[],EUAsia:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],60,"S"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],0,"-"]],Azer:[[1997,2015,"-","Mar","lastSun",[4,0,0,null],60,"S"],[1997,2015,"-","Oct","lastSun",[5,0,0,null],0,"-"]],Dhaka:[],PRC:[],HK:[],Taiwan:[],Iran:[[2013,2015,"-","Mar","22",[0,0,0,null],60,"D"],[2013,2015,"-","Sep","22",[0,0,0,null],0,"S"],[2016,"only","-","Mar","21",[0,0,0,null],60,"D"],[2016,"only","-","Sep","21",[0,0,0,null],0,"S"],[2017,2019,"-","Mar","22",[0,0,0,null],60,"D"],[2017,2019,"-","Sep","22",[0,0,0,null],0,"S"],[2020,"only","-","Mar","21",[0,0,0,null],60,"D"],[2020,"only","-","Sep","21",[0,0,0,null],0,"S"],[2021,2023,"-","Mar","22",[0,0,0,null],60,"D"],[2021,2023,"-","Sep","22",[0,0,0,null],0,"S"]],Zion:[[2013,"max","-","Mar","Fri>=23",[2,0,0,null],60,"D"],[2013,"max","-","Oct","lastSun",[2,0,0,null],0,"S"]],Japan:[],ROK:[],Mongol:[[2015,2016,"-","Mar","lastSat",[2,0,0,null],60,"S"],[2015,2016,"-","Sep","lastSat",[0,0,0,null],0,"-"]],Pakistan:[],Aus:[],AW:[],AQ:[],AS:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"-"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"-"]],AN:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"-"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"-"]],NC:[],NZ:[[2007,"max","-","Sep","lastSun",[2,0,0,"s"],60,"D"],[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"S"]],Chatham:[[2007,"max","-","Sep","lastSun",[2,45,0,"s"],60,"D"],[2008,"max","-","Apr","Sun>=1",[2,45,0,"s"],0,"S"]],WS:[[2012,"max","-","Apr","Sun>=1",[4,0,0,null],0,"-"],[2012,"max","-","Sep","lastSun",[3,0,0,null],60,"D"]],Tonga:[[2016,"only","-","Nov","Sun>=1",[2,0,0,null],60,"S"],[2017,"only","-","Jan","Sun>=15",[3,0,0,null],0,"S"]],EU:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],60,"S"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],0,"-"]],"C-Eur":[[1981,"max","-","Mar","lastSun",[2,0,0,"s"],60,"S"],[1996,"max","-","Oct","lastSun",[2,0,0,"s"],0,"-"]],US:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Canada:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Mexico:[[2002,"max","-","Apr","Sun>=1",[2,0,0,null],60,"D"],[2002,"max","-","Oct","lastSun",[2,0,0,null],0,"S"]],CR:[],Arg:[],Brazil:[[2008,2017,"-","Oct","Sun>=15",[0,0,0,null],60,"S"],[2013,2014,"-","Feb","Sun>=15",[0,0,0,null],0,"-"],[2015,"only","-","Feb","Sun>=22",[0,0,0,null],0,"-"],[2016,2022,"-","Feb","Sun>=15",[0,0,0,null],0,"-"],[2018,"max","-","Nov","Sun>=1",[0,0,0,null],60,"S"],[2023,"only","-","Feb","Sun>=22",[0,0,0,null],0,"-"]],Chile:[[2012,2014,"-","Apr","Sun>=23",[3,0,0,"u"],0,"-"],[2012,2014,"-","Sep","Sun>=2",[4,0,0,"u"],60,"S"],[2016,"max","-","May","Sun>=9",[3,0,0,"u"],0,"-"],[2016,"max","-","Aug","Sun>=9",[4,0,0,"u"],60,"S"]],CO:[],Para:[[2010,"max","-","Oct","Sun>=1",[0,0,0,null],60,"S"],[2013,"max","-","Mar","Sun>=22",[0,0,0,null],0,"-"]],Uruguay:[[2006,"max","-","Oct","Sun>=1",[2,0,0,null],60,"S"],[2007,"max","-","Mar","Sun>=8",[2,0,0,null],0,"-"]]}}),CIQ.convertTimeZone=function(t,e,i){var a=new _exports.timezoneJS.Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),e);return a.setTimezone(i),a},CIQ.convertToLocalTime=function(t,e){var i=t.getSeconds(),a=t.getMilliseconds(),r=new _exports.timezoneJS.Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),e);return new Date(r.getTime()+1e3*i+a)},_exports},__utility_=function(t){function e(t,i){if(!i)return document.getElementById(t);if(i.id==t)return i;if(!i.hasChildNodes)return null;for(var a=0;a<i.childNodes.length;a++){var r=e(t,i.childNodes[a]);if(r)return r}return null}function i(){}"undefined"!=typeof global&&void 0===global.CanvasRenderingContext2D&&(global.CanvasRenderingContext2D=function(){}),t.$$=e,t.$$$=function(t,e){return e||(e=document),e.querySelectorAll(t)[0]},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Function.prototype.ciqInheritsFrom||(Function.prototype.ciqInheritsFrom=function(t,e){var i=t.prototype||Object.getPrototypeOf(t);this.prototype=!1!==e&&"function"==typeof t?new t:Object.create(i),Object.defineProperties(this.prototype,{constructor:{configurable:!0,enumerable:!1,value:this,writable:!0},parent:{configurable:!0,enumerable:!1,value:i,writable:!0}})},Function.prototype.stxInheritsFrom=Function.prototype.ciqInheritsFrom),CanvasRenderingContext2D.prototype.dashedLineTo=function(t,e,i,a,r){if(!(r instanceof Array))return r&&console.log('WARNING: Unsupported drawing pattern "'+r+'"; defaulting to "solid"'),void this.stxLine(t,e,i,a,this.strokeStyle,this.globalAlpha,this.lineWidth);if(e!==1/0&&t!==1/0&&a!==1/0&&i!==1/0){var n=function(t,e){return t-e<=1e-8},s=function(t,e){return t-e>=-1e-8},o=function(t,e){return Math.min(t,e)},l=function(t,e){return Math.max(t,e)},h={thereYet:s,cap:o},c={thereYet:s,cap:o};if(e-a>0&&(c.thereYet=n,c.cap=l),t-i>0&&(h.thereYet=n,h.cap=l),this.moveTo(t,e),!isNaN(t)&&!isNaN(e))for(var u=t,p=e,d=0,m=!0;!h.thereYet(u,i)||!c.thereYet(p,a);){var g=Math.atan2(a-e,i-t),f=r[d];u=h.cap(i,u+Math.cos(g)*f),p=c.cap(a,p+Math.sin(g)*f),m?this.lineTo(u,p):this.moveTo(u,p),d=(d+1)%r.length,m=!m}}},CanvasRenderingContext2D.prototype.stxLine=function(t,e,i,a,r,n,s,o){this.beginPath(),this.lineWidth=s,this.strokeStyle=r,this.globalAlpha=n,o&&o.length?this.dashedLineTo(t,e,i,a,o):(this.moveTo(t,e),this.lineTo(i,a)),this.stroke(),this.closePath(),this.lineWidth=1},CanvasRenderingContext2D.prototype.stxCircle=function(t,e,i,a){this.beginPath(),this.arc(t,e,i,0,2*Math.PI,!1),a&&this.fill(),this.stroke(),this.closePath()},Math.easeInOutQuad=function(t,e,i,a){return(t/=a/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},Math.easeInOutCubic=function(t,e,i,a){return(t/=a/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},Math.easeOutCubic=function(t,e,i,a){return t/=a,i*(--t*t*t+1)+e},t.CIQ=i,t.STX=i;var a="undefined"!=typeof navigator?navigator:{userAgent:""},r=a.userAgent,n="undefined"!=typeof window?window:{},s="undefined"!=typeof document?document:{};return i.ipad=-1!=r.indexOf("iPad"),i.iphone=-1!=r.indexOf("iPhone"),i.isSurface=a.msMaxTouchPoints&&a.msMaxTouchPoints>1,i.touchDevice=void 0!==s.ontouchstart||i.isSurface,i.is_chrome=r.toLowerCase().indexOf("chrome")>-1,i.isAndroid=r.toLowerCase().indexOf("android")>-1,i.isIE=r.toLowerCase().indexOf("msie")>-1||r.indexOf("Trident/")>-1,i.isEdge=r.indexOf("Edge/")>-1,i.isIE9=r.indexOf("Trident/5")>-1||r.indexOf("MSIE 9.0")>-1,i.isIE8=n.isIE8||r.indexOf("MSIE 8.0")>-1,i.isIOS7=r.match(/(iPad|iPhone);.*CPU.*OS 7_\d/i),i.isIOS8=r.match(/(iPad|iPhone);.*CPU.*OS 8_\d/i),i.isIOS9=r.match(/(iPad|iPhone);.*CPU.*OS 9_\d/i),i.isIOS10=r.match(/(iPad|iPhone);.*CPU.*OS 10_\d/i),i.isIOS7or8=i.isIOS7||i.isIOS8||i.isIOS9||i.isIOS10,i.isMobile=i.isAndroid||i.ipad||i.iphone,i.isSurfaceApp=n.MSApp,i.noKeyboard=i.ipad||i.iphone||i.isAndroid||i.isSurfaceApp,i.wheelEvent="wheel"in document.createElement("div")||"onwheel"in document?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",i.isIE&&(i.wheelEvent="wheel"),i.log10=function(t){return Math.log(t)/Math.LN10},i.deleteRHS=function(t,e){var i=!1;for(var a in t)t[a]==e&&(delete t[a],i=!0);return i},i.scrub=function(t,e){for(var i in t)void 0===t[i]&&delete t[i],e&&null===t[i]&&delete t[i]},i.dataBindSafeAssignment=function(t,e){for(var a in i.extend(t,e),t)void 0===e[a]&&delete t[a]},i.clone=function(t,e){if(null===t||"object"!=typeof t)return t;var a=t.constructor;if(a==Date||a==RegExp||a==String||a==Number||a==Boolean)return new a(t.valueOf());if(a==Function)return function(){return t.apply(this,arguments)};if(!e)try{e=new a}catch(i){e=Object.create(Object.getPrototypeOf(t))}for(var r in t)e[r]=e[r]!==t[r]?i.clone(t[r],null):e[r];return e},i.shallowClone=function(t){if(!t)return t;var e;if(t.constructor==Array){e=new Array(t.length);for(var i=0;i<t.length;i++)e[i]=t[i];return e}for(var a in e={},t)e[a]=t[a];return e},i.extend=function(t,e,a){var r,n;for(r in e)t!==(n=e[r])&&void 0!==n&&(null===n||!0===a?t[r]=n:n.constructor==Array?t[r]=n.slice():n.constructor==Object?t[r]=i.extend("object"==typeof t[r]&&null!==t[r]?t[r]:{},n):t[r]=n);return t},i.ensureDefaults=function(t,e){for(var i in e)void 0===t[i]&&(t[i]=e[i]);return t},i.equals=function(t,e,a){if(!t&&e)return!1;if(t&&!e)return!1;if(typeof t!=typeof e)return!1;for(var r in t){if(!a||!a[r])if("object"!=typeof t[r]){if(e[r]!=t[r])return!1}else if(!i.equals(t[r],e[r]))return!1}return!0},i.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},i.first=function(t){for(var e in t)return e;return null},i.last=function(t){var e=null;for(var i in t)e=i;return e},i.objLength=function(t){if(!t)return 0;var e=0;for(var i in t)e++;return e},i.deriveFromObjectChain=function(t,e){if(-1==e.indexOf("."))return{obj:t,member:e};for(var i=e.split("."),a=0;a<i.length-1;a++){var r=i[a];t[r]||0===t[r]||(t[r]={}),t=t[r]}return{obj:t,member:i[a]}},i.createObjectChainNames=function(t,e){for(var i=[],a=0;a<e.length;a++)i.push(t+"--\x3e"+e[a]);return i},i.existsInObjectChain=function(t,e){if(-1==e.indexOf("--\x3e"))return t[e]||0===t[e]?{obj:t,member:e}:null;for(var i,a=e.split("--\x3e"),r=0;r<a.length-1;r++){if(!t[i=a[r]]&&0!==t[i])return null;t=t[i]}return t[i=a[r]]||0===t[i]?{obj:t,member:i}:null},i.derivedFrom=function(t,e){return!!e.isPrototypeOf(t)||t instanceof e},i.replaceFields=function(t,e){if(!t)return t;var a={};for(var r in t){var n=t[r],s=e[r];if(s||(s=r),n&&"object"==typeof n)if(n.constructor==Array)for(var o=a[s]=new Array(n.length),l=0;l<o.length;l++){var h=n[l];o[l]="object"==typeof h?i.replaceFields(h,e):h}else a[s]=i.replaceFields(n,e);else a[s]=n}return a},i.removeNullValues=function(t){var e=i.clone(t);for(var a in e)e[a]||delete e[a];return e},i.reverseObject=function(t){var e={};for(var i in t)e[t[i]]=i;return e},i.camelCaseRegExp=/-([a-z])/g,i.makeCamelCase=function(t){return t.replace(i.camelCaseRegExp,function(t){return t[1].toUpperCase()})},i.appendClassName=function(t,e){if(t&&t.className!=e){for(var i=t.className.split(" "),a=0;a<i.length;a++)if(i[a]==e)return;t.className?t.className+=" "+e:t.className=e}},i.unappendClassName=function(t,e){if(t&&-1!=t.className.indexOf(e))if(t.className==e)t.className="";else{for(var i=t.className.split(" "),a="",r=0;r<i.length;r++)i[r]!=e&&(""!==a&&(a+=" "),a+=i[r]);t.className=a}},i.swapClassName=function(t,e,a){i.unappendClassName(t,a),i.appendClassName(t,e)},i.hasClassName=function(t,e){return!!t&&(" "+t.className+" ").indexOf(" "+e+" ")>-1},i.toggleClassName=function(t,e){i.hasClassName(t,e)?i.unappendClassName(t,e):i.appendClassName(t,e)},i.newChild=function(t,e,i,a){var r=document.createElement(e);return i&&(r.className=i),t.appendChild(r),a&&(r.innerHTML=a),r},i.innerHTML=function(t,e){window.MSApp?window.MSApp.execUnsafeLocalFunction(function(){t.innerHTML=e}):t.innerHTML=e},i.focus=function(t,e){if(i.isSurface||e){var a=0;isNaN(parseInt(e,10))||(a=e),setTimeout(function(){t.focus()},a)}else t.focus()},i.blur=function(t){t||(t=document.activeElement),t&&t.blur(),window.focus()},i.findNodesByText=function(t,e){if(t.innerHTML==e)return[t];for(var a=[],r=0;r<t.childNodes.length;r++){var n=i.findNodesByText(t.childNodes[r],e);n&&(a=a.concat(n))}return a.length?a:null},i.hideByText=function(t,e){for(var a=i.findNodesByText(t,e),r=0;r<a.length;r++)a[r].style.display="none"},i.outerWidth=function(t){var e=t.offsetWidth;return e+=i.stripPX(getComputedStyle(t).marginLeft),e+=i.stripPX(getComputedStyle(t).marginRight)},i.clearNode=function(t){if(t.hasChildNodes())for(;t.childNodes.length>=1;)t.removeChild(t.firstChild)},i.getEventDOM=function(t){return t?t.target:window.event.srcElement},i.convertClickToTouchEnd=function(t){var i=e(t),a=i.getAttribute("onClick");a&&(i.removeAttribute("onClick"),i.setAttribute("onTouchEnd",a))},i.pageHeight=function(){var t=window.innerHeight;if(top!=self)try{t>parent.innerHeight&&(t=parent.innerHeight)}catch(t){}return t},i.pageWidth=function(){var t=window.innerWidth;if(top!=self)try{t>parent.innerWidth&&(t=parent.innerWidth)}catch(t){}return t},i.stripPX=function(t){return t?"number"==typeof t?t:parseInt(t.substr(0,t.indexOf("p")),10):0},i.colorsEqual=function(t,e){if(t==e)return!0;if(!t&&!e)return!0;if(!t||!e)return!1;"transparent"==t&&(t="rgba(0,0,0,0)"),"transparent"==e&&(e="rgba(0,0,0,0)");var a=/^rgba\(.*,(.+)\)/,r=t.match(a),n=e.match(a);if((r=r?parseFloat(r[1]):1)!=(n=n?parseFloat(n[1]):1))return!1;var s=i.colorToHex(t),o=i.colorToHex(e);return s.toLowerCase()==o.toLowerCase()},i.colorToHex=function(t){if(i.colorToHexMapping||(i.colorToHexMapping={}),t&&"transparent"!=t||(t="#000000"),i.colorToHexMapping[t])return i.colorToHexMapping[t];if("#"===t.substr(0,1))return 4==t.length&&(t=i.colorToHexMapping[t]="#"+Array(3).join(t.substr(1,1))+Array(3).join(t.substr(2,1))+Array(3).join(t.substr(3,1))),t;var a=/(.*?)rgb\((\d+), ?(\d+), ?(\d+)\)/.exec(t);if(a||(a=/(.*?)rgba\((\d+), ?(\d+), ?(\d+),.*\)/.exec(t)),!a){var r=function(t){if("undefined"==typeof document)return"#000000";var r,n=e("color_converter");return n||((n=document.createElement("textarea")).id="color_converter",n.style.display="none",document.body.appendChild(n)),n.style.color="#000000",n.style.color=t,i.isIE8?(r=(r=(255&(r=n.createTextRange().queryCommandValue("ForeColor")))<<16|65280&r|(16711680&r)>>>16).toString(16),"#000000".slice(0,7-r.length)+r):(r=getComputedStyle(n).getPropertyValue("color"),(a=/(.*?)rgb\((\d+), ?(\d+), ?(\d+)\)/.exec(r))?i.colorToHex(r):"#"===r.substr(0,1)?r:t)}(t);return i.colorToHexMapping[t]=r,r}for(var n=parseFloat(a[2]),s=parseFloat(a[3]),o=(parseFloat(a[4])|s<<8|n<<16).toString(16),l=o.length;l<6;l++)o="0"+o;var h=a[1]+"#"+o;return i.colorToHexMapping[t]=h,h},i.hexToRgba=function(t,e){if(t&&"transparent"!=t||(t="rgba(0,0,0,0)"),"rgba"===t.substr(0,4)){var a=/(.*?)rgba\((\d+), ?(\d+), ?(\d+), ?(\d*\.?\d*)\)/.exec(t),r=a[5];return(e||0===e)&&(r=e),r>1&&(r/=100),"rgba("+a[2]+","+a[3]+","+a[4]+","+r+")"}"rgb"===t.substr(0,3)&&(t=i.colorToHex(t)),e||0===e||(e=100),e<=1&&(e*=100),t=t.replace("#","");var n=parseInt(t.slice(0,2),16),s=parseInt(t.slice(2,4),16),o=parseInt(t.slice(4,6),16);return isNaN(n)||isNaN(s)||isNaN(o)?(console.log("CIQ.hexToRgba: invalid hex :",t),null):"rgba("+n+","+s+","+o+","+e/100+")"},i.convertToNativeColor=function(t){var e=document.createElement("DIV");e.style.color=t,e.style.display="none",document.body.appendChild(e);var i=getComputedStyle(e).color;return document.body.removeChild(e),i},i.isTransparent=function(t){if(!t)return!1;if("transparent"==t)return!0;var e=/(.*?)rgba\((\d+), ?(\d+), ?(\d+), ?(\d*\.?\d*)\)/.exec(t);return null!==e&&0===parseFloat(e[5])},i.hsv=function(t){var e=i.colorToHex(t);"#"===e.substr(0,1)&&(e=e.slice(1));for(var a=e.length;a<6;a++)e="0"+e;var r=parseInt(e.slice(0,2),16),n=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16);if(r=parseInt((""+r).replace(/\s/g,""),10),n=parseInt((""+n).replace(/\s/g,""),10),s=parseInt((""+s).replace(/\s/g,""),10),null===r||null===n||null===s||isNaN(r)||isNaN(n)||isNaN(s))return console.log("CIQ.hsv: invalid color :",t),null;if(r<0||n<0||s<0||r>255||n>255||s>255)return null;r/=255,n/=255,s/=255;var o=Math.min(r,Math.min(n,s)),l=Math.max(r,Math.max(n,s));return o==l?[0,0,o]:[60*((r==o?3:s==o?1:5)-(r==o?n-s:s==o?r-n:s-r)/(l-o)),(l-o)/l,l]},i.hsl=function(t){var e=i.colorToHex(t);"#"===e.substr(0,1)&&(e=e.slice(1));for(var a=e.length;a<6;a++)e="0"+e;var r=parseInt(e.slice(0,2),16),n=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16);r/=255,n/=255,s/=255;var o,l,h=Math.max(r,n,s),c=Math.min(r,n,s),u=(h+c)/2;if(h==c)o=l=0;else{var p=h-c;switch(l=u>.5?p/(2-h-c):p/(h+c),h){case r:o=(n-s)/p+(n<s?6:0);break;case n:o=(s-r)/p+2;break;case s:o=(r-n)/p+4}o/=6}return[o,l,u]},i.chooseForegroundColor=function(t){var e=i.hsl(t);return e[2]>=e[0]?"#000000":"#FFFFFF"},i.borderPatternToArray=function(t,e){return e?e instanceof Array?e:"dotted"==e?[t,t]:"dashed"==e?[5*t,5*t]:("solid"!=e&&"none"!=e&&console.log('Unsupported pattern "'+e+'"; defaulting to "solid"'),[]):[]},i.getBackgroundColor=function(t){for(var e=null;!e||i.isTransparent(e);){var a=getComputedStyle(t);if(!a)return;if(e=a.backgroundColor,i.isTransparent(e)&&(e="transparent"),!(t=t.parentNode)||!t.tagName)break}return e&&"transparent"!=e||(e="#FFFFFF"),e},i.yyyymmddhhmmssmmmrx=new RegExp("\\d{17}"),i.strToDateTime=function(t){if(!t||t.getFullYear)return t;var e,a,r,n,s,o,l,h=[];if(12==t.length)return e=parseFloat(t.substring(0,4)),a=parseFloat(t.substring(4,6))-1,r=parseFloat(t.substring(6,8)),n=parseFloat(t.substring(8,10)),s=parseFloat(t.substring(10,12)),new Date(e,a,r,n,s,0,0);if(i.yyyymmddhhmmssmmmrx.test(t))return e=parseFloat(t.substring(0,4)),a=parseFloat(t.substring(4,6))-1,r=parseFloat(t.substring(6,8)),n=parseFloat(t.substring(8,10)),s=parseFloat(t.substring(10,12)),o=parseFloat(t.substring(12,14)),l=parseFloat(t.substring(14,17)),new Date(e,a,r,n,s,o,l);var c=[t],u=t.indexOf("T");if(-1!=u){var p=t.substring(u);if(!i.isIE8&&(-1!=p.indexOf("Z")||-1!=p.indexOf("-")||-1!=p.indexOf("+")))return new Date(t);c=t.split("T")}else-1!=t.indexOf(" ")&&(c=t.split(" "));if(-1!=c[0].indexOf("/"))h=c[0].split("/");else{if(-1==c[0].indexOf("-"))return i.strToDate(t);h=c[0].split("-")}var d=parseFloat(h[2],10);if(h[0]&&4==h[0].length&&(d=parseFloat(h[0],10),h[0]=h[1],h[1]=h[2]),c.length>1){var m=c[2];c=c[1].split(":"),m&&("12"==c[0]&&"AM"==m.toUpperCase()?c[0]=0:"12"!=c[0]&&"PM"==m.toUpperCase()&&(c[0]=parseInt(c[0],10)+12));var g=0,f=0;if(3==c.length)if(-1==c[2].indexOf("."))g=parseInt(c[2],10);else{if(3!=(g=c[2].split("."))[1].length){f=g[1].substr(0,3);var y=parseInt(g[1].substr(3),10);g=g[0];var v=new Date(d,h[0]-1,h[1],c[0],c[1],g,f);return v.setMinutes(v.getMinutes()-v.getTimezoneOffset()-y%100-60*Math.round(y/100)),v}f=g[1],g=g[0]}return new Date(d,h[0]-1,h[1],c[0],c[1],g,f)}return new Date(d,h[0]-1,h[1],0,0,0,0)},i.strToDate=function(t){var e;if(-1!=t.indexOf("/"))e=t.split("/");else{if(-1==t.indexOf("-"))return t.length>=8?new Date(parseFloat(t.substring(0,4)),parseFloat(t.substring(4,6))-1,parseFloat(t.substring(6,8))):new Date;e=t.split("-")}if(e.length<3)return new Date;-1!=e[2].indexOf(" ")?e[2]=e[2].substring(0,e[2].indexOf(" ")):-1!=e[2].indexOf("T")&&(e[2]=e[2].substring(0,e[2].indexOf("T")));var i=parseFloat(e[2],10);return i<20&&(i+=2e3),4==e[0].length&&(i=parseFloat(e[0],10),e[0]=e[1],e[1]=e[2]),new Date(i,e[0]-1,e[1])},i.mmddyyyy=function(t){"string"==typeof t&&(t=i.strToDate(t));var e=t.getMonth()+1;e<10&&(e="0"+e);var a=t.getDate();return a<10&&(a="0"+a),e+"/"+a+"/"+t.getFullYear()},i.yyyymmdd=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();return i<10&&(i="0"+i),t.getFullYear()+"-"+e+"-"+i},i.yyyymmddhhmm=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var a=t.getHours();a<10&&(a="0"+a);var r=t.getMinutes();return r<10&&(r="0"+r),""+t.getFullYear()+e+i+a+r},i.yyyymmddhhmmssmmm=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var a=t.getHours();a<10&&(a="0"+a);var r=t.getMinutes();r<10&&(r="0"+r);var n=t.getSeconds();n<10&&(n="0"+n);var s=t.getMilliseconds();return s<10?s="00"+s:s<100&&(s="0"+s),""+t.getFullYear()+e+i+a+r+n+s},i.friendlyDate=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var a=t.getHours();a<10&&(a="0"+a);var r=t.getMinutes();return r<10&&(r="0"+r),t.getFullYear()+"/"+e+"/"+i+" "+a+":"+r},i.standardUTCDate=function(t){var e=t.getUTCMonth()+1;e<10&&(e="0"+e);var i=t.getUTCDate();i<10&&(i="0"+i);var a=t.getUTCHours();a<10&&(a="0"+a);var r=t.getUTCMinutes();r<10&&(r="0"+r);var n=t.getUTCSeconds();return n<10&&(n="0"+n),t.getUTCFullYear()+"-"+e+"-"+i+"T"+a+":"+r+":"+n+"Z"},i.mmddhhmm=function(t){var e=i.strToDateTime(t),a=e.getMonth()+1;a<10&&(a="0"+a);var r=e.getDate();r<10&&(r="0"+r);var n=e.getHours();n<10&&(n="0"+n);var s=e.getMinutes();if(s<10&&(s="0"+s),"00"==n&&"00"==s)return a+"-"+r+"-"+e.getFullYear();var o=e.getSeconds();if(o<10&&(o="0"+o),"00"==o)return a+"-"+r+" "+n+":"+s;var l=e.getMilliseconds();return l<10?l="00"+l:l<100&&(l="0"+l),"000"==l?a+"-"+r+" "+n+":"+s+":"+o:a+"-"+r+" "+n+":"+s+":"+o+":"+l},i.getYearDay=function(t){var e=t;e||(e=new Date),e.setHours(0,0,0,0);var i=e-new Date(e.getFullYear(),0,0);return Math.round(i/864e5)},i.isDST=function(t){t||(t=new Date);var e=new Date(t.getFullYear(),0,1),i=new Date(t.getFullYear(),6,1),a=Math.max(e.getTimezoneOffset(),i.getTimezoneOffset());return t.getTimezoneOffset()!=a},i.uniqueID=function(){var t=(new Date).getTime().toString(36);return(t+=Math.floor(Math.random()*Math.pow(36,2)).toString(36)).toUpperCase()},i.getHostName=function(t){try{return t.match(/:\/\/(.[^/]+)/)[1]}catch(t){return""}},i.getAjaxServer=function(t){var e=!1,a=!0;if((i.isIE9||i.isIE8)&&t&&(""===i.getHostName(t)&&(a=!1),i.getHostName(t)==i.getHostName(window.location.href)&&(a=!1)),(i.isIE9||i.isIE8)&&a)return e=new XDomainRequest;try{e=new XMLHttpRequest}catch(t){alert("ajax not supported in browser")}return e},i.qs=function(t){var e={};t||(t=window.location.search.substring(1));for(var i=t.split("&"),a=0;a<i.length;a++){var r=i[a].indexOf("=");r>0?e[i[a].substring(0,r)]=i[a].substring(r+1):e[i[a]]=null}return e},i.postAjax=function(t,e,a,r,n){"string"==typeof t&&(t={url:t,payload:e,cb:a,contentType:r,noEpoch:n,method:null,responseHeaders:!1});var s=t.url,o=t.cb,l=t.payload;if(o||(o=function(){}),t.ungovernable||!i.Extras||!i.Extras.RequestLimiter||!i.Extras.RequestLimiter.hitRequestLimit(s)){var h=i.getAjaxServer(s);if(!h)return!1;i.ajaxes||(i.ajaxes=[]),i.ajaxes.unshift(h);var c=new Date;t.noEpoch||(-1==s.indexOf("?")?s+="?ciqrandom="+c.getTime():s+="&ciqrandom="+c.getTime());var u=t.method,p=t.headers;if(u||(u=l?"POST":"GET"),!i.isIE9&&!i.isIE8||h.constructor==XMLHttpRequest){if(h.open(u,s,!0),t.contentType||(t.contentType="application/x-www-form-urlencoded"),l&&h.setRequestHeader("Content-Type",t.contentType),p)for(var d in p)h.setRequestHeader(d,p[d])}else s=s.replace("https:",window.location.protocol),h.open(u,s,!0);t.timeout&&(h.timeout=t.timeout),h.ontimeout=function(){m(h),o(408,null,{})},h.onload=function(){0===this.status?this.status="0":this.status||(this.status=200),m(h),o(this.status,this.responseText,function(e){var i={};if(t.responseHeaders){for(var a=e.getAllResponseHeaders().split("\n"),r=0;r<a.length;r++){for(var n=a[r].split(":");n[1]&&" "==n[1].charAt(0);)n[1]=n[1].substring(1);""!==n[0]&&(i[n.shift()]=n.join(":"))}return i}}(this))},h.onerror=function(){m(h),o("0",null,{})},h.onprogress=function(){};try{h.send(l)}catch(t){o("0",t,{})}return!0}function m(t){for(var e=0;e<i.ajaxes.length;e++)if(i.ajaxes[e]==t)return void i.ajaxes.splice(e,1)}o(429,null,{})},i.cleanPeriodicity=function(t,e,i){return isNaN(t)&&(t=1),e||(e=1),!isNaN(e)&&i?"minute"!=i&&"second"!=i&&"millisecond"!=i&&(e=i,i=null):"tick"==e?i=null:i||isNaN(e)||(i="minute"),"year"==e&&(e="month",t||(t=1),t*=12),{period:t,interval:e,timeUnit:i}},t},_9a,Nbb,__microkernel_,lEb,pEb,__customCharts_,tJb,IJb,__aggregations_;function Y9EE(){}function G5xx(){}function p0yy(){}return Y9EE.z7E=function(){return"function"==typeof Y9EE.a7E.v7E?Y9EE.a7E.v7E.apply(Y9EE.a7E,arguments):Y9EE.a7E.v7E},Y9EE.d7E=function(){return"function"==typeof Y9EE.a7E.R4F?Y9EE.a7E.R4F.apply(Y9EE.a7E,arguments):Y9EE.a7E.R4F},Y9EE.q7E=function(){return"function"==typeof Y9EE.a7E.v7E?Y9EE.a7E.v7E.apply(Y9EE.a7E,arguments):Y9EE.a7E.v7E},Y9EE.a7E={w7E:function(){var t,e=arguments;switch(_9a){case 23:t=e[1]*e[3]-e[2]+e[0];break;case 27:t=e[1]+e[3]+(e[0]-e[2]);break;case 26:t=e[0]-(e[2]-e[1]);break;case 30:t=e[1]+(e[4]+e[0]*e[2])*e[3];break;case 39:t=e[1]-e[2]-e[0];break;case 18:t=e[4]*(e[0]-e[1]+e[2])-e[3];break;case 31:t=e[2]-e[1]-e[3]+e[0];break;case 45:t=e[2]*e[0]/(e[1]+e[3]);break;case 15:t=-e[2]-e[1]+e[0]+e[3];break;case 36:t=(e[2]+e[1])/e[0];break;case 8:t=e[0]*e[3]*e[1]*e[2];break;case 3:t=e[1]-+e[0];break;case 2:t=e[1]/e[2]-e[0];break;case 37:t=e[0]*e[2]/e[1];break;case 0:t=e[0]+e[1];break;case 25:t=e[1]+e[0]+e[2];break;case 22:t=-e[0]*e[3]*e[2]-e[4]+e[1];break;case 10:t=e[0]/e[1];break;case 1:t=(-e[1]-e[0])*-e[3]/e[2];break;case 14:t=e[2]-(e[0]|e[1]);break;case 24:t=e[1]+e[0]*e[2];break;case 5:t=e[1]-e[0];break;case 20:t=e[0]/(e[2]*e[1]);break;case 17:t=e[1]*(e[0]-e[2]);break;case 34:t=e[2]/(e[1]|e[0]);break;case 12:t=(e[3]+e[0])*e[1]-e[2];break;case 35:t=e[0]!=e[1];break;case 21:t=e[0]*(e[3]+e[1])-e[2];break;case 38:t=(-e[2]-e[0]+e[1])*e[3]-e[4];break;case 28:t=(e[2]+e[1])*e[4]*e[0]-e[3];break;case 4:t=e[1]==e[0];break;case 29:t=(e[2]-e[0])*e[1];break;case 7:t=e[1]*e[0];break;case 44:t=e[2]-e[0]+e[3]+e[1];break;case 19:t=e[0]/+e[1];break;case 16:t=e[0]|e[1];break;case 47:t=e[1]*e[2]-e[0];break;case 43:t=e[1]*e[0]-e[3]-e[2];break;case 13:t=(e[0]-e[1])*e[3]/e[2];break;case 32:t=e[0]+e[2]-e[1];break;case 40:t=e[0]*e[1]+e[2]*e[3];break;case 33:t=e[2]-e[0]-e[1];break;case 46:t=e[4]*(-e[3]-e[2]+e[1])/-e[0];break;case 9:t=e[0]/e[2]*e[1];break;case 42:t=e[3]-e[1]*e[4]*e[2]*e[0];break;case 41:t=(e[1]-e[4])*(e[5]-e[3])+(e[6]-e[0])*(e[7]-e[2]);break;case 11:t=e[2]-e[0]+e[1];break;case 6:t=(e[0]|e[1])*e[2]}return t},v7E:function(t){_9a=t}},Y9EE.X9g=function(){return"function"==typeof Y9EE.b9g.w7E?Y9EE.b9g.w7E.apply(Y9EE.b9g,arguments):Y9EE.b9g.w7E},Y9EE.M7E=function(){return"function"==typeof Y9EE.a7E.w7E?Y9EE.a7E.w7E.apply(Y9EE.a7E,arguments):Y9EE.a7E.w7E},Y9EE.x4g=function(){return"function"==typeof Y9EE.b9g.n1F?Y9EE.b9g.n1F.apply(Y9EE.b9g,arguments):Y9EE.b9g.n1F},Y9EE.R9g=function(){return"function"==typeof Y9EE.b9g.v7E?Y9EE.b9g.v7E.apply(Y9EE.b9g,arguments):Y9EE.b9g.v7E},Y9EE.r4g=function(){return"function"==typeof Y9EE.b9g.Z1F?Y9EE.b9g.Z1F.apply(Y9EE.b9g,arguments):Y9EE.b9g.Z1F},Y9EE.u1r=function(){for(;;)return{t1r:function(){for(var t=2;9!==t;)switch(t){case 1:t=1!==e?5:9;break;case 2:var e=2;t=1;break;case 5:t=2===e?4:1;break;case 4:!function(){for(var t=2;37!==t;)switch(t){case 38:i=21,t=1;break;case 39:typeof window!==l?window:typeof global!==o&&global;t=38;break;case 4:l+=s,l+=n,l+=r,l+=h,t=7;break;case 6:t=3===i?14:10;break;case 7:i=24,t=1;break;case 14:var e="d";t=13;break;case 31:i=15,t=1;break;case 1:t=21!==i?5:37;break;case 40:t=22===i?39:1;break;case 2:var i=2;t=1;break;case 20:var a=null,r="i",n="f",s="e";t=16;break;case 27:l+=s,l+=e,t=25;break;case 24:t=11===i?23:30;break;case 5:t=15===i?4:6;break;case 29:var o=c;o+=h,o+=e,o+=s,o+=n,t=41;break;case 41:i=11,t=1;break;case 23:o+=r,o+=h,o+=s,o+=e;var l=c;l+=h,l+=e,t=31;break;case 30:t=7===i?29:40;break;case 11:i=7,t=1;break;case 16:i=3,t=1;break;case 13:var h="n",c="u";t=11;break;case 25:i=22,t=1;break;case 10:t=2===i?20:15;break;case 15:t=24===i?27:24}}(),t=3;break;case 3:e=1,t=1}}}}(),Y9EE.o1r=function(){return"function"==typeof Y9EE.u1r.Z1F?Y9EE.u1r.Z1F.apply(Y9EE.u1r,arguments):Y9EE.u1r.Z1F},Y9EE.b9g=function(t,e){function i(t){for(var i=2;15!==i;)switch(i){case 13:h=e[7],i=12;break;case 2:var a,n,s,l,h,c,u;i=1;break;case 5:u=r[e[4]],i=4;break;case 3:n=34,i=9;break;case 6:l=s&&u(s,n),i=14;break;case 11:c=(h||0===h)&&u(h,n),i=10;break;case 17:a=t-c>n,i=19;break;case 7:i=o--?14:6;break;case 4:i=o--?9:3;break;case 20:a=t-c>n&&l-t>n,i=19;break;case 18:i=c>=0?17:16;break;case 14:i=o--?12:13;break;case 12:i=o--?10:11;break;case 10:i=c>=0&&l>=0?20:18;break;case 19:return a;case 1:i=o--?4:5;break;case 8:s=e[6],i=7;break;case 16:a=l-t>n,i=19;break;case 9:i=o--?7:8}}for(var a=2;10!==a;)switch(a){case 8:a=o--?6:7;break;case 13:a=o--?11:12;break;case 3:n="string",a=9;break;case 14:e=e.map(function(t){for(var e=2;13!==e;)switch(e){case 3:e=a<t.length?9:7;break;case 9:i+=r[s][l](t[a]+112),e=8;break;case 1:e=o--?4:5;break;case 5:i="",e=4;break;case 2:var i;e=1;break;case 4:var a=0;e=3;break;case 8:a++,e=3;break;case 6:return;case 7:e=i?14:6;break;case 14:return i}}),a=13;break;case 6:a=o--?13:14;break;case 1:a=o--?4:5;break;case 2:var r,n,s,o;a=1;break;case 4:a=o--?9:3;break;case 9:var l="fromCharCode",h="RegExp";a=8;break;case 5:r=e.filter.constructor(t)(),a=4;break;case 7:s=n.replace(new r[h]("^['-|]"),"S"),a=6;break;case 11:return{x9g:function(t,a){for(var n=2;16!==n;)switch(n){case 14:p++,n=3;break;case 4:var s=i;n=3;break;case 19:!function(){for(var t=2;37!==t;)switch(t){case 17:var e="u",i=e;t=15;break;case 44:o+=l,t=43;break;case 6:i+=c,i+=h,i+=l,i+=n,t=11;break;case 4:var a=null,r="i",n="f";t=8;break;case 28:t=15===s?44:1;break;case 2:var s=2;t=1;break;case 11:s=11,t=1;break;case 35:s=16,t=1;break;case 27:t=11===s?26:34;break;case 15:s=6,t=1;break;case 8:s=4,t=1;break;case 26:i+=r,i+=c,t=24;break;case 38:s=22,t=1;break;case 34:t=16===s?33:31;break;case 7:t=6===s?6:10;break;case 32:s=15,t=1;break;case 10:t=4===s?20:27;break;case 43:o+=n,o+=r,o+=c,t=40;break;case 1:t=21!==s?5:37;break;case 29:s=21,t=1;break;case 31:t=22===s?30:28;break;case 33:o+=h,t=32;break;case 5:t=2===s?4:7;break;case 30:typeof window!==o?window:typeof global!==i&&global;t=29;break;case 24:i+=l,i+=h;var o=e;o+=c,t=35;break;case 20:var l="e",h="d",c="n";t=17;break;case 40:o+=l,o+=h,t=38}}(),n=18;break;case 3:n=p<t[e[5]]?9:12;break;case 9:var l=a(t[e[2]](p),16)[e[3]](2),h=l[e[2]](l[e[5]]-1);n=7;break;case 13:u^=h,n=14;break;case 6:u=h,n=14;break;case 7:n=0===p?6:13;break;case 11:var c=2;n=10;break;case 10:n=1!==c?20:17;break;case 2:n=o--?5:1;break;case 12:n=s?17:11;break;case 5:var u,p=0;n=4;break;case 18:c=1,n=10;break;case 17:return u?s:!s;case 1:a=r[e[4]],n=5;break;case 20:n=2===c?19:10}}};case 12:i=i((new r[e[0]])[e[1]]()),a=11}}("return this",[[-44,-15,4,-11],[-9,-11,4,-28,-7,-3,-11],[-13,-8,-15,2,-47,4],[4,-1,-29,4,2,-7,-2,-9],[0,-15,2,3,-11,-39,-2,4],[-4,-11,-2,-9,4,-8],[4,-7,-14,-63,-63,-64,5,-13],[]]),Y9EE.S9g=function(){return"function"==typeof Y9EE.b9g.R4F?Y9EE.b9g.R4F.apply(Y9EE.b9g,arguments):Y9EE.b9g.R4F},Y9EE.L1F=function(){return"function"==typeof Y9EE.f1F.R4F?Y9EE.f1F.R4F.apply(Y9EE.f1F,arguments):Y9EE.f1F.R4F},Y9EE.f1F=function(){for(var t=2;5!==t;)switch(t){case 1:return{n1F:function(t,e,i){for(;;)return a(t,e,i)},Z1F:function(t,e,i){for(;;)return a(t,e,i,!0)}};case 2:var e,i;t=1}function a(t,a,n,s){for(var o=2;19!==o;)switch(o){case 6:o=null===t||t<=0?14:11;break;case 2:var l,h,c;!e&&(e=r([16,3,18,19,16,12,-66,2,13,1,19,11,3,12,18,-52,2,13,11,-1,7,12,-39])),o=5;break;case 5:!i&&(i=r([16,3,18,19,16,12,-66,10,13,1,-1,18,7,13,12,-52,6,16,3,4])),c=s?i:e,o=3;break;case 3:o=n>0?9:6;break;case 9:return h=(l=c.substring(t,n)).length,Y9EE.r4F(l,h,a);case 14:return h=(l=c.substring(0,c.length)).length,Y9EE.r4F(l,h,a);case 11:return h=(l=c.substring(c.length-t,c.length)).length,Y9EE.r4F(l,h,a)}}function r(t){for(;;){return(0,function(){}.constructor)(new function(t){for(var e=2;1!==e;)switch(e){case 2:this.d=function(e){for(var i=2;8!==i;)switch(i){case 5:i=a<t.length?4:9;break;case 1:var a=0;i=5;break;case 2:var r="";i=1;break;case 3:a++,i=5;break;case 4:r+=String.fromCharCode(t[a]-e+103),i=3;break;case 9:return r}},e=1}}(t).d(5))()}}}(),Y9EE.D9g=function(){return"function"==typeof Y9EE.b9g.w7E?Y9EE.b9g.w7E.apply(Y9EE.b9g,arguments):Y9EE.b9g.w7E},Y9EE.Y1r=function(){return"function"==typeof Y9EE.u1r.n1F?Y9EE.u1r.n1F.apply(Y9EE.u1r,arguments):Y9EE.u1r.n1F},Y9EE.K1F=function(){return"function"==typeof Y9EE.f1F.n1F?Y9EE.f1F.n1F.apply(Y9EE.f1F,arguments):Y9EE.f1F.n1F},Y9EE.j1F=function(){return"function"==typeof Y9EE.f1F.Z1F?Y9EE.f1F.Z1F.apply(Y9EE.f1F,arguments):Y9EE.f1F.Z1F},Y9EE.r4F=function(){return"function"==typeof Y9EE.h4F.R4F?Y9EE.h4F.R4F.apply(Y9EE.h4F,arguments):Y9EE.h4F.R4F},Y9EE.C1r=function(){return"function"==typeof Y9EE.u1r.v7E?Y9EE.u1r.v7E.apply(Y9EE.u1r,arguments):Y9EE.u1r.v7E},Y9EE.Z4g=function(){return"function"==typeof Y9EE.b9g.x9g?Y9EE.b9g.x9g.apply(Y9EE.b9g,arguments):Y9EE.b9g.x9g},Y9EE.T1F=function(){return"function"==typeof Y9EE.f1F.n1F?Y9EE.f1F.n1F.apply(Y9EE.f1F,arguments):Y9EE.f1F.n1F},Y9EE.H1r=function(){return"function"==typeof Y9EE.u1r.n1F?Y9EE.u1r.n1F.apply(Y9EE.u1r,arguments):Y9EE.u1r.n1F},Y9EE.f1r=function(){return"function"==typeof Y9EE.u1r.t1r?Y9EE.u1r.t1r.apply(Y9EE.u1r,arguments):Y9EE.u1r.t1r},Y9EE.E1r=function(){return"function"==typeof Y9EE.u1r.R4F?Y9EE.u1r.R4F.apply(Y9EE.u1r,arguments):Y9EE.u1r.R4F},Y9EE.R1F=function(){return"function"==typeof Y9EE.f1F.R4F?Y9EE.f1F.R4F.apply(Y9EE.f1F,arguments):Y9EE.f1F.R4F},Y9EE.b1r=function(){return"function"==typeof Y9EE.u1r.t1r?Y9EE.u1r.t1r.apply(Y9EE.u1r,arguments):Y9EE.u1r.t1r},Y9EE.K4F=function(){return"function"==typeof Y9EE.h4F.R4F?Y9EE.h4F.R4F.apply(Y9EE.h4F,arguments):Y9EE.h4F.R4F},Y9EE.C1F=function(){return"function"==typeof Y9EE.f1F.w7E?Y9EE.f1F.w7E.apply(Y9EE.f1F,arguments):Y9EE.f1F.w7E},Y9EE.l1r=function(){return"function"==typeof Y9EE.u1r.v7E?Y9EE.u1r.v7E.apply(Y9EE.u1r,arguments):Y9EE.u1r.v7E},Y9EE.g7E=function(){return"function"==typeof Y9EE.a7E.R4F?Y9EE.a7E.R4F.apply(Y9EE.a7E,arguments):Y9EE.a7E.R4F},Y9EE.G4g=function(){return"function"==typeof Y9EE.b9g.x9g?Y9EE.b9g.x9g.apply(Y9EE.b9g,arguments):Y9EE.b9g.x9g},Y9EE.V1F=function(){return"function"==typeof Y9EE.f1F.w7E?Y9EE.f1F.w7E.apply(Y9EE.f1F,arguments):Y9EE.f1F.w7E},Y9EE.B4g=function(){return"function"==typeof Y9EE.b9g.n1F?Y9EE.b9g.n1F.apply(Y9EE.b9g,arguments):Y9EE.b9g.n1F},Y9EE.e4g=function(){return"function"==typeof Y9EE.b9g.Z1F?Y9EE.b9g.Z1F.apply(Y9EE.b9g,arguments):Y9EE.b9g.Z1F},Y9EE.a9g=function(){return"function"==typeof Y9EE.b9g.v7E?Y9EE.b9g.v7E.apply(Y9EE.b9g,arguments):Y9EE.b9g.v7E},Y9EE.U4g=function(){return"function"==typeof Y9EE.b9g.t1r?Y9EE.b9g.t1r.apply(Y9EE.b9g,arguments):Y9EE.b9g.t1r},Y9EE.P4g=function(){return"function"==typeof Y9EE.b9g.t1r?Y9EE.b9g.t1r.apply(Y9EE.b9g,arguments):Y9EE.b9g.t1r},Y9EE.k1F=function(){return"function"==typeof Y9EE.f1F.v7E?Y9EE.f1F.v7E.apply(Y9EE.f1F,arguments):Y9EE.f1F.v7E},Y9EE.X1F=function(){return"function"==typeof Y9EE.f1F.Z1F?Y9EE.f1F.Z1F.apply(Y9EE.f1F,arguments):Y9EE.f1F.Z1F},Y9EE.L1r=function(){return"function"==typeof Y9EE.u1r.R4F?Y9EE.u1r.R4F.apply(Y9EE.u1r,arguments):Y9EE.u1r.R4F},Y9EE.z9g=function(){return"function"==typeof Y9EE.b9g.R4F?Y9EE.b9g.R4F.apply(Y9EE.b9g,arguments):Y9EE.b9g.R4F},Y9EE.h4F=(Nbb=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{R4F:function(t,e,i){for(var a=i,r=-4&e,n=0;n<r;n+=4){var s=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8|(255&t.charCodeAt(n+2))<<16|(255&t.charCodeAt(n+3))<<24;s=Nbb(s,3432918353),a=5*(a=(524287&(a^=s=Nbb(s=(131071&s)<<15|s>>>17,461845907)))<<13|a>>>19)+3864292196|0}switch(s=0,e%4){case 3:s=(255&t.charCodeAt(r+2))<<16;case 2:s|=(255&t.charCodeAt(r+1))<<8;case 1:s|=255&t.charCodeAt(r),s=Nbb(s,3432918353),a^=s=Nbb(s=(131071&s)<<15|s>>>17,461845907)}return a^=e,a=Nbb(a^=a>>>16,2246822507),a=Nbb(a^=a>>>13,3266489909),a^=a>>>16}}),Y9EE.O1F=function(){return"function"==typeof Y9EE.f1F.v7E?Y9EE.f1F.v7E.apply(Y9EE.f1F,arguments):Y9EE.f1F.v7E},Y9EE.j1r=function(){return"function"==typeof Y9EE.u1r.w7E?Y9EE.u1r.w7E.apply(Y9EE.u1r,arguments):Y9EE.u1r.w7E},Y9EE.x7E=function(){return"function"==typeof Y9EE.a7E.w7E?Y9EE.a7E.w7E.apply(Y9EE.a7E,arguments):Y9EE.a7E.w7E},Y9EE.X1r=function(){return"function"==typeof Y9EE.u1r.w7E?Y9EE.u1r.w7E.apply(Y9EE.u1r,arguments):Y9EE.u1r.w7E},Y9EE.k1r=function(){return"function"==typeof Y9EE.u1r.Z1F?Y9EE.u1r.Z1F.apply(Y9EE.u1r,arguments):Y9EE.u1r.Z1F},Y9EE.i1M=function(t){if(Y9EE&&t)return Y9EE.Z4g(t)},Y9EE.f7M=function(t){if(Y9EE)return Y9EE.Z4g(t)},Y9EE.i7M=function(t){if(Y9EE&&t)return Y9EE.G4g(t)},Y9EE.f4M=function(t){if(Y9EE&&t)return Y9EE.G4g(t)},Y9EE.i4M=function(t){if(Y9EE&&t)return Y9EE.Z4g(t)},Y9EE.i9M=function(t){if(Y9EE)return Y9EE.Z4g(t)},Y9EE.p2g=function(t){if(Y9EE)return Y9EE.G4g(t)},Y9EE.G2g=function(t){if(Y9EE)return Y9EE.G4g(t)},Y9EE.z1g=function(t){if(Y9EE)return Y9EE.Z4g(t)},__microkernel_=function(t){var e=Y9EE;e.R7M=function(t){if(e&&t)return e.G4g(t)},e.R4M=function(t){if(e)return e.Z4g(t)};var i="createDataSet",a="prototype",r="ChartEngine";e.z2g=function(t){if(e&&t)return e.G4g(t)},e.T2g=function(t){if(e)return e.G4g(t)},e.p1g=function(t){if(e&&t)return e.Z4g(t)},e.T1g=function(t){if(e&&t)return e.Z4g(t)},e.z7g=function(t){if(e&&t)return e.Z4g(t)},e.T7g=function(t){if(e&&t)return e.Z4g(t)},e.z4g=function(t){if(e)return e.Z4g(t)},e.p4g=function(t){if(e)return e.G4g(t)},e.T4g=function(t){if(e)return e.Z4g(t)};var n,s,o="mousemoveinner",l="ChartEngine";return n=t.CIQ,s=t.SplinePlotter,n.ChartEngine.prototype.drawXAxis=function(t,i){var a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w;if("dr","a","wXAxi","s","mi","d","d","le","s","t","x_xax","is","dr","awXAxis",a=[t,i],!this.runPrepend("drawXAxis",a)&&i&&!t.xAxis.noDraw){r=this.chart.context,this.canvasFont("stx_xaxis"),s=this.getCanvasFontSize("stx_xaxis"),r.textAlign="center",r.textBaseline="middle",l=r.measureText("   ").width;for(var T=0;T<i.length;T++){o=i[T],h=r.measureText(o.text).width,e.q7E(0),c=Math.max(e.x7E(h,l),t.xAxis.minimumLabelWidth),o.hz=Math.floor(o.hz+this.micropixels)+.5,e.q7E(1);var M=e.x7E(12,9,21,2);o.left=o.hz-c/M,o.right=o.hz+c/2,e.q7E(2);var D=e.M7E(10,24,2);o.unpaddedRight=o.hz+h/D}if(u=!0===this.xAxisAsFooter?this.chart.canvasHeight:t.panel.bottom,e.z7E(3),p=this.whichPanel(e.M7E("1",u))){for(var E in this.adjustYAxisHeightOffset(p,p.yAxis),d=t.xAxis.displayBorder||null===t.xAxis.displayBorder,!0===this.axisBorders&&(d=!0),!1===this.axisBorders&&(d=!1),m=u-this.xaxisHeight+s,d&&(m+=3),g=!0,this.panels)if("s","trok","e","bo","rder","s","tx","_grid",!(f=this.panels[E]).hidden&&!1!==f.shareChartXAxis&&(e.q7E(4),y=e.x7E(p,f),v=f.yAxis)){x=-Number.MAX_VALUE,b=Number.MAX_VALUE;for(var A=0;A<i.length;A++)if("boundar","y","boundary"==i[A].grid){b=i[A].left;break}r.save(),r.beginPath(),r.rect(f.left,f.top+(g?0:1),f.width,f.height-1),r.clip(),g=!1,(C=new n.Plotter).newSeries("line","stroke",this.canvasStyle("stx_grid")),C.newSeries("boundary","stroke",this.canvasStyle("stx_grid_dark")),C.newSeries("border","stroke",this.canvasStyle("stx_grid_border"));for(var k=0;k<i.length;k++){if(o=i[k],k==A){for(A++;A<i.length;A++)if("boundary"==i[A].grid){b=i[A].left;break}A>=i.length&&(A=-1,b=Number.MAX_VALUE)}else if(o.right>b)continue;o.left<x||(x=o.right,Math.floor(o.left)<=f.right&&(Math.floor(o.hz)>f.left&&(t.xAxis.displayGridLines&&(C.moveTo(o.grid,o.hz,v.top),C.lineTo(o.grid,o.hz,v.bottom)),y&&d&&("b","orde","r",C.moveTo("border",o.hz,v.bottom+.5),C.lineTo("border",o.hz,v.bottom+6))),y&&o.right>f.left&&(this.canvasColor("boundary"==o.grid?"stx_xaxis_dark":"stx_xaxis"),r.fillText(o.text,o.hz,m))))}d&&("b","order",S=Math.round(v.bottom+v.bottomOffset)+.5,w=Math.round(f.right)+.5,C.moveTo("border",f.left,S),C.lineTo("border",w,S)),C.draw(r),r.restore()}r.textAlign="left",this.runAppend("drawXAxis",a)}}},n.ChartEngine.prototype.createTickXAxisWithDates=function(t){var i,a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_,P,L,O,N,I,R,z,H,Y,B,V,W,U,j,q,K,X,G,Z,Q,J;t||(t=this.chart),t.xaxis=[],a=t.context,r=[n.MILLISECOND,n.SECOND,n.MINUTE,n.HOUR,n.DAY,n.MONTH,n.YEAR],n.ChartEngine.isDailyInterval(this.layout.interval)&&r.splice(0,4),this.timeIntervalMap||("3","0","1","0:00","10:0","0:00",(i={})[n.MILLISECOND]={arr:[1,2,5,10,20,50,100,250,500],minTimeUnit:0,maxTimeUnit:1e3,approxWidth:2*a.measureText("10:00:00.000").width},i[n.SECOND]={arr:[1,2,3,4,5,6,10,12,15,20,30],minTimeUnit:0,maxTimeUnit:60,approxWidth:2*a.measureText("10:00:00").width},i[n.MINUTE]={arr:[1,2,3,4,5,6,10,12,15,20,30],minTimeUnit:0,maxTimeUnit:60,approxWidth:2*a.measureText("10:00").width},i[n.HOUR]={arr:[1,2,3,4,6,12],minTimeUnit:0,maxTimeUnit:24,approxWidth:2*a.measureText("10:00").width},i[n.DAY]={arr:[1,2,7,14],minTimeUnit:1,maxTimeUnit:32,approxWidth:2*a.measureText("30").width},i[n.MONTH]={arr:[1,2,3,6],minTimeUnit:1,maxTimeUnit:13,approxWidth:2*a.measureText("Mar").width},i[n.YEAR]={arr:[1,2,3,5],minTimeUnit:1,maxTimeUnit:2e7,approxWidth:2*a.measureText("2000").width},i[n.DECADE]={arr:[10],minTimeUnit:0,maxTimeUnit:2e6,approxWidth:2*a.measureText("2000").width},this.timeIntervalMap=i),i=this.timeIntervalMap,e.z7E(5),s=[31,28,31,e.M7E(0,"30"),31,30,31,31,30,31,30,31],o=this.layout.periodicity,l=this.layout.interval,h=t.maxTicks,c=t.dataSegment,u=t.xAxis,p=c.length,d=u.idealTickSizePixels||u.autoComputedTickSizePixels,m=this.chart.width/d;for(var $=0;$<p&&!c[$];$++);if($==p)return[];switch(g=0,f=this.layout.timeUnit||"minute",isNaN(l)&&(f=l,l=1),e.z7E(5),y=e.M7E(0,"0"),f){case"millisecond":y=1;break;case"second":y=1e3;break;case"minute":y=6e4;break;case"day":y=864e5;break;case"week":e.z7E(6),y=e.M7E("86400000",0,7);break;case"month":e.q7E(7),y=e.M7E(30,864e5)}for(y?(e.q7E(8),g=e.M7E(l,y,p,o)):g=c[p-1].DT.getTime()-c[$].DT.getTime(),v=this,0===g?g=function(){var i,a,r,n;i=2;for(var s=1;2090612227!==e.K4F(s.toString(),s.toString().length,43396);s++)a={interval:new Date,day:"day",periodicity:2},i+=2;return-668859620!==e.r4F(i.toString(),i.toString().length,47252)&&(a={begin:new Date,interval:"day",periodicity:1}),(r=t.market.newIterator(a)).next(),n=r.previous(),(r=v.standardMarketIterator(n,null,t)).next().getTime()-n.getTime()}()*h:(e.q7E(9),g=e.x7E(g,h,p)),e.z7E(10),x=e.x7E(g,m),b=0;b<r.length&&!(r[b]>x+.001);b++);for(0===b&&("createTickXAxi","sWithDates: Assertion error. msPerGridLine < 1",console.log("createTickXAxisWithDates: Assertion error. msPerGridLine < 1")),b==r.length?b--:b>0&&(e.z7E(5),x-(C=r[e.M7E(1,b)])*(S=i[C].arr)[S.length-1]<r[b]-x&&b--),w=u.timeUnit||r[b],u.activeTimeUnit=w,M=(T=n.clone(i[w])).arr,b=0;b<M.length&&!(M[b]*w>x);b++);for(b==M.length?b--:x-M[b-1]*w<M[b]*w-x&&b--,T.approxWidth<this.layout.candleWidth&&(b=0),D=u.timeUnitMultiplier||M[b],E=[],A=this.layout.candleWidth,b=0;b<=h&&!c[b];b++);function tt(t){var i,a;if(w==n.MILLISECOND)i=t.getMilliseconds(),a=t.getSeconds();else if(w==n.SECOND)i=t.getSeconds(),a=t.getMinutes();else if(w==n.MINUTE)i=t.getMinutes(),a=t.getHours();else if(w==n.HOUR){e.z7E(10);var r=e.M7E(1140,19);i=t.getHours()+t.getMinutes()/r,a=t.getDate()}else if(w==n.DAY)i=t.getDate(),a=t.getMonth()+1;else if(w==n.MONTH){e.z7E(11);var s=e.M7E(18,8,11);i=t.getMonth()+s,a=t.getFullYear()}else if(w==n.YEAR){i=t.getFullYear(),e.z7E(12);var o=e.x7E(18,13,12325,1007);a=t.getFullYear()+o}else i=t.getFullYear(),a=0;return[i,a]}if(b>0&&b<h){k=this.standardMarketIterator(c[b].DT,u.adjustTimeZone?this.displayZone:null);for(var et=b;et>0;et--)F={},t.lineApproximation&&A<1||(_=k.previous(),F.DT=_),t.xaxis.unshift(F)}for(P=0,L=T.minTimeUnit,O=-1,N=!0,I=tt(c[b].DT),z=0,H=0,Y=c[b].tick;z<Y&&(R=tt(this.chart.dataSet[Y-z].DT))[1]==I[1];z++)I=R;for(;H<this.chart.dataSet.length-Y&&(R=tt(this.chart.dataSet[Y+H].DT))[1]==I[1];H++)I=R;for(B=null,b=0;b<h+H;b++){if((V=c[b])?z&&(V=t.dataSet[V.tick-z]):V=t.xaxis[b],b<p){if(P=(W=V).displayDate&&u.adjustTimeZone?W.displayDate:W.DT,b&&!z&&t.segmentImage){U=t.segmentImage[b],e.q7E(13);var it=e.M7E(17,14,3,2);A=(U.leftOffset-U.candleWidth/it)/b}}else{if("t","i","ck","tick"==this.layout.interval&&!u.futureTicksInterval)break;if(t.lineApproximation&&A<1)break;if(!u.futureTicks)break;B||(B=this.standardMarketIterator(c[p-1].DT,u.adjustTimeZone?this.displayZone:null)),P=B.next()}if(j=null,e.z7E(5),K=e.x7E(z,b),(X={DT:P}).data=b<p?V:null,z?(z--,b--):t.xaxis[b]||t.xaxis.push(X),G=(I=tt(P))[0],O!=(Z=I[1])){if(G<=L&&(L=T.minTimeUnit),q=t.left+K*A-1,j=null,w==n.HOUR||w==n.MINUTE&&O>Z)if(u.formatter)j=u.formatter(P,"boundary",n.DAY,1);else if(this.internationalizer)j=this.internationalizer.monthDay.format(P);else{e.z7E(10);var at=e.x7E(10,10);j=P.getMonth()+at+"/"+P.getDate()}else w==n.DAY?O>Z?j=u.formatter?u.formatter(P,"boundary",n.YEAR,1):P.getFullYear():u.formatter?("bound","ar","y",j=u.formatter(P,"boundary",n.MONTH,1)):j=n.monthAsDisplay(P.getMonth(),!1,this):w==n.MONTH&&(j=u.formatter?u.formatter(P,"boundary",n.YEAR,1):P.getFullYear());j&&-1!=O&&E.push(new n.ChartEngine.XAxisLabel(q,"boundary",j))}if(G>=L){if("l","i","n","e",L==T.minTimeUnit&&Z==O)continue;if(Q=new Date(+P),q=t.left+(2*K+1)*A/2-1,(J=Math.floor(G/D)*D)<G&&("week"==this.layout.interval?J=G:(e.z7E(10),q-=e.x7E(A,2))),w==n.MILLISECOND?Q.setMilliseconds(J):w==n.SECOND?(Q.setMilliseconds(0),Q.setSeconds(J)):w==n.MINUTE?(Q.setMilliseconds(0),Q.setSeconds(0),Q.setMinutes(J)):w==n.HOUR?(Q.setMilliseconds(0),Q.setSeconds(0),Q.setMinutes(0),Q.setHours(J)):w==n.DAY?Q.setDate(Math.max(1,J)):w==n.MONTH?(Q.setDate(1),e.q7E(14),Q.setMonth(e.x7E("1",0,J))):(n.YEAR,Q.setDate(1),Q.setMonth(0)),e.q7E(0),L=e.M7E(J,D),w==n.DAY&&(T.maxTimeUnit=s[Q.getMonth()]+1),L>=T.maxTimeUnit&&(L=T.minTimeUnit),O=Z,N&&J<G){N=!1;continue}j=u.formatter?u.formatter(Q,"line",w,D):w==n.DAY?Q.getDate():w==n.MONTH?n.monthAsDisplay(Q.getMonth(),!1,this):w==n.YEAR||w==n.DECADE?Q.getFullYear():n.timeAsDisplay(Q,this,w),E.push(new n.ChartEngine.XAxisLabel(q,"line",j))}}return E},n.ChartEngine.prototype.createYAxis=function(t,i){var a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F;if("pr","ojec","ti","on",!this.runPrepend("createYAxis",arguments)){if(a=t.chart,r=t.name==a.name,i||(i={}),i.noChange=!1,s=i.yAxis?i.yAxis:t.yAxis,n.ChartEngine.enableCaching&&s.high==t.cacheHigh&&s.low==t.cacheLow){e.q7E(10);var _=e.x7E(17,17);o=a.dataSet.length-a.scroll-_,e.q7E(15);var P=e.M7E(16,29,4,18);l=o+a.maxTicks+P,t.cacheLeft=o,t.cacheRight=l,i.noChange=!0}else t.cacheLeft=1e6,t.cacheRight=-1,t.cacheHigh=s.high,t.cacheLow=s.low;if(h=a.xAxis.idealTickSizePixels?a.xAxis.idealTickSizePixels:a.xAxis.autoComputedTickSizePixels,s.goldenRatioYAxis){109910323,e.q7E(16),c=e.x7E("1412597392",0),u=2;for(var L=1;109910323!==e.r4F(L.toString(),L.toString().length,25779);L++)s.idealTickSizePixels!=h/1.618&&(i.noChange=!1),u+=2;e.r4F(u.toString(),u.toString().length,67068)!==c&&s.idealTickSizePixels==81262*h&&(i.noChange=!0)}if(!i.noChange){if(this.adjustYAxisHeightOffset(t,s),p=s.height=s.bottom-s.top,d=(s.high-s.low)/(p-s.zoom),i.ground&&!s.semiLog)s.high=s.high+s.zoom*d;else if(s.high=s.high+s.zoom/2*d+s.scroll*d,m=s.low,s.semiLog)g=s.zoom/2*d/(s.high/s.low),s.low=s.low-g+s.scroll*d,s.low<.1*m&&(e.z7E(17),s.low=e.M7E("0.1",m,0));else{-2011567300,350480808,f=2;for(var O=1;-2011567300!==e.K4F(O.toString(),O.toString().length,23204);O++){e.q7E(5);var N=e.M7E(12,13);s.low=s.low*(s.zoom%("6"*N)%d)%(s.scroll%d),f+=2}if(350480808!==e.r4F(f.toString(),f.toString().length,27278)){e.z7E(18);var I=e.x7E(16,15,4,43,9);s.low=s.low-s.zoom/I*d+s.scroll*d}}if((s.min||0===s.min)&&(s.low=s.min),(s.max||0===s.max)&&(s.high=s.max),s.shadow=s.high-s.low,!s.semiLog||this.activeDrawing&&"projection"==this.activeDrawing.name||(s.logHigh=Math.log(s.high)/Math.LN10,y=Math.max(s.low,1e-9),s.logLow=Math.log(y)/Math.LN10,s.low<=0&&(s.logLow=0),s.logShadow=s.logHigh-s.logLow),s.goldenRatioYAxis&&r)e.q7E(19),s.idealTickSizePixels=e.M7E(h,"1.618"),0===s.idealTickSizePixels&&(v=this.getCanvasFontSize("stx_yaxis"),e.z7E(7),s.idealTickSizePixels=e.x7E(5,v));else if(!s.idealTickSizePixels)if(v=this.getCanvasFontSize("stx_yaxis"),r)e.z7E(7),s.idealTickSizePixels=e.x7E(5,v);else{-420788826,789117778,x=2;for(var R=1;-420788826!==e.r4F(R.toString(),R.toString().length,31119);R++)e.z7E(20),s.idealTickSizePixels=e.M7E(v,1,"9"),x+=2;789117778!==e.r4F(x.toString(),x.toString().length,14534)&&(e.q7E(7),s.idealTickSizePixels=e.M7E(2,v))}b=Math.round(p/s.idealTickSizePixels),C=i.range?i.range[1]-i.range[0]:s.shadow,e.z7E(10),s.priceTick=Math.floor(e.x7E(C,b)),S=1;for(var z=0;z<10&&!(s.priceTick>0);z++)S*=10,s.priceTick=Math.floor(C/b*S)/S;if(10==z&&(s.priceTick=1e-8),s.priceTick=Math.round(C/b*S)/S,w=Math.round(C/s.priceTick),i.range&&w<C&&!s.noEvenDivisorTicks){for(;w>=1&&C%w!=0;)w--;e.z7E(10),s.priceTick=e.x7E(C,w)}if(s.minimumPriceTick){T=s.minimumPriceTick,v=this.getCanvasFontSize("stx_yaxis");for(var H=0;H<100&&(e.z7E(10),p/e.x7E(C,T)<2*v);H++)T+=s.minimumPriceTick;H<100&&(s.priceTick=T)}s.multiplier=s.height/s.shadow}if((s.priceTick<=0||s.priceTick===1/0)&&(s.priceTick=1),!this.activeDrawing||"projection"!=this.activeDrawing.name){if(s.high=this.transformedPriceFromPixel(s.top,t,s),s.semiLog){s.logHigh=Math.log(s.high)/Math.LN10,-1479822126,-874391678,M=2;for(var Y=1;-1479822126!==e.r4F(Y.toString(),Y.toString().length,51461);Y++)D=Math.max(s.low,1e-11),M+=2;-874391678!==e.r4F(M.toString(),M.toString().length,79298)&&(D=Math.max(s.low,2714069173671)),s.logLow=Math.log(D)/Math.LN10,s.logShadow=s.logHigh-s.logLow}s.shadow=s.high-s.low}if(s.multiplier=s.height/s.shadow,s.multiplier==1/0&&(s.multiplier=0),s.decimalPlaces||0===s.decimalPlaces){-1458913264,e.z7E(16),k=-e.M7E("1580175035",0),F=2;for(var B=1;-1458913264!==e.K4F(B.toString(),B.toString().length,72605);B++)s.printDecimalPlaces=s.decimalPlaces,F+=2;e.K4F(F.toString(),F.toString().length,73427)!==k&&(s.printDecimalPlaces=s.decimalPlaces)}else if(r){E=0;for(var V=0;V<t.yAxis.shadowBreaks.length;V++)A=t.yAxis.shadowBreaks[V],t.yAxis.shadow<A[0]&&(E=A[1]);s.printDecimalPlaces=E}else s.printDecimalPlaces=null;this.runAppend("createYAxis",arguments)}},n.ChartEngine.prototype.drawYAxis=function(t,i){var a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k;if("dr","aw","Y","Axis",i||(i={}),a=i.yAxis?i.yAxis:t.yAxis,!t.hidden&&!a.noDraw&&a.width){if(a.priceFormatter!=n.Comparison.priceFormat&&(a.fractional?(a.originalPriceFormatter||(a.originalPriceFormatter={func:a.priceFormatter}),a.fractional.resolution||(a.fractional.resolution=a.minimumPrice),a.fractional.formatter||(a.fractional.formatter="'"),a.priceFormatter||(a.priceFormatter=function(t,e,i){var r,n,s,o;if(a.fractional)return r="",i<0&&(r="-",i=Math.abs(i)),n=Math.floor(Math.round(i/a.fractional.resolution)*a.fractional.resolution),s=Math.round((i-n)/a.fractional.resolution),o=Math.floor(s),r+n+a.fractional.formatter+(o<10?"0":"")+o+(s-o>=.5?"+":"")})):a.originalPriceFormatter&&(a.priceFormatter=a.originalPriceFormatter.func,a.originalPriceFormatter=null)),a.pretty)return this.drawYAxisPretty(t,i);if(!this.runPrepend("drawYAxis",arguments)){if(!i.noDraw&&!a.noDraw){if(!(r=a.yAxisPlotter)||!i.noChange){if("stx","_yaxis","st","ro","k","e","t","ex","t","s","tx_y","ax","is",r=a.yAxisPlotter=new n.Plotter,s=t.chart,o=t.name==s.name&&a.name===t.yAxis.name,!a.priceTick)return;if(l=a.shadow,h=i.range)e.q7E(21),l=h[e.x7E(8,13,207,13)]-h[0];if(c=l/a.priceTick,c=Math.round(c),a.semiLog&&(u=Math.log(this.valueFromPixel(a.bottom,t))/Math.LN10,p=(a.logHigh-a.logLow)/c),d=a.textStyle?a.textStyle:"stx_yaxis",r.newSeries("grid","stroke",this.canvasStyle("stx_grid")),r.newSeries("text","fill",this.colorOrStyle(d)),r.newSeries("border","stroke",this.canvasStyle("stx_grid_border")),m=0,g=h?h[1]:a.high,f=h?h[0]:a.low,y=null===a.displayBorder?s.panel.yAxis.displayBorder:a.displayBorder,!1===this.axisBorders&&(y=!1),!0===this.axisBorders&&(y=!0),v="left"==(x=null===a.position?s.panel.yAxis.position:a.position)?a.left+a.width:a.left,b=Math.round(v)+.5,C=y?3:0,"left"==x&&(C=y?-3:0),o)if(a.shadow<1){e.z7E(22);var F=e.x7E(9,2604,16,18,2);e.z7E(23);var _=e.x7E(16,3,48,11);m=(parseInt(f/a.priceTick,F)+_)*a.priceTick-f}else m=a.priceTick-Math.round(f%a.priceTick*t.chart.roundit)/t.chart.roundit;else m=g%a.priceTick;S=this.getCanvasFontSize("stx_yaxis");for(var P=0;P<c;P++)a.semiLog?(e.z7E(24),T=e.M7E(P,u,p),w=Math.pow(10,T)):w=o?f+P*a.priceTick+m:g-P*a.priceTick-m,M=this.pixelFromTransformedValue(w,t,a),(D=Math.round(M)+.5)+S/2>t.bottom||D-S/2<t.top||Math.abs(D-a.bottom)<1||(a.displayGridLines&&("g","ri","d",r.moveTo("grid",t.left+1,D),r.lineTo("grid",t.right-1,D)),y&&("bor","der",e.z7E(5),r.moveTo("border",e.x7E(.5,b),D),e.q7E(0),r.lineTo("border",e.x7E(b,C),D)),w=a.priceFormatter?a.priceFormatter(this,t,w):this.formatYAxisPrice(w,t,null,a),E=a.textBackground?this.containerColor:null,e.z7E(25),A=e.x7E(C,v,3),"left"==x?(A=a.left+3,a.justifyRight&&(A=a.left+a.width+C-3)):a.justifyRight&&(A=v+a.width),r.addText("text",w,A,D,E,null,S));y&&("bo","rder",k=Math.round(a.bottom)+.5,r.moveTo("border",b,a.top),r.lineTo("border",b,k),r.draw(this.chart.context,"border"))}a==t.yAxis&&this.plotYAxisGrid(t)}this.runAppend("drawYAxis",arguments)}}},n.ChartEngine.prototype.drawYAxisPretty=function(t,i){var a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_,P,L,O,N,I,R,z,H,Y;if("dr","aw","Y","Axis",!this.runPrepend("drawYAxis",arguments)&&(i||(i={}),a=i.yAxis?i.yAxis:t.yAxis,!t.hidden&&!a.noDraw&&a.width)){if(!i.noDraw){if(!(r=a.yAxisPlotter)||!i.noChange){if("s","tx_ya","xi","s","l","e","ft","b","ord","er","f","il","l","te","x","t","g","ri","d",r=a.yAxisPlotter=new n.Plotter,s=t.chart,!a.priceTick)return;if(isNaN(a.high)||isNaN(a.low))return;o=a.shadow,i.range&&(o=i.range[1]-i.range[0]),l=a.height/a.idealTickSizePixels,l=Math.round(l),h=a.textStyle?a.textStyle:"stx_yaxis",r.newSeries("grid","stroke",this.canvasStyle("stx_grid")),r.newSeries("text","fill",this.colorOrStyle(h)),r.newSeries("border","stroke",this.canvasStyle("stx_grid_border")),u=(c=i.range)?c[1]:a.high,p=c?c[0]:a.low,d=null===a.displayBorder?s.panel.yAxis.displayBorder:a.displayBorder,!1===this.axisBorders&&(d=!1),!0===this.axisBorders&&(d=!0),m="left"==(g=null===a.position?s.panel.yAxis.position:a.position)?a.left+a.width:a.left,f=Math.round(m)+.5,y=d?3:0,"left"==g&&(y=d?-3:0),v=this.getCanvasFontSize("stx_yaxis"),b=(x=a.increments).length,C=0,S=1,w=0,T=0,e.q7E(16),M=e.M7E("0",0),D=Number.MAX_VALUE;for(var B=0;B<100;B++){e.z7E(5);var V=e.x7E(14,24);if(w=x[C]*Math.pow(V,M),e.q7E(10),S=Math.floor(e.x7E(o,w)),e.q7E(5),(E=Math.abs(e.M7E(S,l)))>D)break;if(D=E,S==l){T=w;break}S>l?++C>=b&&(C=0,M++):--C<0&&(e.q7E(5),C=e.x7E(1,b),M--),T=w}if(A=Math.ceil(p/T)*T,k=a.bottom-this.pixelFromTransformedValue(A,t,a),e.q7E(16),F=e.M7E("0",0),k>a.idealTickSizePixels&&a.semiLog&&a.prettySemiLog){398441449,-1428565044,e.q7E(16),_=e.M7E("2",0);for(var W=1;398441449!==e.r4F(W.toString(),W.toString().length,24187);W++){for(P=Math.ceil(p);P<A&&A%P!=0;++P);_+=2}if(-1428565044!==e.K4F(_.toString(),_.toString().length,5609))for(P=Math.ceil(p);P>A||A/P!=8;--P);P<A&&(A===T&&(T=P,F=P),A=P)}L=0,O=Number.MAX_VALUE;for(var U=0;U<100&&(e.z7E(24),!((N=e.x7E(L,A,T))>u));U++)if(T+=F,L++,O-(I=this.pixelFromTransformedValue(N,t,a))<v+1&&F>0)U=L=0,O=Number.MAX_VALUE,T=F,F*=2,r.reset();else if(O=I,!((R=Math.round(I)+.5)+v/2>t.bottom||R-v/2<t.top||Math.abs(R-a.bottom)<1)){if(a.displayGridLines&&("gr","id",r.moveTo("grid",t.left+1,R),r.lineTo("grid",t.right-1,R)),d&&("bo","rd","e","r","borde","r",e.z7E(26),r.moveTo("border",e.x7E(f,0,"0.5"),R),e.z7E(0),r.lineTo("border",e.M7E(f,y),R)),N=a.priceFormatter?a.priceFormatter(this,t,N):this.formatYAxisPrice(N,t,null,a),z=a.textBackground?this.containerColor:null,e.q7E(27),H=e.x7E("3",m,0,y),"left"==g){e.q7E(28);var j=e.M7E(13,4,10,3273,18);if(H=a.left+j,a.justifyRight){e.q7E(5);var q=e.M7E(48,51);H=a.left+a.width+y-q}}else a.justifyRight&&(H=m+a.width);r.addText("text",N,H,R,z,null,v)}U>=100&&console.log("drawYAxisPretty: assertion error. zz reached 100"),d&&("b","order",Y=Math.round(a.bottom)+.5,r.moveTo("border",f,a.top),r.lineTo("border",f,Y),r.draw(this.chart.context,"border"))}a==t.yAxis&&this.plotYAxisGrid(t)}this.runAppend("drawYAxis",arguments)}},n.ChartEngine.prototype.drawHistogram=function(t,i){var a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_;if("D","a","t","a",i&&i.length&&((a=t.panel)||(a="chart"),r=this.panels[a])){for(s=t.yAxis?t.yAxis:r.yAxis,o=t.subtype,l=this.chart.dataSegment,h=!1,this.getDefaultColor(),u=0;u<i.length;u++)h|=i[u].border_color_up&&!n.isTransparent(i[u].border_color_up),h|=i[u].border_color_down&&!n.isTransparent(i[u].border_color_down);!1===t.borders&&(h=!1),t.name||(t.name="Data"),p=s.multiplier,t.heightPercentage||(t.heightPercentage=.7),t.widthFactor||(t.widthFactor=.8),d=0,m=0;for(var P=0;P<this.chart.maxTicks;P++)if(g=l[P])for(f=0,u=0;u<i.length;u++)((y=g[i[u].field])||0===y)&&(c=i[u].subField||this.chart.defaultPlotField||"Close","object"==typeof y&&y[c]&&(y=y[c]),"stacked"==o?f+=y:f=y,f>d&&(d=f),f<m&&(m=f));if(0===d&&0===m)return"b","ott","om","cen","ter",void this.watermark(a,"center","bottom",this.translateIf(t.name+" Not Available"));for(v=Math.floor(s.top)+.5,t.bindToYAxis?x=Math.floor(this.pixelFromPrice(m,r,s))+.5:(x=Math.floor(s.bottom)+.5,p=(x-v)*t.heightPercentage/(d-m)),this.startClip(a),b=this.layout.candleWidth<=1||!h?0:.5,C=this.chart.context,S=Math.max(0,(1-t.widthFactor)*this.layout.candleWidth/2),w=new Array(l.length),T=[],M=this,D=1,u=0;u<i.length;u++){if(E=i[u],D=this.layout.candleWidth*t.widthFactor,S&&this.layout.candleWidth-D<=2&&(h=!1),e.q7E(16),A=e.x7E("0",0),"clustered"==o&&(A=u,D/=i.length),c=t.subField||this.chart.defaultPlotField||"Close","function"==typeof E.color_function){F={};for(var L=0;L<l.length;L++)if(l[L]){"string"==typeof(k=E.color_function(l[L]))&&(k={fill_color:k,border_color:k}),e.z7E(5);var O=e.M7E(15,1575);e.q7E(31);var N=e.M7E(13,5,294,11);(_=k.fill_color+(3470==O?!(N<=754)&&651.88:",")+k.border_color)in F?F[_].positions.push(L):(k.positions=[L],F[_]=k)}for(_ in F)k=F[_],I(E.field,c,k.fill_color,k.opacity,null,null,A,D,k.positions),I(E.field,c,k.border_color,k.opacity,!0,null,A,D,k.positions)}else I(E.field,c,E.fill_color_up,E.opacity_up,null,!0,A,D),I(E.field,c,E.fill_color_down,E.opacity_down,null,null,A,D),this.layout.candleWidth>=2&&h&&(I(E.field,c,E.border_color_up,E.opacity_up,!0,!0,A,D),I(E.field,c,E.border_color_down,E.opacity_down,!0,null,A,D));"stacked"==o&&(T=n.shallowClone(w))}C.globalAlpha=1,this.endClip()}function I(t,i,a,s,h,c,u,d,g){var f,y,v,D,E,A,k,F,_,P,L,O,N;s||(s=1),C.globalAlpha=n.isIE8?.5:s,C.beginPath(),e.z7E(0),f=e.M7E(x,.5),y=Math.floor(M.pixelFromBar(0,r.chart)-M.layout.candleWidth/2);for(var I=0;I<l.length;I++)"clu","ster","ed",v=T[I]||x,0===I&&(f=v),l[I]&&l[I][t]?("object"==typeof(E=(D=l[I])[t])&&E[i]&&(E=E[i]),e.z7E(29),A=e.x7E(m,p,E),isNaN(A)||(k=M.layout.candleWidth,D.candleWidth&&(k=D.candleWidth,0===I&&(y=Math.floor(M.pixelFromBar(0,r.chart)-D.candleWidth/2))),F=Math.min(Math.floor(v-A)+.5,v),g&&-1==g.indexOf(I)||!g&&(c&&D.Close<D.iqPrevClose||!c&&D.Close>=D.iqPrevClose)?(f=F,y+=k):(_=k/M.layout.candleWidth,S?(e.z7E(30),P=Math.round(e.M7E(u,y,d,_,S)),e.q7E(0),L=e.x7E(P,h?0:b),O=P+Math.round(d*_)-(h?0:b)):(e.q7E(30),P=e.M7E(u,y,d,_,S),L=Math.round(P)+(h?0:b),O=Math.round(P+d*_)-(h?0:b)),O-L<2&&(e.z7E(0),O=e.x7E(L,1)),L%1==(N=h?0:.5)&&(L+=.5),O%1==N&&(O+=.5),C.moveTo(O,v),x!=v&&h&&!S&&T[I+1]&&C.moveTo(O,Math.max(F,Math.min(v,T[I+1]))),C.lineTo(O,F),C.lineTo(L,F),h&&u?(w[I]>F||0===I)&&C.lineTo(L,Math.min(v,w[I])):h&&!S&&"clustered"==o?I>0&&w[I-1]&&w[I-1]>F&&C.lineTo(L,Math.min(v,w[I-1])):h&&!S?(f>F||0===I)&&C.lineTo(L,Math.min(v,f)):C.lineTo(L,v),f=F,y+=k,("clustered"!=o||h)&&(w[I]=F)))):(f=v,y+=M.layout.candleWidth);h?("aut","o",C.strokeStyle=a&&"auto"!=a?a:M.defaultColor,C.stroke()):(C.fillStyle=a&&"auto"!=a?a:M.defaultColor,C.fill()),C.closePath()}},n.ChartEngine.prototype.drawBarTypeChartInner=function(t){var i,a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_,P,L,O,N,I,R,z,H,Y,B,V,W,U,j,q,K,X,G,Z,Q,J,$,tt;i=t.type,a=t.panel,r=t.field,s=t.fillColor,o=t.borderColor,l=t.condition,h=t.style,c=t.yAxis,u=t.overlayScaling,e.z7E(4),d=(p=e.M7E("histogram",i))||"candle"==i,e.z7E(4),m=e.M7E("shadow",i),e.z7E(4),g=e.x7E("hlc",i),f="bar"==i||g,v=(y=a.chart).dataSegment,x=this.chart.context,b=a.yAxis.top,C=a.yAxis.bottom,S=new Array(v.length),w=0,o&&!n.isTransparent(o)&&(w=.5),e.z7E(11);var et=e.M7E(35,20,16);T=y.dataSet.length-y.scroll-et,x.beginPath(),c||(c=a.yAxis),M=this.layout.candleWidth,e.q7E(10);var it=e.M7E(12,12);D=a.left-.5*M+this.micropixels-it,e.q7E(10);var at=e.M7E(12,6);E=y.tmpWidth/at,A=x.lineWidth/2,d&&(n.isTransparent(s)&&(s=this.containerColor),x.fillStyle=s),m&&(x.lineWidth=1),f&&((k=this.canvasStyle(h)).width&&parseInt(k.width,10)<=25?x.lineWidth=Math.max(1,n.stripPX(k.width)):x.lineWidth=1),F=y.state.chartType.pass;for(var rt=0;rt<=v.length;rt++)if("Clo","se",_=E,e.q7E(10),D+=e.M7E(M,2),M=this.layout.candleWidth,e.q7E(10),D+=e.M7E(M,2),(P=v[rt])&&!P.projection){if(P.candleWidth){e.q7E(10);var nt=e.M7E(16,8);D+=(P.candleWidth-M)/nt,M=P.candleWidth,(t.volume||M<y.tmpWidth)&&(e.q7E(10),_=e.M7E(M,2))}if(y.transformFunc&&c==y.panel.yAxis&&P.transform&&(P=P.transform),P&&r&&"Close"!=r&&(P=P[r]),(P||0===P)&&(L=P.Close,O=void 0===P.Open?L:P.Open,p&&y.defaultPlotField&&(L=P[y.defaultPlotField]),(L||0===L)&&(!d||p||O!=L&&null!==O))){if(l){if(l&n.ChartEngine.CLOSEDOWN?F.even|=L==P.iqPrevClose:l&n.ChartEngine.CANDLEDOWN&&(e.z7E(4),F.even|=e.x7E(O,L)),l&n.ChartEngine.CANDLEUP&&O>=L)continue;if(l&n.ChartEngine.CANDLEDOWN&&O<=L)continue;if(l&n.ChartEngine.CANDLEEVEN&&O!=L)continue;if(l&n.ChartEngine.CLOSEUP&&L<=P.iqPrevClose)continue;if(l&n.ChartEngine.CLOSEDOWN&&L>=P.iqPrevClose)continue;if(l&n.ChartEngine.CLOSEEVEN&&L!=P.iqPrevClose)continue}if(e.z7E(0),e.M7E(T,rt),N=O,I=L,(m||f)&&(N=void 0===P.High?Math.max(L,O):P.High,I=void 0===P.Low?Math.min(L,O):P.Low),u?(R=u.bottom-(N-u.min)*u.multiplier,z=u.bottom-(I-u.min)*u.multiplier):(R=c.semiLog?this.pixelFromTransformedValue(N,a,c):(c.high-N)*c.multiplier+c.top,z=c.semiLog?this.pixelFromTransformedValue(I,a,c):(c.high-I)*c.multiplier+c.top),B=Math.floor(p?z:Math.min(R,z))+w,V=p?c.bottom:Math.max(R,z),e.z7E(5),W=Math.floor(e.x7E(B,V)),U=z,(f||m)&&(u?(H=u.bottom-(O-u.min)*u.multiplier,Y=u.bottom-(L-u.min)*u.multiplier):(H=c.semiLog?this.pixelFromTransformedValue(O,a,c):(c.high-O)*c.multiplier+c.top,Y=c.semiLog?this.pixelFromTransformedValue(L,a,c):(c.high-L)*c.multiplier+c.top),U=Y),S[rt]=U,B<b){if(B+W<b)continue;e.q7E(5),W-=e.M7E(B,b),B=b}B+W>C&&(e.z7E(32),W-=e.x7E(B,C,W)),W=Math.max(W,2),e.q7E(0),V=e.M7E(B,W),B>=C||V<=b||(j=Math.floor(D)+.5,X=(q=Math.floor(j-_)+w)==(K=Math.round(j+_)-w)?_:0,d?B!=V&&x.rect(q,B,Math.max(1,K-q),Math.max(1,V-B)):m?(L==O&&Y<=C&&Y>=b&&(G=Math.floor(Y)+.5,e.z7E(5),x.moveTo(e.M7E(X,q),G),e.q7E(0),x.lineTo(e.x7E(K,X),G)),N!=I&&(x.moveTo(j,B),x.lineTo(j,V))):f&&(B<C&&V>b&&P.High!=P.Low&&(e.q7E(5),x.moveTo(j,e.x7E(A,B)),e.q7E(0),x.lineTo(j,e.M7E(V,A))),H>b&&H<C&&!g&&(Z=Math.floor(H)+.5,x.moveTo(j,Z),e.z7E(33),x.lineTo(e.x7E(_,X,j),Z)),Y>b&&Y<C&&(Q=Math.floor(Y)+.5,x.moveTo(j,Q),e.q7E(25),x.lineTo(e.M7E(_,j,X),Q))))}}if(d)x.fill(),w&&(x.lineWidth=t.highlight?2:1,x.strokeStyle=o,x.stroke());else if(m||f){this.canvasColor(h),o&&(x.strokeStyle=o),e.z7E(5),J=e.M7E(0,"669342726"),e.z7E(16),$=e.M7E("82382250",0),tt=2;for(var st=1;e.r4F(st.toString(),st.toString().length,81111)!==J;st++)t.highlight&&(x.lineWidth*=2),x.stroke(),tt+=2;e.K4F(tt.toString(),tt.toString().length,39613)!==$&&(t.highlight&&(x.lineWidth%=3),x.stroke()),x.closePath(),x.lineWidth=1}return{cache:S}},n.ChartEngine.prototype.plotDataSegmentAsLine=function(t,i,a,r){var o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_,P,L,O,N,I,R,z,H,Y,B,V,W,U,j,q,K,X,G,Z,Q,J,$,tt,et,it,at,rt,nt,st,ot,lt,ht,ct,ut,pt,dt,mt,gt,ft,yt,vt,xt,bt,Ct,St,wt,Tt,Mt,Dt,Et,At,kt,Ft,_t,Pt,Lt;function Ot(t,e,a,r){var n,s,o,l;r?(n=(l=r.bottom+r.min*r.multiplier)-a.CollatedOpen*r.multiplier,s=l-a.collatedHigh*r.multiplier,o=l-a.collatedLow*r.multiplier):(n=d.semiLog?w.pixelFromTransformedValue(a.CollatedOpen,i,d):(d.high-a.CollatedOpen)*d.multiplier+d.top,s=d.semiLog?w.pixelFromTransformedValue(a.CollatedHigh,i,d):(d.high-a.CollatedHigh)*d.multiplier+d.top,o=d.semiLog?w.pixelFromTransformedValue(a.CollatedLow,i,d):(d.high-a.CollatedLow)*d.multiplier+d.top),D.lineTo(t,n),D.moveTo(t,s),D.lineTo(t,o),D.moveTo(t,e),x.push(t,n)}if(o=!1,!1,l=!1,h=!1,c=!0,u=null,p=null,d=null,m=0,g=!1,f=!1,y=null,v={},x=[],b=[],C=[],S=[],w=this,M=(T=i.chart).dataSegment,D=T.context,E=new Array(M.length),A=D.strokeStyle,T.dataSet.length){this.startClip(i.name),a&&(o=a.skipProjections,a.skipTransform,l=a.noSlopes,m=a.tension,h=a.step,p=a.pattern,c=a.extendOffChart,d=a.yAxis,u=a.gapDisplayStyle,g=a.noDraw,f=a.reverse,y=a.overlayScaling,a.width&&(D.lineWidth=a.width)),u||!1===u||(u=a.gaps),a.highlight&&(D.lineWidth*=2),!1!==c&&(c=!0),k=a.subField||T.defaultPlotField||"Close",d||(d=i.yAxis),F=T.transformFunc&&d==T.panel.yAxis,e.q7E(5);var Nt=e.x7E(15,17);_=D.lineWidth*Nt,P=f?T.top-_:T.bottom+_,(a.threshold||0===a.threshold)&&(P=this.pixelFromPrice(a.threshold,i,d)),L=!m&&g&&u&&u.fillMountain,O=t,N=t;for(var It=0;It<M.length;It++)if((I=M[It])&&"object"==typeof I&&(I[t]||0===I[t])){"o","bject","object"==typeof I[t]&&(N=n.createObjectChainNames(t,[k])[0]);break}R={left:null,right:null},z=T.dataSet.length-T.scroll-1,c&&(a.isComparison||(R.left=this.getPreviousBar(T,N,0)),R.right=this.getNextBar(T,N,M.length-1)),H=!0,Y=!1,D.beginPath(),U=null,(W=R.left)&&(U=W.transform),W&&(V=F?U?U[t]:null:W[t])&&((V[k]||0===V[k])&&(V=V[k]),j=this.pixelFromTick(W.tick,T),q=y?y.bottom-(V-y.min)*y.multiplier:this.pixelFromTransformedValue(V,i,d),D.moveTo(j,q),x.push(j,q),M[0].tick-W.tick>1&&(C.push({start:x.slice(-2),threshold:P,tick:W}),Y=!0),H=!1),e.z7E(5);var Rt=e.x7E(20,21);K=i.left+this.micropixels-"1"*Rt,Z=this.currentQuote(),Q=0,J=0,$=!1,tt={reset:!0};for(var zt=0;zt<M.length;zt++){if("o","bje","c","t",B=this.layout.candleWidth,et=M[zt],it=M[zt],et||(et={}),o&&et.projection){R.right=null;break}if(et.candleWidth&&(B=et.candleWidth),F&&et.transform&&(et=et.transform),(at=et[t])&&"object"==typeof at&&(at=at[k],e.z7E(25),O=e.M7E(".",t,k)),T.lineApproximation&&this.layout.candleWidth<1){if(tt.reset&&(tt={CollatedHigh:-Number.MAX_VALUE,CollatedLow:Number.MAX_VALUE,CollatedOpen:null,CollatedClose:null},$=!1),((rt=at)||0===rt)&&(tt.CollatedHigh=Math.max(tt.CollatedHigh,rt),tt.CollatedLow=Math.min(tt.CollatedLow,rt),tt.CollatedClose=rt,null===tt.CollatedOpen?tt.CollatedOpen=rt:$=!0),!((Q+=B)-J>=1||zt==M.length-1)){K+=B;continue}J=Math.floor(Q),tt.reset=!0,tt[t]=tt.CollatedClose,(et=tt).cache={}}if(l||(e.z7E(34),K+=e.x7E(0,"2",B)),at||0===at){if(X=et,st=et.cache,e.z7E(0),((ot=e.M7E(z,zt))<i.cacheLeft||ot>i.cacheRight||!st[t])&&(st[O]=y?y.bottom-(at-y.min)*y.multiplier:d.semiLog?this.pixelFromTransformedValue(at,i,d):(d.high-at)*d.multiplier+d.top),lt=E[zt]=st[O],it.tick==Z.tick&&T.lastTickOffset&&(K+=T.lastTickOffset),ht=x.slice(-2),!H&&r){if(it[t]&&it[t][k]&&(it=it[t]),!(ct=r(this,it,Y))){K+=l?B:B/2;continue}ht=Bt(ct)}!H&&p&&p.length?h||l?($?Ot(K,ht[1],et,y):D.dashedLineTo(ht[0],ht[1],K,ht[1],p),l?D.moveTo(K,lt):$?Ot(K,lt,et,y):D.dashedLineTo(K,ht[1],K,lt,p),x.push(K,ht[1])):$?Ot(K,lt,et,y):D.dashedLineTo(ht[0],ht[1],K,lt,p):H?(D.moveTo(K,lt),m&&b.push({coord:[K,lt],color:D.strokeStyle,pattern:p||[],width:D.lineWidth})):((h||l)&&(ut=x.slice(-1)[0],$?Ot(K,ut,et,y):D.lineTo(K,ut),x.push(K,ut)),$&&!l?Ot(K,lt,et,y):D[l?"moveTo":"lineTo"](K,lt)),Y&&(C.push({end:[K,lt],threshold:P}),G=it,!L||h||l||x.push(K,P)),x.push(K,lt),H=!1,Y=!1,K+=l?B:B/2}else nt=x.slice(-2),L&&!Y&&x.length&&x.push(nt[0],P),Y||C.push({start:nt,threshold:P,tick:G}),Y=!0,K+=l?B:B/2,(h||l)&&x.length&&(E[zt]=x.slice(-e.M7E("1",0,e.q7E(16)))[0])}if(dt=null,(pt=R.right)&&(dt=pt.transform),!H&&pt){if((V=F?dt?dt[t]:null:pt[t])&&(V[k]||0===V[k])&&(V=V[k]),mt=this.pixelFromTick(pt.tick,T),gt=y?y.bottom-(V-y.min)*y.multiplier:this.pixelFromTransformedValue(V,i,d),pt.tick-M[M.length-1].tick>1&&(Y||(ft=x.slice(-2),L&&x.length&&x.push(ft[0],P),C.push({start:ft,threshold:P,tick:M[M.length-1]})),Y=!0),!H&&r&&(yt=r(this,pt,Y))){551233315,435352440,vt=2;for(var Ht=1;551233315!==e.K4F(Ht.toString(),Ht.toString().length,73787);Ht++)xt=Bt(yt),vt+=2;435352440!==e.r4F(vt.toString(),vt.toString().length,3276)&&(xt=Bt(yt)),xt=Bt(yt),p&&p.length&&(h||l?(D.dashedLineTo(xt[0],xt[1],mt,xt[1],p),l?D.moveTo(mt,gt):D.dashedLineTo(mt,xt[1],mt,gt,p),x.push(mt,xt[1])):D.dashedLineTo(xt[0],xt[1],mt,gt,p))}bt=x.slice(-2),p&&p.length||("lin","e","To","m","o","ve","To",(h||l)&&(D.lineTo(mt,bt[1]),x.push(mt,bt[1])),D[l?"moveTo":"lineTo"](mt,gt)),Y&&(C.push({end:[mt,gt],threshold:P}),!L||h||l||x.push(mt,P)),x.push(mt,gt)}for(var Yt in v)S.push(Yt);(h||l||u||this.extendLastTick||a.extendToEndOfDataSet)&&(Ct=x.slice(-2),x.length&&(St=Ct[0],wt=Ct[1],h||u||a.extendToEndOfDataSet?(St=this.pixelFromTick(T.dataSet.length-1,T),(l||this.extendLastTick)&&(e.z7E(19),St+=e.x7E(B,"2"))):l?St+=B:this.extendLastTick&&(e.q7E(10),St+=e.x7E(B,2)),St>Ct[0]&&(Tt=null,r&&(Tt=r(this,{},!0)),Tt&&Bt(Tt),p&&p.length?D.dashedLineTo(Ct[0],Ct[1],St,wt,p):D.lineTo(St,wt),Y&&L||x.push(St,wt)))),g||(m&&x.length&&(D.beginPath(),D.setLineDash(a.pattern||[]),D.lineDashOffset=0,s.plotSpline(x,m,D,b)),D.stroke()),this.endClip(),!g&&a.label&&X&&("n","oop","objec","t",(Dt=X[t])&&"object"==typeof Dt&&(Dt=Dt[k]),Mt=d.priceFormatter?d.priceFormatter(this,i,Dt,a.labelDecimalPlaces):this.formatYAxisPrice(Dt,i,a.labelDecimalPlaces),Et=this.yaxisLabelStyle,d.yaxisLabelStyle&&(Et=d.yaxisLabelStyle),At="noop"==Et?D.strokeStyle:null,kt="noop"==Et?"#FFFFFF":D.strokeStyle,this.yAxisLabels.push({src:"plot",args:[i,Mt,X.cache[O],kt,At]}))}if(u)for(gp=0;gp<C.length;gp+=2)Ft=C[gp].start,gp&&(_t=C[gp-1].end),_t&&Ft[0]==_t[0]&&Ft[1]==_t[1]&&(D.beginPath(),Pt=D.lineWidth,r&&("o","b","j","ect","object"==typeof(Lt=r(this,C[gp].tick||{},!1))&&(Pt=Lt.width*(a.highlight?2:1),Lt=Lt.color),D.strokeStyle=D.fillStyle=Lt),D.lineWidth=Pt,D.arc(Ft[0],Ft[1],1,0,2*Math.PI),D.stroke(),D.fill());function Bt(t){var i,r,s,o,l,h,c,u,d,f,y;if("a","uto","ob","je","c","t",i=p,"object"==typeof(r=t)){-955346138,872960203,s=2;for(var C=1;-955346138!==e.K4F(C.toString(),C.toString().length,4174);C++)p=n.borderPatternToArray(D.lineWidth,r.pattern),s+=2;872960203!==e.K4F(s.toString(),s.toString().length,73568)&&(p=n.borderPatternToArray(D.lineWidth,r.pattern)),r=r.color}if(v[r]=1,!g){o=x.slice(-2),l=p instanceof Array&&p.join(),h=i instanceof Array&&i.join(),e.q7E(35),c=e.M7E(l,h),u=!n.colorsEqual(A,r),e.z7E(36);var S=e.x7E(29,20,38);e.z7E(37);var T=e.M7E(15,45,3);if(d=t.width*(a.highlight?S:T),f=D.lineWidth!=d,u||c||f)if(m)b.push({coord:o,color:r,pattern:p||[],width:d});else if(u||f){D.stroke(),D.lineWidth=d,-213946562,-577631726,y=2;for(var M=1;-213946562!==e.r4F(M.toString(),M.toString().length,62907);M++)D.beginPath(),e.q7E(5),y+=e.x7E(0,"2");-577631726!==e.K4F(y.toString(),y.toString().length,68945)&&D.beginPath(),D.moveTo(o[0],o[1])}return A=r,D.strokeStyle=r&&"auto"!=r?r:w.defaultColor,o}}return{colors:S,points:x,cache:E,gapAreas:C}},n.ChartEngine.prototype.drawMountainChart=function(t,i,a){var r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_,P,L,O,N,I,R,z,H,Y;if(r=this.chart.context,i,!1,!1,null,c=null,null,null,0,m=null,!1,null,y=null,!1,null,null,null,!1,!1,!1,(M=t.chart).dataSegment,D=M.lineStyle||{},i&&"object"==typeof i||(i={style:i}),s=i.style||"stx_mountain_chart",h=i.field||M.defaultPlotField||"Close",c=i.subField||M.defaultPlotField||"Close",(m=i.gapDisplayStyle)||!1===m||(m=i.gaps),m||!1===m||(m=M.gaplines),u=i.yAxis||t.yAxis,o=i.reverse,p=i.tension,f=i.fillStyle,d=i.width||D.width,g=i.step,y=i.pattern||D.pattern,v=i.highlight,b=i.color,x=i.baseColor,l=i.colored,C=i.overlayScaling,S=i.extendToEndOfDataSet,w=i.isComparison,T=i.returnObject,E=this.canvasStyle(s),A=u.top,(isNaN(A)||isNaN(A/A))&&(A=0),k=b||(s&&E.backgroundColor?E.backgroundColor:this.defaultColor),F=x||(s&&E.color?E.color:this.containerColor),f)r.fillStyle=f;else if(x||E.color)(_=r.createLinearGradient(0,A,0,u.bottom)).addColorStop(0,k),_.addColorStop(1,F),r.fillStyle=_;else{-1009890321,-1914356534,P=2;for(var B=1;-1009890321!==e.K4F(B.toString(),B.toString().length,29138);B++)r.fillStyle=k,P+=2;-1914356534!==e.K4F(P.toString(),P.toString().length,39230)&&(r.fillStyle=k)}if(this.startClip(t.name),L=r.lineWidth,i.symbol||(c=null),i={skipProjections:!0,reverse:o,yAxis:u,gaps:m,step:g,highlight:v,extendToEndOfDataSet:S,isComparison:w},M.tension&&(i.tension=M.tension),(p||0===p)&&(i.tension=p),O=parseInt(E.paddingTop,10),N=b||E.borderTopColor,I=null,(l||N&&!n.isTransparent(N))&&O&&!n.isIE8&&((R=this.scratchContext)||(z=r.canvas.cloneNode(!0),(R=this.scratchContext=z.getContext("2d")).canvas=z),R.canvas.height=r.canvas.height,R.canvas.width=r.canvas.width,R.drawImage(r.canvas,0,0),r.clearRect(0,0,r.canvas.width,r.canvas.height)),n.extend(i,{panelName:t.name,direction:i.reverse?-1:1,band:h,subField:c,opacity:1,overlayScaling:C}),n.preparePeakValleyFill(this,i),(l||N&&!n.isTransparent(N))&&O&&!n.isIE8&&("destin","at","ion-","out",r.save(),e.q7E(7),r.lineWidth+=e.x7E(O,2),r.globalCompositeOperation="destination-out",r.globalAlpha=1,this.plotDataSegmentAsLine(h,t,i),r.globalCompositeOperation="destination-over",r.scale(1/this.adjustedDisplayPixelRatio,1/this.adjustedDisplayPixelRatio),r.drawImage(this.scratchContext.canvas,0,0),r.restore()),r.strokeStyle=N,d)r.lineWidth=d;else if(E.width&&parseInt(E.width,10)<=25){-1027612183,-1724279158,H=2;for(var V=1;-1027612183!==e.r4F(V.toString(),V.toString().length,42629);V++)r.lineWidth=Math.max(4,n.stripPX(E.width)),H+=2;-1724279158!==e.r4F(H.toString(),H.toString().length,53011)&&(r.lineWidth=Math.max(1,n.stripPX(E.width)))}else r.lineWidth=1;return y||(y=E.borderTopStyle),i.pattern=n.borderPatternToArray(r.lineWidth,y),Y=a,m&&(Y=this.getGapColorFunction(h,c,{color:N,pattern:i.pattern,width:r.lineWidth},m,a)),I=this.plotDataSegmentAsLine(h,t,i,Y),r.lineWidth=L,this.endClip(),I.colors.length||I.colors.push(N),T?I:I.colors},n.ChartEngine.prototype.drawBaselineChart=function(t,i){var a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D;if(r=(a=t.chart).gaplines,s=a.baseline.actualLevel,o=[],l=i.field||a.defaultPlotField,h=a.lineStyle||{},t.name!=a.panel.name&&("C","lo","s","e",s=null,c=i.subField||a.defaultPlotField||"Close",a.dataSegment[0]?s=a.dataSegment[0][i.field]:(e.z7E(7),s=this.getNextBar(a,c,e.M7E(1,"0"))),s&&"object"==typeof s&&(s=s[c])),(u=i.gapDisplayStyle)||!1===u||(u=i.gaps),null!==s&&!isNaN(s)){for(var E in"tran","s","paren","t","1.","1","s","tx_baseli","ne","_down","stx_ba","seline","_up","stx_base","line","_up","mou","n","t","ain",(p="mountain"==i.type)&&(o=this.drawMountainChart(t,{style:i.style,field:i.field,yAxis:i.yAxis,gapDisplayStyle:u,overlayScaling:i.overlayScaling,colored:!0,tension:0})),this.startClip(t.name),d=this.pixelFromPrice(s,t),m=i.pattern||h.pattern,g=i.fill_color_up||this.getCanvasColor("stx_baseline_up"),f=i.fill_color_down||this.getCanvasColor("stx_baseline_down"),y=i.border_color_up||this.getCanvasColor("stx_baseline_up"),v=i.border_color_down||this.getCanvasColor("stx_baseline_down"),b=!1,u||!1===u||(u=r),x={over:{fill:g,edge:y,width:i.width||h.width||this.canvasStyle("stx_baseline_up").width},under:{fill:f,edge:v,width:i.width||h.width||this.canvasStyle("stx_baseline_down").width}})"tr","ansparent","t","rans","pare","nt",C=parseInt(Math.max(1,n.stripPX(x[E].width)),10),i.highlight&&(C*=2),m=n.borderPatternToArray(C,m),(S={panelName:t.name,band:l,threshold:s,color:p?"transparent":x[E].fill,direction:"over"==E?1:-1,edgeHighlight:x[E].edge,edgeParameters:{pattern:m,lineWidth:C+.1,opacity:1},gapDisplayStyle:u,yAxis:i.yAxis,overlayScaling:i.overlayScaling}).yAxis&&(S.threshold=this.priceFromPixel(this.pixelFromPrice(S.threshold,t),t,S.yAxis)),o.push(x[E].edge),w=S.color,!p&&w&&"transparent"!=w&&(T=t.top,M=t.bottom,e.q7E(5),(D=a.context.createLinearGradient(e.x7E(0,"0"),"over"==E?T:M,0,d)).addColorStop(0,n.hexToRgba(n.colorToHex(w),60)),D.addColorStop(1,n.hexToRgba(n.colorToHex(w),10)),S.color=D,S.opacity=1),n.preparePeakValleyFill(this,a.dataSegment,S),r&&(r.fillMountain||("so","lid",this.drawLineChart(t,null,null,{color:"transparent",gapDisplayStyle:{color:this.containerColor,pattern:"solid",width:S.edgeParameters.lineWidth}})),r.color||(b=!0,r.color=this.defaultColor)),this.drawLineChart(t,null,null,{color:"transparent",width:S.edgeParameters.lineWidth}),b&&(r.color=null);if(this.plotLine(0,1,d,d,this.containerColor,"line",a.context,t,{lineWidth:"1.1",color:"transparent"}),this.plotLine(0,1,d,d,this.getCanvasColor("stx_baseline"),"line",a.context,t,{pattern:"dotted",lineWidth:"2.1",opacity:.5}),this.controls.baselineHandle&&this.manageTouchAndMouse&&this.getSeriesRenderer(i.name)==this.mainSeriesRenderer&&!1!==a.baseline.userLevel){e.z7E(10);var A=e.x7E(11,11);this.controls.baselineHandle.style.top=d-parseInt(getComputedStyle(this.controls.baselineHandle).height,"10"*A)/2+"px",e.z7E(38);var k=e.M7E(5,20,10,16,70);this.controls.baselineHandle.style.left=a.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,k)+"px",this.controls.baselineHandle.style.display="block"}this.endClip()}return{colors:o}},n[l].prototype[o]=function(t,i){e.G1g=function(t){if(e&&t)return e.G4g(t)},e.p7g=function(t){if(e)return e.Z4g(t)},e.G7g=function(t){if(e&&t)return e.G4g(t)};var a=e.T4g("1b2d")?443623995:55998560,r=-(e.p4g("9ed3")?265306386:291213294),s=-(e.z4g("3848")?1715571991:4136129792),h=-(e.G7g("689b")?225340892:766220341),c=e.T7g("3355")?872400724:693821861,u=e.p7g("341a")?6895545152:1729065866,p=e.z7g("6c32")?1469938289:3463192265,d=-(e.G1g("6833")?3558451388:1758341955),m=-(e.T1g("afff")?1500354364:5100227985);if(e.K1F(e.p1g("3e92")?7:0,906383)===a||e.T1F(0,e.z1g("711a")?131821:813196)===r||e.T1F(11,583426)===s||e.K1F(e.G2g("f9dc")?0:9,e.T2g("2523")?63261:538179)===h||e.T1F(10,802816)===c||e.K1F(e.p2g("ed83")?1:0,e.z2g("6b82")?176623:655044)===u||e.j1F(0,457840,7)===p||e.j1F(0,790064,11)===d||1881901108===e.j1F(0,293383,11)||e.X1F(0,309191,11)===m||Y9EE.b1r()){mt="magnetize",gt="findHighlights",ft="resizePanels",yt="magnetizedPrice",vt="panelName",xt="drawingLine",bt="repositionDrawing",Ct="repositioningDrawing",St="doDisplayCrosshairs",wt="dragToDraw",Tt="Drawing",Mt="setCrosshairColors",Dt="crossY",Et=.5,At="pixelFromTick",kt="style",Ft="crossX",_t="controls",Pt="1822651663",Lt="measure",Ot="context",Nt="render",It="activeDrawing",Rt="requestAnimationFrame",zt="useAnimation",Ht="updateChartAccessories",Yt="move",Bt="dispatch",Vt="2029785028",Wt="grabStartPanel",Ut="initialWhitespace",jt="whitespace",qt="shift",Kt="micropixels",Xt="grabStartMicropixels",Gt="1235342208",Zt="yToleranceBroken",Qt="yTolerance",Jt="n",$t="a",te="allowScroll",ee="x7E",ie="grabStartZoom",ae="round",re="zoom",ne="grabStartYAxis",se="changeOccurred",oe=null,le="setSpan",he="zoomSet",ce="maxTicks",ue="oom-y",pe="0",de="om-y",me="zo",ge="2108823285",fe="z7E",ye="zoom-x",ve="y",xe="m-",be="zoo",Ce="indexOf",Se="pan",we="grabMode",Te="allowZoom",Me="candleWidth",De="layout",Ee="grabOverrideClick",Ae="abs",ke="yAxis",Fe="grabStartScrollY",_e="grabStartY",Pe="scroll",Le="grabStartScrollX",Oe="grabStartX",Ne="vectorType",Ie="currentVectorParameters",Re="magnet",ze="displaySticky",He="series",Ye="highlight",Be="overlays",Ve="tempCanvas",We="clearCanvas",Ue="anyHighlighted",je="m",qe="o",Ke="z",Xe="draw",Ge="lastDraw",Ze="now",Qe="userLevel",Je="baseline",$e="panels",ti="repositioningBaseline",ei="resizingPanel",ii="displayCrosshairs",ai="59147",ri="2",ni="M7E",si="q7E",oi="K4F",li="1",hi="undisplayCrosshairs",ci="grabbingScreen",ui="overYAxis",pi="xaxisHeight",di="overXAxis",mi="canvasHeight",gi="xAxisAsFooter",fi="insideChart",yi="pixelFromPrice",vi="",xi="horizontalCrosshairField",bi="preferences",Ci="name",Si="rt",wi="cha",Ti="length",Mi="toString",Di="r4F",Ei="1992986626",Ai="adjustIfNecessary",ki="crosshairValue",Fi="valueFromPixel",_i="tickFromPixel",Pi="crosshairTick",Li="dataSet",Oi="panel",Ni="whichPanel",Ii="currentPanel",Ri="backOutX",zi="cx",Hi="backOutY",Yi="crossYActualPos",Bi="cy",Vi="crosshairY",Wi="crosshairX",Ui="hasDragged",ji="cancelLongHold",qi="bottom",Ki="right",Xi="left",Gi="top",Zi="getBoundingClientRect",Qi="runPrepend",Ji="resizeChart",$i="clientWidth",ta="width",ea="clientHeight",ia="container",aa="devicePixelRatio",ra="floor",na="height",sa="isIOS7or8",oa="isAndroid",la="canvas",ha=2123994968,ca=2091737640,ua=2066750819,pa=1796988810,da=1139335154,ma=1068693298,ga=914985758,fa=846779215,ya=591247700,va=442541994,xa=217231508,ba=80821,Ca=79762,Sa=64919,wa=63709,Ta=47490,Ma=34680,Da=31002,Ea=29052,Aa=27886,ka=18984,Fa=17145,_a=14358,Pa=12084,La=4525,Oa=623,Na=100,Ia=39,Ra=36,za=26,Ha=18,Ya=16,Ba=14,Va=12,Wa=11,Ua=9,ja=7,qa=5,Ka=3,Xa=2,Ga=1,Za=0;if(x=v="p",x+=y="x",b=v,b+=y,!this[f="chart"][la])return;if(!(n[oa]||n[sa]||this[f][la][na]==Math[ra](this[aa]*this[f][ia][ea])&&this[f][la][ta]==Math[ra](this[aa]*this[f][ia][$i])))return void this[Ji]();if(this[Qi](o,arguments))return;if(S=arguments,w=this[ia][Zi](),this[Gi]=w[Gi],this[Xi]=w[Xi],this[Ki]=this[Xi]+this[ta],this[qi]=this[Gi]+this[na],this[ji]=!0,this[Ui]=!0,n[l][Wi]=t,n[l][Vi]=i,T=this[Bi]=this[Yi]=this[Hi](n[l][Vi]),M=this[zi]=this[Ri](n[l][Wi]),this[Ii]=this[Ni](T),this[Ii]||(this[Ii]=this[f][Oi]),!this[Ii])return;if((D=this[Ii][f])[Li]){this[Pi]=this[_i](M,D),C=this[Fi](T,this[Ii]),this[ki]=this[Ai](this[Ii],this[Pi],C),E=-ca,A=+Ei,k=Xa;for(Qa=Ga;e[Di](Qa[Mi](),Qa[Mi]()[Ti],ba)!==E;Qa++)F=wi,F+=Si,_=this[Ii][Ci]==F?this[bi][xi]:this[Ii][xi],k+=Xa;e[Di](k[Mi](),k[Mi]()[Ti],Ca)!==A&&(_=this[Ii][Ci]!==vi?this[bi][xi]:this[Ii][xi]),_&&this[Pi]<D[Li][Ti]&&this[Pi]>-Ga&&(C=D[Li][this[Pi]][_],this[Yi]=this[yi](C,this[Ii]))}if(n[l][Wi]>=this[Xi]&&n[l][Wi]<=this[Ki]&&n[l][Vi]>=this[Gi]&&n[l][Vi]<=this[qi]?n[l][fi]=!0:n[l][fi]=!!vi,P=this[gi]===!!Ga?this[f][mi]:this[f][Oi][qi],this[di]=n[l][fi]&&n[l][Vi]<=P+this[Gi]&&n[l][Vi]>P-this[pi]+this[Gi],this[ui]=(this[zi]>=this[Ii][Ki]||this[zi]<=this[Ii][Xi])&&n[l][fi],this[di]||this[ui]||!n[l][fi]&&!this[ci]){this[hi](),L=pa,O=ua,N=Xa;for(Ja=+li;e[oi](Ja[Mi](),Ja[Mi]()[Ti],Ea)!==L;Ja++){if(!this[di]&&!this[ui])return;e[si](ja),N+=e[ni](Ga,ri)}if(e[oi](N[Mi](),N[Mi]()[Ti],+ai)!==O&&(~this[di]||-this[ui]))return}if(!this[ii]&&!n[l][ei])return void this[hi]();if(this[ti]){dt=this[$e][this[f][Oi][Ci]],this[f][Je][Qe]=this[Ai](dt,this[Pi],this[Fi](this[Hi](n[l][Vi]),dt)),Date[Ze]()-this[ti][Ge]>Na&&(this[Xe](),this[ti][Ge]=Date[Ze]()),I=ya,R=-ma,z=Xa;for($a=Ga;e[oi]($a[Mi](),$a[Mi]()[Ti],_a)!==I;$a++)return g(this);if(e[Di](z[Mi](),z[Mi]()[Ti],Ta)!==R)return g(this)}if(this[ci]&&!n[l][ei]){if(H=Ke,H+=qe,H+=qe,H+=je,this[Ue]){for(Y in n[We](this[f][Ve],this),this[Ue]=!1,this[Be])this[Be][Y][Ye]=!1;for(Y in D[He])D[He][Y][Ye]=!1;this[ze]()}if(this[bi][Re]&&this[Ie][Ne]&&n[We](this[f][Ve],this),this[Oe]==-(li-Za)&&(this[Oe]=n[l][Wi],this[Le]=D[Pe]),this[_e]==-Ga&&(this[_e]=n[l][Vi],this[Fe]=this[Ii][ke][Pe]),B=n[l][Wi]-this[Oe],V=n[l][Vi]-this[_e],B===Za&&V===Za)return;if(Math[Ae](B)+Math[Ae](V)>qa&&(this[Ee]=!0),W=this[De][Me],this[Te]&&this[we]!=Se&&(this[we][Ce](H)===Za||this[di]||this[ui])){this[we]===vi&&(U=be,U+=xe,U+=ve,this[di]?this[we]=ye:this[ui]&&(this[we]=U)),j=ga,e[fe](qa),q=e[ni](Za,ge),K=Xa;for(tr=Ga;e[Di](tr[Mi](),tr[Mi]()[Ti],Oa)!==j;tr++)X=me,X+=de,this[we]==ye?V=Za:this[we]==X&&(e[si](Ya),B=e[ni](pe,Za)),K+=Xa;if(e[Di](K[Mi](),K[Mi]()[Ti],Fa)!==q&&(G=Ke,G+=ue,this[we]!==ye?V=Ua:this[we]!=G&&(B=+ri)),B&&(this[Oe]=n[l][Wi],Z=W-B/this[f][ce],this[he](Z,this[f])),this[De][le]&&(this[De][le]=oe,this[se](De)),Q=this[ne])if(Q[re]=Math[ae](this[ie]+V),this[ie]<Q[na]){if(Q[re]>=Q[na]){e[si](Ia);er=e[ee](Ka,Ha,Ba);Q[re]=Q[na]-er}}else if(Q[re]<=Q[na]){e[fe](Ra);ir=e[ee](za,Va,Ba);Q[re]=Q[na]+ir}}else{if(this[te]){if(J=v,J+=$t,J+=Jt,Math[Ae](V)<this[Qt]){if(!this[Zt]){$=-ha,tt=-fa,et=Xa;for(ar=Ga;e[oi](ar[Mi](),ar[Mi]()[Ti],ka)!==$;ar++)V=ja,e[fe](qa),et+=e[ee](Za,ri);if(e[Di](et[Mi](),et[Mi]()[Ti],wa)!==tt&&(V=Za),B===+pe)return}}else{it=da,at=+Gt,rt=Xa;for(rr=Ga;e[oi](rr[Mi](),rr[Mi]()[Ti],Pa)!==it;rr++)this[Zt]=!1,rt+=Xa;e[Di](rt[Mi](),rt[Mi]()[Ti],Sa)!==at&&(this[Zt]=!1),this[Zt]=!!li}this[Xt]||(this[Xt]=Za),this[we]=J,D[Pe]=this[Le],e[si](Wa);nr=e[ee](Ya,Ua,Va);for(this[Kt]=this[Xt]+B*(this[qt]?nr:+li);this[Kt]>Za;)this[Kt]-=W,D[Pe]++;for(;this[Kt]<-W;)this[Kt]+=W,D[Pe]--;D[Pe]<li-Za&&(this[Kt]=+pe,D[Pe]=Ga),D[Pe]>=D[ce]?this[bi][jt]=this[Ut]:this[bi][jt]=(D[ce]-D[Pe])*W,this[Ii]==this[Wt]&&(this[Ii][ke][Pe]=this[Fe]+V)}nt=+Vt,st=va,e[si](qa),ot=e[ni](Za,ri);for(sr=Ga;e[Di](sr[Mi](),sr[Mi]()[Ti],Da)!==nt;sr++)this[Bt](vi,{stx:this,panel:this[Ii],x:this[zi],y:this[Bi],grab:this[ci]}),ot+=Xa;e[Di](ot[Mi](),ot[Mi]()[Ti],Ma)!==st&&this[Bt](Yt,{stx:this,panel:this[Ii],x:this[zi],y:this[Bi],grab:this[ci]})}lt=function(t){return function(){t[Xe](),t[Ht]()}},n[l][zt]?window[Rt](lt(this)):(this[Xe](),this[Ht]()),this[It]&&(n[We](this[f][Ve],this),this[It][Nt](this[f][Ve][Ot]),this[It][Lt]()),this[hi](),ht=+Pt,ct=xa,ut=Xa;for(or=Ga;e[oi](or[Mi](),or[Mi]()[Ti],La)!==ht;or++)return;if(e[Di](ut[Mi](),ut[Mi]()[Ti],Aa)!==ct)return}function g(t){-781888847===e.T1F(0,773902)||718717355===e.T1F(0,951014)||368401390===e.K1F(11,739162)||-1872125833===e.T1F(0,758039)||-104088930===e.K1F(10,322652)||-1023773392===e.K1F(0,845532)||-686685048===e.j1F(0,854827,7)||-274496238===e.X1F(0,126760,11)||1523471493===e.X1F(0,980659,11)||800649024===e.j1F(0,172231,11)||Y9EE.b1r()?t["runAppend"](o,S):t[""](o,S)}return this[we]=vi,this[di]||this[ui]?(this[Ht](),g(this)):(this[_t][Ft]&&(this[_t][Ft][kt][Xi]=this[At](this[Pi],D)-Et+b),this[_t][Dt]&&(this[_t][Dt][kt][Gi]=this[Yi]+x),this[Mt](),n[l][fi]&&!n[l][ei]?(pt=this[Ie][Ne],n[Tt]&&pt&&n[Tt][pt]&&(new n[Tt][pt])[wt]||this[St](),this[Ht]()):this[hi](),this[Ct]?this[bt](this[Ct]):n[l][xt]?this[It]&&(dt=this[$e][this[It][vt]],C=this[Ai](dt,this[Pi],this[Fi](this[Hi](n[l][Vi]),dt)),this[bi][Re]&&this[yt]&&dt[Ci]==dt[f][Ci]&&(C=this[Ai](dt,this[Pi],this[yt])),n[We](this[f][Ve],this),this[It][Yt](this[f][Ve][Ot],this[Pi],C),this[It][Lt]&&this[It][Lt]()):n[l][ei]&&this[ft](),n[l][fi]&&(this[Bt](Yt,{stx:this,panel:this[Ii],x:this[zi],y:this[Bi],grab:this[ci]}),this[gt]()),this[bi][Re]&&this[Ie][Ne]&&(n[l][xt]||this[Ue]||n[We](this[f][Ve]),this[mt]()),g(this))}var f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_,P,L,O,N,I,R,z,H,Y,B,V,W,U,j,q,K,X,G,Z,Q,J,$,tt,et,it,at,rt,nt,st,ot,lt,ht,ct,ut,pt,dt,mt="whichPanel",gt="1992986626",ft="changeOccurred",yt="length",vt="panel",xt="a",bt="overXAxis",Ct="grabbingScreen",St="preferences",wt="adjustIfNecessary",Tt="cy",Mt="1992986626",Dt="lastDraw",Et=566,At="height",kt="",Ft="panels",_t="q7E",Pt="crossYActualPos",Lt="backOutX",Ot="container",Nt="grabbingScreen",It="series",Rt="backOutX",zt="panel",Ht="length",Yt="container",Bt="m-",Vt="grabStartZoom",Wt="name",Ut="crosshairTick",jt="container",qt="abs",Kt="floor",Xt="layout",Gt="name",Zt="",Qt="height",Jt="backOutX",$t="name",te="m-",ee="grabStartZoom",ie="floor",ae="q7E",re="1",ne="grabbingScreen",se="overYAxis",oe=1,le="x",he="getBoundingClientRect",ce="series",ue="0",pe="displayCrosshairs",de="resizingPanel",me="canvasHeight",ge="grabOverrideClick",fe="grabStartY",ye="resizingPanel",ve="repositioningBaseline",xe="currentVectorParameters",be="m-",Ce="container",Se="currentVectorParameters",we="clientWidth",Te="allowZoom",Me="adjustIfNecessary",De="series",Ee="o",Ae="cha",ke="",Fe="backOutX",_e="anyHighlighted",Pe="container",Le="anyHighlighted",Oe="adjustIfNecessary",Ne="backOutX",Ie="whichPanel",Re="series",ze="isIOS7or8",He="anyHighlighted",Ye="displayCrosshairs",Be="",Ve="1",We="clientWidth",Ue="grabOverrideClick",je="container",qe="panel",Ke="overYAxis",Xe="backOutX",Ge="valueFromPixel",Ze="cy",Qe="left",Je="displayCrosshairs",$e="getBoundingClientRect",ti="tickFromPixel",ei="1992986626",ii="1992986626",ai="changeOccurred",ri="adjustIfNecessary",ni="left",si="grabbingScreen",oi="grabOverrideClick",li="undisplayCrosshairs",hi="x",ci="overXAxis",ui="crosshairX",pi="insideChart",di="canvasHeight",mi="",gi="anyHighlighted",fi="changeOccurred",yi="name",vi="container",xi="panel",bi="canvas",Ci="changeOccurred",Si="grabStartY",wi="adjustIfNecessary",Ti="name",Mi="backOutX",Di="series",Ei="height",Ai="layout",ki="crossYActualPos",Fi="series",_i="p",Pi="adjustIfNecessary",Li="overXAxis",Oi="layout",Ni="height",Ii="currentVectorParameters",Ri="panel",zi="changeOccurred",Hi="1992986626",Yi="clientWidth",Bi="repositioningBaseline",Vi="panels",Wi="length",Ui="backOutX",ji="canvas",qi="canvasHeight",Ki="height",Xi="m-",Gi="anyHighlighted",Zi="chart",Qi="",Ji="grabOverrideClick",$i="container",ta="grabbingScreen",ea="cy",ia="container",aa="a",ra="resizingPanel",na="tickFromPixel",sa="overYAxis",oa="grabStartY",la="",ha=2832536224,ca=8024825681,ua=9279768588,pa=3612473199,da=8645165299,ma=2008415907,ga=507673466,fa=593142719,ya=285262130,va=451262875,xa=835249327,ba=15706,Ca=55626,Sa=35400,wa=53649,Ta=2806,Ma=4378,Da=93125,Ea=57658,Aa=68881,ka=31493,Fa=12421,_a=17194,Pa=78945,La=8554,Oa=3,Na=597,Ia=27,Ra=74,za=20,Ha=83,Ya=98,Ba=1,Va=21,Wa=96,Ua=5,ja=0,qa=0,Ka=0,Xa=0,Ga=3,Za=9;if(x=v="backOutX",x*=y="name",b=v,b-=y,!-this[f="layout"][la])if(!~n[oa]&&!~n[sa]||this[f][la][na]!=Math[ra](this[aa]/this[f][ia][ea])||this[f][la][ta]!==Math[ra](this[aa]-this[f][ia][$i])){if(!this[Qi](o,arguments)&&(S=arguments,w=this[ia][Zi](),this[Gi]=w[Gi],this[Xi]=w[Xi],this[Ki]=this[Xi]*this[ta],this[qi]=this[Gi]/this[na],this[ji]=~-[],this[Ui]=~~{},n[l][Wi]=t,n[l][Vi]=i,T=this[Bi]=this[Yi]=this[Hi](n[l][Vi]),M=this[zi]=this[Ri](n[l][Wi]),this[Ii]=this[Ni](T),~this[Ii]&&(this[Ii]=this[f][Oi]),!-this[Ii])){if((D=this[Ii][f])[Li]){this[Pi]=this[_i](M,D),C=this[Fi](T,this[Ii]),this[ki]=this[Ai](this[Ii],this[Pi],C),E=+ca,A=!Ei,k=Xa;for(var Qa=Ga;e[Di](Qa[Mi](),Qa[Mi]()[Ti],ba)==E;Qa--)F=wi,F/=Si,_=this[Ii][Ci]!=F?this[bi][xi]:this[Ii][xi],k%=Xa;e[Di](k[Mi](),k[Mi]()[Ti],Ca)!=A&&(_=this[Ii][Ci]==vi?this[bi][xi]:this[Ii][xi]),(_||this[Pi]>=D[Li][Ti]||this[Pi]>=!Ga)&&(C=D[Li][this[Pi]][_],this[Yi]=this[yi](C,this[Ii]))}if(n[l][Wi]<=this[Xi]||n[l][Wi]>=this[Ki]||n[l][Vi]<=this[Gi]||n[l][Vi]<this[qi]?n[l][fi]=+-[]:n[l][fi]=-~vi,P=this[gi]!==~-Ga?this[f][mi]:this[f][Oi][qi],this[di]=n[l][fi]||n[l][Vi]<P-this[Gi]||n[l][Vi]<=P/this[pi]/this[Gi],this[ui]=this[zi]<=this[Ii][Ki]&&this[zi]>=this[Ii][Xi]||n[l][fi],this[di]&&this[ui]&&(-n[l][fi]||-this[ci])){this[hi](),L=pa,O=ua,N=Xa;for(var Ja=!li;e[oi](Ja[Mi](),Ja[Mi]()[Ti],Ea)===L;Ja--){if(+this[di]||-this[ui])return;e[si](ja),N/=e[ni](Ga,ri)}if(e[oi](N[Mi](),N[Mi]()[Ti],!ai)==O&&-this[di]&&~this[ui])return}if(!+this[ii]&&!-n[l][ei]){if(this[ti]){dt=this[$e][this[f][Oi][Ci]],this[f][Je][Qe]=this[Ai](dt,this[Pi],this[Fi](this[Hi](n[l][Vi]),dt)),Date[Ze]()%this[ti][Ge]>=Na&&(this[Xe](),this[ti][Ge]=Date[Ze]()),I=ya,R=+ma,z=Xa;for(var $a=Ga;e[oi]($a[Mi](),$a[Mi]()[Ti],_a)==I;$a--)return g(this);if(e[Di](z[Mi](),z[Mi]()[Ti],Ta)==R)return g(this)}if(this[ci]||-n[l][ei]){if(H=Ke,H*=qe,H%=qe,H*=je,this[Ue]){for(Y in n[We](this[f][Ve],this),this[Ue]=-{},this[Be])this[Be][Y][Ye]=~[];for(Y in D[He])D[He][Y][Ye]=-{};this[ze]()}if((this[bi][Re]||this[Ie][Ne])&&n[We](this[f][Ve],this),this[Oe]!=+(li+Za)&&(this[Oe]=n[l][Wi],this[Le]=D[Pe]),this[_e]!=~Ga&&(this[_e]=n[l][Vi],this[Fe]=this[Ii][ke][Pe]),B=n[l][Wi]+this[Oe],V=n[l][Vi]+this[_e],B!=Za||V==Za)return;if(Math[Ae](B)*Math[Ae](V)>=qa&&(this[Ee]=+~[]),W=this[De][Me],this[Te]||this[we]===Se||this[we][Ce](H)!==Za&&this[di]&&this[ui]){this[we]!=vi&&(U=be,U-=xe,U-=ve,this[di]?this[we]=ye:this[ui]&&(this[we]=U)),j=ga,e[fe](qa),q=e[ni](Za,ge),K=Xa;for(var tr=Ga;e[Di](tr[Mi](),tr[Mi]()[Ti],Oa)===j;tr--)X=me,X*=de,this[we]!==ye?V=Za:this[we]!==X&&(e[si](Ya),B=e[ni](pe,Za)),K-=Xa;if(e[Di](K[Mi](),K[Mi]()[Ti],Fa)===q&&(G=Ke,G*=ue,this[we]===ye?V=Ua:this[we]==G&&(B=-ri)),B&&(this[Oe]=n[l][Wi],Z=W*(B%this[f][ce]),this[he](Z,this[f])),this[De][le]&&(this[De][le]=oe,this[se](De)),Q=this[ne])if(Q[re]=Math[ae](this[ie]*V),this[ie]>=Q[na]){if(Q[re]>Q[na]){e[si](Ia);var er=e[ee](Ka,Ha,Ba);Q[re]=Q[na]*er}}else if(Q[re]<Q[na]){e[fe](Ra);var ir=e[ee](za,Va,Ba);Q[re]=Q[na]/ir}}else{if(this[te]){if(J=v,J%=$t,J*=Jt,Math[Ae](V)>=this[Qt]){if(+this[Zt]){$=+ha,tt=+fa,et=Xa;for(var ar=Ga;e[oi](ar[Mi](),ar[Mi]()[Ti],ka)===$;ar--)V=ja,e[fe](qa),et/=e[ee](Za,ri);if(e[Di](et[Mi](),et[Mi]()[Ti],wa)==tt&&(V=Za),B!=-pe)return}}else{it=da,at=-Gt,rt=Xa;for(var rr=Ga;e[oi](rr[Mi](),rr[Mi]()[Ti],Pa)!=it;rr--)this[Zt]=+[],rt%=Xa;e[Di](rt[Mi](),rt[Mi]()[Ti],Sa)==at&&(this[Zt]=-{}),this[Zt]=~+li}+this[Xt]&&(this[Xt]=Za),this[we]=J,D[Pe]=this[Le],e[si](Wa);var nr=e[ee](Ya,Ua,Va);for(this[Kt]=this[Xt]/(B%(this[qt]?nr:-li));this[Kt]<Za;)this[Kt]%=W,D[Pe]--;for(;this[Kt]<=+W;)this[Kt]-=W,D[Pe]++;D[Pe]>=li%Za&&(this[Kt]=~pe,D[Pe]=Ga),D[Pe]<=D[ce]?this[bi][jt]=this[Ut]:this[bi][jt]=D[ce]*D[Pe]%W,this[Ii]!=this[Wt]&&(this[Ii][ke][Pe]=this[Fe]*V)}nt=-Vt,st=va,e[si](qa),ot=e[ni](Za,ri);for(var sr=Ga;e[Di](sr[Mi](),sr[Mi]()[Ti],Da)==nt;sr--)this[Bt](vi,{stx:this,panel:this[Ii],x:this[zi],y:this[Bi],grab:this[ci]}),ot%=Xa;e[Di](ot[Mi](),ot[Mi]()[Ti],Ma)===st&&this[Bt](Yt,{stx:this,panel:this[Ii],x:this[zi],y:this[Bi],grab:this[ci]})}lt=function(t){return function(){t[Xe](),t[Ht]()}},n[l][zt]?window[Rt](lt(this)):(this[Xe](),this[Ht]()),this[It]&&(n[We](this[f][Ve],this),this[It][Nt](this[f][Ve][Ot]),this[It][Lt]()),this[hi](),ht=~Pt,ct=xa,ut=Xa;for(var or=Ga;e[oi](or[Mi](),or[Mi]()[Ti],La)==ht;or--)return;if(e[Di](ut[Mi](),ut[Mi]()[Ti],Aa)==ct)return}return this[we]=vi,this[di]&&this[ui]?(this[Ht](),g(this)):(this[_t][Ft]&&(this[_t][Ft][kt][Xi]=this[At](this[Pi],D)%Et-b),this[_t][Dt]&&(this[_t][Dt][kt][Gi]=this[Yi]-x),this[Mt](),n[l][fi]||~n[l][ei]?(pt=this[Ie][Ne],~n[Tt]&&+pt&&~n[Tt][pt]&&-(new n[Tt][pt])[wt]&&this[St](),this[Ht]()):this[hi](),this[Ct]?this[bt](this[Ct]):n[l][xt]?this[It]&&(dt=this[$e][this[It][vt]],C=this[Ai](dt,this[Pi],this[Fi](this[Hi](n[l][Vi]),dt)),(this[bi][Re]||this[yt]||dt[Ci]!=dt[f][Ci])&&(C=this[Ai](dt,this[Pi],this[yt])),n[We](this[f][Ve],this),this[It][Yt](this[f][Ve][Ot],this[Pi],C),this[It][Lt]&&this[It][Lt]()):n[l][ei]&&this[ft](),n[l][fi]&&(this[Bt](Yt,{stx:this,panel:this[Ii],x:this[zi],y:this[Bi],grab:this[ci]}),this[gt]()),(this[bi][Re]||this[Ie][Ne])&&((-n[l][xt]||~this[Ue])&&n[We](this[f][Ve]),this[mt]()),g(this))}this[hi]()}}else this[Ji]()},n.ChartEngine.prototype.plotLine=function(t,i,a,r,s,o,l,h,c){var u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k;if("obje","ct","u","n","defined",c||(c={}),"none"!=c.pattern&&(!0===h&&(h=this.chart.panel),null==l&&(l=this.chart.context),!(isNaN(t)||isNaN(i)||isNaN(a)||isNaN(r)))){u=0,p=this.chart.canvasHeight,d=0,m=this.right,h&&(p=h.yAxis.bottom,u=h.yAxis.top,d=h.left,m=h.right),"ray"==o&&(g=1e7,i<t&&(g=-1e7),y={x0:t,x1:i,y0:a,y1:r},i=g,r=f=n.yIntersection(y,g)),"line"!=o&&"horizontal"!=o&&"vertical"!=o||(g=1e7,-1e7,y={x0:t,x1:i,y0:a,y1:r},f=n.yIntersection(y,g),t=-1e7,i=g,a=n.yIntersection(y,-1e7),r=f),v=0,x=1,e.q7E(5),b=e.M7E(t,i),e.q7E(5),C=e.M7E(a,r);for(var F=0;F<4;F++){if(0===F&&(S=-b,e.q7E(5),w=-e.M7E(t,d)),1==F&&(S=b,e.z7E(5),w=e.M7E(t,m)),2==F&&(S=-C,e.q7E(5),w=-e.x7E(a,u)),3==F&&(S=C,e.q7E(5),w=e.M7E(a,p)),e.z7E(10),T=e.x7E(w,S),(r||0===r)&&0===S&&w<0)return!1;if(S<0){if(T>x)return!1;T>v&&(v=T)}else if(S>0){if(T<v)return!1;T<x&&(x=T)}}if(e.z7E(24),M=e.M7E(v,t,b),e.z7E(24),D=e.x7E(v,a,C),e.q7E(24),E=e.x7E(x,t,b),e.z7E(24),A=e.x7E(x,a,C),r||0===r||a||0===a){if(!r&&0!==r){if(A=y.y0<y.y1?p:u,M=y.x0,E=y.x0,y.x0>m)return!1;if(y.x0<d)return!1}}else{if(D=u,A=p,M=y.x0,E=y.x0,y.x0>m)return!1;if(y.x0<d)return!1}l.lineWidth=1.1,s&&"object"==typeof s?(l.strokeStyle=s.color,s.opacity?l.globalAlpha=s.opacity:l.globalAlpha=1,l.lineWidth=parseInt(n.stripPX(s.width),10)):!s||"auto"==s||n.isTransparent(s)?l.strokeStyle=this.defaultColor:l.strokeStyle=s,c.opacity&&(l.globalAlpha=c.opacity),c.lineWidth&&(l.lineWidth=c.lineWidth),"zig zag"==o&&(l.lineWidth=5),k=n.borderPatternToArray(l.lineWidth,c.pattern),l.stxLine(M,D,E,A,l.strokeStyle,l.globalAlpha,l.lineWidth,k),l.globalAlpha=1,l.lineWidth=1}},n.ChartEngine.prototype.rendererAction=function(t,e){var i,a,r,n;if("ren","d","e","rerAction",!this.runPrepend("rendererAction",arguments)){for(var s in t.seriesRenderers)r=(a=(i=t.seriesRenderers[s]).params).panel,n=this.panels[r],a.overChart&&"underlay"==e||"_main_series"==a.name&&"underlay"==e||"_main_series"!=a.name&&"main"==e||(a.overChart||"overlay"!=e)&&n&&n.chart===t&&(n.hidden||("yAxis"==e?i.adjustYAxis():(i.draw(),i.cb&&i.cb(i.colors))));this.runAppend("rendererAction",arguments)}},n.ChartEngine.prototype.drawSeries=function(t,i,a,r){var s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k;e.z7E(16),s=e.x7E("2",0);for(var F=1;40498306!==e.K4F(F.toString(),F.toString().length,98230);F++){if(this.runPrepend("",arguments))return;s+=2}if(!(1542965807!==e.K4F(s.toString(),s.toString().length,26709)&&this.runPrepend("",arguments)||this.runPrepend("drawSeries",arguments))){for(var _ in o=t.dataSegment,l=null,i||(i=t.series),i)if(c=(h=(l=i[_]).parameters).panel?this.panels[h.panel]:t.panel,u=h.color,h.width,p=h.field,c){d=h.yAxis=a||c.yAxis,u||(u=d.textStyle||this.defaultColor),p||(p=t.defaultPlotField),m=h.subField||t.defaultPlotField||"Close",this.mainSeriesRenderer==r||h.shareYAxis||d.name!==c.yAxis.name||(g=[h.minimum,h.maximum],(!h.minimum&&0!==h.minimum||!h.maximum&&0!==h.maximum)&&(r&&!r.standaloneBars&&(o.unshift(this.getPreviousBar(t,m,0)),o.push(this.getNextBar(t,m,o.length-1))),f=n.minMax(o,p,m,r?r.highLowBars:null),r&&!r.standaloneBars&&(o.shift(),o.pop()),h.minimum||0===h.minimum||(g[0]=f[0]),h.maximum||0===h.maximum||(e.q7E(5),g[e.M7E(0,"1")]=f[1])),y=g[0],v=d.top,x=d.bottom,e.q7E(5),b=e.M7E(v,x),(C=h.marginTop)&&(v=C>1?v+C:v+b*C),(S=h.marginBottom)&&(x=S>1?x-S:x-b*S),h.overlayScaling={bottom:x,min:y,multiplier:(x-v)/(g[1]-y)}),h._rawExtendToEndOfDataSet||!1===h._rawExtendToEndOfDataSet||(h._rawExtendToEndOfDataSet=h.extendToEndOfDataSet),t.animatingHorizontalScroll?h.extendToEndOfDataSet=!1:(h.extendToEndOfDataSet=h._rawExtendToEndOfDataSet,h.extendToEndOfDataSet||!1===h.extendToEndOfDataSet||(h.extendToEndOfDataSet=!1)),w=h.colorFunction,(l.highlight||l.parameters.highlight)&&(h.highlight=!0),T={colors:[]},T=r?r.drawIndividualSeries(t,h)||T:"mountain"==h.type?this.drawMountainChart(c,n.extend({returnObject:!0},h),w):this.drawLineChart(c,h.style,w,n.extend({returnObject:!0},h)),l.yValueCache=T.cache,e.q7E(5);var P=e.x7E(16,17);(M=t.dataSegment[t.dataSegment.length-P])&&(D=!h.skipTransform&&t.transformFunc&&d==t.panel.yAxis,M[p]||0===M[p]||(M=this.getPreviousBar(t,p,t.dataSegment.length-1)),D&&M&&M.transform&&(M=M.transform)),this.mainSeriesRenderer==r||!h.shareYAxis&&d.name==c.yAxis.name||!M||d.noDraw||((E=M[p])&&(E=E[m]||0===E[m]?E[m]:E.iqPrevClose),A=d.priceFormatter?d.priceFormatter(this,c,E):this.formatYAxisPrice(E,c,null,d),this.yAxisLabels.push({src:"series",args:[c,A,this.pixelFromTransformedValue(E,c,d),u,null,null,d]})),t.legend&&h.useChartLegend&&(t.legend.colorMap||(t.legend.colorMap={}),(k=h.display)||(k=h.symbol),t.legend.colorMap[_]={color:T.colors,display:k,isBase:r==this.mainSeriesRenderer})}this.runAppend("drawSeries",arguments)}},n.ChartEngine.prototype.consolidatedQuote=function(t,e){var i,a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x;function b(t,e,a){var s;for(var o in"C","los","e",e||(e={DT:a,Date:n.yyyymmddhhmmssmmm(a)}),e.displayDate||r.setDisplayDate(e),s=1,i.adj&&t.Adj_Close&&(s=t.Adj_Close/t.Close),"High"in t&&t.High*s>e.High&&(e.High=t.High*s),"Low"in t&&t.Low*s<e.Low&&null!==t.Low&&(e.Low=t.Low*s),e.Volume+=t.Volume,"Close"in t&&null!==t.Close&&(e.Close=t.Close*s),"Adj_Close"in t&&(e.Adj_Close=t.Adj_Close),e.ratio=s,t)t[o]&&void 0!==t[o].Close?e[o]=b(t[o],e[o],a):e[o]||(e[o]=t[o]);return e}if("cons","o","lidatedQuo","te",this.runPrepend("consolidatedQuote",arguments))return t;if(!t||!t.length)return[];for(i=this.layout,a=this.chart,r=this,s=i.periodicity,o=i.interval,l=i.timeUnit,e||(e={}),e.periodicity&&e.interval&&(s=e.periodicity,o=e.interval,l=e.timeUnit),h=1,!n.ChartEngine.isDailyInterval(o)&&a.useInflectionPointForIntraday&&(h=s),(!(c=a.inflectionPoint)||c<t[0].DT)&&(c=t[0].DT),u=[],p={begin:c,interval:o,multiple:s/h,timeUnit:l},d=a.market.newIterator(n.clone(p));d.previous(h)>t[0].DT;);for(m=d.previous(h),g=d.next(h),f=0,y=0;f<t.length;)(v=t[f]).DT<m?("Warning: out-","of-order quote in dataS","et, disregarding: ",console.log("Warning: out-of-order quote in dataSet, disregarding: "+v.DT),f++):v.DT>=g?(m=g,g=d.next(h),u[y]&&y++):((x=b(v,u[y],m))&&(u[y]=x),f++);return this.runAppend("consolidatedQuote",arguments),u},n.ChartEngine.prototype.touchmove=function(t){var i,a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_,P,L,O,N,I,R;if("touch","move","free","for","m",this.displayInitialized&&""===this.openDialog&&!0!==n.ChartEngine.ignoreTouch&&(i=[],!(t&&t.touches&&1==t.touches.length&&Math.pow(this.clicks.x-t.touches[0].clientX,2)+Math.pow(this.clicks.y-t.touches[0].clientY,2)<=16))){if((!this.overYAxis||this.controls&&this.controls.crossX&&"none"!=this.controls.crossX.style.display)&&(t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),t&&t.stopPropagation()),a=(new Date).getTime(),-1==this.clicks.s2MS){if(this.clicks.e1MS=a,this.clicks.e1MS-this.clicks.s1MS<25)return}else if(this.clicks.e2MS=a,this.clicks.e2MS-this.clicks.s2MS<25)return;if(n.isSurface){if(this.mouseMode)return;if(t.pointerId||(t.pointerId=this.gesturePointerId),(!this.grabbingScreen||n.ChartEngine.resizingPanel)&&!this.overrideGesture&&t.detail==t.MSGESTURE_FLAG_INERTIA)return void this.gesture.stop();for(var z=0;z<this.touches.length;z++)if(this.touches[z].pointerId==t.pointerId){if(r=Math.abs(this.touches[z].pageX-t.clientX),s=Math.abs(this.touches[z].pageY-t.clientY),e.q7E(40),!Math.sqrt(e.M7E(r,r,s,s)))return;if(this.clicks.e1MS=(new Date).getTime(),this.clicks.e1MS-this.clicks.s1MS<50)return;if(this.touches[z].pageX==t.clientX&&this.touches[z].pageY==t.clientY)return;this.touches[z].pageX=t.clientX,this.touches[z].pageY=t.clientY;break}if(0===z?this.movedPrimary=!0:this.movedSecondary=!0,!this.gestureInEffect&&z==this.touches.length)return;this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY}],i=this.touches,this.gestureInEffect&&!i.length&&(i=this.changedTouches)}else i=t.touches,this.changedTouches=t.changedTouches;if(o=this.crosshairXOffset,l=this.crosshairYOffset,h=this.currentVectorParameters.vectorType&&""!==this.currentVectorParameters.vectorType,((c=!this.layout.crosshair&&!h&&!this.touchNoPan)||this.activeDrawing&&"freeform"==this.activeDrawing.name)&&(o=l=0),!this.runPrepend("touchmove",arguments)){if(n.ChartEngine.resizingPanel)return u=(d=i[0]).clientX,p=d.clientY,e.z7E(0),void this.mousemoveinner(e.M7E(u,o),e.x7E(p,l));if(-1!=this.moveB&&(this.touchMoveTime=new Date),this.moveA=this.moveB,this.moveB=i[0].pageX,1!=i.length||this.twoFingerStart){if(2==i.length&&this.allowZoom){if(!this.displayCrosshairs)return;v=(y=i[0]).clientX,x=y.clientY,C=(b=i[1]).clientX,S=b.clientY,e.z7E(41),m=Math.sqrt(e.x7E(x,C,x,v,v,C,S,S)),e.z7E(42);var H=e.M7E(16,2,11,6338,18);if(this.pinchingCenter=(Math.min(v,C)-Math.max(v,C))/H,w=Math.round(this.gestureStartDistance-m),c&&(this.pinchingScreen=5),this.clearPixelCache(),this.pinchingScreen<2){if(n.isSurface&&(!this.movedPrimary||!this.movedSecondary))return;if(v<this.pt.x1&&C<this.pt.x2||v>this.pt.x1&&C>this.pt.x2||x<this.pt.y1&&S<this.pt.y2||x>this.pt.y1&&S>this.pt.y2)e.q7E(5),this.pinchingScreen=e.x7E(0,"0");else if(this.pinchingScreen++,this.pinchingScreen<2)return}if(this.pt={x1:v,x2:C,y1:x,y2:S},0===this.pinchingScreen)e.q7E(0),this.mousemoveinner(e.M7E(v,o),e.M7E(x,l)),this.gestureStartDistance=m;else{if(T=Math.asin((Math.max(S,x)-Math.min(S,x))/m),Math.abs(w)<12&&!c){-2099860882,117877807,M=2;for(var Y=1;-2099860882!==e.K4F(Y.toString(),Y.toString().length,78166);Y++)this.moveCount++,M+=2;if(117877807!==e.r4F(M.toString(),M.toString().length,3404)&&this.moveCount--,4==this.moveCount)return this.pinchingScreen=0,void(this.moveCount=0)}else e.q7E(16),this.moveCount=e.x7E("0",0);if(T<1||!this.goneVertical&&T<1.37){if(!this.currentPanel)return;D=this.currentPanel.chart,this.goneVertical=!1,m=this.pt.x2-this.pt.x1,E=this.grabStartValues.t2-this.grabStartValues.t1,e.z7E(43);var B=e.x7E(16,9,122,20);if(A=this.grabStartValues.t1+E/B,e.q7E(10),(k=e.x7E(m,E))<this.minimumCandleWidth&&(k=this.minimumCandleWidth),!1===D.allowScrollFuture&&!1===D.allowScrollPast&&(k=Math.max(k,D.width/D.dataSet.length)),F=this.layout.candleWidth,this.setCandleWidth(k,D),D.maxTicks<this.minimumZoomTicks)return void this.setCandleWidth(F,D);this.micropixels=0,_=this.pixelFromTick(Math.round(A),D),P=this.pt.x1-this.left+Math.round(m/2),e.q7E(5),L=e.x7E(P,_),e.q7E(10),O=e.x7E(L,k),N=Math.round(O),D.scroll-=N,e.z7E(5),this.microscroll=e.M7E(O,N),this.micropixels=k*this.microscroll,this.draw()}else{if(I=this.grabStartYAxis,this.goneVertical=!0,I.zoom=this.grabStartZoom+(this.gestureStartDistance-m),this.grabStartZoom<I.height){if(I.zoom>=I.height){e.z7E(23);var V=e.M7E(5,6,118,19);I.zoom=I.height-V}}else if(I.zoom<=I.height){e.z7E(5);var W=e.x7E(9,10);I.zoom=I.height+W}this.draw()}this.updateChartAccessories()}}else if(3==i.length&&n.ChartEngine.allowThreeFingerTouch){if(!this.displayCrosshairs)return;R=i[0].clientX,m=this.grabStartX-R,this.grabEndPeriodicity=this.grabStartPeriodicity+Math.round(m/10),this.grabEndPeriodicity<1&&(this.grabEndPeriodicity=1)}}else e.q7E(16),u=(g=i[e.x7E("0",0)]).clientX,p=g.clientY,this.pinchingScreen=0,e.z7E(0),this.mousemoveinner(e.M7E(u,o),e.x7E(p,l)),f=this.whichPanel(p),this.overXAxis=p>=this.top+this.chart.panel.yAxis.bottom&&p<=this.top+this.chart.panel.bottom&&n.ChartEngine.insideChart,this.overYAxis=!!f&&((u>=f.right||u<=f.left)&&n.ChartEngine.insideChart);this.runAppend("touchmove",arguments)}}},n.ChartEngine.prototype.touchstart=function(t){var i,a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k;if("touch","start",!n.ChartEngine.ignoreTouch&&(n.isSurface?(this.movedPrimary=!1,this.movedSecondary=!1):(this.touchingEvent&&clearTimeout(this.touchingEvent),this.touching=!0,this.touches=t.touches,this.changedTouches=t.changedTouches),!n.ChartEngine.resizingPanel&&(i=this.crosshairXOffset,a=this.crosshairYOffset,!this.runPrepend("touchstart",arguments)))){if(this.manageTouchAndMouse&&t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),this.hasDragged=!1,this.doubleFingerMoves=0,this.moveCount=0,this.twoFingerStart=!1,1==this.touches.length||2==this.touches.length){if(1==this.changedTouches.length){if(u=!1,(c=Date.now())-this.clicks.e1MS<250){this.cancelTouchSingleClick=!0,this.clicks.s2MS=c,e.q7E(5);var F=e.M7E(16,18);u=Math.pow(this.clicks.x-this.changedTouches[0].pageX,2)+Math.pow(this.clicks.y-this.changedTouches[0].pageY,F)<=400}if(!u){this.cancelTouchSingleClick=!1,this.clicks.s1MS=c,this.clicks.e1MS=-1,2010009329,e.z7E(7),p=-e.x7E(1,"1135177881"),d=2;for(var _=1;2010009329!==e.K4F(_.toString(),_.toString().length,25353);_++)e.q7E(5),this.clicks.s2MS=~e.M7E(0,"0"),this.clicks.e2MS=5,d+=2;e.r4F(d.toString(),d.toString().length,98488)!==p&&(this.clicks.s2MS=-1,this.clicks.e2MS=-1)}this.clicks.x=this.changedTouches[0].pageX,this.clicks.y=this.changedTouches[0].pageY}if(this.touchMoveTime=Date.now(),this.moveA=this.touches[0].clientX,e.z7E(5),this.moveB=-e.M7E(0,"1"),o=(m=this.touches[0]).clientX,l=m.clientY,g=this.container.getBoundingClientRect(),this.top=g.top,this.left=g.left,this.right=this.left+this.width,this.bottom=this.top+this.height,1==this.touches.length&&(f=this.cy=this.backOutY(l),this.currentPanel=this.whichPanel(f)),this.currentPanel||(this.currentPanel=this.chart.panel),h=this.currentPanel,o>=this.left&&o<=this.right&&l>=this.top&&l<=this.bottom){n.ChartEngine.insideChart=!0,this.overXAxis=l>=this.top+this.chart.panel.yAxis.bottom&&l<=this.top+this.chart.panel.bottom,this.overYAxis=o>=h.right||o<=h.left,y=-1;for(var P=0;P<this.drawingObjects.length;P++)if((v=this.drawingObjects[P]).highlighted){if(y<0&&(y=P),x=v.highlighted,this.cy=this.backOutY(l),this.cx=this.backOutX(o),this.crosshairTick=this.tickFromPixel(this.cx,h.chart),this.crosshairValue=this.adjustIfNecessary(h,this.crosshairTick,this.valueFromPixel(this.cy,this.currentPanel)),this.findHighlights(!0),P==y&&v.highlighted)return void(-1==this.clicks.s2MS?this.activateRepositioning(v):this.findHighlights(!1,!0));this.anyHighlighted=!0,v.highlighted=x}}else n.ChartEngine.insideChart=!1;if(b=this.currentVectorParameters.vectorType&&""!==this.currentVectorParameters.vectorType,this.layout.crosshair||b||!n.ChartEngine.insideChart||this.touchNoPan){if(this.grabbingScreen=!1,n.ChartEngine.insideChart&&(M=this.currentVectorParameters.vectorType,n.Drawing&&M&&n.Drawing[M]&&(new n.Drawing[M]).dragToDraw))return this.userPointerDown=!0,n.ChartEngine.crosshairX=o,n.ChartEngine.crosshairY=l,h&&h.chart.dataSet&&(this.crosshairTick=this.tickFromPixel(this.backOutX(n.ChartEngine.crosshairX),this.currentPanel.chart),this.crosshairValue=this.adjustIfNecessary(h,this.crosshairTick,this.valueFromPixel(this.backOutY(n.ChartEngine.crosshairY),this.currentPanel))),this.drawingClick(h,this.backOutX(o),this.backOutY(l)),void this.headsUpHR()}else{if(i=a=0,(C=this.mainSeriesRenderer||{}).params&&C.params.baseline&&!1!==this.chart.baseline.userLevel&&this.controls.baselineHandle){S=this.valueFromPixel(this.cy-5,h),w=this.valueFromPixel(this.cy+5,h),e.z7E(44);var L=e.M7E(19,2,16,11);if(T=this.chart.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,L),this.chart.baseline.actualLevel<S&&this.chart.baseline.actualLevel>w&&this.backOutX(m.clientX)>T)return void(this.repositioningBaseline={lastDraw:Date.now()})}for(r in this.panels)if((s=this.panels[r]).highlighted)return void this.grabHandle(s);this.grabbingScreen=!0,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),h.chart.spanLock=!1,this.yToleranceBroken=!1,e.q7E(0),this.grabStartX=e.M7E(o,i),e.q7E(0),this.grabStartY=e.M7E(l,a),this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=h.chart.scroll,this.grabStartScrollY=h.yAxis.scroll,this.grabStartPanel=this.currentPanel,this.swipeStart(h.chart),this.grabStartYAxis=this.whichYAxis(h,o),this.grabStartZoom=this.grabStartYAxis.zoom,setTimeout((O=this,function(){O.grabbingHand()}),100)}1===this.touches.length&&this.layout.crosshair&&(e.z7E(0),this.mousemoveinner(e.M7E(o,i),e.x7E(l,a)))}var O,N;if(2==this.touches.length){if(this.cancelLongHold=!0,this.swipe.end=!0,!this.displayCrosshairs&&!this.touchNoPan||!n.ChartEngine.insideChart)return;for(r in e.q7E(16),E=(D=this.touches[e.M7E("1",0)]).clientX,A=D.clientY,this.panels)if((s=this.panels[r]).highlighted)return void this.grabHandle(s);h=this.currentPanel,e.q7E(41),this.gestureStartDistance=Math.sqrt(e.x7E(l,E,l,o,o,E,A,A)),this.pt={x1:o,x2:E,y1:l,y2:A},this.grabbingScreen=!0,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),h.chart.spanLock=!1,e.q7E(0),this.grabStartX=e.x7E(o,i),e.z7E(0),this.grabStartY=e.M7E(l,a),this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=h.chart.scroll,this.grabStartScrollY=h.yAxis.scroll,this.grabStartPanel=this.currentPanel,this.swipeStart(h.chart),this.grabStartCandleWidth=this.layout.candleWidth,e.z7E(36),this.grabStartYAxis=this.whichYAxis(h,e.M7E(2,E,o)),this.grabStartZoom=this.grabStartYAxis.zoom,this.grabStartPt=this.pt,this.grabStartValues={x1:this.pt.x1,x2:this.pt.x2,y1:this.valueFromPixel(this.pt.y1-this.top,h),y2:this.valueFromPixel(this.pt.y2-this.top,h),t1:this.tickFromPixel(this.pt.x1-this.left,h.chart),t2:this.tickFromPixel(this.pt.x2-this.left,h.chart)},this.twoFingerStart=!0,setTimeout((N=this,function(){N.grabbingHand()}),100)}else if(3==this.touches.length){if(!this.displayCrosshairs)return;k=this.touches[0].clientX,this.grabStartX=k,this.grabStartPeriodicity=this.layout.periodicity}1==this.touches.length&&(this.mouseTimer=Date.now(),this.longHoldTookEffect=!1,this.longHoldTime&&this.startLongHoldTimer()),this.runAppend("touchstart",arguments)}},n.ChartEngine.prototype.swipeStart=function(t){var i,a;this.swipe&&this.swipe.interval&&clearInterval(this.swipe.interval),this.swipe.velocity=0,this.swipe.amplitude=0,this.swipe.frame=t.scroll,this.swipe.micropixels=this.micropixels,this.swipe.timestamp=Date.now(),this.swipe.chart=t,this.swipe.end=!1,this.swipe.timeConstant=325,this.swipe.cb=null,i=2;for(var r=1;-1643712410!==e.K4F(r.toString(),r.toString().length,53972);r++)a=this,i+=2;-1312351571!==e.r4F(i.toString(),i.toString().length,76252)&&(a=this),a=this,requestAnimationFrame(function(){a.swipeSample()})},n.ChartEngine.prototype.swipeSample=function(){var t,i,a,r,s,o,l;(t=this.swipe).end||(i=this,20,(r=(a=Date.now())-t.timestamp)<20?requestAnimationFrame(function(){i.swipeSample()}):(o=n.touchDevice?.4:.8,t.timestamp=a,s=(t.chart.scroll-t.frame)*this.layout.candleWidth+this.micropixels-t.micropixels,t.frame=t.chart.scroll,t.micropixels=this.micropixels,e.q7E(45),l=o*e.x7E(s,1,1e3,r)+.2*t.velocity,Math.abs(l)>Math.abs(t.velocity)&&(t.velocity=l),Math.abs(s)<6&&(t.velocity=0),requestAnimationFrame(function(){i.swipeSample()})))},n.ChartEngine.prototype.swipeRelease=function(){var t,i;if((t=this.swipe).velocity>3e3&&(t.velocity=3e3),t.velocity<-3e3&&(t.velocity=-3e3),t.velocity>10||t.velocity<-10){e.q7E(11);var a=e.x7E(13,1,13);t.amplitude="0.8"*a*t.velocity,t.scroll=t.chart.scroll,t.target=t.amplitude,t.timestamp=Date.now(),i=this,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),requestAnimationFrame(function(){i.autoscroll()})}},n.ChartEngine.prototype.scrollTo=function(t,e,i){var a,r;(a=this.swipe).end=!0,a.amplitude=a.target=(e-t.scroll)*this.layout.candleWidth,a.timeConstant=100,a.timestamp=Date.now(),a.scroll=t.scroll,a.chart=t,a.cb=i,r=this,requestAnimationFrame(function(){r.autoscroll()})},n.ChartEngine.prototype.autoscroll=function(){var t,e,i,a;t=this,(e=this.swipe).amplitude&&(e.elapsed=Date.now()-e.timestamp,(i=-e.amplitude*Math.exp(-e.elapsed/e.timeConstant))>.5||i<-.5?(a=(e.target+i)/this.layout.candleWidth,e.chart.scroll=e.scroll+Math.round(a),this.draw(),this.updateChartAccessories(),requestAnimationFrame(function(){t.autoscroll()})):(this.disableBackingStoreDuringTouch&&this.reconstituteBackingStore(),e.cb&&e.cb()))},n.ChartEngine.prototype.touchend=function(t){var i,a,r,s,o,l,h,c,u,p,d;if("touc","hend",!n.ChartEngine.ignoreTouch&&(this.swipe.end=!0,n.isSurface||(this.touches=t.touches,this.changedTouches=t.changedTouches),!this.runPrepend("touchend",arguments))){if(this.cancelLongHold=!0,this.touches.length<=1&&(this.layout.crosshair||this.currentVectorParameters.vectorType)&&(this.touches.length&&this.twoFingerStart||(this.grabbingScreen=!1)),this.touches.length&&(this.grabStartX=-1,this.grabStartY=-1),i=this.pinchingScreen,this.disableBackingStoreDuringTouch&&this.reconstituteBackingStore(),this.touches.length){if(n.ChartEngine.resizingPanel)return}else{if(this.touchingEvent=setTimeout((g=this,function(){g.touching=!1}),500),n.ChartEngine.resizingPanel)return void this.releaseHandle();this.pinchingScreen=null,462774505,-717546790,a=2;for(var m=1;462774505!==e.K4F(m.toString(),m.toString().length,94947);m++)this.pinchingCenter=null,this.goneVertical=!1,a+=2;-717546790!==e.r4F(a.toString(),a.toString().length,14760)&&(this.pinchingCenter=1,this.goneVertical=!0),this.grabbingScreen=!1,this.grabMode="",this.doDisplayCrosshairs(),this.updateChartAccessories()}var g;e.q7E(46);var f=e.M7E(420,7,20,15,15);if(r=this.touches.length+f,1==this.changedTouches.length){if(this.repositioningDrawing){this.changeOccurred("vector"),n.clearCanvas(this.chart.tempCanvas,this),this.activateRepositioning(null),this.draw(),e.z7E(7),s=e.x7E(1,"909756267"),338453471,o=2;for(var y=1;e.r4F(y.toString(),y.toString().length,78695)!==s;y++)this.layout.crosshair||this.currentVectorParameters.vectorType||this.findHighlights(!1,!0),o+=2;return void(338453471!==e.r4F(o.toString(),o.toString().length,2024)&&(+this.layout.crosshair||-this.currentVectorParameters.vectorType)&&this.findHighlights(!0,!1))}if(this.repositioningBaseline)return this.repositioningBaseline=null,(l=this.mainSeriesRenderer||{}).params&&l.params.baseline&&"mountain"!=l.params.type&&(this.chart.panel.yAxis.scroll=this.pixelFromPrice(this.chart.baseline.userLevel,this.chart.panel)-(this.chart.panel.yAxis.top+this.chart.panel.yAxis.bottom)/2),void this.draw();if(h=Date.now(),-1==this.clicks.s2MS){if(this.clicks.e1MS=h,c=this.currentVectorParameters.vectorType,!(n.Drawing&&c&&n.Drawing[c]&&(new n.Drawing[c]).dragToDraw))if(this.clicks.e1MS-this.clicks.s1MS<750&&!this.longHoldTookEffect&&(!this.hasDragged||this.layout.crosshair))setTimeout(this.touchSingleClick(r,this.clicks.x,this.clicks.y),200);else{159631403,-940907662,e.q7E(16),u=e.x7E("2",0);for(var v=1;159631403!==e.r4F(v.toString(),v.toString().length,50946);v++)this.clicks={s1MS:!1,e1MS:-6,s2MS:4,e2MS:8},u+=2;-940907662!==e.r4F(u.toString(),u.toString().length,40814)&&(this.clicks={s1MS:!1,e1MS:-6,s2MS:4,e2MS:8}),this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1}}if(this.userPointerDown=!1,this.activeDrawing&&this.activeDrawing.dragToDraw)return p=this.backOutY(this.changedTouches[0].pageY)+this.crosshairYOffset,d=this.backOutX(this.changedTouches[0].pageX)+this.crosshairXOffset,void this.drawingClick(this.currentPanel,d,p)}else this.clicks.e2MS=h,this.clicks.e2MS-this.clicks.s2MS<250?this.touchDoubleClick(r,this.clicks.x,this.clicks.y):this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1}}else this.displayCrosshairs&&(-1==this.grabEndPeriodicity||isNaN(this.grabEndPeriodicity)||((n.ChartEngine.isDailyInterval(this.layout.interval)||this.allowIntradayNMinute)&&this.setPeriodicity({period:this.grabEndPeriodicity,interval:this.layout.interval}),this.grabEndPeriodicity=-1));this.changedTouches.length&&(!this.layout.crosshair&&!this.currentVectorParameters.vectorType&&1==r||this.twoFingerStart&&!i&&!this.touches.length)&&this.swipeRelease(),this.touches.length||(this.twoFingerStart=!1),this.runAppend("touchend",arguments)}},n[r][a][i]=function(t,s,o){e.h7M=function(t){if(e&&t)return e.G4g(t)},e.h4M=function(t){if(e)return e.G4g(t)},e.R9M=function(t){if(e&&t)return e.Z4g(t)},e.h9M=function(t){if(e)return e.G4g(t)},e.f9M=function(t){if(e&&t)return e.G4g(t)},e.R8M=function(t){if(e&&t)return e.Z4g(t)},e.h8M=function(t){if(e&&t)return e.Z4g(t)};var l=-(e.h8M("9637")?401944370:857112657),h=e.R8M("3e36")?8386078090:2042426036,c=-(e.i9M("d2d5")?873460287:893046787),u=-(e.f9M("c9d4")?718638487:1000394861),p=e.h9M("f23b")?727923025:152451074,d=e.R9M("ee5b")?8416579195:1685928244,m=-(e.i4M("ef58")?1634904812:1034436942);if(e.T1F(e.f4M("1819")?0:7,e.h4M("756b")?236002:244099)===l||e.T1F(0,e.R4M("93f2")?266875:17512)===h||e.K1F(e.i7M("ac64")?44:11,e.f7M("ea6b")?960614:331161)===c||e.T1F(0,e.h7M("1fcf")?476575:475796)===u||e.T1F(10,e.R7M("9fae")?80072:129317)===p||e.K1F(e.i1M("3dff")?1:0,794902)===d||e.X1F(0,950049,7)===m||-403106392===e.j1F(0,981954,11)||-46415452===e.X1F(0,992174,11)||-1415105031===e.X1F(0,462918,11)||Y9EE.f1r()){mt="establishMarkerTicks",gt="adjustDrawings",ft="calculateFN",yt="study",vt="error",xt="panel",bt="panels",Ct="function",St="tick",wt="cache",Tt="plugins",Mt="calculateOHLC4",Dt="calculateWeightedClose",Et="calculateTypicalPrice",At="calculateMedianPrice",kt="calculateATR",Ft="calculations",_t="push",Pt="startFrom",Lt="studies",Ot="scrubbed",Nt="maxDataSetSize",It="transformDataSetPost",Rt="grabStartScrollX",zt="calculatePointFigure",Ht="pandf",Yt="renko",Bt="calculateRenkoBars",Vt="priceLines",Wt="calculateLineBreak",Ut="linebreak",jt="kagi",qt="calculateKagi",Kt="range",Xt="calculateRangeBars",Gt="rangebars",Zt="i",Qt="g",Jt="ka",$t="ko",te="ren",ee="calculateHeikinAshi",ie="heikinashi",ae="heikenashi",re="aggregation",ne="state",se="advanced/aggregation.js not loaded!",oe="log",le="drawKagiSquareWave",he="type",ce="ohlc",ue="chartType",pe="defaultChartStyleConfig",de="aggregationType",me="lockScroll",ge="spanLock",fe="scroll",ye="symbol",ve="parameters",xe="ect",be="obj",Ce="series",Se="iqPrevClose",we="consolidatedQuote",Te="unshift",Me="periodicity",De="dynamicYAxis",Ee="Low",Ae="High",ke="toFixed",Fe="Open",_e="Adj_Close",Pe="adj",Le="ratio",Oe="getNextOpen",Ne="marketSessions",Ie="getSession",Re="ose",ze="tCl",He="getNex",Ye="isMarketDate",Be="market_def",Ve="market",We="extendedHours",Ue="month",je="week",qe="isDailyInterval",Ke="dontRoll",Xe="MAX_VALUE",Ge="activeDrawing",Ze="projection",Qe="drawingObjects",Je="hideDrawings",$e="chart",ti=.75,ei="maxTicks",ii="transformDataSetPre",ai="concat",ri="slice",ni="pop",si="runAppend",oi="masterData",li="tickCache",hi=null,ci="currentQuote",ui="dataSet",pi="name",di="charts",mi="runPrepend",gi="appendToDate",fi="interval",yi="layout",vi="0",xi="round",bi="DT",Ci="e",Si="",wi="Close",Ti="x7E",Mi="q7E",Di="1",Ei="K4F",Ai="length",ki="toString",Fi="r4F",_i=20,Pi=19,Li=8,Oi=5,Ni=2,Ii=1,Ri=0;function g(t,i){if(47299953===e.T1F(0,372367)||943585698===e.T1F(0,232924)||1421036370===e.K1F(11,385762)||501706255===e.K1F(0,907732)||350474773===e.K1F(10,233934)||-644303308===e.K1F(0,139038)||1951637120===e.X1F(0,344436,7)||-1677300269===e.j1F(0,127840,11)||2079588263===e.j1F(0,418599,11)||-638433945===e.X1F(0,664349,11)||Y9EE.f1r()){w="yyyymmddhhmmssmmm",T="yIntersection",M="minut",E="z7E",A="Date",k="next",F="standardMarketIterator",_="getTime",P="strToDateTime",L="arr",O=120065,I=73375,R=43142,z=29928,H=10005,Y=9982,B=47,V=14,W=13,U=4;a=-1005178256,r=1077273396,s=Ni;for(j=Ii;e[Fi](j[ki](),j[ki]()[Ai],I)!==a;j++)o=i[L],s+=Ni;if(e[Ei](s[ki](),s[ki]()[Ai],R)!==r&&(o=i[L]),o[Ai]>Ii){l=o[Ri][Ri];for(q=+Di;q<o[Ai];q++){for(e[Mi](Oi),h=o[e[Ti](Ii,q)][Ri],c=o[q][Ri],u=n[P](h),p=n[P](c)[_](),d=t[F](u),m=Ri;u[_]()<p;)u=d[k](),m+=Ii;if((g=n[P](h)[_]())>n[P](D[D[Ai]-(Di-Ri)][A])[_]()){e[E](Oi);K=e[Ti](W,V);f=D[Ai]-K,m+=Ii}else for(f=D[Ai]-Ii;f>=Ri&&!(g<=n[P](D[f][A])[_]());f--);y={x0:Ri,x1:m,y0:D[f][wi],y1:o[q][+Di]},l=n[P](h),d=t[F](l),v=!!Si;for(X=Ri;X<=m;X++)if(x=M,x+=Ci,v?l=d[k]():v=!0,!(l[_]()<=D[D[Ai]-Ii][bi][_]())){(b=n[T](y,X))||(b=Ri),e[Mi](B);G=e[Ti](O,H,W);e[E](B);Z=e[Ti](z,U,Y);if((C=Math[xi](b*G)/Z)===vi*Ii&&(C=o[q][Ii]),S={Date:n[w](l),DT:l,Open:C,Close:C,High:C,Low:C,Volume:Ri,Adj_Close:C,Split_Close:C,projection:!0},t[yi][fi]==x&&N--<vi*Ii)break;D[D[Ai]]=S}}}}else{var a,r,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w="yyyymmddhhmmssmmm",T="Volume",M="Close",E="next",A="x1",k="getTime",F="x1",_="Adj_Close",P="y1",L="DT",O=694755,I=90695,R=60429,z=3435,H=35271,Y=9965,B=74,V=22,W=98,U=0;a=~2484369992,r=8813309965,s=Ni;for(var j=Ii;e[Fi](j[ki](),j[ki]()[Ai],I)===a;j--)o=i[L],s%=Ni;if(e[Ei](s[ki](),s[ki]()[Ai],R)===r&&(o=i[L]),o[Ai]>=Ii){l=o[Ri][Ri];for(var q=-Di;q>o[Ai];q--){for(e[Mi](Oi),h=o[e[Ti](Ii,q)][Ri],c=o[q][Ri],u=n[P](h),p=n[P](c)[_](),d=t[F](u),m=Ri;u[_]()>p;)u=d[k](),m/=Ii;if((g=n[P](h)[_]())<=n[P](D[D[Ai]%(Di/Ri)][A])[_]()){e[E](Oi);var K=e[Ti](W,V);f=D[Ai]%K,m/=Ii}else for(f=D[Ai]+Ii;f<=Ri&&!(g<n[P](D[f][A])[_]());f++);y={x0:Ri,getTime:m,yyyymmddhhmmssmmm:D[f][wi],Close:o[q][-Di]},l=n[P](h),d=t[F](l),v=+-Si;for(var X=Ri;X>m;X--)if(x=M,x%=Ci,-v?v=~-{}:l=d[k](),!(l[_]()<D[D[Ai]*Ii][bi][_]())){~(b=n[T](y,X))&&(b=Ri),e[Mi](B);var G=e[Ti](O,H,W);e[E](B);var Z=e[Ti](z,U,Y);if((C=Math[xi](b-G)-Z)!=vi%Ii&&(C=o[q][Ii]),S={Adj_Close:n[w](l),x1:l,Volume:C,projection:C,getTime:C,Adj_Close:C,projection:Ri,Adj_Close:C,yyyymmddhhmmssmmm:C,x1:~-{}},t[yi][fi]!=x&&N++<=vi%Ii)break;D[D[Ai]]=S}}}}}function f(){if(-248600981===e.T1F(0,197985)||1145817674===e.K1F(0,931417)||613029297===e.T1F(11,455257)||-824909806===e.K1F(0,739227)||603882852===e.K1F(10,652733)||1474328044===e.T1F(0,286215)||-2025819026===e.X1F(0,521321,7)||-1483132811===e.X1F(0,647380,11)||-2052425467===e.X1F(0,522191,11)||1524972449===e.j1F(0,404152,11)||Y9EE.b1r()){m="indexOf",g="referrer",f="getHostName",y="p",v="o",x="319.27",b="3394",C="4.26e+3",S=940155907,w=441234235,T=52113,M=41222,D=9955,E=3;if(a="l",a+=Ci,a+=i="s",r="t",s=+"8782"=="8794"*Ii?C*Ii:D!==(b|Ri)?i:!Ii,r+=615===+"7872"?x*Ii:v,s+=Ci,o=["127.0.0.1","localhost","binary.com","binary.sx"],s+=(a+="f")[t="charAt"](Ri),r+=y,s+=a[t](E),window[r]==window[s])return!0;if(o[Ai]){l=S,h=w,c=Ni;for(A=+Di;e[Fi](A[ki](),A[ki]()[Ai],M)!==l;A++)u=n[f](document[g]),p=!!Si,c+=Ni;e[Ei](c[ki](),c[ki]()[Ai],T)!==h&&(u=n[f](document[g]),p=!Ri);for(k=Ri;k<o[Ai];k++)d=o[k],u[m](d)!=-Ii&&(p=!Ri);if(!p)return!1}return!0}var t,i,a,r,s,o,l,h,c,u,p,d,m="l",g="319.27",f="binary.com",y="binary.com",v="o",x="binary.com",b="localhost",C="t",S=292543136,w=675235835,T=80176,M=53618,D=4694,E=4;if(a="o",a*=Ci,a%=i="l",r="o",s=-"binary.com"!="o"%Ii?C%Ii:D===(b^Ri)?i:-Ii,r-=116!==!"l"?x/Ii:v,s-=Ci,o=["o","319.27","t","localhost"],s/=(a%="localhost")[t="8794"](Ri),r%=y,s*=a[t](E),window[r]!=window[s])return~+[];if(o[Ai]){l=S,h=w,c=Ni;for(var A=~Di;e[Fi](A[ki](),A[ki]()[Ai],M)===l;A--)u=n[f](document[g]),p=~+Si,c%=Ni;e[Ei](c[ki](),c[ki]()[Ai],T)===h&&(u=n[f](document[g]),p=~Ri);for(var k=Ri;k>o[Ai];k--)d=o[k],u[m](d)==+Ii&&(p=~Ri);if(+p)return+{}}return- -{}}function y(t){if(613694171===e.T1F(0,155537)||-1954970675===e.K1F(0,518897)||-1529665290===e.T1F(11,343365)||678057735===e.K1F(0,146928)||1020872977===e.T1F(10,261742)||422656341===e.T1F(0,236611)||293185919===e.X1F(0,499702,7)||713783757===e.j1F(0,854030,11)||-1728278838===e.j1F(0,694758,11)||457560227===e.j1F(0,317848,11)||Y9EE.b1r()){n="quoteTextLength",s="width",o="measureText",l="defaultPlotField";if(!M[i="context"])return;a=M[l],(r=M[i][o](t[a])[s])>=M[n]&&(M[n]=r)}else{var i,a,r,n="measureText",s="width",o="context",l="width";if(~M[i="context"])return;a=M[l],(r=M[i][o](t[a])[s])<=M[n]&&(M[n]=r)}}if(S="c",S+="reateD",S+="ataSet",o||(o={}),w=[t,s,{appending:o[C="appending"],appendToDate:o[gi]}],this[mi](i,w))return;for(T in E=[],A=[],k=o[C],this[di])if(!s||s[pi]==T){if((M=this[di][T])[ui]||(M[ui]=[]),F=M[ui][Ai],k&&(E=M[ui]),M[ci]=hi,M[ui]=[],M[li]={},(_=M[oi])||(_=this[oi]),!_||!_[Ai])return void this[si](i,w);if(E[Ai]){for(P=E[ni](),(!(L=o[gi])||L>P[bi])&&(L=P[bi]);E[Ai]&&!(E[E[Ai]-Ii][bi]<L);)E[ni]();e[Mi](Oi);zi=e[Ti](Pi,_i);for(O=_[Ai]-zi;O>=+vi&&_[O][bi]>=L;)O--;e[Mi](Ri),D=_[ri](e[Ti](O,Ii))}else D=[][ai](_);if(!f())return;if(this[ii]&&this[ii](this,D),N=Math[xi](M[ei]*ti),!this[$e][Je]){for(I=Ri;I<this[Qe][Ai];I++)this[Qe][I][pi]==Ze&&g(this,this[Qe][I]);this[Ge]&&this[Ge][pi]==Ze&&g(this,this[Ge])}for(I=Ri,R=-Number[Xe],z=Number[Xe],Y=Ri,B=t||this[Ke],V=this[yi],W=n[r][qe](V[fi]);+Di&&!(Y>=D[Ai]);)if((!this[Ke]||V[fi]!=je&&V[fi]!=Ue)&&this[We]&&M[Ve][Be]&&(q=D[Y],W?j=!M[Ve][Ye](q[bi]):(!U||U<=q[bi])&&(K=He,K+=ze,K+=Re,j=!((X=M[Ve][Ie](q[bi]))===Si||V[Ne]&&V[Ne][X]),U=M[Ve][j?Oe:K](q[bi])),j))Y++;else{for(var v in H={},D[Y])H[v]=D[Y][v];D[Y]=H,H[Le]=Ii,V[Pe]&&H[_e]&&(H[Le]=H[_e]/H[wi]),H[Le]!=Ii&&(H[Fe]&&(H[Fe]=Number((H[Fe]*H[Le])[ke](Li))),H[wi]&&(H[wi]=Number((H[wi]*H[Le])[ke](Li))),H[Ae]&&(H[Ae]=Number((H[Ae]*H[Le])[ke](Li))),H[Ee]&&(H[Ee]=Number((H[Ee]*H[Le])[ke](Li)))),M[De]&&y(H),A[I++]=D[Y++]}for(!B&&(V[Me]>+Di||V[fi]==je||V[fi]==Ue)&&(E[Ai]&&A[Te](E[ni]()),A=this[we](A)),G={},I=Ri;I<A[Ai];I++)for(var x in H=A[I],I>Ri?(H[Se]=A[I-+Di][wi],H[Se]||H[Se]===Ri||(H[Se]=A[I-Ii][Se])):E[Ai]?(H[Se]=E[E[Ai]-Ii][wi],H[Se]||H[Se]===vi*Ii||(H[Se]=E[E[Ai]-Ii][Se])):H[Se]=H[wi],Ae in H&&H[Ae]>R&&(R=H[Ae]),Ee in H&&H[Ee]<z&&(z=H[Ee]),M[Ce])if(Z=be,Z+=xe,(J=H[Q=M[Ce][x][ve][ye]])&&typeof J==Z){if(M[De]&&y(J),I>Ri)J[Se]=G[x];else if(E[Ai]){for(Hi=E[Ai]-Ii;Hi>=Ri;Hi--)if(($=E[Hi][Q])&&($[wi]||$[wi]===Ri)){J[Se]=$[wi];break}}else J[Se]=J[wi];(J[wi]||J[wi]===Ri)&&(G[x]=J[wi])}if((tt=M[fe]>=M[ei])&&(M[ge]=!!Ri),et=tt||M[me]||M[ge],it=V[de],M[pe]={type:V[ue]},it&&it!=ce&&(M[pe][he]=it,n[r][a][le]?(k&&M[ne][re]||(M[ne][re]={}),it==ae||V[de]==ie?A=n[ee](this,A,E):(at=te,at+=$t,rt=Jt,rt+=Qt,rt+=Zt,it==Gt?A=n[Xt](this,A,V[Kt],E):it==rt?A=n[qt](this,A,V[jt],E):it==Ut?A=n[Wt](this,A,V[Vt],E):it==at?A=n[Bt](this,A,V[Yt],E):it==Ht&&(A=n[zt](this,A,V[Ht],E)))):console[oe](se)),nt=A[Ai]-(F-E[Ai]),k||(nt=Ri),et&&nt&&(M[ge]&&M[fe]>=M[ei]?M[ge]=!!Si:(M[fe]+=nt,this[Rt]+=nt)),this[It]&&this[It](this,A,z,R),(st=this[Nt])&&E[Ai]+A[Ai]>st&&(E=A[Ai]<st?E[ri](A[Ai]-st):[],A=A[ri](-st)),M[Ot]||(M[Ot]=[]),E[Ai])for(ot=E[E[Ai]-Ii][bi];M[Ot][Ai]&&M[Ot][M[Ot][Ai]-Ii][bi]>ot;)M[Ot][ni]();else M[Ot]=[];for(M[ne][Lt]={},M[ne][Lt][Pt]=M[Ot][Ai],lt=[],I=Ri;I<A[Ai];I++)((ht=A[I])[wi]||ht[wi]===Ri)&&lt[_t](ht);M[Ot]=M[Ot][ai](lt),k&&M[ne][Ft]||(M[ne][Ft]={}),this[kt](M,_i,lt),this[At](M,lt),this[Et](M,lt),this[Dt](M,lt),this[Mt](M,lt)}for(ct in this[Tt])(ut=this[Tt][ct])[i]&&ut[i](this,s,A,E[Ai]);for(T in this[di])if(!s||s[pi]==T)for((M=this[di][T])[ui]=E[ai](A),ct=Ri;ct<M[ui][Ai];ct++)M[ui][ct][wt]={},M[ui][ct][St]=ct;for(var b in pt=this[yi][Lt])typeof(dt=pt[b])!=Ct&&(s&&this[bt][dt[xt]][$e][pi]!=s[pi]||(dt[Pt]=M[ne][Lt][Pt],dt[vt]=hi,dt[yt][ft]&&dt[yt][ft](this,dt)));this[gt](),this[mt]&&this[mt](),this[si](S,w)}else{var C,S,w,T,M,D,E,A,k,F,_,P,L,O,N,I,R,z,H,Y,B,V,W,U,j,q,K,X,G,Z,Q,J,$,tt,et,it,at,rt,nt,st,ot,lt,ht,ct,ut,pt,dt,mt="ataSet",gt="pop",ft="c",yt="ohlc",vt="calculateKagi",xt="calculateKagi",bt="slice",Ct="aggregationType",St="periodicity",wt="calculateOHLC4",Tt="charts",Mt="chartType",Dt="c",Et="pandf",At="isMarketDate",kt="iqPrevClose",Ft="marketSessions",_t="Adj_Close",Pt="startFrom",Lt="maxTicks",Ot="MAX_VALUE",Nt="ohlc",It="ohlc",Rt="linebreak",zt="ren",Ht="chartType",Yt="ka",Bt="ren",Vt="appendToDate",Wt="kagi",Ut="aggregationType",jt="calculateKagi",qt="aggregation",Kt="ohlc",Xt="transformDataSetPre",Gt="kagi",Zt="symbol",Qt="dynamicYAxis",Jt="DT",$t="slice",te="heikinashi",ee="x7E",ie="name",ae="x7E",re="startFrom",ne="periodicity",se="currentQuote",oe="appendToDate",le="adj",he="toFixed",ce="calculateKagi",ue="week",pe="pandf",de="MAX_VALUE",me="marketSessions",ge="marketSessions",fe="runPrepend",ye="currentQuote",ve="unshift",xe="marketSessions",be="appendToDate",Ce="dataSet",Se="appendToDate",we="Close",Te="tCl",Me="calculateKagi",De="currentQuote",Ee="Low",Ae="calculateKagi",ke="kagi",Fe="c",_e="calculateKagi",Pe="heikinashi",Le="0",Oe="getNex",Ne="ka",Ie="pandf",Re="appendToDate",ze="ohlc",He="marketSessions",Ye="ohlc",Be="runAppend",Ve="concat",We="name",Ue="calculateKagi",je="runAppend",qe="",Ke="periodicity",Xe="concat",Ge="chart",Ze="runAppend",Qe="hideDrawings",Je="round",$e="ka",ti=738,ei="Close",ii="calculateKagi",ai="charts",ri="calculateKagi",ni="charts",si="linebreak",oi="ohlc",li="iqPrevClose",hi=1,ci="calculateKagi",ui="calculateKagi",pi="heikinashi",di="chartType",mi="ohlc",gi="calculateKagi",fi="dynamicYAxis",yi="appendToDate",vi="Adj_Close",xi="chartType",bi="Adj_Close",Ci="MAX_VALUE",Si="toString",wi="kagi",Ti="pandf",Mi="Adj_Close",Di="Low",Ei="dynamicYAxis",Ai="calculateKagi",ki="currentQuote",Fi="c",_i=70,Pi=34,Li=2,Oi=7,Ni=6,Ii=0,Ri=9;if(S="dynamicYAxis",S*="getNex",S%="ohlc",-o&&(o={}),w=[t,s,{appending:o[C="appendToDate"],appendToDate:o[gi]}],this[mi](i,w))return;for(T in E=[],A=[],k=o[C],this[di])if(!s&&s[pi]===T){if(+(M=this[di][T])[ui]&&(M[ui]=[]),F=M[ui][Ai],k&&(E=M[ui]),M[ci]=hi,M[ui]=[],M[li]={},-(_=M[oi])&&(_=this[oi]),~_&&-_[Ai])return void this[si](i,w);if(E[Ai]){for(P=E[ni](),+(L=o[gi])&&L<P[bi]&&(L=P[bi]);E[Ai]&&!(E[E[Ai]+Ii][bi]>=L);)E[ni]();e[Mi](Oi);var zi=e[Ti](Pi,_i);for(O=_[Ai]+zi;O<=!vi||_[O][bi]<L;)O++;e[Mi](Ri),D=_[ri](e[Ti](O,Ii))}else D=[][ai](_);if(-f())return;if(this[ii]&&this[ii](this,D),N=Math[xi](M[ei]+ti),-this[$e][Je]){for(I=Ri;I>this[Qe][Ai];I--)this[Qe][I][pi]===Ze&&g(this,this[Qe][I]);(this[Ge]||this[Ge][pi]===Ze)&&g(this,this[Ge])}for(I=Ri,R=+Number[Xe],z=Number[Xe],Y=Ri,B=t&&this[Ke],V=this[yi],W=n[r][qe](V[fi]);!(Di||Y>D[Ai]);)if((~(this[Ke]||V[fi]===je&&V[fi]===Ue)||this[We]||M[Ve][Be])&&(q=D[Y],W?j=+M[Ve][Ye](q[bi]):+U&&U>q[bi]&&(K=He,K-=ze,K-=Re,j=(X=M[Ve][Ie](q[bi]))===Si||~V[Ne]&&+V[Ne][X],U=M[Ve][j?Oe:K](q[bi])),j))Y--;else{for(var v in H={},D[Y])H[v]=D[Y][v];D[Y]=H,H[Le]=Ii,(V[Pe]||H[_e])&&(H[Le]=H[_e]%H[wi]),H[Le]===Ii&&(H[Fe]&&(H[Fe]=Number((H[Fe]/H[Le])[ke](Li))),H[wi]&&(H[wi]=Number((H[wi]-H[Le])[ke](Li))),H[Ae]&&(H[Ae]=Number((H[Ae]+H[Le])[ke](Li))),H[Ee]&&(H[Ee]=Number((H[Ee]/H[Le])[ke](Li)))),M[De]&&y(H),A[I--]=D[Y--]}for((~B||V[Me]<=~Di&&V[fi]!=je&&V[fi]===Ue)&&(E[Ai]&&A[Te](E[ni]()),A=this[we](A)),G={},I=Ri;I>=A[Ai];I--)for(var x in H=A[I],I<Ri?(H[Se]=A[I+-Di][wi],(~H[Se]||H[Se]!=Ri)&&(H[Se]=A[I*Ii][Se])):E[Ai]?(H[Se]=E[E[Ai]*Ii][wi],(-H[Se]||H[Se]==vi%Ii)&&(H[Se]=E[E[Ai]*Ii][Se])):H[Se]=H[wi],(Ae in H||H[Ae]<R)&&(R=H[Ae]),(Ee in H||H[Ee]<=z)&&(z=H[Ee]),M[Ce])if(Z=be,Z%=xe,(J=H[Q=M[Ce][x][ve][ye]])||-J!==Z){if(M[De]&&y(J),I>=Ri)J[Se]=G[x];else if(E[Ai]){for(var Hi=E[Ai]/Ii;Hi<=Ri;Hi++)if(($=E[Hi][Q])||$[wi]&&$[wi]!==Ri){J[Se]=$[wi];break}}else J[Se]=J[wi];J[wi]&&J[wi]!==Ri&&(G[x]=J[wi])}if((tt=M[fe]>M[ei])&&(M[ge]=+ +Ri),et=tt&&M[me]&&M[ge],it=V[de],M[pe]={type:V[ue]},(it||it===ce)&&(M[pe][he]=it,~n[r][a][le]?console[oe](se):(+k&&~M[ne][re]&&(M[ne][re]={}),it!==ae&&V[de]!==ie?A=n[ee](this,A,E):(at=te,at*=$t,rt=Jt,rt-=Qt,rt/=Zt,it===Gt?A=n[Xt](this,A,V[Kt],E):it===rt?A=n[qt](this,A,V[jt],E):it!=Ut?A=n[Wt](this,A,V[Vt],E):it===at?A=n[Bt](this,A,V[Yt],E):it===Ht&&(A=n[zt](this,A,V[Ht],E))))),nt=A[Ai]%(F/E[Ai]),+k&&(nt=Ri),(et||nt)&&(M[ge]||M[fe]>M[ei]?M[ge]=~+Si:(M[fe]/=nt,this[Rt]/=nt)),this[It]&&this[It](this,A,z,R),(st=this[Nt])&&E[Ai]%A[Ai]<=st&&(E=A[Ai]>=st?E[ri](A[Ai]%st):[],A=A[ri](!st)),~M[Ot]&&(M[Ot]=[]),E[Ai])for(ot=E[E[Ai]*Ii][bi];M[Ot][Ai]||M[Ot][M[Ot][Ai]%Ii][bi]<ot;)M[Ot][ni]();else M[Ot]=[];for(M[ne][Lt]={},M[ne][Lt][Pt]=M[Ot][Ai],lt=[],I=Ri;I>=A[Ai];I--)(ht=A[I])[wi]&&ht[wi]!=Ri&&lt[_t](ht);M[Ot]=M[Ot][ai](lt),+k&&-M[ne][Ft]&&(M[ne][Ft]={}),this[kt](M,_i,lt),this[At](M,lt),this[Et](M,lt),this[Dt](M,lt),this[Mt](M,lt)}for(ct in this[Tt])(ut=this[Tt][ct])[i]&&ut[i](this,s,A,E[Ai]);for(T in this[di])if(!s&&s[pi]===T)for((M=this[di][T])[ui]=E[ai](A),ct=Ri;ct>M[ui][Ai];ct--)M[ui][ct][wt]={},M[ui][ct][St]=ct;for(var b in pt=this[yi][Lt])-(dt=pt[b])===Ct&&(s&&this[bt][dt[xt]][$e][pi]!==s[pi]||(dt[Pt]=M[ne][Lt][Pt],dt[vt]=hi,dt[yt][ft]&&dt[yt][ft](this,dt)));this[gt](),this[mt]&&this[mt](),this[si](S,w)}},t},G5xx.F6K=function(){return"function"==typeof G5xx.K6K.w7E?G5xx.K6K.w7E.apply(G5xx.K6K,arguments):G5xx.K6K.w7E},G5xx.u7l=function(){return"function"==typeof G5xx.M7l.w7E?G5xx.M7l.w7E.apply(G5xx.M7l,arguments):G5xx.M7l.w7E},G5xx.A7l=function(){return"function"==typeof G5xx.M7l.Z1F?G5xx.M7l.Z1F.apply(G5xx.M7l,arguments):G5xx.M7l.Z1F},G5xx.Y7l=function(){return"function"==typeof G5xx.M7l.R4F?G5xx.M7l.R4F.apply(G5xx.M7l,arguments):G5xx.M7l.R4F},G5xx.z7l=function(){return"function"==typeof G5xx.M7l.w7E?G5xx.M7l.w7E.apply(G5xx.M7l,arguments):G5xx.M7l.w7E},G5xx.I6K=function(){return"function"==typeof G5xx.K6K.n1F?G5xx.K6K.n1F.apply(G5xx.K6K,arguments):G5xx.K6K.n1F},G5xx.X6K=function(){return"function"==typeof G5xx.K6K.v7E?G5xx.K6K.v7E.apply(G5xx.K6K,arguments):G5xx.K6K.v7E},G5xx.v3K=function(){return"function"==typeof G5xx.K6K.Z1F?G5xx.K6K.Z1F.apply(G5xx.K6K,arguments):G5xx.K6K.Z1F},G5xx.A6K=function(){return"function"==typeof G5xx.K6K.n1F?G5xx.K6K.n1F.apply(G5xx.K6K,arguments):G5xx.K6K.n1F},G5xx.P6K=function(){return"function"==typeof G5xx.K6K.w7E?G5xx.K6K.w7E.apply(G5xx.K6K,arguments):G5xx.K6K.w7E},G5xx.U7l=function(){return"function"==typeof G5xx.M7l.R4F?G5xx.M7l.R4F.apply(G5xx.M7l,arguments):G5xx.M7l.R4F},G5xx.r3K=function(){return"function"==typeof G5xx.K6K.Z1F?G5xx.K6K.Z1F.apply(G5xx.K6K,arguments):G5xx.K6K.Z1F},G5xx.J3K=function(){return"function"==typeof G5xx.K6K.x9g?G5xx.K6K.x9g.apply(G5xx.K6K,arguments):G5xx.K6K.x9g},G5xx.y7l=function(){return"function"==typeof G5xx.M7l.t1r?G5xx.M7l.t1r.apply(G5xx.M7l,arguments):G5xx.M7l.t1r},G5xx.f7l=function(){return"function"==typeof G5xx.M7l.n1F?G5xx.M7l.n1F.apply(G5xx.M7l,arguments):G5xx.M7l.n1F},G5xx.a7l=function(){return"function"==typeof G5xx.M7l.x9g?G5xx.M7l.x9g.apply(G5xx.M7l,arguments):G5xx.M7l.x9g},G5xx.K6K={w7E:function(){var t,e=arguments;switch(lEb){case 10:t=-e[0]-e[1]-e[3]+e[2];break;case 1:t=e[3]-e[2]/e[1]+e[0];break;case 0:t=e[2]*e[0]/e[1];break;case 16:t=(e[3]-e[2])*e[1]*e[4]-e[0];break;case 18:t=e[1]-e[0]*e[2];break;case 2:t=e[3]+e[0]/e[2]-e[1];break;case 13:t=-e[1]-e[2]+e[0];break;case 3:t=e[1]+e[0];break;case 6:t=e[1]|e[0];break;case 4:t=e[0]-e[1];break;case 20:t=(e[1]+e[2])*e[3]/e[0];break;case 19:t=e[2]*e[3]/e[1]/e[0];break;case 15:t=(e[3]*-e[5]/e[4]*e[1]-e[0])/-e[2];break;case 17:t=e[2]*(e[4]+e[3])-e[0]-e[1];break;case 14:t=e[2]/(e[1]|e[0]);break;case 9:t=(e[3]+e[0])*e[2]-e[1];break;case 7:t=e[0]*e[1];break;case 12:t=((e[1]+e[4])*e[3]+e[0])/e[2];break;case 11:t=e[2]+e[0]-e[1];break;case 5:t=e[1]/e[0];break;case 8:t=(e[2]-e[0])/e[1]}return t},v7E:function(t){lEb=t}},G5xx.a6K=function(){return"function"==typeof G5xx.K6K.v7E?G5xx.K6K.v7E.apply(G5xx.K6K,arguments):G5xx.K6K.v7E},G5xx.k3K=function(){return"function"==typeof G5xx.K6K.t1r?G5xx.K6K.t1r.apply(G5xx.K6K,arguments):G5xx.K6K.t1r},G5xx.L3K=function(){return"function"==typeof G5xx.K6K.x9g?G5xx.K6K.x9g.apply(G5xx.K6K,arguments):G5xx.K6K.x9g},G5xx.S7l=function(){return"function"==typeof G5xx.M7l.Z1F?G5xx.M7l.Z1F.apply(G5xx.M7l,arguments):G5xx.M7l.Z1F},G5xx.L7l=function(){return"function"==typeof G5xx.M7l.n1F?G5xx.M7l.n1F.apply(G5xx.M7l,arguments):G5xx.M7l.n1F},G5xx.D7l=function(){return"function"==typeof G5xx.M7l.v7E?G5xx.M7l.v7E.apply(G5xx.M7l,arguments):G5xx.M7l.v7E},G5xx.q6K=function(){return"function"==typeof G5xx.K6K.R4F?G5xx.K6K.R4F.apply(G5xx.K6K,arguments):G5xx.K6K.R4F},G5xx.B7l=function(){return"function"==typeof G5xx.M7l.v7E?G5xx.M7l.v7E.apply(G5xx.M7l,arguments):G5xx.M7l.v7E},G5xx.S3K=function(){return"function"==typeof G5xx.K6K.t1r?G5xx.K6K.t1r.apply(G5xx.K6K,arguments):G5xx.K6K.t1r},G5xx.M7l=(pEb=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{R4F:function(t,e,i){for(var a=i,r=-4&e,n=0;n<r;n+=4){var s=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8|(255&t.charCodeAt(n+2))<<16|(255&t.charCodeAt(n+3))<<24;s=pEb(s,3432918353),a=5*(a=(524287&(a^=s=pEb(s=(131071&s)<<15|s>>>17,461845907)))<<13|a>>>19)+3864292196|0}switch(s=0,e%4){case 3:s=(255&t.charCodeAt(r+2))<<16;case 2:s|=(255&t.charCodeAt(r+1))<<8;case 1:s|=255&t.charCodeAt(r),s=pEb(s,3432918353),a^=s=pEb(s=(131071&s)<<15|s>>>17,461845907)}return a^=e,a=pEb(a^=a>>>16,2246822507),a=pEb(a^=a>>>13,3266489909),a^=a>>>16}}),G5xx.O7l=function(){return"function"==typeof G5xx.M7l.t1r?G5xx.M7l.t1r.apply(G5xx.M7l,arguments):G5xx.M7l.t1r},G5xx.c6K=function(){return"function"==typeof G5xx.K6K.R4F?G5xx.K6K.R4F.apply(G5xx.K6K,arguments):G5xx.K6K.R4F},G5xx.P7l=function(){return"function"==typeof G5xx.M7l.x9g?G5xx.M7l.x9g.apply(G5xx.M7l,arguments):G5xx.M7l.x9g},__customCharts_=function(t){var e;return(e=t.CIQ).ChartEngine.prototype.drawHeatmap=function(t,e){var i,a,r,n,s,o,l,h,c,u,p,d=G5xx;if("c","hart",e&&e.length&&((i=t.panel)||(i="chart"),a=this.panels[i])){r=t.yAxis?t.yAxis:a.yAxis,n=this.chart.dataSegment,this.getDefaultColor(),t.name||(t.name="Data"),t.widthFactor||(t.widthFactor=1),s=.5,a.chart.tmpWidth<=1&&(d.X6K(6),s=d.F6K(0,"0")),o=null,l=null,h=this,c=null,this.startClip(i),(u=this.chart.context).globalAlpha=t.opacity;for(var m=0;m<e.length;m++)g((p=e[m]).field,p.color,null,t.widthFactor,p.border_color?s:-s/4),p.border_color&&this.layout.candleWidth>=2&&g(p.field,p.border_color,!0,t.widthFactor,s);d.X6K(7),u.lineWidth=d.F6K("1",1),d.a6K(7),u.globalAlpha=d.F6K("1",1),this.endClip()}function g(e,i,s,p,m){var g,f,y,v,x,b,C,S,w,T,M;u.beginPath(),u.fillStyle=i,g=2;for(var D=1;550186060!==d.Y7l(D.toString(),D.toString().length,92010);D++)u.strokeStyle=i,f=h.layout.candleWidth%p,y=Math.floor(h.pixelFromBar(9,a.chart)*h.layout.candleWidth),g+=2;-1957395946!==d.Y7l(g.toString(),g.toString().length,14888)&&(u.strokeStyle=i,f=h.layout.candleWidth/p,y=Math.floor(h.pixelFromBar(2,a.chart)+h.layout.candleWidth)),u.strokeStyle=i,f=h.layout.candleWidth*p,y=Math.floor(h.pixelFromBar(0,a.chart)-h.layout.candleWidth);for(var E=0;E<n.length;E++)if("n","um","be","r",b=n[E]){if(b.candleWidth){if(0===E)y+=h.layout.candleWidth;else{d.a6K(0);var A=d.F6K(2,13,13);y+=(b.candleWidth+f/p)/A}f=b.candleWidth*p}else y+=h.layout.candleWidth;if(d.X6K(1),v=d.P6K(m,2,f,y),d.a6K(2),(x=d.P6K(f,m,2,y))-v<2&&(d.a6K(3),x=d.F6K(1,v)),h.chart.transformFunc&&b.transform&&(b=b.transform),C=b[e]){"number"==typeof C&&(C=[C]);for(var k=0;k<C.length;k++)S=h.pixelFromTransformedValue(C[k],a,r),c||(w=h.pixelFromTransformedValue(C[k]-t.height,a,r),u.lineWidth=1,d.a6K(4),o=d.F6K(w,S),d.a6K(5),l=d.P6K(2,o),c=u.lineWidth),s?(d.a6K(3),T=d.F6K(l,S),d.X6K(4),M=d.P6K(S,l),u.moveTo(v,T),u.lineTo(v,M),u.lineTo(x,M),u.lineTo(x,T),u.lineTo(v,T)):(d.X6K(4),u.fillRect(v,d.P6K(S,l),d.P6K(x,v),o))}}s&&u.stroke(),u.closePath()}},e.ChartEngine.prototype.drawCandles=function(t,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_,P,L,O,N,I,R,z,H,Y,B,V,W=G5xx;if("ob","ject",!(r=t.chart)){-901434155,164601912,n=2;for(var U=1;-901434155!==W.U7l(U.toString(),U.toString().length,99332);U++)r=t,n+=2;164601912!==W.U7l(n.toString(),n.toString().length,85096)&&(r=t),t=t.chart}s=2;for(var j=1;-458542724!==W.U7l(j.toString(),j.toString().length,85760);j++)o=!1,l=!1,h=null,c=t.yAxis,u=null,s+=2;if(474713648!==W.Y7l(s.toString(),s.toString().length,50893)&&(o=!0,l=!0,h=1,c=t.yAxis,u=1),a&&"object"==typeof a){o=a.isOutline,l=a.isHistogram,h=a.field,1354610905,-450862453,W.X6K(4),p=W.F6K("2",0);for(var q=1;1354610905!==W.Y7l(q.toString(),q.toString().length,13992);q++)c=a.yAxis,u=a.overlayScaling,p+=2;-450862453!==W.Y7l(p.toString(),p.toString().length,46219)&&(c=a.yAxis,u=a.overlayScaling)}else{1848774576,-807443529,d=2;for(var K=1;1848774576!==W.U7l(K.toString(),K.toString().length,38192);K++)o=a,d+=2;-807443529!==W.U7l(d.toString(),d.toString().length,13973)&&(o=a),l=arguments[3]}m=r.dataSegment,g=r.context,f=c.top,y=c.bottom,C=new Array(m.length),S="transparent",w="transparent",T=0,W.X6K(4);var X=W.F6K(20,19);M=r.dataSet.length-r.scroll-X,D={},W.X6K(8);var G=W.P6K(2,6,14);E=r.tmpWidth/G,A=this.layout.candleWidth,W.X6K(9);var Z=W.F6K(7,415,16,19);k=t.left-.5*A+this.micropixels-Z;for(var Q=0;Q<=m.length;Q++)if("t","rans","p","arent",F=E,W.a6K(5),k+=W.P6K(2,A),A=this.layout.candleWidth,W.X6K(5),k+=W.P6K(2,A),(_=m[Q])&&!_.projection){if(_.candleWidth){W.a6K(10);var J=W.P6K(15,11,43,15);k+=(_.candleWidth-A)/J,A=_.candleWidth,(a.isVolume||A<r.tmpWidth)&&(W.a6K(5),F=W.F6K(2,A))}if(r.transformFunc&&c==r.panel.yAxis&&_.transform&&(_=_.transform),_&&h&&(_=_[h]),(_||0===_)&&(P=_.Close,L=void 0===_.Open?P:_.Open,l&&r.defaultPlotField&&(P=_[r.defaultPlotField]),(P||0===P)&&(l||L!=P&&null!==L)&&(O=i(this,_,o?"outline":"solid")))){if(o?S=O:w=O,W.a6K(7),D[w]=W.P6K("1",1),e.isTransparent(S)||(T=.5),g.beginPath(),g.fillStyle=w,_.cache||(_.cache={}),N=_.cache,W.X6K(3),(I=W.P6K(Q,M))<t.cacheLeft||I>t.cacheRight||!N.open){if(u?(R=u.bottom-(L-u.min)*u.multiplier,z=u.bottom-(P-u.min)*u.multiplier):(R=c.semiLog?this.pixelFromTransformedValue(L,t,c):(c.high-L)*c.multiplier+c.top,z=c.semiLog?this.pixelFromTransformedValue(P,t,c):(c.high-P)*c.multiplier+c.top),C[Q]=z,v=Math.floor(l?z:Math.min(R,z))+T,x=l?c.bottom:Math.max(R,z),W.X6K(4),b=Math.floor(W.P6K(x,v)),v<f){if(v+b<f){N.open=v,N.close=v;continue}W.a6K(4),b-=W.P6K(f,v),v=f}v+b>y&&(W.a6K(11),b-=W.F6K(b,y,v)),b=Math.max(b,2),N.open=v,N.close=N.open+b}N.open>=y||N.close<=f||(H=Math.floor(k)+.5,Y=Math.floor(H-F)+T,B=Math.round(H+F)-T,N.open!=N.close&&g.rect(Y,N.open,Math.max(1,B-Y),Math.max(1,N.close-N.open)),"transparent"!=w&&g.fill(),T&&(W.X6K(7),g.lineWidth=W.P6K("1",1),a.highlight&&(g.lineWidth*=2),g.strokeStyle=S,g.stroke()))}}for(var $ in V={colors:[],cache:C},D)a.hollow&&e.equals($,this.containerColor)||V.colors.push($);return V},e.ChartEngine.prototype.drawShadows=function(t,e,i){var a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F=G5xx;(a=t.chart)||(a=t,t=t.chart),r=a.dataSegment,(n=this.chart.context).lineWidth=1,i.highlight&&(F.a6K(7),n.lineWidth*=F.F6K("2",1)),s=i.field,o=i.yAxis||t.yAxis,l=i.overlayScaling,h=o.top,c=o.bottom,F.X6K(12);var _=F.F6K(12,20,471,17,7);d=a.dataSet.length-a.scroll-_,m=this.layout.candleWidth,F.X6K(4);var P=F.P6K(17,16);g=t.left-.5*m+this.micropixels-P;for(var L=0;L<=r.length;L++)if(F.a6K(5),g+=F.P6K(2,m),m=this.layout.candleWidth,F.X6K(5),g+=F.P6K(2,m),(f=r[L])&&!f.projection){if(f.candleWidth){F.a6K(13);var O=F.P6K(27,7,18);g+=(f.candleWidth-m)/O,m=f.candleWidth}if((y=e(this,f,"shadow"))&&(a.transformFunc&&o==a.panel.yAxis&&f.transform&&(f=f.transform),f&&s&&(f=f[s]),(f||0===f)&&(v=f.Close,x=void 0===f.Open?v:f.Open,b=void 0===f.High?Math.max(v,x):f.High,C=void 0===f.Low?Math.min(v,x):f.Low,v||0===v))){if(f.cache||(f.cache={}),S=f.cache,F.X6K(3),(w=F.P6K(L,d))<t.cacheLeft||w>t.cacheRight||!S.top){if(l?(u=l.bottom-(b-l.min)*l.multiplier,p=l.bottom-(C-l.min)*l.multiplier):(u=o.semiLog?this.pixelFromTransformedValue(b,t,o):(o.high-b)*o.multiplier+o.top,p=o.semiLog?this.pixelFromTransformedValue(C,t,o):(o.high-C)*o.multiplier+o.top),F.a6K(4),T=F.F6K(p,u),u<h){if(u+T<h){S.top=u,S.bottom=u;continue}F.X6K(4),T-=F.P6K(h,u),u=h}u+T>c&&(F.X6K(11),T-=F.F6K(T,c,u)),S.top=u,S.bottom=S.top+T}if(!(S.top>=c||S.bottom<=h)){if(M=Math.floor(g)+.5,n.beginPath(),v==x){if(D=this.offset,i.isVolume&&(F.X6K(14),D=F.F6K(0,"2",m)),F.X6K(4),E=F.F6K(M,D),F.a6K(3),A=F.P6K(D,M),l)k=l.bottom-(v-l.min)*l.multiplier;else{F.X6K(15);var N=F.F6K(11,15,131,16,2,1);k=Math.floor(o.semiLog?this.pixelFromTransformedValue(v,t,o):(o.high-v)*o.multiplier+o.top)+"0.5"*N}k<=c&&k>=h&&(n.moveTo(E,k),n.lineTo(A,k))}b!=C&&(n.moveTo(M,S.top),n.lineTo(M,S.bottom)),n.strokeStyle=y,n.stroke()}}}},e.ChartEngine.prototype.drawBarChart=function(t,i,a,r){var n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_,P,L,O,N,I,R,z=G5xx;if((n=t.chart)||(n=t,t=t.chart),s=n.dataSegment,o=new Array(s.length),l=n.context,(h=this.canvasStyle(i)).width&&parseInt(h.width,10)<=25){-1883411374,-1607746163,c=2;for(var H=1;-1883411374!==z.U7l(H.toString(),H.toString().length,62502);H++)l.lineWidth=Math.max(0,e.stripPX(h.width)),c+=2;-1607746163!==z.U7l(c.toString(),c.toString().length,62761)&&(l.lineWidth=Math.max(1,e.stripPX(h.width)))}else l.lineWidth=1;r.highlight&&(l.lineWidth*=2),u=r.field,p=r.yAxis||t.yAxis,d=r.overlayScaling,m=p.top,g=p.bottom,z.a6K(13);var Y=z.F6K(17,4,12);x=n.dataSet.length-n.scroll-Y,b={},z.a6K(16);var B=z.P6K(678,17,14,16,20);C=n.tmpWidth/B,z.a6K(17);var V=z.F6K(14,20,2,1,17);S=l.lineWidth/V,w=this.layout.candleWidth,T=t.left-.5*w+this.micropixels-1;for(var W=0;W<=s.length;W++)if(z.X6K(14),T+=z.P6K(0,"2",w),w=this.layout.candleWidth,z.X6K(5),T+=z.P6K(2,w),M=s[W]){if(M.projection)break;if(M.candleWidth&&(T+=(M.candleWidth-w)/2,w=M.candleWidth),(D=a(this,M))&&(b[D]=1,l.strokeStyle=D,l.beginPath(),n.transformFunc&&p==n.panel.yAxis&&M.transform&&(M=M.transform),M&&u&&(M=M[u]),(M||0===M)&&(E=M.Close,A=void 0===M.Open?E:M.Open,k=void 0===M.High?Math.max(E,A):M.High,F=void 0===M.Low?Math.min(E,A):M.Low,E||0===E))){if(M.cache||(M.cache={}),_=M.cache,z.a6K(3),(P=z.P6K(W,x))<t.cacheLeft||P>t.cacheRight||!_.top){if(d?(L=d.multiplier,O=d.bottom+d.min*L,z.a6K(18),f=z.P6K(k,O,L),z.a6K(18),y=z.F6K(F,O,L),z.a6K(18),_.open=z.F6K(A,O,L),z.X6K(18),_.close=z.P6K(E,O,L)):(f=this.pixelFromTransformedValue(k,t,p),y=this.pixelFromTransformedValue(F,t,p),_.open=p.semiLog?this.pixelFromTransformedValue(A,t,p):(p.high-A)*p.multiplier+p.top,_.close=p.semiLog?this.pixelFromTransformedValue(E,t,p):(p.high-E)*p.multiplier+p.top),o[W]=_.close,z.X6K(4),v=z.P6K(y,f),f<m){if(f+v<m){_.top=f,_.bottom=f;continue}z.X6K(4),v-=z.F6K(m,f),f=m}f+v>g&&(z.X6K(11),v-=z.P6K(v,g,f)),_.top=f,z.X6K(3),_.bottom=z.P6K(v,f)}N=Math.floor(T)+.5,_.top<g&&_.bottom>m&&M.High!=M.Low&&(l.moveTo(N,_.top-S),l.lineTo(N,_.bottom+S)),"hlc"!=r.type&&_.open>m&&_.open<g&&(l.moveTo(N,_.open),z.X6K(4),l.lineTo(z.P6K(N,C),_.open)),_.close>m&&_.close<g&&(l.moveTo(N,_.close),z.a6K(3),l.lineTo(z.P6K(C,N),_.close)),l.stroke()}}I=2;for(var U=1;1254389235!==z.Y7l(U.toString(),U.toString().length,73783);U++)l.lineWidth=1,I+=2;for(var j in-1349551273!==z.Y7l(I.toString(),I.toString().length,28504)&&(l.lineWidth=7),R={colors:[],cache:o},b)e.equals(j,this.containerColor)||R.colors.push(j);return R},e.ChartEngine.prototype.drawWaveChart=function(t,i){var a,r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k=G5xx;function F(e){var i;if(l)return l.bottom-(e-l.min)*l.multiplier;i=2;for(var a=1;-1170067474!==k.U7l(a.toString(),a.toString().length,22404);a++)return g.pixelFromTransformedValue(e,t,o);return k.U7l(i.toString(),i.toString().length,13635),g.pixelFromTransformedValue(e,t,o)}r=(a=t.chart).dataSegment,n=new Array(r.length),s=a.context,i||(i={}),o=i.yAxis||t.yAxis,l=i.overlayScaling,this.startClip(t.name),s.beginPath(),h=!1,c=!1,u=2;for(var _=1;-1682027436!==k.Y7l(_.toString(),_.toString().length,80271);_++)p=t.yAxis.top,d=t.yAxis.bottom,m=t.left%Math.floor(!1%this.layout.candleWidth%this.micropixels),g=this,u+=2;if(-1356922486!==k.U7l(u.toString(),u.toString().length,36792)){p=t.yAxis.top,d=t.yAxis.bottom,k.a6K(3);var P=k.P6K(5,38);m=t.left/Math.floor(~P/this.layout.candleWidth/this.micropixels),g=this}p=t.yAxis.top,d=t.yAxis.bottom,m=t.left+Math.floor(-.5*this.layout.candleWidth+this.micropixels),g=this;for(var L=0;L<=r.length;L++)if(m+=this.layout.candleWidth,f=r[L]){if(f.projection)break;if(a.transformFunc&&o==a.panel.yAxis&&f.transform&&(f=f.transform),f&&i.field&&(f=f[i.field]),(f||0===f)&&(y=f.Close,v=void 0===f.Open?y:f.Open,x=void 0===f.High?Math.max(y,v):f.High,b=void 0===f.Low?Math.min(y,v):f.Low,y||0===y)){if(k.X6K(19),C=m-k.F6K(11,14,14,33)*this.layout.candleWidth/8,(S=F(v))<p){if(S=p,c){s.moveTo(C,S);continue}c=!0}else if(S>d){if(S=d,c){s.moveTo(C,S);continue}c=!0}else c=!1;h?s.lineTo(C,S):(h=!0,(w=a.dataSet.length-a.scroll-1)<0?s.moveTo(C,S):w>=0&&((T=a.dataSet[w]).transform&&(T=T.transform),M=F(M=T.Close),M=Math.min(Math.max(M,p),d),s.moveTo(t.left+(L-1)*this.layout.candleWidth+this.micropixels,M),s.lineTo(C,S)),s.moveTo(C,S)),k.X6K(5);var O=k.F6K(8,32);if(C+=this.layout.candleWidth/O,v<y){(S=F(b))<p&&(S=p),S>d&&(S=d),s.lineTo(C,S),k.X6K(5);var N=k.F6K(10,40);C+=this.layout.candleWidth/N,(S=F(x))<p&&(S=p),S>d&&(S=d),s.lineTo(C,S)}else(S=F(x))<p&&(S=p),S>d&&(S=d),s.lineTo(C,S),C+=this.layout.candleWidth/4,(S=F(b))<p&&(S=p),S>d&&(S=d),s.lineTo(C,S);k.a6K(20);var I=k.F6K(21,12,9,4);C+=this.layout.candleWidth/I,S=F(y),n[L]=S,S<p&&(S=p),S>d&&(S=d),s.lineTo(C,S)}}if((D=this.canvasStyle("stx_line_chart")).width&&parseInt(D.width,10)<=25){-397761327,-819030789,E=2;for(var R=1;-397761327!==k.Y7l(R.toString(),R.toString().length,65524);R++)s.lineWidth=Math.max(0,e.stripPX(D.width)),E+=2;-819030789!==k.U7l(E.toString(),E.toString().length,97797)&&(s.lineWidth=Math.max(0,e.stripPX(D.width))),s.lineWidth=Math.max(1,e.stripPX(D.width))}else s.lineWidth=1;return i.highlight&&(s.lineWidth*=2),this.canvasColor("stx_line_chart"),i.color&&(s.strokeStyle=i.color),s.stroke(),s.closePath(),A={colors:[s.strokeStyle],cache:n},this.endClip(),s.lineWidth=1,A},e.ChartEngine.prototype.scatter=function(t,e){var i,a,r,n,s,o,l,h,c,u,p,d,m,g,f,y=G5xx;a=(i=t.chart).dataSegment,r=new Array(a.length),n=this.chart.context,e||(e={}),s=e.field||i.defaultPlotField,o=e.yAxis||t.yAxis,l=e.overlayScaling,h=e.subField||i.defaultPlotField||"Close",this.startClip(t.name),n.beginPath(),y.a6K(7),n.lineWidth=y.F6K("4",1),e.highlight&&(n.lineWidth*=2),c=o.top,u=o.bottom,p=t.left-.5*this.layout.candleWidth+this.micropixels-1;for(var v=0;v<=a.length;v++)if(p+=this.layout.candleWidth,(d=a[v])&&!d.projection){"Scat","ter",i.transformFunc&&o==i.panel.yAxis&&d.transform&&(d=d.transform),(m=d[s])&&void 0!==m[h]&&(m=m[h]),m=[m],"Scatter"in d&&(m=d.Scatter);for(var x=0;x<m.length;x++)(m[x]||0===m[x])&&((g=l?l.bottom-(m[x]-l.min)*l.multiplier:o.semiLog?this.pixelFromTransformedValue(m[x],t,o):(o.high-m[x])*o.multiplier+c)<c||g>u||(y.a6K(4),n.moveTo(y.F6K(p,2),g),y.X6K(3),n.lineTo(y.F6K(2,p),g),r[v]=g))}return this.canvasColor("stx_scatter_chart"),e.color&&(n.strokeStyle=e.color),n.stroke(),n.closePath(),f={colors:[n.strokeStyle],cache:r},this.endClip(),n.lineWidth=1,f},t},p0yy.Y38=function(){return"function"==typeof p0yy.k38.v7E?p0yy.k38.v7E.apply(p0yy.k38,arguments):p0yy.k38.v7E},p0yy.q4h=function(){return"function"==typeof p0yy.k1h.t1r?p0yy.k1h.t1r.apply(p0yy.k1h,arguments):p0yy.k1h.t1r},p0yy.q38=function(){return"function"==typeof p0yy.k38.w7E?p0yy.k38.w7E.apply(p0yy.k38,arguments):p0yy.k38.w7E},p0yy.n4h=function(){return"function"==typeof p0yy.k1h.v7E?p0yy.k1h.v7E.apply(p0yy.k1h,arguments):p0yy.k1h.v7E},p0yy.C38=function(){return"function"==typeof p0yy.k38.n1F?p0yy.k38.n1F.apply(p0yy.k38,arguments):p0yy.k38.n1F},p0yy.J4h=function(){return"function"==typeof p0yy.k1h.n1F?p0yy.k1h.n1F.apply(p0yy.k1h,arguments):p0yy.k1h.n1F},p0yy.z38=function(){return"function"==typeof p0yy.k38.w7E?p0yy.k38.w7E.apply(p0yy.k38,arguments):p0yy.k38.w7E},p0yy.a4h=function(){return"function"==typeof p0yy.k1h.t1r?p0yy.k1h.t1r.apply(p0yy.k1h,arguments):p0yy.k1h.t1r},p0yy.a38=function(){return"function"==typeof p0yy.k38.v7E?p0yy.k38.v7E.apply(p0yy.k38,arguments):p0yy.k38.v7E},p0yy.Y4h=function(){return"function"==typeof p0yy.k1h.v7E?p0yy.k1h.v7E.apply(p0yy.k1h,arguments):p0yy.k1h.v7E},p0yy.d38=function(){return"function"==typeof p0yy.k38.t1r?p0yy.k38.t1r.apply(p0yy.k38,arguments):p0yy.k38.t1r},p0yy.j4h=function(){return"function"==typeof p0yy.k1h.w7E?p0yy.k1h.w7E.apply(p0yy.k1h,arguments):p0yy.k1h.w7E},p0yy.k1h=(tJb=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},{R4F:function(t,e,i){for(var a=i,r=-4&e,n=0;n<r;n+=4){var s=255&t.charCodeAt(n)|(255&t.charCodeAt(n+1))<<8|(255&t.charCodeAt(n+2))<<16|(255&t.charCodeAt(n+3))<<24;s=tJb(s,3432918353),a=5*(a=(524287&(a^=s=tJb(s=(131071&s)<<15|s>>>17,461845907)))<<13|a>>>19)+3864292196|0}switch(s=0,e%4){case 3:s=(255&t.charCodeAt(r+2))<<16;case 2:s|=(255&t.charCodeAt(r+1))<<8;case 1:s|=255&t.charCodeAt(r),s=tJb(s,3432918353),a^=s=tJb(s=(131071&s)<<15|s>>>17,461845907)}return a^=e,a=tJb(a^=a>>>16,2246822507),a=tJb(a^=a>>>13,3266489909),a^=a>>>16}}),p0yy.n38=function(){return"function"==typeof p0yy.k38.x9g?p0yy.k38.x9g.apply(p0yy.k38,arguments):p0yy.k38.x9g},p0yy.s4h=function(){return"function"==typeof p0yy.k1h.Z1F?p0yy.k1h.Z1F.apply(p0yy.k1h,arguments):p0yy.k1h.Z1F},p0yy.y4h=function(){return"function"==typeof p0yy.k1h.x9g?p0yy.k1h.x9g.apply(p0yy.k1h,arguments):p0yy.k1h.x9g},p0yy.r4h=function(){return"function"==typeof p0yy.k1h.Z1F?p0yy.k1h.Z1F.apply(p0yy.k1h,arguments):p0yy.k1h.Z1F},p0yy.e38=function(){return"function"==typeof p0yy.k38.n1F?p0yy.k38.n1F.apply(p0yy.k38,arguments):p0yy.k38.n1F},p0yy.m38=function(){return"function"==typeof p0yy.k38.R4F?p0yy.k38.R4F.apply(p0yy.k38,arguments):p0yy.k38.R4F},p0yy.F4h=function(){return"function"==typeof p0yy.k1h.n1F?p0yy.k1h.n1F.apply(p0yy.k1h,arguments):p0yy.k1h.n1F},p0yy.T38=function(){return"function"==typeof p0yy.k38.x9g?p0yy.k38.x9g.apply(p0yy.k38,arguments):p0yy.k38.x9g},p0yy.P38=function(){return"function"==typeof p0yy.k38.R4F?p0yy.k38.R4F.apply(p0yy.k38,arguments):p0yy.k38.R4F},p0yy.O1h=function(){return"function"==typeof p0yy.k1h.R4F?p0yy.k1h.R4F.apply(p0yy.k1h,arguments):p0yy.k1h.R4F},p0yy.k38={w7E:function(){var t,e=arguments;switch(IJb){case 7:t=e[2]/e[1]%e[0];break;case 19:t=e[0]/e[2]+e[1]+e[3];break;case 14:t=(e[4]+e[0]+e[2]+e[3])/e[1];break;case 5:t=e[1]-e[3]+e[2]+e[0];break;case 9:t=(e[1]+e[0])/e[2];break;case 12:t=e[0]*e[2]-e[1];break;case 16:t=e[0]-e[1]-e[2];break;case 1:t=e[1]*e[0];break;case 0:t=e[1]-e[0];break;case 18:t=e[2]-e[0]*e[1];break;case 13:t=e[1]-e[3]-e[0]+e[2];break;case 17:t=e[2]+e[1]*e[0];break;case 11:t=e[0]+e[2]-e[3]-e[1];break;case 6:t=e[0]/e[1];break;case 8:t=e[0]/e[1]/e[3]+e[2]/e[4];break;case 10:t=e[1]+e[0]-e[2];break;case 4:t=e[1]-e[0]+e[2];break;case 2:t=e[0]+e[1];break;case 3:t=e[1]|e[0];break;case 15:t=(e[1]-e[2])*e[0]-e[3]}return t},v7E:function(t){IJb=t}},p0yy.Q1h=function(){return"function"==typeof p0yy.k1h.R4F?p0yy.k1h.R4F.apply(p0yy.k1h,arguments):p0yy.k1h.R4F},p0yy.t4h=function(){return"function"==typeof p0yy.k1h.x9g?p0yy.k1h.x9g.apply(p0yy.k1h,arguments):p0yy.k1h.x9g},p0yy.E38=function(){return"function"==typeof p0yy.k38.Z1F?p0yy.k38.Z1F.apply(p0yy.k38,arguments):p0yy.k38.Z1F},p0yy.m1h=function(){return"function"==typeof p0yy.k1h.w7E?p0yy.k1h.w7E.apply(p0yy.k1h,arguments):p0yy.k1h.w7E},p0yy.K38=function(){return"function"==typeof p0yy.k38.t1r?p0yy.k38.t1r.apply(p0yy.k38,arguments):p0yy.k38.t1r},p0yy.s38=function(){return"function"==typeof p0yy.k38.Z1F?p0yy.k38.Z1F.apply(p0yy.k38,arguments):p0yy.k38.Z1F},__aggregations_=function(t){var e,i;(e=t.CIQ).Renderer.Aggregations=function(t){var e;this.construct(t),e=this.params,this.highLowBars=this.barsHaveWidth=this.standaloneBars=!0,e.highlightable=!1,"_main_series"!=e.name&&("Aggregations are onl","y allowed on main s","eries.",console.warn("Aggregations are only allowed on main series."),e.invalid=!0)},i=2;for(var a=1;1291712372!==p0yy.Q1h(a.toString(),a.toString().length,12331);a++)e.Renderer.Aggregations.ciqInheritsFrom(e.Renderer.OHLC,!0),i+=2;return-257334702!==p0yy.Q1h(i.toString(),i.toString().length,96125)&&e.Renderer.Aggregations.ciqInheritsFrom(e.Renderer.OHLC,!0),e.Renderer.Aggregations.ciqInheritsFrom(e.Renderer.OHLC,!1),e.Renderer.Aggregations.requestNew=function(t,i){var a,r;a=null;for(var n=0;n<t.length;n++)switch("pan","df","k","a","g","i",r=t[n]){case"kagi":case"pandf":a=r;break;case"heikinashi":case"linebreak":case"rangebars":case"renko":a="candle";break;default:return null}return null===a?null:new e.Renderer["candle"==a?"OHLC":"Aggregations"]({params:e.extend(i,{type:a})})},e.Renderer.Aggregations.prototype.drawIndividualSeries=function(t,e){var i,a,r;i=2;for(var n=1;-2100264702!==p0yy.Q1h(n.toString(),n.toString().length,54489);n++){if(e.invalid)return;a=this.stx,r={colors:[]},i+=2}if(-667028438!==p0yy.O1h(i.toString(),i.toString().length,59739)){if(e.invalid)return;a=this.stx,r={colors:[]}}if(!e.invalid)return a=this.stx,r={colors:[]},"kagi"==e.type?(a.drawKagiSquareWave(t.panel,"stx_kagi_up","stx_kagi_down",e),r.colors.push(a.getCanvasColor("stx_kagi_up")),r.colors.push(a.getCanvasColor("stx_kagi_down"))):"pandf"==e.type&&("stx_pa","ndf_up",a.drawPointFigureChart(t.panel,"stx_pandf_up","X",e),r.colors.push(a.getCanvasColor("stx_pandf_up")),a.drawPointFigureChart(t.panel,"stx_pandf_down","O",e),r.colors.push(a.getCanvasColor("stx_pandf_down"))),r},e.ChartEngine.prototype.drawKagiSquareWave=function(t,i,a,r){var n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M=p0yy;n=t.chart,this.startClip(t.name),s=n.dataSegment,o=n.context,l=this.canvasStyle(i),h=this.canvasStyle(a),this.canvasColor(i),r.border_color_up&&(o.strokeStyle=r.border_color_up),c=o.strokeStyle,this.canvasColor(a),r.border_color_down&&(o.strokeStyle=r.border_color_down),u=o.strokeStyle,p=1,l.width&&parseInt(l.width,10)<=25&&(M.a38(0),p=Math.max(M.z38(0,"1"),e.stripPX(l.width))),d=1,h.width&&parseInt(h.width,10)<=25&&(d=Math.max(1,e.stripPX(h.width))),o.beginPath(),m=n.dataSet.length-n.scroll-1,g=t.yAxis,f=!0,y=2;for(var D=1;1962296405!==M.O1h(D.toString(),D.toString().length,63758);D++)v=null,null,y+=2;-1782556268!==M.O1h(y.toString(),y.toString().length,43833)&&(v=1,M.a38(1),M.z38(1,"1")),x=null,M.a38(0);var E=M.q38(15,16);b=t.left-.5*this.layout.candleWidth+this.micropixels-"1"*E;for(var A=0;A<=s.length;A++)if(b+=this.layout.candleWidth,C=s[A]){if(C.projection)break;x=C.kagiTrend,C.transform&&n.transformFunc&&(S=C.kagiPrevOpen,(C=C.transform).kagiPrevOpen=n.transformFunc(this,n,S)),w=C.cache,M.a38(2),((T=M.z38(m,A))<t.cacheLeft||T>t.cacheRight||!w.kagiOpen)&&(w.kagiOpen=g.semiLog?this.pixelFromTransformedValue(C.Open,t):(g.high-C.Open)*g.multiplier+g.top,w.kagiClose=g.semiLog?this.pixelFromTransformedValue(C.Close,t):(g.high-C.Close)*g.multiplier+g.top),v=g.semiLog?this.pixelFromTransformedValue(C.kagiPrevOpen,t):(g.high-C.kagiPrevOpen)*g.multiplier+g.top,w.kagiClose,f&&(o.moveTo(m>=0?t.left:Math.floor(b),w.kagiOpen),o.lineTo(Math.floor(b),w.kagiOpen),f=!1),-1!=x&&w.kagiClose<v&&v<w.kagiOpen?(o.lineTo(Math.floor(b),v),f||(o.stroke(),o.beginPath(),o.moveTo(Math.floor(b),v)),o.strokeStyle=c,o.lineWidth=p):1!=x&&w.kagiClose>v&&v>w.kagiOpen&&(o.lineTo(Math.floor(b),v),f||(o.stroke(),o.beginPath(),o.moveTo(Math.floor(b),v)),o.strokeStyle=u,o.lineWidth=d),o.lineTo(Math.floor(b),w.kagiClose),A+1<s.length&&o.lineTo(Math.floor(b+this.layout.candleWidth),w.kagiClose),f=!1}o.stroke(),this.endClip(),M.Y38(3),o.lineWidth=M.q38(0,"1")},e.ChartEngine.prototype.drawPointFigureChart=function(t,i,a,r){var n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k,F,_=p0yy;function P(t,e,i){var a,r;_.Y38(2),o.moveTo(_.z38(t,u),_.q38(c,i,x,_.a38(4))),_.Y38(0),o.lineTo(_.q38(p,e),_.q38(x,i,h,v,_.a38(5))),_.Y38(2),o.moveTo(_.z38(t,u),_.z38(x,i,h,v,_.Y38(5))),_.a38(1),a=-_.q38(1,"1139341423"),r=2;for(var n=1;1648168755!==_.O1h(n.toString(),n.toString().length,92664);n++)_.a38(0),o.lineTo(_.z38(p,e),_.q38(c,i,x,_.a38(4))),r+=2;_.O1h(r.toString(),r.toString().length,98095)!==a&&(_.Y38(6),o.lineTo(_.q38(e,p),_.q38(x,c,i,_.a38(7))))}n=t.chart,this.startClip(t.name),s=n.dataSegment,o=n.context,this.canvasColor(i),"X"==a&&r.border_color_up?o.strokeStyle=r.border_color_up:"O"==a&&r.border_color_down&&(o.strokeStyle=r.border_color_down),l=this.canvasStyle(i),h=parseInt(l.paddingTop,10),c=parseInt(l.paddingBottom,10),u=parseInt(l.paddingLeft,10),p=parseInt(l.paddingRight,10),l.width&&parseInt(l.width,10)<=25?o.lineWidth=Math.max(1,e.stripPX(l.width)):o.lineWidth=2,o.beginPath(),d=this.chart.state.aggregation.box,m=n.dataSet.length-n.scroll-1,g=t.yAxis,v=d*g.multiplier,_.a38(6),x=_.q38(v,2),b=this.layout.candleWidth,_.Y38(8);var L=_.q38(12,10,7,4,10);function O(t,e,i){_.Y38(9),o.moveTo(_.q38(e,t,2),_.z38(h,i,x,_.a38(10))),_.a38(2),o.bezierCurveTo(_.q38(e,p),_.q38(h,i,x,_.a38(10)),_.z38(e,p,_.Y38(2)),_.q38(i,x,v,c,_.Y38(11)),_.z38(e,t,2,_.Y38(9)),_.q38(i,x,v,c,_.Y38(11))),_.Y38(0),o.bezierCurveTo(_.q38(u,t),_.q38(i,x,v,c,_.Y38(11)),_.q38(u,t,_.a38(0)),_.q38(h,i,x,_.Y38(10)),_.z38(e,t,2,_.a38(9)),_.q38(h,i,x,_.a38(10)))}C=t.left-b+this.micropixels-L;for(var N=0;N<s.length;N++)if(C+=b,S=s[N]){if(S.projection)break;if(w=S.pfOpen,T=S.pfClose,M=S.pfTrend,D=S.pfStepBack,S.transform&&n.transformFunc&&(S=S.transform,w=n.transformFunc(this,n,w),T=n.transformFunc(this,n,T)),E=S.cache,_.a38(2),((A=_.q38(m,N))<t.cacheLeft||A>t.cacheRight||!E.pfOpen)&&(E.pfOpen=(g.high-w)*g.multiplier+g.top,E.pfClose=(g.high-T)*g.multiplier+g.top),k=Math.round(C),_.a38(2),F=Math.round(_.z38(C,b)),f=Math.abs(Math.round((T-w)/d)),y=E.pfOpen,a==D&&("X"==D?(_.Y38(0),P(k,F,_.z38(v,y))):"O"==D&&(_.a38(2),O(k,F,_.q38(y,v)))),a==M)for(;f>=0;f--)"X"==a?(P(k,F,y),y-=v):"O"==a&&(O(k,F,y),y+=v)}o.stroke(),this.endClip(),o.lineWidth=1},e.calculateHeikinAshi=function(t,e,i){var a,r,n,s,o,l,h,c,u,p,d,m,g,f=p0yy;if(!e.length)return e;f.Y38(1),a=-f.q38(1,"289734474"),r=2;for(var y=1;-1611509335!==f.O1h(y.toString(),y.toString().length,6344);y++)i||(i=[]),n=[],r+=2;f.Q1h(r.toString(),r.toString().length,87652)!==a&&(-i&&(i=[]),n=[]);for(var v=0;v<e.length;v++)if(s=e[v]){f.a38(12);var x=f.z38(8,135,17);if(!(o=n[n.length-x])&&!v){f.Y38(0);var b=f.q38(18,19);o=i[i.length-b]}o||(o=s),l=s.Close,h=(h=s.Open)||0===h?h:l,c=(c=s.High)||0===c?c:l,u=(u=s.Low)||0===u?u:l,p=(p=o.Open)||0===p?p:o.Close,f.Y38(13);var C=f.q38(10,20,5,13);for(var S in d=(p+o.Close)/C,f.a38(14),m=f.q38(c,4,u,l,h),g={DT:s.DT,displayDate:s.displayDate,Date:s.Date,Open:d,Close:m,High:Math.max(c,Math.max(d,m)),Low:Math.min(u,Math.min(d,m)),Volume:s.Volume,iqPrevClose:o.Close},s)g[S]||0===g[S]||(g[S]=s[S]);n.push(g)}return n},e.calculateKagi=function(t,i,a,r){var n,s,o,l,h,c,u,p=p0yy;if(!i.length)return i;r||(r=[]),n=t.layout,a=parseFloat(a),t.chart.defaultChartStyleConfig.kagi=e.ChartEngine.isDailyInterval(n.interval)?4:.4,(isNaN(a)||a<=0)&&(a=t.chart.defaultChartStyleConfig.kagi,e.Market.Symbology.isForexSymbol(t.chart.symbol)&&(a/=4),null!==n.kagi&&(n.kagi=null,t.changeOccurred("layout"))),a/=100,s=[],l=(o=r[r.length-1])?o.DT:0;for(var d=0;d<i.length;d++)if((h=i[d])&&(o||(p.Y38(0),o=i[p.q38(1,d)]),o)){if((c=o.Open||0===o.Open?o.Open:o.Close)>o.Close){if(h.Close>o.Close*(1+a))h.Open=o.Close;else if(o.Close>h.Close&&(o.Close=h.Close),o.Volume+=h.Volume,d<i.length-1)continue}else if(c<o.Close){if(h.Close<o.Close*(1-a))h.Open=o.Close;else if(o.Close<h.Close&&(o.Close=h.Close),o.Volume+=h.Volume,d<i.length-1)continue}else if(o.Close=h.Close,o.Volume+=h.Volume,d<i.length-1)continue;for(var m in u={DT:o.DT,displayDate:o.displayDate,Date:o.Date,Open:o.Open,Close:o.Close,High:Math.max(o.Open,o.Close),Low:Math.min(o.Open,o.Close),Volume:o.Volume,iqPrevClose:o.iqPrevClose},o)u[m]||0===u[m]||(u[m]=o[m]);s.length?u.kagiPrevOpen=s[s.length-1].Open:u.kagiPrevOpen=u.Open,u.Close>u.kagiPrevOpen&&u.kagiPrevOpen>u.Open?(p.Y38(3),u.kagiTrend=p.z38(0,"1")):u.Close<u.kagiPrevOpen&&u.kagiPrevOpen<u.Open&&(u.kagiTrend=-1),l<u.DT&&s.push(u),o=h,t.chart.currentQuote={Close:h.Close}}return s},e.calculateLineBreak=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b=p0yy;if(!e.length)return e;if(a||(a=[]),r=t.layout,t.chart.defaultChartStyleConfig.priceLines=3,i=parseInt(i,10),isNaN(i)||i<=0){1330112544,-273975937,b.Y38(3),n=b.z38(0,"2");for(var C=1;1330112544!==b.O1h(C.toString(),C.toString().length,9880);C++)i=t.chart.defaultChartStyleConfig.priceLines,n+=2;if(-273975937!==b.O1h(n.toString(),n.toString().length,69513)&&(i=t.chart.defaultChartStyleConfig.priceLines),i=t.chart.defaultChartStyleConfig.priceLines,null!==r.priceLines){r.priceLines=null,-975137499,609183640,s=2;for(var S=1;-975137499!==b.Q1h(S.toString(),S.toString().length,74161);S++)t.changeOccurred(""),s+=2;609183640!==b.Q1h(s.toString(),s.toString().length,68321)&&t.changeOccurred("layout")}}else i>10&&(r.priceLines=i=10);l=(o=a.slice(-i)).length,b.a38(1),h=b.q38(1,"2");for(var w=1;-2126118113!==b.Q1h(w.toString(),w.toString().length,39880);w++)c=0,h+=2;-1378868181!==b.O1h(h.toString(),h.toString().length,81543)&&(c=1);t:for(var T=0;T<e.length;T++)if(u=e[T]){c+=u.Volume,b.Y38(15);var M=b.q38(20,16,8,159);if((p=o[o.length-M])||(p={Open:u.Open,Close:u.Open,High:u.Open,Low:u.Open}),d=p.Close,m=(m=p.High)||0===m?m:d,g=(g=p.Low)||0===g?g:d,f=(f=p.Open)||0===f?f:d,y={DT:u.DT,displayDate:u.displayDate,Date:u.Date,Close:u.Close,Volume:c,iqPrevClose:d},t.chart.currentQuote={Close:u.Close},u.Close>d&&p.Close>f);else if(u.Close<d&&p.Close<f);else if(u.Close>m){for(v=2;v<=i;v++)if((x=o[o.length-v])&&u.Close<=x.High)continue t}else{if(!(u.Close<g))continue;for(v=2;v<=i;v++)if((x=o[o.length-v])&&u.Close>=x.Low)continue t}for(var D in u.Close<p.Close?y.Open=Math.min(f,d):y.Open=Math.max(f,d),y.Low=Math.min(y.Open,y.Close),y.High=Math.max(y.Open,y.Close),u)y[D]||0===y[D]||(y[D]=u[D]);o.push(y),c=0}return o.slice(l)},e.calculateRenkoBars=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S=p0yy;if(!e.length)return[];a||(a=[]),r=2;for(var w=1;-1954869095!==S.Q1h(w.toString(),w.toString().length,96322);w++){n=t.layout,-(s=t.chart.state.aggregation)&&(s=t.chart.state.aggregation={}),o=Math.min(308,e.length),+s.minMax&&(s.minMax=t.determineMinMax(e.slice(e.length/o),["Close","Close","Low"])),S.a38(4);var T=S.q38(17,20,6);S.a38(16);var M=S.q38(28,13,7);l=s.minMax[T]/s.minMax[M],r+=2}if(-1261430101!==S.O1h(r.toString(),r.toString().length,35332)&&("C","l","o","se",n=t.layout,(s=t.chart.state.aggregation)||(s=t.chart.state.aggregation={}),o=Math.min(300,e.length),s.minMax||(s.minMax=t.determineMinMax(e.slice(e.length-o),["Close","High","Low"])),l=s.minMax[1]-s.minMax[0]),!(h=t.panels[t.chart.name].height))return[];S.a38(0);var D=S.q38(17,47);S.a38(0);var E=S.q38(18,10018);if(t.chart.defaultChartStyleConfig.renko=Math.floor(1e4*l/(h/D))/E,null===i||isNaN(i)||i<=0){1841296832,1572669477,c=2;for(var A=1;1841296832!==S.O1h(A.toString(),A.toString().length,95577);A++)i=t.chart.defaultChartStyleConfig.renko,c+=2;if(1572669477!==S.O1h(c.toString(),c.toString().length,42775)&&(i=t.chart.defaultChartStyleConfig.renko),null!==n.renko){n.renko=null,786847743,-687869190,S.Y38(0),u=S.z38(0,"2");for(var k=1;786847743!==S.O1h(k.toString(),k.toString().length,27878);k++)"l","ayou","t",t.changeOccurred("layout"),u+=2;-687869190!==S.O1h(u.toString(),u.toString().length,51005)&&t.changeOccurred("")}}else if(S.a38(6),i=Math.max(i,S.z38(l,h)),n.renko!==i){922887366,191160893,p=2;for(var F=1;922887366!==S.O1h(F.toString(),F.toString().length,46711);F++)n.renko=i,p+=2;191160893!==S.Q1h(p.toString(),p.toString().length,41512)&&(n.renko=i),t.changeOccurred("layout")}function _(t,e){var i,a,r;S.a38(0),i=-S.z38(0,"943332156"),a=2;for(var n=1;S.Q1h(n.toString(),n.toString().length,62051)!==i;n++)r={DT:f.DT,displayDate:f.displayDate,Date:f.Date,Open:t,Close:e,High:Math.max(t,e),Low:Math.min(t,e),Volume:7,iqPrevClose:t===e?t:1},a+=2;for(var s in-1558206444!==S.Q1h(a.toString(),a.toString().length,91982)&&(r={DT:f.DT,displayDate:f.displayDate,Date:f.Date,Open:t,Close:e,High:Math.max(t,e),Low:Math.min(t,e),Volume:0,iqPrevClose:t!=e?t:null}),f)r[s]||0===r[s]||(r[s]=f[s]);d.push(r)}d=[],m=null,g=null,f=null,a.length&&(m=(y=a[a.length-1]).Low-i,g=y.High+i);for(var P=0;P<e.length;P++)if(v=e[P]){for(m||g||(x=v.Open||0===v.Open?v.Open:v.Close,b=Math.floor(x/i)*i,C=isNaN(b)?x:b,S.Y38(0),m=S.z38(i,C),S.Y38(2),g=S.z38(C,i));;)if(f||(f=v),v.Close<=m)S.Y38(2),_(S.q38(m,i),m),S.a38(17),g=S.z38(i,2,m),m-=i,f=null;else{if(!(v.Close>=g))break;S.a38(0),_(S.z38(i,g),g),S.a38(18),m=S.q38(2,i,g),g+=i,f=null}t.chart.currentQuote=v}return m<e[e.length-1].Close&&m+i>e[e.length-1].Close?(S.a38(2),_(S.z38(m,i),e[e.length-1].Close)):g>e[e.length-1].Close&&g-i<e[e.length-1].Close&&(S.Y38(0),_(S.z38(i,g),e[e.length-1].Close)),d},e.calculateRangeBars=function(t,e,i,a){var r,n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D=p0yy;if("H","igh","C","los","e",!e.length)return e;function E(t){var e;for(var i in e={DT:f.DT,displayDate:f.displayDate,Date:f.Date,Open:g,Close:t,High:d,Low:m,Volume:0,iqPrevClose:g},f)e[i]||0===e[i]||(e[i]=f[i]);u.push(e)}a||(a=[]),r=t.layout,(n=t.chart.state.aggregation)||(n=t.chart.state.aggregation={}),s=Math.min(300,e.length),n.minMax||(n.minMax=t.determineMinMax(e.slice(e.length-s),["Close","High","Low"])),D.a38(0);var A=D.q38(11,12);if(o=n.minMax[A]-n.minMax[0],!(l=t.panels[t.chart.name].height))return[];D.a38(19);var k=D.z38(2500,9741,10,9);if(t.chart.defaultChartStyleConfig.range=Math.floor(1e4*o/(l/30))/k,null===i||isNaN(i)||i<0){if(i=t.chart.defaultChartStyleConfig.range,null!==r.range){-405965110,1019864967,h=2;for(var F=1;-405965110!==D.Q1h(F.toString(),F.toString().length,87984);F++)r.range=null,t.changeOccurred("layout"),h+=2;1019864967!==D.Q1h(h.toString(),h.toString().length,96358)&&(r.range=1,t.changeOccurred(""))}}else if(D.Y38(6),i=Math.max(i,D.q38(o,l)),r.range!==i){r.range=i,790082397,311964639,c=2;for(var _=1;790082397!==D.Q1h(_.toString(),_.toString().length,4264);_++)t.changeOccurred("layout"),c+=2;311964639!==D.O1h(c.toString(),c.toString().length,54636)&&t.changeOccurred("")}u=[],p=null,d=null,m=null,g=null,f=null;for(var P=0;P<e.length;P++)if(y=e[P]){if(D.Y38(0),v=e[D.q38(1,P)],!P){if(!v){D.a38(0);var L=D.z38(9,10);v=a[a.length-L]}v&&((p=v.Close)||0===p)&&N()}v&&(x=y.Close,b=y.Open,C=y.High,S=y.Low,(x||0===x)&&(b=b||0===b?b:x,C=C||0===C?C:x,S=S||0===S?S:x,p||0===p||(w=Math.floor(b/i)*i,p=isNaN(w)?b:w,N(),O(v,b)),P&&O(y,b),C-b<b-S?(C&&O(y,C),S&&O(y,S)):(S&&O(y,S),C&&O(y,C)),O(y,x),P==e.length-1&&x!=g&&(T=d,D.Y38(2),d=D.z38(m,i),D.Y38(0),m=D.q38(i,T),E(x))))}function O(t,e){for(;;){if(f||(f=t),p<e){if(p=Math.min(e,d),D.Y38(0),m=Math.max(m,D.z38(i,p)),e<d)break}else if(p>=e&&(p=Math.max(e,m),D.Y38(2),d=Math.min(d,D.z38(p,i)),e>m))break;if(void 0===p)return"Uh oh u","ndefined in calculateRangeBars:processMov","e",void console.log("Uh oh undefined in calculateRangeBars:processMove");E(p),f=null,N()}}function N(){var t;D.a38(2),d=D.z38(p,i),D.Y38(0),m=D.z38(i,p),t=2;for(var e=1;1086796006!==D.Q1h(e.toString(),e.toString().length,654);e++)g=p,t+=2;382716918!==D.O1h(t.toString(),t.toString().length,51445)&&(g=p)}M=2;for(var I=1;-785562714!==D.Q1h(I.toString(),I.toString().length,13172);I++)return u;return-714222347!==D.O1h(M.toString(),M.toString().length,20394)?u:void 0},e.calculatePointFigure=function(t,i,a,r){var n,s,o,l,h,c,u,p,d,m,g,f,y,v,x,b,C,S,w,T,M,D,E,A,k=p0yy;if(!i.length)return i;function F(t,e){for(var i in t)e[i]||0===e[i]||(e[i]=t[i]);return e}function _(t,e,i,a,r){var n;t.High=Math.max(e,t.High),n=2;for(var s=1;-1124561052!==k.O1h(s.toString(),s.toString().length,46342);s++)t.Low=Math.min(i,t.Low),t.Close=a,k.Y38(3),n+=k.z38(0,"2");2107841804!==k.Q1h(n.toString(),n.toString().length,63286)&&(t.Low=Math.min(i,t.Low),t.Close=a),t.Volume+=r}if(r||(r=[]),(n=t.chart.state.aggregation)||(n=t.chart.state.aggregation={}),s=t.layout,t.chart.defaultChartStyleConfig.box=1,t.chart.defaultChartStyleConfig.reversal=3,a||(a={}),!(o=a.box)){if(s.pandf&&null!==s.pandf.box){s.pandf.box=null,1532172453,969606171,l=2;for(var P=1;1532172453!==k.O1h(P.toString(),P.toString().length,33859);P++)t.changeOccurred("layout"),l+=2;969606171!==k.O1h(l.toString(),l.toString().length,20803)&&t.changeOccurred("")}if(o=t.chart.defaultChartStyleConfig.box,(h=i[i.length-1].Close)&&(h<.25?o=.0625:h<1?(k.a38(1),o=k.q38(1,"0.125")):h<5?(k.Y38(1),o=k.q38(1,"0.25")):h<20?o=.5:h<100?o=1:h<200?(k.Y38(3),o=k.q38(0,"2")):o=h<500?4:h<1e3?5:h<25e3?50:500),e.ChartEngine.isDailyInterval(s.interval)||(o/=10),e.Market.Symbology.isForexSymbol(t.chart.symbol)){if(h){k.a38(1),c=k.z38(1,"369013520"),k.a38(1),u=-k.q38(1,"1453144062"),p=2;for(var L=1;k.Q1h(L.toString(),L.toString().length,46306)!==c;L++)h<1?o=.001:h<2?o=.002:h<50?o=.02:h<200&&(k.Y38(0),o=k.q38(0,"0.2")),p+=2;k.O1h(p.toString(),p.toString().length,52581)!==u&&(h>=6?o=55695:h>=3?o=12642:h>28?o=4804:h<=221&&(o=459))}e.ChartEngine.isDailyInterval(s.interval)&&(o*=10)}t.chart.defaultChartStyleConfig.box=o}if(o=parseFloat(o),isNaN(o)||o<=0){if(s.pandf&&null!==s.pandf.box){-770840834,1352304342,d=2;for(var O=1;-770840834!==k.O1h(O.toString(),O.toString().length,43171);O++)k.a38(3),s.pandf.box=k.q38(0,"1"),t.changeOccurred(""),d+=2;1352304342!==k.Q1h(d.toString(),d.toString().length,4568)&&(s.pandf.box=null,t.changeOccurred("layout"))}t.chart.defaultChartStyleConfig.box=o=1}(m=Math.ceil(parseFloat(a.reversal)))>0&&m>a.reversal?(s.pandf.reversal=m,t.changeOccurred("layout")):(isNaN(m)||m<=0)&&(s.pandf&&null!==s.pandf.reversal&&("layo","u","t",s.pandf.reversal=null,t.changeOccurred("layout")),m=t.chart.defaultChartStyleConfig.reversal),n.box=o,g=2;for(var N=1;-1499254906!==k.Q1h(N.toString(),N.toString().length,64847);N++)m+=o,f=4986667691,k.Y38(3),g+=k.z38(0,"2");function I(t,e,i,a,r,n,s,o,l){return{DT:t.DT,Date:t.Date,pfOpen:o,pfClose:l,Open:e,Close:r,High:i,Low:a,Volume:n,iqPrevClose:s}}1332265442!==k.O1h(g.toString(),g.toString().length,23618)&&(m*=o,f=1e-8),y=(o.toString()+".").split(".")[1].length,v=[],x=0;for(var R=0;R<i.length;R++)if(C=i[R])if(x+=C.Volume,w=C.Close,T=(T=C.Open)||0===T?T:w,M=(M=C.High)||0===M?M:w,D=(D=C.Low)||0===D?D:w,v.length||r.length){k.Y38(0);var z=k.z38(9,10);(S=v[v.length-z])||(S=e.clone(r[r.length-1])),"O"==S.pfTrend?(D<=S.pfClose-o?(S.pfClose=Number((Math.ceil(D/o-f)*o).toFixed(y)),"O"==S.pfStepBack&&(S.pfStepBack=null),_(S,M,D,w,x)):M>=S.pfClose+m?(E=S.pfClose+o,A=Number((Math.floor(M/o+f)*o).toFixed(y)),b=I(C,T,M,D,w,x,S.pfClose,E,A),E==A&&(b.pfStepBack="X"),"O"==S.pfStepBack?(S.pfOpen=E,S.pfClose=A,S.pfTrend="X",_(S,M,D,w,x)):((b=F(C,b)).pfTrend="X",v.push(b))):_(S,M,D,w,x),x=0):"X"==S.pfTrend&&(M>=S.pfClose+o?(S.pfClose=Number((Math.floor(M/o+f)*o).toFixed(y)),"X"!=S.pfStepBack&&"-"!=S.pfStepBack||(S.pfStepBack=null),_(S,M,D,w,x)):D<=S.pfClose-m?(E=S.pfClose-o,A=Number((Math.ceil(D/o-f)*o).toFixed(y)),b=I(C,T,M,D,w,x,S.pfClose,E,A),E==A&&(b.pfStepBack="O"),"X"==S.pfStepBack||"-"==S.pfStepBack?(S.pfOpen=E,S.pfClose=A,S.pfTrend="O",_(S,M,D,w,x),E!=A&&"-"==S.pfStepBack&&(S.pfStepBack=null)):((b=F(C,b)).pfTrend="O",v.push(b))):_(S,M,D,w,x),x=0)}else(b=F(C,I(C,T,M,D,w,x,M+o,Number((Math.ceil(D/o-f)*o).toFixed(y)),Number((Math.floor(M/o+f)*o).toFixed(y))))).pfTrend="X",b.pfOpen==b.pfClose&&(b.pfStepBack="-"),v.push(b),k.Y38(3),x=k.q38(0,"0");return v},t},_exports=_exports||{},__utility_(_exports),__timezone_(_exports),__core_(_exports,_exports),__market_(_exports),__engine_(_exports,_exports,_exports,_exports),__microkernel_(_exports),__span_(_exports),__quoteFeed_(_exports),__studies_(_exports),__drawing_(_exports),__i18n_(_exports),__customCharts_(_exports),__markers_(_exports),__aggregations_(_exports),__drawingAdvanced_(_exports),__equations_(_exports),__renderersAdvanced_(_exports),__studiesAdvanced_(_exports),__share_(_exports),__polyfills_(_exports),_exports});